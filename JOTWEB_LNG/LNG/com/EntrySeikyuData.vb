Option Strict On
Imports MySQL.Data.MySqlClient

#Region "パラメタ群"
''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求ヘッダーデータ 検索用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_PRIMALKEY
    SP_ISSUETYPE            '発行種別
    SP_KEIJOYM              '請求年月(必須)
    SP_INVOICENUMBER        '請求番号
    SP_INVOICEORGCODE       '請求担当部店コード
    SP_TORICODE             '請求取引先コード
    SP_SCHEDATEPAYMENT      '入金予定日
    SP_INVOICETYPE          '請求書種類
    SP_INVSUBCD             '細分コード
    SP_DELFLG               '削除フラグ
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>コンテナ清算ファイル 検索用</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_RESSNF_KEY
    SL_KEIJOYM              '計上年月
    SL_TORICODE             '取引先コード
    SL_KEIJYOBRANCHCD       '請求担当部店コード
    SL_DEPOSITYMD           '入金年月日
    'SL_DEPOSITMONTHKBN      '入金月区分
    'SL_CLOSINGDAY           '締日
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求明細データ 検索用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_DETAIL_KEY
    SL_KEIJOYM              '請求年月
    SL_INVOICENUMBER        '請求番号
    SL_INVOICEORGCODE       '請求担当部店コード
    SL_TORICODE             '請求取引先コード
    SL_INVOICETYPE          '請求書種類
    SL_INVSUBCD             '細分コード
    SL_OUTINVTYPE           '出力先請求書区分
    SL_DELFLG               '削除フラグ
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求追加金額明細データ 検索用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_ADDAMOUNT_KEY
    SL_KEIJOYM              '請求年月
    SL_INVOICENUMBER        '請求番号
    SL_INVOICEORGCODE       '請求担当部店コード
    SL_TORICODE             '請求取引先コード
    SL_INVKEIJYOBRANCHCD    '計上支店コード
    SL_SCHEDATEPAYMENT      '入金予定日
    SL_AMOUNTTYPE           '金額種類
    SL_INVOICETYPE          '請求書種類
    SL_ACCOUNTCODE          '科目コード
    SL_SEGMENTCODE          'セグメント
    SL_BEFINVOICETYPE       '変更前請求書種類
    SL_DELFLG               '削除フラグ
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求追加金額明細データ 検索用</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_ADDAMOUNT_KEY2
    SL_KEIJOYM              '請求年月
    SL_INVOICENUMBER        '請求番号
    SL_INVOICEORGCODE       '請求担当部店コード
    SL_TORICODE             '請求取引先コード
    SL_SCHEDATEPAYMENT      '入金予定日
    SL_DELFLG               '削除フラグ
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求書連携用</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_INVOICE_COOP
    SL_CORPCD               '会社コード
    SL_KEIJOYM              '計上年月
    SL_TORICODE             '取引先コード
    SL_KEIJYOBRANCHCD       '請求担当部店コード
    SL_DEPOSITYMD           '入金年月日
    SL_INVSUBCD             '細分コード
    SL_SUM_USEFEE           '合計使用料
    SL_SUM_USEFEE_DTL       '合計使用料税額
    SL_SEQ                  'SEQ
    SL_LOGIN_USER           'ログインユーザーID
    SL_LOGIN_ORG            'ログイン組織コード
    SL_ZEIRITU              '税率
    SL_TAXCALCULATION       '税計算区分
    SL_INVOICENUMBER        '請求番号
    SL_NOW                  '処理日
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求ヘッダーヘーダ 登録用</description></item>
''' </list>
''' </remarks>
Public Enum SEIKYU_INSTPARAM
    IP_KEIJOYM              '請求年月
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '取引先コード
    IP_INVOICETYPE          '請求書種類
    IP_SCHEDATEPAYMENT      '入金予定日
    IP_INVSUBCD             '細分コード
    IP_INACCOUNTCD          '社内口座コード
    IP_ACCOUNTINGMONTH      '計上月区分
    IP_CLOSINGDAY           '計上締日
    IP_DEPOSITDAY           '入金日
    IP_DEPOSITMONTHKBN      '入金月区分
    IP_SLIPDESCRIPTION1     '伝票摘要１
    IP_SLIPDESCRIPTION2     '伝票摘要２
    IP_RENTALQTY            'レンタル個数
    IP_RENTALTOTAL          'レンタル使用料合計
    IP_RENTALCTAX           'レンタル使用料消費税
    IP_LEASEQTY             'リース個数
    IP_LEASETOTAL           'リース料合計
    IP_LEASECTAX            'リース料消費税
    IP_WRITEQTY             '手書き個数
    IP_WRITETOTAL           '手書き合計
    IP_WRITECTAX            '手書き消費税
    IP_CTNQTY               '売却在庫個数
    IP_CTNTOTAL             '売却在庫合計
    IP_CTNCTAX              '売却在庫消費税
    IP_INVOICEOUTKBN        '請求出力区分
    IP_INVOICELINK          '請求連携状態
    IP_ACNTLINK             '経理連携状態
    IP_REQUESTSTATUS        '申請状態
    IP_RQSTAFF              '担当者
    IP_RQDATE               '担当処理日時
    IP_RQACKNOWLEDGER       '確認者
    IP_RQACKNDATE           '確認処理日時
    IP_PRINTDATE            '印字発行日
    IP_DETAILKBN            '明細有無区分
    IP_HEADERCOMMENT        '請求ヘッダーコメント
    IP_FOOTERCOMMENT        '請求フッターコメント
    IP_REMARKS              '備考
    IP_UPDATEFLG            '変更有りフラグ
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
    IP_RECEIVEYMD           '集信日時
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求ヘッダーデータ 更新用(収入管理(詳細))</description></item>
''' </list>
''' </remarks>
Public Enum SEIKYU_UPDDTLPARAM
    DP_KEIJOYM              '請求年月
    DP_INVOICENUMBER        '請求番号
    DP_INVOICEORGCODE       '請求担当部店コード
    DP_TORICODE             '取引先コード
    DP_INVOICETYPE          '請求書種類
    DP_SCHEDATEPAYMENT      '入金予定日
    DP_INVSUBCD             '細分コード
    DP_RENTALQTY            'レンタル個数
    DP_RENTALTOTAL          'レンタル使用料合計
    DP_RENTALCTAX           'レンタル使用料消費税
    DP_LEASEQTY             'リース個数
    DP_LEASETOTAL           'リース料合計
    DP_LEASECTAX            'リース料消費税
    DP_WRITEQTY             '手書き個数
    DP_WRITETOTAL           '手書き合計
    DP_WRITECTAX            '手書き消費税
    DP_CTNQTY               '売却在庫個数
    DP_CTNTOTAL             '売却在庫合計
    DP_CTNCTAX              '売却在庫消費税
    DP_REQUESTSTATUS        '請求申請状態
    DP_RQSTAFF              '担当ユーザーID
    DP_RQDATE               '担当処理日時
    DP_RQACKNOWLEDGER       '確認ユーザーID
    DP_RQACKNDATE           '確認処理日時
    DP_PRINTDATE            '印字発行日
    DP_DETAILKBN            '明細有無区分
    DP_HEADERCOMMENT        '請求ヘッダーコメント
    DP_FOOTERCOMMENT        '請求フッターコメント
    DP_DELFLG               '削除フラグ
    DP_UPDYMD               '更新年月日
    DP_UPDUSER              '更新ユーザーID
    DP_UPDTERMID            '更新端末
    DP_RECEIVEYMD           '集信日時
    DP_MONEYFLG             '金額更新フラグ
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求使用料明細データ 登録用</description></item>
''' </list>
''' </remarks>
Public Enum RENTAL_INSTPARAM
    IP_KEIJOYM              '請求年月
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '請求取引先コード
    IP_INVOICETYPE          '請求書種類
    IP_INVSUBCD             '細分コード
    IP_SHIPYMD              '発送年月日
    IP_CTNTYPE              'コンテナ記号
    IP_CTNNO                'コンテナ番号
    IP_SAMEDAYCNT           '同日内回数
    IP_CTNLINENO            '行番
    IP_JOTDEPBRANCHCD       'JOT発組織コード
    IP_DEPSTATION           '発駅コード
    IP_DEPTRUSTEECD         '発受託人コード
    IP_DEPTRUSTEESUBCD      '発受託人サブ
    IP_JOTARRBRANCHCD       'JOT着組織コード
    IP_ARRSTATION           '着駅コード
    IP_ARRTRUSTEECD         '着受託人コード
    IP_ARRTRUSTEESUBCD      '着受託人サブ
    IP_JRITEMCD             'JR品目コード
    IP_USEFEE               '使用料金額
    IP_OWNDISCOUNTFEE       '私有割引相当額
    IP_RETURNFARE           '割戻し運賃
    IP_NITTSUFREESEND       '通運負担回送運賃
    IP_MANAGEFEE            '運行管理料
    IP_SHIPBURDENFEE        '荷主負担運賃
    IP_SHIPFEE              '発送料
    IP_ARRIVEFEE            '到着料
    IP_PICKUPFEE            '集荷料
    IP_DELIVERYFEE          '配達料
    IP_OTHER1FEE            'その他１
    IP_OTHER2FEE            'その他２
    IP_FREESENDFEE          '回送運賃
    IP_TAXKBN               '税区分
    IP_TAXRATE              '税率
    IP_BILLINGFEE           '請求額
    IP_OUTINVTYPE           '出力先請求書区分
    IP_INVOICEEXCLUSIONFLAG '請求除外フラグ
    IP_REMARKS              '備考
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
    IP_RECEIVEYMD           '集信日時
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求リース明細データ 登録用</description></item>
''' </list>
''' </remarks>
Public Enum LEASE_INSTPARAM
    IP_KEIJOYM              '請求年月
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '請求取引先コード
    IP_INVOICETYPE          '請求書種類
    IP_INVSUBCD             '細分コード
    IP_LEASENO              'リース登録番号
    IP_CTNTYPE              'コンテナ形式
    IP_CTNNO                'コンテナ番号
    IP_LEASEYM              'リース年月
    IP_CLOSINGDATE          '締年月日
    IP_LEASESTARTYMD        'リース開始日
    IP_LEASEENDYMD          'リース終了日
    IP_MONTHLEASEFEE        '月額リース料
    IP_TAXKBN               '税区分
    IP_ROUNDKBN             '日割端数処理区分
    IP_LEASEAPPLYKBN        'リース適用区分
    IP_CANCELYMD            '途中解約日
    IP_DAILYRATE            'リース額（日割）
    IP_DAILYRATEROUND       'リース額（日割）丸め前
    IP_LEASEMONTHSTARTYMD   '当月のリース期間 開始日
    IP_LEASEMONTHENDYMD     '当月のリース期間 終了日
    IP_OUTINVTYPE           '出力先請求書区分
    IP_INVOICEEXCLUSIONFLAG '請求除外フラグ
    IP_REMARKS              '備考
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
    IP_RECEIVEYMD           '集信日時
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求売却在庫明細データ 登録用</description></item>
''' </list>
''' </remarks>
Public Enum CTN_INSTPARAM
    IP_KEIJOYM
    IP_INVOICENUMBER
    IP_INVOICEORGCODE
    IP_TORICODE
    IP_INVOICETYPE
    IP_INVSUBCD
    IP_CTNTYPE
    IP_CTNNO
    IP_CONFIRMFLG
    IP_STOCKBRANCHCODE
    IP_BRANCHCODE
    IP_STATIONCODE
    IP_STOCKSTATUS
    IP_BEFMONTHBALANCE
    IP_BOOKVALUE
    IP_COSTOFGOODSSALES
    IP_FRACTIONAMOUNT
    IP_CURRENTMONTHPAYOUT
    IP_MONTHBALANCE
    IP_SALESAMOUNT
    IP_SALESAMOUNTTAXRATE
    IP_SALESAMOUNTTAXCODE
    IP_POSTAGE
    IP_POSTAGETAXRATE
    IP_POSTAGETAXCODE
    IP_CLEANINGFEE
    IP_CLEANINGFEETAXRATE
    IP_CLEANINGFEETAXCODE
    IP_MAINTENANCEFEE
    IP_MAINTENANCEFEETAXRATE
    IP_MAINTENANCEFEETAXCODE
    IP_OTHERFEE
    IP_OTHERFEETAXRATE
    IP_OTHERFEETAXCODE
    IP_TAXAMOUNT
    IP_TAXKBN
    IP_STOCKREGISTRATIONDATE
    IP_EXCEPTIONDATE
    IP_SALESCONTRACTDATE
    IP_DELIVERYLOCATION
    IP_INVKESAIKBN
    IP_SCHEDATEPAYMENT
    IP_INACCOUNTCD
    IP_ACCOUNTINGMONTH
    IP_CLOSINGDAY
    IP_DEPOSITDAY
    IP_DEPOSITMONTHKBN
    IP_ACC_DEBIT_ACCOUNT
    IP_ACC_DEBIT_ORGCD
    IP_ACC_DEBIT_SEGMENTCODE1
    IP_ACC_DEBIT_SEGMENTCODE2
    IP_ACC_DEBIT_SEGMENTCODE3
    IP_ACC_CREDIT_ACCOUNT
    IP_ACC_CREDIT_ORGCD
    IP_ACC_CREDIT_SEGMENTCODE1
    IP_ACC_CREDIT_SEGMENTCODE2
    IP_ACC_CREDIT_SEGMENTCODE3
    IP_STOCKREGISTRATID
    IP_STOCKUPDATEID
    IP_REQUESTID
    IP_REQUESTDATE
    IP_INVOICEEXCLUSIONFLAG
    IP_REMARKS
    IP_DISPOSALFLG
    IP_NOOPERATINGFLG
    IP_WFREQUESTFLG
    IP_DELFLG
    IP_INITYMD
    IP_INITUSER
    IP_INITTERMID
    IP_INITPGID
    IP_RECEIVEYMD
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求明細データ 削除用</description></item>
''' </list>
''' </remarks>
Public Enum DETALI_DELTPARAM
    DP_KEIJOYM              '請求年月
    DP_INVOICENUMBER        '請求番号
    DP_INVOICEORGCODE       '請求担当部店コード
    DP_TORICODE             '取引先コード
    DP_SCHEDATEPAYMENT      '入金予定日
    DP_INVOICETYPE          '請求書種類
    DP_DELFLG               '削除フラグ
    DP_UPDYMD               '更新年月日
    DP_UPDUSER              '更新ユーザーID
    DP_UPDTERMID            '更新端末
    DP_UPDPGID              '更新プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求発行履歴 登録用</description></item>
''' </list>
''' </remarks>
Public Enum INVOICELOG_PARM
    IP_KEIJOYM              '請求年月
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '請求取引先コード
    IP_INVOICETYPE          '請求書種類
    IP_INVSUBCD             '細分コード
    IP_REQUESTSTATUS        '請求申請状態
    IP_RQSTAFF              '担当ユーザID
    IP_RQDATE               '確認提出日
    IP_RQACKNOWLEDGER       '確認ユーザID
    IP_RQACKNDATE           '確認者確認日
    IP_SENDBACKDATE         '確認者差戻日
    IP_ISSUEDATE            '請求書発行日
    IP_INVOICECANCELER      '取消ユーザID
    IP_INVOICECANCELDATE    '取消日
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
    IP_UPDYMD               '更新年月日
    IP_UPDUSER              '更新ユーザーID
    IP_UPDTERMID            '更新端末
    IP_UPDPGID              '更新プログラムID
    IP_RECEIVEYMD           '集信日時
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求書連携　更新用</description></item>
''' </list>
''' </remarks>
Public Enum UPDATE_INVRENKEI_PARM
    DP_KEIJOYM              '計上年月
    DP_TORICODE             '取引先コード
    DP_KEIJYOBRANCHCD       '請求項目 計上店コード
    DP_DEPOSITYMD           '入金年月日
    DP_INVSUBCD             '細分コード 
    DP_UPDYMD               '更新年月日
    DP_UPDUSER              '更新ユーザーID
    DP_UPDTERMID            '更新端末
    DP_UPDPGID              '更新プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求明細データ 更新用</description></item>
''' </list>
''' </remarks>
Public Enum DETAIL_UPDPARAM
    DP_KEIJOYM              '請求年月
    DP_INVOICENUMBER_NEW    '請求番号(新)
    DP_INVOICENUMBER_OLD    '請求番号(旧)
    DP_INVOICEORGCODE       '請求担当部店コード
    DP_TORICODE             '請求取引先コード
    DP_INVOICETYPE          '請求書種類
    DP_SHIPYMD
    DP_CTNTYPE
    DP_CTNNO
    DP_SAMEDAYCNT
    DP_CTNLINENO
    DP_LEASENO
    DP_LEASESTARTYMD
    DP_OUTINVTYPE           '出力先請求書区分
    DP_REMARKS              '備考
    DP_DELFLG               '削除フラグ
    DP_UPDYMD               '更新年月日
    DP_UPDUSER              '更新ユーザーID
    DP_UPDTERMID            '更新端末
    DP_UPDPGID              '更新プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求追加金額明細データ 登録用</description></item>
''' </list>
''' </remarks>
Public Enum INSERT_ADDAMOUNT
    IP_KEIJOYM              '請求年月
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '取引先コード
    IP_INVKEIJYOBRANCHCD    '計上支店コード
    IP_AMOUNTTYPE           '金額種類
    IP_INVSUBCD             '細分コード
    IP_SEQNO                'SEQNO
    IP_INVOICETYPE          '請求書種類
    IP_SCHEDATEPAYMENT      '入金予定日
    IP_INACCOUNTCD          '社内口座コード
    IP_ACCOUNTINGMONTH      '計上月区分
    IP_CLOSINGDAY           '計上締日
    IP_DEPOSITDAY           '入金日
    IP_DEPOSITMONTHKBN      '入金月区分
    IP_SLIPDESCRIPTION1     '伝票摘要１
    IP_SLIPDESCRIPTION2     '伝票摘要２
    IP_RENTALINCENTIVE      'ボリュームインセンティブ
    IP_RENTADJUSTMENT       '加減額
    IP_RENTALATEFEE         '延滞料金
    IP_RENTSUBSCADJUST      'サブスク調整額
    IP_LEASEADJUSTMENT      'リース料加減額
    IP_SHIPYMD              '発送年月日
    IP_CTNTYPE              'コンテナ記号
    IP_CTNNO                'コンテナ番号
    IP_DEPSTATION           '発駅コード
    IP_DEPTRUSTEE           '発受託人コード
    IP_DEPTRUSTEESUB        '発受託人サブコード
    IP_ARRSTATION           '着駅コード
    IP_LEASESTARTYMD        '全体契約開始日
    IP_LEASEENDYMD          '全体契約終了日
    IP_MISCELLANEOUSEXPENSE '雑費
    IP_INPUTDATE            '日付
    IP_WRITEFEE             '手書き料
    IP_SPOTLEASEFEE         'スポットリース料
    IP_FIXEDFEE             '固定料金
    IP_ACCOUNTCODE          '科目コード
    IP_SEGMENTCODE          'セグメント
    IP_SEGMENTBRANCHCODE    'セグメント枝番
    IP_DETAILS              '明細内容
    IP_OUTINVTYPE           '出力先請求書区分
    IP_BEFOREINVOICETYPE    '変更前請求書種類
    IP_INVOICEEXCLUSIONFLAG '請求除外フラグ
    IP_INOUTSIDEKBN         '内外区分
    IP_TAXKBN               '税区分
    IP_TAXRATE              '税率
    IP_REMARKS              '備考
    IP_QUANTITY             '個数
    IP_UNITPRICE            '単価 2024/09/06 伊藤 ADD
    IP_UNIT                 '数量単位
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
    IP_UPDYMD               '更新年月日
    IP_UPDUSER              '更新ユーザーＩＤ
    IP_UPDTERMID            '更新端末
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求追加金額明細データ 更新用</description></item>
''' </list>
''' </remarks>
Public Enum UPDATE_ADDAMOUNT
    DP_KEIJOYM              '請求年月
    DP_INVOICENUMBER        '請求番号
    DP_INVOICEORGCODE       '請求担当部店コード
    DP_TORICODE             '取引先コード
    DP_INVKEIJYOBRANCHCD    '計上支店コード
    DP_AMOUNTTYPE           '金額種類
    DP_INVOICETYPE          '請求書種類
    DP_RENTALINCENTIVE      'ボリュームインセンティブ
    DP_RENTADJUSTMENT       '加減額
    DP_RENTALATEFEE         '延滞料金
    DP_RENTSUBSCADJUST      'サブスク調整額
    DP_LEASEADJUSTMENT      'リース料加減額
    DP_SHIPYMD              '発送年月日
    DP_CTNTYPE              'コンテナ記号
    DP_CTNNO                'コンテナ番号
    DP_DEPSTATION           '発駅コード
    DP_ARRSTATION           '着駅コード
    DP_LEASESTARTYMD        '全体契約開始日
    DP_LEASEENDYMD          '全体契約終了日
    DP_MISCELLANEOUSEXPENSE '雑費
    DP_ACCOUNTCODE          '科目コード
    DP_SEGMENTCODE          'セグメント
    DP_SEGMENTBRANCHCODE    'セグメント枝番
    DP_INOUTSIDEKBN         '内外区分
    DP_REMARKS              '備考
    DP_DELFLG               '削除フラグ
    DP_UPDYMD               '更新年月日
    DP_UPDUSER              '更新ユーザーID
    DP_UPDTERMID            '更新端末
    DP_UPDPGID              '更新プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求追加金額明細データ 更新用</description></item>
''' </list>
''' </remarks>
Public Enum UPDATE_ADDAMOUNT2
    DP_KEIJOYM              '請求年月
    DP_INVOICENUMBER_RENTAL '請求番号(レンタル)
    DP_INVOICENUMBER_LEASE  '請求番号(リース)
    DP_INVOICEORGCODE       '請求担当部店コード
    DP_TORICODE             '取引先コード
    DP_INVOICETYPE          '請求書種類
    DP_UPDYMD               '更新年月日
    DP_UPDUSER              '更新ユーザーID
    DP_UPDTERMID            '更新端末
    DP_UPDPGID              '更新プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求追加金額明細データ 削除用</description></item>
''' </list>
''' </remarks>
Public Enum DELETE_ADDAMOUNT
    DP_KEIJOYM              '請求年月
    DP_INVOICENUMBER        '請求番号
    DP_INVOICEORGCODE       '請求担当部店コード
    DP_TORICODE             '取引先コード
    DP_INVKEIJYOBRANCHCD    '計上支店コード
    DP_AMOUNTTYPE           '金額種類
    DP_SCHEDATEPAYMENT      '入金予定日
    DP_ACCOUNTCODE          '科目コード
    DP_SEGMENTCODE          'セグメント
    DP_INVOICETYPE          '請求書種類
    DP_BEFOREINVOICETYPE    '変更前請求書種類
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>ドラフト版請求書連携実績テーブル 登録用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum INSERT_DRAFTINVOICELOG
    IP_ISSUETYPE            '発行種別
    IP_KEIJOYM              '請求年月(必須)
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '請求取引先コード
    IP_SCHEDATEPAYMENT      '入金予定日
    IP_INVSUBCD             '細分コード
    IP_RENKEICOUNT          '連携回数
    IP_INVOICETYPE          '請求書種類
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>ドラフト版請求書連携実績テーブル 登録用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum UPDATE_DRAFTINVOICELOG
    IP_ISSUETYPE            '発行種別
    IP_KEIJOYM              '請求年月(必須)
    IP_INVOICENUMBER        '請求番号
    IP_INVOICEORGCODE       '請求担当部店コード
    IP_TORICODE             '請求取引先コード
    IP_SCHEDATEPAYMENT      '入金予定日
    IP_INVSUBCD             '細分コード
    IP_RENKEICOUNT          '連携回数
    IP_INVOICETYPE          '請求書種類
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>請求ヘッダーデータ 検索用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum SELECT_SEIKYU_KEY
    SP_INVOICENUMBER        '請求番号
    SP_USERID               'ユーザーID
    SP_SEQ                  'SEQ
End Enum

''' <summary>
''' パラメタ群
''' </summary>
''' <remarks>
''' <list type="number">
''' <item><description>仮請求番号採番テーブル 登録用(主キー)</description></item>
''' </list>
''' </remarks>
Public Enum INSERT_PROVINVOICENOSEQ
    IP_KEIJOYM              '請求年月(必須)
    IP_SEQ                  'SEQ
    IP_DELFLG               '削除フラグ
    IP_INITYMD              '登録年月日
    IP_INITUSER             '登録ユーザーID
    IP_INITTERMID           '登録端末
    IP_INITPGID             '登録プログラムID
End Enum
#End Region

''' <summary>
''' 請求ヘッダーデータ登録クラス
''' </summary>
''' <remarks>各種請求ヘッダーデータに登録する際はこちらに定義</remarks>
Public Class EntrySeikyuData

#Region "検索処理部"
    ''' <summary>
    ''' 新規用のORDERNOを取得する
    ''' </summary>
    ''' <param name="sqlCon"></param>
    ''' <param name="sqlTran"></param>
    ''' <remarks></remarks>
    Public Shared Function GetNewOrderNo(sqlCon As MySqlConnection, sqlTran As MySqlTransaction) As String
        Dim sqlText As New StringBuilder()
        Dim sqlParam As New Hashtable()
        Dim sqlRetSet As DataTable = Nothing
        Dim CS0050SESSION As New CS0050SESSION    'セッション情報操作処理
        Dim strOrderNo As String = ""

        With sqlText
            .AppendLine("SELECT")
            .AppendLine("     FORMAT(CURDATE(),'yyyyMMdd') + FORMAT(NEXT VALUE FOR LNG.seikyu_sequence,'00000') AS INVOICENO")
        End With

        'SQL実行
        CS0050SESSION.GetDataTable(sqlCon, sqlText.ToString, sqlParam, sqlRetSet, sqlTran)

        If sqlRetSet.Rows.Count > 0 Then
            strOrderNo = GetStringValue(sqlRetSet, 0, "INVOICENO")
        End If

        Return strOrderNo

    End Function

    ''' <summary>
    ''' 請求ヘッダーデータ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectInvoiceHead(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    A01.KEIJOYM")                                               '請求年月
        SQLBldr.AppendLine("    , A01.INVOICENUMBER")                                       '請求番号
        SQLBldr.AppendLine("    , A01.INVOICEORGCODE")                                      '請求担当部店コード
        SQLBldr.AppendLine("    , A01.TORICODE")                                            '請求取引先コード
        SQLBldr.AppendLine("    , A01.INVOICETYPE")                                         '請求書種類
        SQLBldr.AppendLine("    , A01.SCHEDATEPAYMENT")                                     '入金予定日
        SQLBldr.AppendLine("    , A01.INVSUBCD")                                            '細分コード
        SQLBldr.AppendLine("    , A01.INACCOUNTCD")                                         '社内口座コード
        SQLBldr.AppendLine("    , A01.ACCOUNTINGMONTH")                                     '計上月区分
        SQLBldr.AppendLine("    , A01.CLOSINGDAY")                                          '計上締日
        SQLBldr.AppendLine("    , A01.DEPOSITDAY")                                          '入金日
        SQLBldr.AppendLine("    , A01.DEPOSITMONTHKBN")                                     '入金月区分
        SQLBldr.AppendLine("    , A01.SLIPDESCRIPTION1")                                    '伝票摘要１
        SQLBldr.AppendLine("    , A01.SLIPDESCRIPTION2")                                    '伝票摘要２
        SQLBldr.AppendLine("    , coalesce(A01.RENTALQTY, 0) AS RENTALQTY")                   'レンタル個数
        SQLBldr.AppendLine("    , coalesce(A01.RENTALTOTAL, 0) AS RENTALTOTAL")               'レンタル使用料合計
        SQLBldr.AppendLine("    , coalesce(A01.RENTALCTAX, 0) AS RENTALCTAX")                 'レンタル使用料消費税
        SQLBldr.AppendLine("    , coalesce(A01.LEASEQTY, 0) AS LEASEQTY")                     'リース個数
        SQLBldr.AppendLine("    , coalesce(A01.LEASETOTAL, 0) AS LEASETOTAL")                 'リース料合計
        SQLBldr.AppendLine("    , coalesce(A01.LEASECTAX, 0) AS LEASECTAX")                   'リース料消費税
        SQLBldr.AppendLine("    , A01.INVOICEOUTKBN")                                       '請求出力区分
        SQLBldr.AppendLine("    , A01.INVOICELINK")                                         '請求連携状態
        SQLBldr.AppendLine("    , A01.ACNTLINK")                                            '経理連携状態
        SQLBldr.AppendLine("    , A01.REQUESTSTATUS")                                       '請求申請状態
        SQLBldr.AppendLine("    , A01.RQSTAFF")                                             '担当ユーザーID
        SQLBldr.AppendLine("    , A01.RQDATE")                                              '担当処理日時
        SQLBldr.AppendLine("    , A01.RQACKNOWLEDGER")                                      '確認ユーザーID
        SQLBldr.AppendLine("    , A01.RQACKNDATE")                                          '確認処理日時
        SQLBldr.AppendLine("    , A01.REMARKS")                                             '備考
        SQLBldr.AppendLine("    , A01.UPDATEFLG")                                           '変更有りフラグ
        SQLBldr.AppendLine("    , A01.DELFLG")                                              '削除フラグ
        SQLBldr.AppendLine("    , A01.INITYMD")                                             '登録年月日
        SQLBldr.AppendLine("    , A01.INITUSER")                                            '登録ユーザーID
        SQLBldr.AppendLine("    , A01.INITTERMID")                                          '登録端末
        SQLBldr.AppendLine("    , A01.INITPGID")                                            '登録プログラムID
        SQLBldr.AppendLine("    , A01.UPDYMD")                                              '更新年月日
        SQLBldr.AppendLine("    , A01.UPDUSER")                                             '更新ユーザーID
        SQLBldr.AppendLine("    , A01.UPDTERMID")                                           '更新端末
        SQLBldr.AppendLine("    , A01.RECEIVEYMD")                                          '集信日時
        SQLBldr.AppendLine("    , A01.UPDTIMSTP")                                           'タイムスタンプ
        SQLBldr.AppendLine("    , coalesce(A02.RESSNFAPPROVEDFLG, 0) AS RESSNFAPPROVEDFLG")   '精算ファイル承認フラグ
        SQLBldr.AppendLine("FROM")
        'メイン 請求ヘッダーデータ
        SQLBldr.AppendLine("    lng.LNT0064_INVOICEHEAD A01")
        'コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN")
        SQLBldr.AppendLine("        (")
        SQLBldr.AppendLine("         SELECT")
        SQLBldr.AppendLine("             A01.KEIJOYM AS KEIJOYM")
        SQLBldr.AppendLine("            ,A01.TORICODE AS TORICODE")
        SQLBldr.AppendLine("            ,A01.INVFILINGDEPT AS INVFILINGDEPT")
        SQLBldr.AppendLine("            ,A01.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("            ,MAX(")
        SQLBldr.AppendLine("                 CASE")
        SQLBldr.AppendLine("                     WHEN A01.APPLSTATUS = '0' or A01.APPLSTATUS = '4' or A01.APPLSTATUS = '5' THEN 0")
        SQLBldr.AppendLine("                     ELSE 1")
        SQLBldr.AppendLine("                 END")
        SQLBldr.AppendLine("             ) AS RESSNFAPPROVEDFLG")
        SQLBldr.AppendLine("         FROM")
        SQLBldr.AppendLine("             lng.LNT0017_RESSNF A01")
        SQLBldr.AppendLine("         WHERE")
        SQLBldr.AppendLine("             A01.DELFLG = '" & htParm(SELECT_PRIMALKEY.SP_DELFLG).ToString & "'")
        SQLBldr.AppendLine("         AND A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("         AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("         AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("         AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("         GROUP BY")
        SQLBldr.AppendLine("             A01.KEIJOYM")
        SQLBldr.AppendLine("            ,A01.TORICODE")
        SQLBldr.AppendLine("            ,A01.INVFILINGDEPT")
        SQLBldr.AppendLine("            ,A01.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("        ) A02")
        SQLBldr.AppendLine("        ON A01.KEIJOYM = A02.KEIJOYM ")
        SQLBldr.AppendLine("        AND A01.INVOICEORGCODE = A02.INVFILINGDEPT ")
        SQLBldr.AppendLine("        AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("        AND A01.INVOICETYPE IN ('1', '2')")
        SQLBldr.AppendLine("        AND A01.SCHEDATEPAYMENT = A02.DEPOSITYMD")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        '検索条件追加
        '請求年月
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & htParm(SELECT_PRIMALKEY.SP_KEIJOYM).ToString & "'")
        '請求番号
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_INVOICENUMBER).ToString) Then
            SQLBldr.AppendLine("    AND A01.INVOICENUMBER = '" & htParm(SELECT_PRIMALKEY.SP_INVOICENUMBER).ToString & "'")
        End If
        '請求担当部店コード
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_INVOICEORGCODE).ToString) Then
            SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = '" & htParm(SELECT_PRIMALKEY.SP_INVOICEORGCODE).ToString & "'")
        End If
        '請求取引先コード
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_TORICODE).ToString) Then
            SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_PRIMALKEY.SP_TORICODE).ToString & "'")
        End If
        '入金予定日
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_SCHEDATEPAYMENT).ToString) Then
            SQLBldr.AppendLine("    AND A01.SCHEDATEPAYMENT = '" & htParm(SELECT_PRIMALKEY.SP_SCHEDATEPAYMENT).ToString & "'")
        End If
        '請求書種類
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_INVOICETYPE).ToString) Then
            SQLBldr.AppendLine("    AND A01.INVOICETYPE IN ('" & htParm(SELECT_PRIMALKEY.SP_INVOICETYPE).ToString & "', '0')")
        End If
        '細分コード
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_INVSUBCD).ToString) Then
            SQLBldr.AppendLine("    AND A01.INVSUBCD = '" & htParm(SELECT_PRIMALKEY.SP_INVSUBCD).ToString & "'")
        End If
        '削除フラグ
        If Not String.IsNullOrEmpty(htParm(SELECT_PRIMALKEY.SP_DELFLG).ToString) Then
            SQLBldr.AppendLine("    AND A01.DELFLG = '" & htParm(SELECT_PRIMALKEY.SP_DELFLG).ToString & "'")
        End If

        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    A01.KEIJOYM")
        SQLBldr.AppendLine("    , A01.INVOICENUMBER")
        SQLBldr.AppendLine("    , A01.INVOICEORGCODE")
        SQLBldr.AppendLine("    , A01.TORICODE")
        SQLBldr.AppendLine("    , A01.INVOICETYPE")
        SQLBldr.AppendLine("    , A01.INVSUBCD")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイルTBL 収入管理画面用検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectIncome(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    A01.SHIPYMD")                                                          '発送年月日
        SQLBldr.AppendLine("	, A01.CTNTYPE")                                                        'コンテナ記号
        SQLBldr.AppendLine("    , A01.CTNNO")                                                          'コンテナ番号
        SQLBldr.AppendLine("    , A01.SAMEDAYCNT")                                                     '同日内回数
        SQLBldr.AppendLine("    , A01.CTNLINENO")                                                      '行番
        SQLBldr.AppendLine("    , A01.JOTDEPBRANCHCD")                                                 'JOT発組織コード
        SQLBldr.AppendLine("    , A01.DEPSTATION")                                                     '発駅コード
        SQLBldr.AppendLine("    , A01.DEPTRUSTEECD")                                                   '発受託人コード
        SQLBldr.AppendLine("    , A01.DEPTRUSTEESUBCD")                                                '発受託人サブ
        SQLBldr.AppendLine("    , A01.JOTARRBRANCHCD")                                                 'JOT着組織コード
        SQLBldr.AppendLine("    , A01.ARRSTATION")                                                     '着駅コード
        SQLBldr.AppendLine("    , A01.ARRTRUSTEECD")                                                   '着受託人コード
        SQLBldr.AppendLine("    , A01.ARRTRUSTEESUBCD")                                                '着受託人サブ
        SQLBldr.AppendLine("	, A01.JRITEMCD")                                                       'JR品目コード
        SQLBldr.AppendLine("    , A01.USEFEE")                                                         '使用料金額
        SQLBldr.AppendLine("    , A01.OWNDISCOUNTFEE")                                                 '私有割引相当額
        SQLBldr.AppendLine("    , A01.RETURNFARE")                                                     '割戻し運賃
        SQLBldr.AppendLine("    , A01.NITTSUFREESEND")                                                 '通運負担回送運賃
        SQLBldr.AppendLine("    , A01.MANAGEFEE")                                                      '運行管理料
        SQLBldr.AppendLine("    , A01.SHIPBURDENFEE")                                                  '荷主負担運賃
        SQLBldr.AppendLine("    , A01.SHIPFEE")                                                        '発送料
        SQLBldr.AppendLine("    , A01.ARRIVEFEE")                                                      '到着料
        SQLBldr.AppendLine("    , A01.PICKUPFEE")                                                      '集荷料
        SQLBldr.AppendLine("    , A01.DELIVERYFEE")                                                    '配達料
        SQLBldr.AppendLine("    , A01.OTHER1FEE")                                                      'その他１
        SQLBldr.AppendLine("    , A01.OTHER2FEE")                                                      'その他２
        SQLBldr.AppendLine("    , A01.FREESENDFEE")                                                    '回送運賃
        SQLBldr.AppendLine("    , A01.TAXKBN")                                                         '税区分
        SQLBldr.AppendLine("    , A01.TAXRATE")                                                        '税率
        SQLBldr.AppendLine("    , A01.TOTALINCOME")                                                    '収入合計
        SQLBldr.AppendLine("    , A01.INVSUBCD")                                                       '細分コード
        SQLBldr.AppendLine("FROM")
        'メイン コンテナ清算ファイル
        SQLBldr.AppendLine("    lng.LNT0017_RESSNF A01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.DELFLG = @P01")
        SQLBldr.AppendLine("    AND A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("    AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("    AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("    AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("    AND A01.KEIJOYM = '" & htParm(SELECT_RESSNF_KEY.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_RESSNF_KEY.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVFILINGDEPT = '" & htParm(SELECT_RESSNF_KEY.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.SCHEDATEPAYMENT = '" & htParm(SELECT_RESSNF_KEY.SL_DEPOSITYMD).ToString & "'")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細使用料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_rent_init(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0067_INVOICEDATA_RENT")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htRentData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htRentData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htRentData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htRentData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND INVOICETYPE = '" & htRentData(SELECT_DETAIL_KEY.SL_INVOICETYPE).ToString & "'")                  '請求書種類
        SQLBldr.AppendLine("AND INVSUBCD = '" & htRentData(SELECT_DETAIL_KEY.SL_INVSUBCD).ToString & "'")                        '細分コード
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                  '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細使用料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0067_INVOICEDATA_RENT")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htRentData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htRentData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htRentData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htRentData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND OUTINVTYPE = '" & htRentData(SELECT_DETAIL_KEY.SL_OUTINVTYPE).ToString & "'")                    '出力先請求書区分
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                  '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細使用料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_rent_ALL(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String) As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0067_INVOICEDATA_RENT A01")
        SQLBldr.AppendLine("LEFT JOIN lng.LNT0064_INVOICEHEAD A02")
        SQLBldr.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE   = '" & INVOICEORGCODE & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A02.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '2'")
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

    ''' <summary>
    ''' 請求明細使用料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRESSNF_ALL(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String,
                                                     Optional ByVal INVSUB As String = "") As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0017_RESSNF A01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVFILINGDEPT   = '" & INVOICEORGCODE & "'")           '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A01.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        If Not String.IsNullOrEmpty(INVSUB) Then
            SQLBldr.AppendLine("    AND A01.INVSUBCD = '" & INVSUB & "'")
        End If
        SQLBldr.AppendLine("AND A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' リースデータ 収入管理画面用検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectLease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    A01.LEASENO")                           　　　　　　　                 'リース登録番号
        SQLBldr.AppendLine("	, A01.CTNTYPE")                         　　　　　　　                 'コンテナ形式
        SQLBldr.AppendLine("    , A01.CTNNO")                           　　　　　　　                 'コンテナ番号
        SQLBldr.AppendLine("    , A01.LEASEYM")                         　　　　　　　                 'リース年月
        SQLBldr.AppendLine("    , A01.CLOSINGDATE")                     　　　　　　　                 '締年月日
        SQLBldr.AppendLine("    , A01.LEASESTARTYMD")                   　　　　　　　                 'リース開始日
        SQLBldr.AppendLine("    , A01.LEASEENDYMD")                     　　　　　　　                 'リース終了日
        SQLBldr.AppendLine("    , A01.MONTHLEASEFEE")                   　　　　　　　                 '月額リース適用区分
        SQLBldr.AppendLine("    , A01.TAXKBN")                          　　　　　　　                 '税区分
        SQLBldr.AppendLine("    , A01.ROUNDKBN")                        　　　　　　　                 '日割端数処理区分
        SQLBldr.AppendLine("    , A01.LEASEAPPLYKBN")                   　　　　　　　                 'リース適用区分
        SQLBldr.AppendLine("	, A01.CANCELYMD")                       　　　　　　　                 '途中解約日
        SQLBldr.AppendLine("    , A01.DAILYRATE")                       　　　　　　　                 'リース額（日割）
        SQLBldr.AppendLine("    , A01.DAILYRATEROUND")                  　　　　　　　                 'リース額（日割）丸め前
        SQLBldr.AppendLine("    , FORMAT(A01.LEASEMONTHSTARTYMD,'yyyy/MM/dd') AS LEASEMONTHSTARTYMD")  '当月のリース期間 開始日
        SQLBldr.AppendLine("    , A01.LEASEMONTHENDYMD ")               　　　　　　　                 '当月のリース期間 終了日
        SQLBldr.AppendLine("    , A01.INVSUBCD ")               　　　　　　　                         '細分コード
        SQLBldr.AppendLine("FROM")
        'メイン リース明細データ
        SQLBldr.AppendLine("    lng.LNT0042_LEASEDATA A01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("    AND A01.DELFLG = @P01")
        SQLBldr.AppendLine("    AND A01.KEIJOYM = '" & htParm(SELECT_RESSNF_KEY.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_RESSNF_KEY.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVOICEOUTORGCD = '" & htParm(SELECT_RESSNF_KEY.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.DEPOSITYMD = '" & htParm(SELECT_RESSNF_KEY.SL_DEPOSITYMD).ToString & "'")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 売却在庫データ 収入管理画面用検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectContainer(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine(" SELECT")
        SQLBldr.AppendLine("    A01.KEIJOYM")
        SQLBldr.AppendLine("    , A01.TORICODE")
        SQLBldr.AppendLine("    , A01.INVOICEORGCODE")
        SQLBldr.AppendLine("    , A01.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("    , A01.CTNTYPE")
        SQLBldr.AppendLine("    , A01.CTNNO")
        SQLBldr.AppendLine("    , coalesce(A01.CONFIRMFLG,'0') AS CONFIRMFLG")
        SQLBldr.AppendLine("    , A01.STOCKBRANCHCODE ")
        SQLBldr.AppendLine("    , A01.BRANCHCODE ")
        SQLBldr.AppendLine("    , A01.STATIONCODE ")
        SQLBldr.AppendLine("    , A01.STOCKSTATUS ")
        SQLBldr.AppendLine("    , coalesce(A01.BEFMONTHBALANCE,0) AS BEFMONTHBALANCE")
        SQLBldr.AppendLine("    , coalesce(A01.BOOKVALUE,0) AS BOOKVALUE")
        SQLBldr.AppendLine("    , coalesce(A01.COSTOFGOODSSALES,0) AS COSTOFGOODSSALES")
        SQLBldr.AppendLine("    , coalesce(A01.FRACTIONAMOUNT,0) AS FRACTIONAMOUNT")
        SQLBldr.AppendLine("    , coalesce(A01.CURRENTMONTHPAYOUT,0) AS CURRENTMONTHPAYOUT")
        SQLBldr.AppendLine("    , coalesce(A01.MONTHBALANCE,0) AS MONTHBALANCE")
        SQLBldr.AppendLine("    , coalesce(A01.SALESAMOUNT,0) AS SALESAMOUNT")
        SQLBldr.AppendLine("    , A01.SALESAMOUNTTAXRATE ")
        SQLBldr.AppendLine("    , A01.SALESAMOUNTTAXCODE")
        SQLBldr.AppendLine("    , coalesce(A01.POSTAGE,0) AS POSTAGE")
        SQLBldr.AppendLine("    , A01.POSTAGETAXRATE ")
        SQLBldr.AppendLine("    , A01.POSTAGETAXCODE ")
        SQLBldr.AppendLine("    , coalesce(A01.CLEANINGFEE,0) AS CLEANINGFEE")
        SQLBldr.AppendLine("    , A01.CLEANINGFEETAXRATE ")
        SQLBldr.AppendLine("    , A01.CLEANINGFEETAXCODE ")
        SQLBldr.AppendLine("    , coalesce(A01.MAINTENANCEFEE,0) AS MAINTENANCEFEE")
        SQLBldr.AppendLine("    , A01.MAINTENANCEFEETAXRATE ")
        SQLBldr.AppendLine("    , A01.MAINTENANCEFEETAXCODE ")
        SQLBldr.AppendLine("    , coalesce(A01.OTHERFEE,0) AS OTHERFEE")
        SQLBldr.AppendLine("    , A01.OTHERFEETAXRATE ")
        SQLBldr.AppendLine("    , A01.OTHERFEETAXCODE ")
        SQLBldr.AppendLine("    , coalesce(A01.TAXAMOUNT,0) AS TAXAMOUNT")
        SQLBldr.AppendLine("    , A01.TAXKBN ")
        SQLBldr.AppendLine("    , A01.STOCKREGISTRATIONDATE ")
        SQLBldr.AppendLine("    , A01.EXCEPTIONDATE ")
        SQLBldr.AppendLine("    , A01.SALESCONTRACTDATE ")
        SQLBldr.AppendLine("    , A01.DELIVERYLOCATION ")
        SQLBldr.AppendLine("    , A01.INVKESAIKBN ")
        SQLBldr.AppendLine("    , A01.INACCOUNTCD ")
        SQLBldr.AppendLine("    , A01.ACCOUNTINGMONTH ")
        SQLBldr.AppendLine("    , A01.CLOSINGDAY ")
        SQLBldr.AppendLine("    , A01.DEPOSITDAY ")
        SQLBldr.AppendLine("    , A01.DEPOSITMONTHKBN ")
        SQLBldr.AppendLine("    , A01.ACC_DEBIT_ACCOUNT ")
        SQLBldr.AppendLine("    , A01.ACC_DEBIT_ORGCD ")
        SQLBldr.AppendLine("    , A01.ACC_DEBIT_SEGMENTCODE1 ")
        SQLBldr.AppendLine("    , A01.ACC_DEBIT_SEGMENTCODE2 ")
        SQLBldr.AppendLine("    , A01.ACC_DEBIT_SEGMENTCODE3 ")
        SQLBldr.AppendLine("    , A01.ACC_CREDIT_ACCOUNT ")
        SQLBldr.AppendLine("    , A01.ACC_CREDIT_ORGCD ")
        SQLBldr.AppendLine("    , A01.ACC_CREDIT_SEGMENTCODE1 ")
        SQLBldr.AppendLine("    , A01.ACC_CREDIT_SEGMENTCODE2 ")
        SQLBldr.AppendLine("    , A01.ACC_CREDIT_SEGMENTCODE3 ")
        SQLBldr.AppendLine("    , A01.STOCKREGISTRATID ")
        SQLBldr.AppendLine("    , A01.STOCKUPDATEID ")
        SQLBldr.AppendLine("    , A01.COSTACCOUNTINGID ")
        SQLBldr.AppendLine("    , A01.COSTACCOUNTINGDATE ")
        SQLBldr.AppendLine("    , A01.CONFIRMID ")
        SQLBldr.AppendLine("    , A01.CONFIRMDATE ")
        SQLBldr.AppendLine("    , A01.UNCONFIRMID ")
        SQLBldr.AppendLine("    , A01.UNCONFIRMDATE ")
        SQLBldr.AppendLine("    , A01.CLOSINGID ")
        SQLBldr.AppendLine("    , A01.CLOSINGDATE ")
        SQLBldr.AppendLine("    , A01.REQUESTID ")
        SQLBldr.AppendLine("    , A01.REQUESTDATE ")
        SQLBldr.AppendLine("    , A01.REQUESTFLG ")
        SQLBldr.AppendLine("    , A01.DISPOSALFLG ")
        SQLBldr.AppendLine("    , A01.NOOPERATINGFLG ")
        SQLBldr.AppendLine("    , A01.WFREQUESTFLG ")
        SQLBldr.AppendLine(" FROM")
        'メイン 在庫テーブル
        SQLBldr.AppendLine("    lng.LNT0089_CONTAINER_STOCK A01")
        '抽出条件
        SQLBldr.AppendLine(" WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & htParm(SELECT_RESSNF_KEY.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_RESSNF_KEY.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = '" & htParm(SELECT_RESSNF_KEY.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.SCHEDATEPAYMENT = '" & htParm(SELECT_RESSNF_KEY.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.REQUESTFLG = '1'")
        SQLBldr.AppendLine("    AND A01.DELFLG = @P01")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細リース料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0068_INVOICEDATA_LEASE")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htLeaseData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND OUTINVTYPE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_OUTINVTYPE).ToString & "'")                    '出力先請求書区分
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                   '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細リースデータ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_lease_ALL(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String) As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0068_INVOICEDATA_LEASE A01")
        SQLBldr.AppendLine("LEFT JOIN lng.LNT0064_INVOICEHEAD A02")
        SQLBldr.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE   = '" & INVOICEORGCODE & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A02.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '3'")                                                                                  '削除フラグ
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                                                                  '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

    ''' <summary>
    ''' 請求明細リースデータ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectLEASEDATA_ALL(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String,
                                                     Optional ByVal INVSUB As String = "") As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0042_LEASEDATA A01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEOUTORGCD   = '" & INVOICEORGCODE & "'")         '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A01.DEPOSITYMD = '" & SCHEDATEPAYMENT & "'")               '入金年月日
        If Not String.IsNullOrEmpty(INVSUB) Then
            SQLBldr.AppendLine("    AND A01.INVSUBCD = '" & INVSUB & "'")
        End If
        SQLBldr.AppendLine("AND A01.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細リース料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_lease_init(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0068_INVOICEDATA_LEASE")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htLeaseData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND INVOICETYPE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICETYPE).ToString & "'")                  '請求書書類
        SQLBldr.AppendLine("AND INVSUBCD = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVSUBCD).ToString & "'")                        '細分コード
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                   '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細追加金額データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_add_init(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0080_INVOICEDATA_ADDAMOUNT")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htLeaseData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND INVOICETYPE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICETYPE).ToString & "'")                  '請求書書類
        SQLBldr.AppendLine("AND INVSUBCD = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVSUBCD).ToString & "'")                        '細分コード
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                   '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求追加金額明細データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectInvoiceAddAmount(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    KEIJOYM")                                                              '請求年月
        SQLBldr.AppendLine("    , INVOICENUMBER")                                                      '請求番号
        SQLBldr.AppendLine("    , INVOICEORGCODE")                                                     '請求担当部店コード
        SQLBldr.AppendLine("    , TORICODE")                                                           '請求取引先コード
        SQLBldr.AppendLine("    , INVKEIJYOBRANCHCD")                                                  '計上支店コード
        SQLBldr.AppendLine("    , AMOUNTTYPE")                                                         '金額種類
        SQLBldr.AppendLine("    , SEQNO")                                                              'SEQ№
        SQLBldr.AppendLine("    , INVOICETYPE")                                                        '請求書種類
        SQLBldr.AppendLine("    , coalesce(RENTALINCENTIVE, 0) AS RENTALINCENTIVE")                      'ボリュームインセンティブ
        SQLBldr.AppendLine("    , CONVERT(FLOAT, coalesce(RENTADJUSTMENT, 0)) AS RENTADJUSTMENT")        '加減額
        SQLBldr.AppendLine("    , CONVERT(FLOAT, coalesce(RENTALATEFEE, 0)) AS RENTALATEFEE")            '延滞料金
        SQLBldr.AppendLine("    , coalesce(RENTSUBSCADJUST, 0) AS RENTSUBSCADJUST")                      'サブスク調整額
        SQLBldr.AppendLine("    , CONVERT(FLOAT, coalesce(LEASEADJUSTMENT, 0)) AS LEASEADJUSTMENT")      'リース料加減額
        SQLBldr.AppendLine("    , SHIPYMD")                                                            '発送年月日
        SQLBldr.AppendLine("    , CTNTYPE")                                                            'コンテナ記号
        SQLBldr.AppendLine("    , CTNNO")                                                              'コンテナ番号
        SQLBldr.AppendLine("    , DEPSTATION")                                                         '発駅コード
        SQLBldr.AppendLine("    , ARRSTATION")                                                         '着駅コード
        SQLBldr.AppendLine("    , LEASESTARTYMD")                                                      '全体契約開始日
        SQLBldr.AppendLine("    , LEASEENDYMD")                                                        '全体契約終了日
        SQLBldr.AppendLine("    , INPUTDATE")                                                          '日付
        SQLBldr.AppendLine("    , coalesce(MISCELLANEOUSEXPENSE, 0) AS MISCELLANEOUSEXPENSE")            '雑費
        SQLBldr.AppendLine("    , coalesce(WRITEFEE, 0) AS WRITEFEE")                                    '手書き
        SQLBldr.AppendLine("    , coalesce(SPOTLEASEFEE, 0) AS SPOTLEASEFEE")                            'スポットリース料
        SQLBldr.AppendLine("    , coalesce(FIXEDFEE, 0) AS FIXEDFEE")                                    '固定料金
        SQLBldr.AppendLine("    , ACCOUNTCODE")                                                        '科目コード
        SQLBldr.AppendLine("    , SEGMENTCODE")                                                        'セグメント
        SQLBldr.AppendLine("    , SEGMENTBRANCHCODE")                                                  'セグメント枝番
        'SQLBldr.AppendLine("    , INOUTSIDEKBN")                                                       '内外区分
        SQLBldr.AppendLine("    , REMARKS")                                                            '備考
        SQLBldr.AppendLine("    , DELFLG")                                                             '削除フラグ
        SQLBldr.AppendLine("    , INITYMD")                                                            '登録年月日
        SQLBldr.AppendLine("    , INITUSER")                                                           '登録ユーザーID
        SQLBldr.AppendLine("    , INITTERMID")                                                         '登録端末
        SQLBldr.AppendLine("    , INITPGID")                                                           '登録プログラムID
        SQLBldr.AppendLine("    , UPDYMD")                                                             '更新年月日
        SQLBldr.AppendLine("    , UPDUSER")                                                            '更新ユーザーID
        SQLBldr.AppendLine("    , UPDTERMID")                                                          '更新端末
        SQLBldr.AppendLine("    , UPDTIMSTP")                                                          'タイムスタンプ
        SQLBldr.AppendLine("FROM")
        'メイン 請求ヘッダーデータ
        SQLBldr.AppendLine("    lng.LNT0080_INVOICEDATA_ADDAMOUNT")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        '検索条件追加
        '請求年月
        SQLBldr.AppendLine("    KEIJOYM = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_KEIJOYM).ToString & "'")
        '請求番号
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_INVOICENUMBER).ToString) Then
            SQLBldr.AppendLine("    AND INVOICENUMBER = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_INVOICENUMBER).ToString & "'")
        End If
        '請求担当部店コード
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_INVOICEORGCODE).ToString) Then
            SQLBldr.AppendLine("    AND INVOICEORGCODE = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_INVOICEORGCODE).ToString & "'")
        End If
        '請求取引先コード
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_TORICODE).ToString) Then
            SQLBldr.AppendLine("    AND TORICODE = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_TORICODE).ToString & "'")
        End If
        '入金予定日
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_SCHEDATEPAYMENT).ToString) Then
            SQLBldr.AppendLine("    AND SCHEDATEPAYMENT = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_SCHEDATEPAYMENT).ToString & "'")
        End If
        '計上支店コード
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_INVKEIJYOBRANCHCD).ToString) Then
            SQLBldr.AppendLine("    AND INVKEIJYOBRANCHCD = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_INVKEIJYOBRANCHCD).ToString & "'")
        End If
        '金額種類
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_AMOUNTTYPE).ToString) Then
            SQLBldr.AppendLine("    AND AMOUNTTYPE = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_AMOUNTTYPE).ToString & "'")
        End If
        '請求書種類
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_INVOICETYPE).ToString) Then
            SQLBldr.AppendLine("    AND INVOICETYPE IN ('" & htParm(SELECT_ADDAMOUNT_KEY.SL_INVOICETYPE).ToString & "', '0')")
        End If
        '科目コード
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_ACCOUNTCODE).ToString) Then
            SQLBldr.AppendLine("    AND ACCOUNTCODE = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_ACCOUNTCODE).ToString & "'")
        End If
        'セグメント
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_SEGMENTCODE).ToString) Then
            SQLBldr.AppendLine("    AND SEGMENTCODE = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_SEGMENTCODE).ToString & "'")
        End If
        '変更前請求書種類
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_BEFINVOICETYPE).ToString) Then
            SQLBldr.AppendLine("    AND BEFOREINVOICETYPE = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_BEFINVOICETYPE).ToString & "'")
        End If
        '削除フラグ
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY.SL_DELFLG).ToString) Then
            SQLBldr.AppendLine("    AND DELFLG = '" & htParm(SELECT_ADDAMOUNT_KEY.SL_DELFLG).ToString & "'")
        End If

        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    SEQNO DESC")
        SQLBldr.AppendLine("    , KEIJOYM")
        SQLBldr.AppendLine("    , INVOICENUMBER")
        SQLBldr.AppendLine("    , INVOICEORGCODE")
        SQLBldr.AppendLine("    , TORICODE")
        SQLBldr.AppendLine("    , INVKEIJYOBRANCHCD")
        SQLBldr.AppendLine("    , AMOUNTTYPE")
        SQLBldr.AppendLine("    , INVOICETYPE")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求追加金額明細データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectInvoiceAddAmount_Money(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    KEIJOYM")                                                              '請求年月
        SQLBldr.AppendLine("    , INVOICENUMBER")                                                      '請求番号
        SQLBldr.AppendLine("    , INVOICEORGCODE")                                                     '請求担当部店コード
        SQLBldr.AppendLine("    , TORICODE")                                                           '請求取引先コード
        SQLBldr.AppendLine("    , INVKEIJYOBRANCHCD")                                                  '計上支店コード
        SQLBldr.AppendLine("    , AMOUNTTYPE")                                                         '金額種類
        SQLBldr.AppendLine("    , INVOICETYPE")                                                        '請求書種類
        SQLBldr.AppendLine("    , coalesce(RENTALINCENTIVE, 0) AS RENTALINCENTIVE")                      'ボリュームインセンティブ
        SQLBldr.AppendLine("    , CONVERT(FLOAT, coalesce(RENTADJUSTMENT, 0)) AS RENTADJUSTMENT")        '加減額
        SQLBldr.AppendLine("    , CONVERT(FLOAT, coalesce(RENTALATEFEE, 0)) AS RENTALATEFEE")            '延滞料金
        SQLBldr.AppendLine("    , coalesce(RENTSUBSCADJUST, 0) AS RENTSUBSCADJUST")                      'サブスク調整額
        SQLBldr.AppendLine("    , CONVERT(FLOAT, coalesce(LEASEADJUSTMENT, 0)) AS LEASEADJUSTMENT")      'リース料加減額
        SQLBldr.AppendLine("    , SHIPYMD")                                                            '発送年月日
        SQLBldr.AppendLine("    , CTNTYPE")                                                            'コンテナ記号
        SQLBldr.AppendLine("    , CTNNO")                                                              'コンテナ番号
        SQLBldr.AppendLine("    , DEPSTATION")                                                         '発駅コード
        SQLBldr.AppendLine("    , ARRSTATION")                                                         '着駅コード
        SQLBldr.AppendLine("    , LEASESTARTYMD")                                                      '全体契約開始日
        SQLBldr.AppendLine("    , LEASEENDYMD")                                                        '全体契約終了日
        SQLBldr.AppendLine("    , INPUTDATE")                                                          '日付
        SQLBldr.AppendLine("    , coalesce(MISCELLANEOUSEXPENSE, 0) AS MISCELLANEOUSEXPENSE")            '雑費
        SQLBldr.AppendLine("    , coalesce(WRITEFEE, 0) AS WRITEFEE")                                    '手書き
        SQLBldr.AppendLine("    , coalesce(SPOTLEASEFEE, 0) AS SPOTLEASEFEE")                            'スポットリース料
        SQLBldr.AppendLine("    , coalesce(FIXEDFEE, 0) AS FIXEDFEE")                                    '固定料金
        SQLBldr.AppendLine("    , ACCOUNTCODE")                                                        '科目コード
        SQLBldr.AppendLine("    , SEGMENTCODE")                                                        'セグメント
        SQLBldr.AppendLine("    , SEGMENTBRANCHCODE")                                                  'セグメント枝番
        SQLBldr.AppendLine("    , OUTINVTYPE")                                                         '出力先請求書区分
        SQLBldr.AppendLine("    , BEFOREINVOICETYPE")                                                  '変更前請求書種類
        'SQLBldr.AppendLine("    , INOUTSIDEKBN")                                                       '内外区分
        SQLBldr.AppendLine("    , REMARKS")                                                            '備考
        SQLBldr.AppendLine("    , DELFLG")                                                             '削除フラグ
        SQLBldr.AppendLine("    , INITYMD")                                                            '登録年月日
        SQLBldr.AppendLine("    , INITUSER")                                                           '登録ユーザーID
        SQLBldr.AppendLine("    , INITTERMID")                                                         '登録端末
        SQLBldr.AppendLine("    , INITPGID")                                                           '登録プログラムID
        SQLBldr.AppendLine("    , UPDYMD")                                                             '更新年月日
        SQLBldr.AppendLine("    , UPDUSER")                                                            '更新ユーザーID
        SQLBldr.AppendLine("    , UPDTERMID")                                                          '更新端末
        SQLBldr.AppendLine("    , UPDTIMSTP")                                                          'タイムスタンプ
        SQLBldr.AppendLine("FROM")
        'メイン 請求ヘッダーデータ
        SQLBldr.AppendLine("    lng.LNT0080_INVOICEDATA_ADDAMOUNT")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        '検索条件追加
        '請求年月
        SQLBldr.AppendLine("    KEIJOYM = '" & htParm(SELECT_ADDAMOUNT_KEY2.SL_KEIJOYM).ToString & "'")
        '請求番号
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY2.SL_INVOICENUMBER).ToString) Then
            SQLBldr.AppendLine("    AND INVOICENUMBER = '" & htParm(SELECT_ADDAMOUNT_KEY2.SL_INVOICENUMBER).ToString & "'")
        End If
        '請求担当部店コード
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY2.SL_INVOICEORGCODE).ToString) Then
            SQLBldr.AppendLine("    AND INVOICEORGCODE = '" & htParm(SELECT_ADDAMOUNT_KEY2.SL_INVOICEORGCODE).ToString & "'")
        End If
        '請求取引先コード
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY2.SL_TORICODE).ToString) Then
            SQLBldr.AppendLine("    AND TORICODE = '" & htParm(SELECT_ADDAMOUNT_KEY2.SL_TORICODE).ToString & "'")
        End If
        '入金予定日
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY2.SL_SCHEDATEPAYMENT).ToString) Then
            SQLBldr.AppendLine("    AND SCHEDATEPAYMENT = '" & htParm(SELECT_ADDAMOUNT_KEY2.SL_SCHEDATEPAYMENT).ToString & "'")
        End If
        '削除フラグ
        If Not String.IsNullOrEmpty(htParm(SELECT_ADDAMOUNT_KEY2.SL_DELFLG).ToString) Then
            SQLBldr.AppendLine("    AND DELFLG = '" & htParm(SELECT_ADDAMOUNT_KEY2.SL_DELFLG).ToString & "'")
        End If

        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    KEIJOYM")
        SQLBldr.AppendLine("    , INVOICENUMBER")
        SQLBldr.AppendLine("    , INVOICEORGCODE")
        SQLBldr.AppendLine("    , TORICODE")
        SQLBldr.AppendLine("    , INVKEIJYOBRANCHCD")
        SQLBldr.AppendLine("    , AMOUNTTYPE")
        SQLBldr.AppendLine("    , INVOICETYPE")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細使用料データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectInvoiceAddAmount_Request(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0080_INVOICEDATA_ADDAMOUNT")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htRentData(UPDATE_ADDAMOUNT2.DP_KEIJOYM).ToString & "'")                          '請求年月
        If htRentData(UPDATE_ADDAMOUNT2.DP_INVOICETYPE).ToString = "2" Then
            SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htRentData(UPDATE_ADDAMOUNT2.DP_INVOICENUMBER_LEASE).ToString & "'")  '請求番号
        Else
            SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htRentData(UPDATE_ADDAMOUNT2.DP_INVOICENUMBER_RENTAL).ToString & "'") '請求番号
        End If
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htRentData(UPDATE_ADDAMOUNT2.DP_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htRentData(UPDATE_ADDAMOUNT2.DP_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND INVOICETYPE = '" & htRentData(UPDATE_ADDAMOUNT2.DP_INVOICETYPE).ToString & "'")                  '請求書種類
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                  '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細履歴データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_History(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String,
                                                     INVTYPE As String,
                                                     Optional ByVal INVSUB As String = "") As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0069_INVOICELOG A01")
        SQLBldr.AppendLine("LEFT JOIN lng.LNT0064_INVOICEHEAD A02")
        SQLBldr.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE   = '" & INVOICEORGCODE & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A02.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '" & INVTYPE & "'")
        If Not String.IsNullOrEmpty(INVSUB) Then
            SQLBldr.AppendLine("    AND A01.INVSUBCD = '" & INVSUB & "'")
        End If
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

    ''' <summary>
    ''' 請求明細連携履歴データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_Renkei(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     ISSUETYPE As String,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String,
                                                     INVTYPE As String,
                                                     Optional ByVal INVSUB As String = "") As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0069_INVOICELOG A01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.ISSUETYPE = '" & ISSUETYPE & "'")
        SQLBldr.AppendLine("AND A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE   = '" & INVOICEORGCODE & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A01.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '" & INVTYPE & "'")
        If Not String.IsNullOrEmpty(INVSUB) Then
            SQLBldr.AppendLine("    AND A01.INVSUBCD = '" & INVSUB & "'")
        End If
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細売却在庫データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細売却在庫データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_Container(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0104_INVOICEDATA_CONTAINER")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htLeaseData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                   '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求明細売却在庫データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_ctn_ALL(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String) As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0104_INVOICEDATA_CONTAINER A01")
        SQLBldr.AppendLine("LEFT JOIN lng.LNT0064_INVOICEHEAD A02")
        SQLBldr.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE   = '" & INVOICEORGCODE & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A02.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '5'")                                                                                  '削除フラグ
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                                                                  '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

    ''' <summary>
    ''' 請求明細売却在庫データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectCONTAINER_ALL(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String,
                                                     SCHEDATEPAYMENT As String) As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0089_CONTAINER_STOCK A01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM = '" & KEIJOYM & "'")                          '請求年月
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE   = '" & INVOICEORGCODE & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND A01.SCHEDATEPAYMENT = '" & SCHEDATEPAYMENT & "'")          '入金年月日
        SQLBldr.AppendLine("AND A01.REQUESTFLG = '1'")
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

    ''' <summary>
    ''' 請求明細売却在庫データ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細売却在庫データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectSeikyuData_ctn_init(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   INVOICENUMBER ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0104_INVOICEDATA_CONTAINER")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    KEIJOYM = '" & htLeaseData(SELECT_DETAIL_KEY.SL_KEIJOYM).ToString & "'")                          '請求年月
        SQLBldr.AppendLine("AND INVOICENUMBER   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICENUMBER).ToString & "'")            '請求番号
        SQLBldr.AppendLine("AND INVOICEORGCODE   = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICEORGCODE).ToString & "'")          '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_TORICODE).ToString & "'")                        '請求取引先コード
        SQLBldr.AppendLine("AND INVOICETYPE = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVOICETYPE).ToString & "'")                  '請求書書類
        SQLBldr.AppendLine("AND INVSUBCD = '" & htLeaseData(SELECT_DETAIL_KEY.SL_INVSUBCD).ToString & "'")                        '細分コード
        SQLBldr.AppendLine("AND DELFLG = @P01")                                                                                   '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 営業収入決済条件マスタ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectKEKKJM(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     INVOICEORGCODE As String,
                                                     TORICODE As String) As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNM0024_KEKKJM A01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.INVFILINGDEPT   = '" & INVOICEORGCODE & "'")           '請求担当部店コード
        SQLBldr.AppendLine("AND A01.TORICODE = '" & TORICODE & "'")                        '請求取引先コード                                                    '削除フラグ
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                        '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

    ''' <summary>
    ''' 経理締め状態テーブル 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectCLOSE(sqlCon As MySqlConnection,
                                                     sqlTran As MySqlTransaction,
                                                     KEIJOYM As String) As DataTable
        '2024/07/23 伊藤 ADD START

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT ")
        SQLBldr.AppendLine("   A01.* ")
        SQLBldr.AppendLine("FROM")
        SQLBldr.AppendLine("    lng.LNT0081_ACCOUNT_CLOSE A01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.KEIJOYM   = '" & KEIJOYM & "'")
        SQLBldr.AppendLine("AND A01.CLOSETYPE = '1'")
        SQLBldr.AppendLine("AND A01.DELFLG = @P01")                                                                                  '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

        '2024/07/23 伊藤 ADD END

    End Function

#End Region

#Region "登録処理部"
    ''' <summary>
    ''' 請求ヘッダーデータTBL追加処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub InsertSeikyuData(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0064_INVOICEHEAD (")
        sqlSeikyuStat.AppendLine("    KEIJOYM")                 '請求年月
        sqlSeikyuStat.AppendLine("  , INVOICENUMBER")           '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , TORICODE")                '取引先コード
        sqlSeikyuStat.AppendLine("  , INVOICETYPE")             '請求書種類
        sqlSeikyuStat.AppendLine("  , SCHEDATEPAYMENT")         '入金予定日
        sqlSeikyuStat.AppendLine("  , INVSUBCD")                '細分コード
        sqlSeikyuStat.AppendLine("  , INACCOUNTCD")             '社内口座コード
        sqlSeikyuStat.AppendLine("  , ACCOUNTINGMONTH")         '計上月区分
        sqlSeikyuStat.AppendLine("  , CLOSINGDAY")              '計上締日
        sqlSeikyuStat.AppendLine("  , DEPOSITDAY")              '入金日
        sqlSeikyuStat.AppendLine("  , DEPOSITMONTHKBN")         '入金月区分
        sqlSeikyuStat.AppendLine("  , SLIPDESCRIPTION1")        '伝票摘要１
        sqlSeikyuStat.AppendLine("  , SLIPDESCRIPTION2")        '伝票摘要２
        sqlSeikyuStat.AppendLine("  , RENTALQTY")               'レンタル個数
        sqlSeikyuStat.AppendLine("  , RENTALTOTAL")             'レンタル使用料合計
        sqlSeikyuStat.AppendLine("  , RENTALCTAX")              'レンタル使用料消費税
        sqlSeikyuStat.AppendLine("  , LEASEQTY")                'リース個数
        sqlSeikyuStat.AppendLine("  , LEASETOTAL")              'リース料合計
        sqlSeikyuStat.AppendLine("  , LEASECTAX")               'リース料消費税
        sqlSeikyuStat.AppendLine("  , WRITEQTY")                '手書き個数
        sqlSeikyuStat.AppendLine("  , WRITETOTAL")              '手書き合計
        sqlSeikyuStat.AppendLine("  , WRITECTAX")               '手書き消費税
        sqlSeikyuStat.AppendLine("  , CTNQTY")                  '売却在庫個数
        sqlSeikyuStat.AppendLine("  , CTNTOTAL")                '売却在庫合計
        sqlSeikyuStat.AppendLine("  , CTNTAX")                  '売却在庫消費税
        sqlSeikyuStat.AppendLine("  , INVOICEOUTKBN")           '請求出力区分
        sqlSeikyuStat.AppendLine("  , INVOICELINK")             '請求連携状態
        sqlSeikyuStat.AppendLine("  , ACNTLINK")                '経理連携状態
        sqlSeikyuStat.AppendLine("  , REQUESTSTATUS")           '申請状態
        sqlSeikyuStat.AppendLine("  , RQSTAFF")                 '担当者
        sqlSeikyuStat.AppendLine("  , RQDATE")                  '担当処理日時
        sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER")          '確認者
        sqlSeikyuStat.AppendLine("  , RQACKNDATE")              '確認処理日時
        sqlSeikyuStat.AppendLine("  , PRINTDATE")               '印字発行日
        sqlSeikyuStat.AppendLine("  , DETAILKBN")               '明細有無区分
        sqlSeikyuStat.AppendLine("  , HEADERCOMMENT")           '請求ヘッダーコメント
        sqlSeikyuStat.AppendLine("  , FOOTERCOMMENT")           '請求フッターコメント
        sqlSeikyuStat.AppendLine("  , REMARKS")                 '備考
        sqlSeikyuStat.AppendLine("  , UPDATEFLG")               '変更有りフラグ
        sqlSeikyuStat.AppendLine("  , DELFLG")                  '削除フラグ
        sqlSeikyuStat.AppendLine("  , INITYMD")                 '登録年月日
        sqlSeikyuStat.AppendLine("  , INITUSER")                '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , INITTERMID")              '登録端末
        sqlSeikyuStat.AppendLine("  , INITPGID")                '登録プログラムＩＤ
        sqlSeikyuStat.AppendLine("  , RECEIVEYMD")              '集信日時
        sqlSeikyuStat.AppendLine(")")
        sqlSeikyuStat.AppendLine(" VALUES(")
        sqlSeikyuStat.AppendLine("    @KEIJOYM")                '計上年月
        sqlSeikyuStat.AppendLine("  , @INVOICENUMBER")          '請求番号
        sqlSeikyuStat.AppendLine("  , @INVOICEORGCODE")         '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , @TORICODE")               '取引先コード
        sqlSeikyuStat.AppendLine("  , @INVOICETYPE")            '請求書種類
        sqlSeikyuStat.AppendLine("  , @SCHEDATEPAYMENT")        '入金予定日
        sqlSeikyuStat.AppendLine("  , @INVSUBCD")               '細分コード
        sqlSeikyuStat.AppendLine("  , @INACCOUNTCD")            '社内口座コード
        sqlSeikyuStat.AppendLine("  , @ACCOUNTINGMONTH")        '計上月区分
        sqlSeikyuStat.AppendLine("  , @CLOSINGDAY")             '計上締日
        sqlSeikyuStat.AppendLine("  , @DEPOSITDAY")             '入金日
        sqlSeikyuStat.AppendLine("  , @DEPOSITMONTHKBN")        '入金月区分
        sqlSeikyuStat.AppendLine("  , @SLIPDESCRIPTION1")       '伝票摘要１
        sqlSeikyuStat.AppendLine("  , @SLIPDESCRIPTION2")       '伝票摘要２
        sqlSeikyuStat.AppendLine("  , @RENTALQTY")              'レンタル個数
        sqlSeikyuStat.AppendLine("  , @RENTALTOTAL")            'レンタル使用料合計
        sqlSeikyuStat.AppendLine("  , @RENTALCTAX")             'レンタル使用料消費税
        sqlSeikyuStat.AppendLine("  , @LEASEQTY")               'リース個数
        sqlSeikyuStat.AppendLine("  , @LEASETOTAL")             'リース料合計
        sqlSeikyuStat.AppendLine("  , @LEASECTAX")              'リース料消費税
        sqlSeikyuStat.AppendLine("  , @WRITEQTY")               '手書き個数
        sqlSeikyuStat.AppendLine("  , @WRITETOTAL")             '手書き合計
        sqlSeikyuStat.AppendLine("  , @WRITECTAX")              '手書き消費税
        sqlSeikyuStat.AppendLine("  , @CTNQTY")                 '売却在庫個数
        sqlSeikyuStat.AppendLine("  , @CTNTOTAL")               '売却在庫合計
        sqlSeikyuStat.AppendLine("  , @CTNTAX")                 '売却在庫消費税
        sqlSeikyuStat.AppendLine("  , @INVOICEOUTKBN")          '請求出力区分
        sqlSeikyuStat.AppendLine("  , @INVOICELINK")            '請求連携状態
        sqlSeikyuStat.AppendLine("  , @ACNTLINK")               '経理連携状態
        sqlSeikyuStat.AppendLine("  , @REQUESTSTATUS")          '申請状態
        sqlSeikyuStat.AppendLine("  , @RQSTAFF")                '担当者
        sqlSeikyuStat.AppendLine("  , @RQDATE")                 '担当処理日時
        sqlSeikyuStat.AppendLine("  , @RQACKNOWLEDGER")         '確認者
        sqlSeikyuStat.AppendLine("  , @RQACKNDATE")             '確認処理日時
        sqlSeikyuStat.AppendLine("  , @PRINTDATE")              '印字発行日
        sqlSeikyuStat.AppendLine("  , @DETAILKBN")              '明細有無区分
        sqlSeikyuStat.AppendLine("  , @HEADERCOMMENT")          '請求ヘッダーコメント
        sqlSeikyuStat.AppendLine("  , @FOOTERCOMMENT")          '請求フッターコメント
        sqlSeikyuStat.AppendLine("  , @REMARKS")                '備考
        sqlSeikyuStat.AppendLine("  , @UPDATEFLG")              '変更有りフラグ
        sqlSeikyuStat.AppendLine("  , @DELFLG")                 '削除フラグ
        sqlSeikyuStat.AppendLine("  , @INITYMD")                '登録年月日
        sqlSeikyuStat.AppendLine("  , @INITUSER")               '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , @INITTERMID")             '登録端末
        sqlSeikyuStat.AppendLine("  , @INITPGID")               '登録プログラムＩＤ
        sqlSeikyuStat.AppendLine("  , @RECEIVEYMD")             '集信日時
        sqlSeikyuStat.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htHeadData(SEIKYU_INSTPARAM.IP_KEIJOYM)                                          '計上年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_INSTPARAM.IP_INVOICENUMBER)                         '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_INSTPARAM.IP_INVOICEORGCODE)                       '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_INSTPARAM.IP_TORICODE)                                   '取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_INSTPARAM.IP_INVOICETYPE)                             '請求書種類
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SCHEDATEPAYMENT))          '入金予定日
                .Add("INVSUBCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INVSUBCD))                    '細分コード
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INACCOUNTCD))              '社内口座コード
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_ACCOUNTINGMONTH))      '計上月区分
                .Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_CLOSINGDAY))                '計上締日
                .Add("DEPOSITDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_DEPOSITDAY))                '入金日
                .Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_INSTPARAM.IP_DEPOSITMONTHKBN)                     '入金月区分
                .Add("SLIPDESCRIPTION1", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION1))    '伝票摘要１
                .Add("SLIPDESCRIPTION2", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION2))    '伝票摘要２
                .Add("RENTALQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RENTALQTY))                       'レンタル個数
                .Add("RENTALTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RENTALTOTAL))                 'レンタル使用料合計
                .Add("RENTALCTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RENTALCTAX))                   'レンタル使用料消費税
                .Add("LEASEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_LEASEQTY))                         'リース個数
                .Add("LEASETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_LEASETOTAL))                   'リース料合計
                .Add("LEASECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_LEASECTAX))                     'リース料消費税
                .Add("WRITEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_WRITEQTY))                         '手書き個数
                .Add("WRITETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_WRITETOTAL))                   '手書き合計
                .Add("WRITECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_WRITECTAX))                     '手書き消費税
                .Add("CTNQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_CTNQTY))                             '売却在庫個数
                .Add("CTNTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_CTNTOTAL))                       '売却在庫合計
                .Add("CTNTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_CTNCTAX))                          '売却在庫消費税
                .Add("INVOICEOUTKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INVOICEOUTKBN))          '請求出力区分
                .Add("INVOICELINK", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INVOICELINK))              '請求連携状態
                .Add("ACNTLINK", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_ACNTLINK))                    '経理連携状態
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_REQUESTSTATUS))          '申請状態
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RQSTAFF))                      '担当者
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RQDATE))                        '担当処理日時
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RQACKNOWLEDGER))        '確認者
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RQACKNDATE))                '確認処理日時
                .Add("PRINTDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_PRINTDATE))                  '印字発行日
                .Add("DETAILKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_DETAILKBN))                  '明細有無区分
                .Add("HEADERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_HEADERCOMMENT))          '請求ヘッダーコメント
                .Add("FOOTERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_FOOTERCOMMENT))          '請求フッターコメント
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_REMARKS))                      '備考
                .Add("UPDATEFLG", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_UPDATEFLG))                       '変更有りフラグ
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_DELFLG))                             '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INITYMD))                      '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INITUSER))                    '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INITTERMID))                '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INITPGID))                    '登録プログラムID
                .Add("RECEIVEYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_RECEIVEYMD))                '集信日時
            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0064_INVOICEHEAD]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求追加金額明細データTBL追加処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub InsertSeikyuAddAmountData(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0080_INVOICEDATA_ADDAMOUNT (")
        sqlSeikyuStat.AppendLine("    KEIJOYM")                 '請求年月
        sqlSeikyuStat.AppendLine("  , INVOICENUMBER")           '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , TORICODE")                '取引先コード
        sqlSeikyuStat.AppendLine("  , INVKEIJYOBRANCHCD")       '計上支店コード
        sqlSeikyuStat.AppendLine("  , AMOUNTTYPE")              '金額種類
        sqlSeikyuStat.AppendLine("  , SEQNO")                   'SEQ№
        sqlSeikyuStat.AppendLine("  , INVOICETYPE")             '請求書種類
        sqlSeikyuStat.AppendLine("  , SCHEDATEPAYMENT")         '入金予定日
        sqlSeikyuStat.AppendLine("  , INVSUBCD")                '細分コード
        sqlSeikyuStat.AppendLine("  , INACCOUNTCD")             '社内口座コード
        sqlSeikyuStat.AppendLine("  , ACCOUNTINGMONTH")         '計上月区分
        sqlSeikyuStat.AppendLine("  , CLOSINGDAY")              '計上締日
        sqlSeikyuStat.AppendLine("  , DEPOSITDAY")              '入金日
        sqlSeikyuStat.AppendLine("  , DEPOSITMONTHKBN")         '入金月区分
        sqlSeikyuStat.AppendLine("  , SLIPDESCRIPTION1")        '伝票摘要１
        sqlSeikyuStat.AppendLine("  , SLIPDESCRIPTION2")        '伝票摘要２
        sqlSeikyuStat.AppendLine("  , RENTALINCENTIVE")         'ボリュームインセンティブ
        sqlSeikyuStat.AppendLine("  , RENTADJUSTMENT")          '使用料加減額
        sqlSeikyuStat.AppendLine("  , RENTALATEFEE")            '延滞料金
        sqlSeikyuStat.AppendLine("  , RENTSUBSCADJUST")         'サブスク調整額
        sqlSeikyuStat.AppendLine("  , LEASEADJUSTMENT")         'リース料加減額
        sqlSeikyuStat.AppendLine("  , SHIPYMD")                 '発送年月日
        sqlSeikyuStat.AppendLine("  , CTNTYPE")                 'コンテナ記号
        sqlSeikyuStat.AppendLine("  , CTNNO")                   'コンテナ番号
        sqlSeikyuStat.AppendLine("  , DEPSTATION")              '発駅コード
        sqlSeikyuStat.AppendLine("  , DEPTRUSTEECD")            '発受託人コード
        sqlSeikyuStat.AppendLine("  , DEPTRUSTEESUBCD")         '発受託人サブコード  
        sqlSeikyuStat.AppendLine("  , ARRSTATION")              '着駅コード
        sqlSeikyuStat.AppendLine("  , LEASESTARTYMD")           '全体契約開始日
        sqlSeikyuStat.AppendLine("  , LEASEENDYMD")             '全体契約終了日
        sqlSeikyuStat.AppendLine("  , MISCELLANEOUSEXPENSE")    '雑費
        sqlSeikyuStat.AppendLine("  , INPUTDATE")               '日付
        sqlSeikyuStat.AppendLine("  , WRITEFEE")                '手書き料
        sqlSeikyuStat.AppendLine("  , SPOTLEASEFEE")            'スポットリース料
        sqlSeikyuStat.AppendLine("  , FIXEDFEE")                '固定料金
        sqlSeikyuStat.AppendLine("  , ACCOUNTCODE")             '科目コード
        sqlSeikyuStat.AppendLine("  , SEGMENTCODE")             'セグメント
        sqlSeikyuStat.AppendLine("  , SEGMENTBRANCHCODE")       'セグメント枝番
        sqlSeikyuStat.AppendLine("  , DETAILS")                 '明細内容
        sqlSeikyuStat.AppendLine("  , OUTINVTYPE")              '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , BEFOREINVOICETYPE")       '変更前請求書種類
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG")    '請求除外フラグ
        'sqlSeikyuStat.AppendLine("  , INOUTSIDEKBN")            '内外区分
        sqlSeikyuStat.AppendLine("  , TAXKBN")                  '税区分
        sqlSeikyuStat.AppendLine("  , TAXRATE")                 '税率
        sqlSeikyuStat.AppendLine("  , REMARKS")                 '備考
        sqlSeikyuStat.AppendLine("  , QUANTITY")                '個数
        sqlSeikyuStat.AppendLine("  , UNITPRICE")               '単価 2024/09/06 伊藤 ADD
        sqlSeikyuStat.AppendLine("  , UNITNAME")                '数量単位
        sqlSeikyuStat.AppendLine("  , DELFLG")                  '削除フラグ
        sqlSeikyuStat.AppendLine("  , INITYMD")                 '登録年月日
        sqlSeikyuStat.AppendLine("  , INITUSER")                '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , INITTERMID")              '登録端末
        sqlSeikyuStat.AppendLine("  , INITPGID")                '登録プログラムＩＤ
        sqlSeikyuStat.AppendLine(")")
        sqlSeikyuStat.AppendLine(" VALUES(")
        sqlSeikyuStat.AppendLine("    @KEIJOYM")                '計上年月
        sqlSeikyuStat.AppendLine("  , @INVOICENUMBER")          '請求番号
        sqlSeikyuStat.AppendLine("  , @INVOICEORGCODE")         '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , @TORICODE")               '取引先コード
        sqlSeikyuStat.AppendLine("  , @INVKEIJYOBRANCHCD")      '計上支店コード
        sqlSeikyuStat.AppendLine("  , @AMOUNTTYPE")             '金額種類
        sqlSeikyuStat.AppendLine("  , @SEQNO")                  'SEQ№
        sqlSeikyuStat.AppendLine("  , @INVOICETYPE")            '請求書種類
        sqlSeikyuStat.AppendLine("  , @SCHEDATEPAYMENT")        '入金予定日
        sqlSeikyuStat.AppendLine("  , @INVSUBCD")               '細分コード
        sqlSeikyuStat.AppendLine("  , @INACCOUNTCD")            '社内口座コード
        sqlSeikyuStat.AppendLine("  , @ACCOUNTINGMONTH")        '計上月区分
        sqlSeikyuStat.AppendLine("  , @CLOSINGDAY")             '計上締日
        sqlSeikyuStat.AppendLine("  , @DEPOSITDAY")             '入金日
        sqlSeikyuStat.AppendLine("  , @DEPOSITMONTHKBN")        '入金月区分
        sqlSeikyuStat.AppendLine("  , @SLIPDESCRIPTION1")       '伝票摘要１
        sqlSeikyuStat.AppendLine("  , @SLIPDESCRIPTION2")       '伝票摘要２
        sqlSeikyuStat.AppendLine("  , @RENTALINCENTIVE")        'ボリュームインセンティブ
        sqlSeikyuStat.AppendLine("  , @RENTADJUSTMENT")         '加減額
        sqlSeikyuStat.AppendLine("  , @RENTALATEFEE")           '延滞料金
        sqlSeikyuStat.AppendLine("  , @RENTSUBSCADJUST")        'サブスク調整額
        sqlSeikyuStat.AppendLine("  , @LEASEADJUSTMENT")        'リース料加減額
        sqlSeikyuStat.AppendLine("  , @SHIPYMD")                '発送年月日
        sqlSeikyuStat.AppendLine("  , @CTNTYPE")                'コンテナ記号
        sqlSeikyuStat.AppendLine("  , @CTNNO")                  'コンテナ番号
        sqlSeikyuStat.AppendLine("  , @DEPSTATION")             '発駅コード
        sqlSeikyuStat.AppendLine("  , @DEPTRUSTEECD")           '発受託人コード
        sqlSeikyuStat.AppendLine("  , @DEPTRUSTEESUBCD")        '発受託人サブコード  
        sqlSeikyuStat.AppendLine("  , @ARRSTATION")             '着駅コード
        sqlSeikyuStat.AppendLine("  , @LEASESTARTYMD")          '全体契約開始日
        sqlSeikyuStat.AppendLine("  , @LEASEENDYMD")            '全体契約終了日
        sqlSeikyuStat.AppendLine("  , @MISCELLANEOUSEXPENSE")   '雑費
        sqlSeikyuStat.AppendLine("  , @INPUTDATE")              '日付
        sqlSeikyuStat.AppendLine("  , @WRITEFEE")               '手書き料
        sqlSeikyuStat.AppendLine("  , @SPOTLEASEFEE")           'スポットリース料
        sqlSeikyuStat.AppendLine("  , @FIXEDFEE")               '固定料金
        sqlSeikyuStat.AppendLine("  , @ACCOUNTCODE")            '科目コード
        sqlSeikyuStat.AppendLine("  , @SEGMENTCODE")            'セグメント
        sqlSeikyuStat.AppendLine("  , @SEGMENTBRANCHCODE")      'セグメント枝番
        sqlSeikyuStat.AppendLine("  , @DETAILS")                '明細内容
        sqlSeikyuStat.AppendLine("  , @OUTINVTYPE")             '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , @BEFOREINVOICETYPE")      '変更前請求書種類
        sqlSeikyuStat.AppendLine("  , @INVOICEEXCLUSIONFLAG")   '請求除外フラグ
        'sqlSeikyuStat.AppendLine("  , @INOUTSIDEKBN")           '内外区分
        sqlSeikyuStat.AppendLine("  , @TAXKBN")                 '税区分
        sqlSeikyuStat.AppendLine("  , @TAXRATE")                '税率
        sqlSeikyuStat.AppendLine("  , @REMARKS")                '備考
        sqlSeikyuStat.AppendLine("  , @QUANTITY")               '個数
        sqlSeikyuStat.AppendLine("  , @UNITPRICE")              '単価 2024/09/06 伊藤 ADD
        sqlSeikyuStat.AppendLine("  , @UNITNAME")               '数量単位
        sqlSeikyuStat.AppendLine("  , @DELFLG")                 '削除フラグ
        sqlSeikyuStat.AppendLine("  , @INITYMD")                '登録年月日
        sqlSeikyuStat.AppendLine("  , @INITUSER")               '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , @INITTERMID")             '登録端末
        sqlSeikyuStat.AppendLine("  , @INITPGID")               '登録プログラムＩＤ
        sqlSeikyuStat.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htHeadData(INSERT_ADDAMOUNT.IP_KEIJOYM)                                                '計上年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVOICENUMBER)                               '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVOICEORGCODE)                             '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_TORICODE)                                         '取引先コード
                .Add("INVKEIJYOBRANCHCD", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVKEIJYOBRANCHCD)                       '計上支店コード
                .Add("AMOUNTTYPE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_AMOUNTTYPE)                                     '金額種類
                .Add("SEQNO", MySqlDbType.Int32).Value = htHeadData(INSERT_ADDAMOUNT.IP_SEQNO)                                                    'SEQ№
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVOICETYPE)                                   '請求書種類
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SCHEDATEPAYMENT))                '入金予定日
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INVSUBCD))                               '細分コード
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INACCOUNTCD))                    '社内口座コード
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_ACCOUNTINGMONTH))            '計上月区分
                .Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_CLOSINGDAY))                      '計上締日
                .Add("DEPOSITDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DEPOSITDAY))                      '入金日
                .Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_DEPOSITMONTHKBN)                           '入金月区分
                .Add("SLIPDESCRIPTION1", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SLIPDESCRIPTION1))          '伝票摘要１
                .Add("SLIPDESCRIPTION2", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SLIPDESCRIPTION2))          '伝票摘要２
                .Add("RENTALINCENTIVE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTALINCENTIVE))                 'ボリュームインセンティブ
                .Add("RENTADJUSTMENT", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTADJUSTMENT))                 '加減額
                .Add("RENTALATEFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTALATEFEE))                     '延滞料金
                .Add("RENTSUBSCADJUST", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTSUBSCADJUST))               'サブスク調整額
                .Add("LEASEADJUSTMENT", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_LEASEADJUSTMENT))               'リース料加減額
                .Add("SHIPYMD", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SHIPYMD))                                '発送年月日
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_CTNTYPE))                            'コンテナ記号
                .Add("CTNNO", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_CTNNO))                                     'コンテナ番号
                .Add("DEPSTATION", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DEPSTATION))                      '発駅コード
                .Add("DEPTRUSTEECD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DEPTRUSTEE))                    '発受託人コード
                .Add("DEPTRUSTEESUBCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DEPTRUSTEESUB))              '発受託人サブコード
                .Add("ARRSTATION", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_ARRSTATION))                           '着駅コード
                .Add("LEASESTARTYMD", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_LEASESTARTYMD))                    '全体契約開始日
                .Add("LEASEENDYMD", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_LEASEENDYMD))                        '全体契約終了日
                .Add("MISCELLANEOUSEXPENSE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_MISCELLANEOUSEXPENSE))       '雑費
                .Add("INPUTDATE", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INPUTDATE))                            '日付
                .Add("WRITEFEE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_WRITEFEE))                               '手書き料
                .Add("SPOTLEASEFEE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SPOTLEASEFEE))                       'スポットリース料
                .Add("FIXEDFEE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_FIXEDFEE))                               '固定料金
                .Add("ACCOUNTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_ACCOUNTCODE))                    '科目コード
                .Add("SEGMENTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SEGMENTCODE))                    'セグメント
                .Add("SEGMENTBRANCHCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SEGMENTBRANCHCODE))        'セグメント枝番
                .Add("DETAILS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DETAILS))                            '明細内容
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_OUTINVTYPE))                      '出力先請求書区分
                .Add("BEFOREINVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_BEFOREINVOICETYPE))        '変更前請求書種類
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INVOICEEXCLUSIONFLAG))  '請求除外フラグ
                '.Add("INOUTSIDEKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INOUTSIDEKBN))                  '内外区分
                .Add("TAXKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_TAXKBN))                              '税区分
                .Add("TAXRATE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_TAXRATE))                            '税率
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_REMARKS))                            '備考
                .Add("QUANTITY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_QUANTITY))                               '個数
                .Add("UNITPRICE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_UNITPRICE))                        '単価 2024/09/06 伊藤 ADD
                .Add("UNITNAME", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_UNIT))                              '数量単位
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DELFLG))                                   '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INITYMD))                            '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INITUSER))                          '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INITTERMID))                      '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INITPGID))                          '登録プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細使用料データTBL追加処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求ヘッダーデータ</param>
    Public Shared Sub InsertSeikyuData_Rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0067_INVOICEDATA_RENT (")
        sqlSeikyuStat.AppendLine("    KEIJOYM")              '請求年月
        sqlSeikyuStat.AppendLine("  , INVOICENUMBER")        '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICEORGCODE")       '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , TORICODE")             '取引先コード
        sqlSeikyuStat.AppendLine("  , INVOICETYPE")          '請求書種類
        sqlSeikyuStat.AppendLine("  , INVSUBCD")             '細分コード
        sqlSeikyuStat.AppendLine("  , SHIPYMD")              '発送年月日
        sqlSeikyuStat.AppendLine("  , CTNTYPE")              'コンテナ記号
        sqlSeikyuStat.AppendLine("  , CTNNO")                'コンテナ番号
        sqlSeikyuStat.AppendLine("  , SAMEDAYCNT")           '同日内回数
        sqlSeikyuStat.AppendLine("  , CTNLINENO")            '行番
        sqlSeikyuStat.AppendLine("  , JOTDEPBRANCHCD")       'JOT発組織コード
        sqlSeikyuStat.AppendLine("  , DEPSTATION")           '発駅コード
        sqlSeikyuStat.AppendLine("  , DEPTRUSTEECD")         '発受託人コード
        sqlSeikyuStat.AppendLine("  , DEPTRUSTEESUBCD")      '発受託人サブ
        sqlSeikyuStat.AppendLine("  , JOTARRBRANCHCD")       'JOT着組織コード
        sqlSeikyuStat.AppendLine("  , ARRSTATION")           '着駅コード
        sqlSeikyuStat.AppendLine("  , ARRTRUSTEECD")         '着受託人コード
        sqlSeikyuStat.AppendLine("  , ARRTRUSTEESUBCD")      '着受託人サブ
        sqlSeikyuStat.AppendLine("  , JRITEMCD")             'JR品目コード
        sqlSeikyuStat.AppendLine("  , USEFEE")               '使用料金額
        sqlSeikyuStat.AppendLine("  , OWNDISCOUNTFEE")       '私有割引相当額
        sqlSeikyuStat.AppendLine("  , RETURNFARE")           '割戻し運賃
        sqlSeikyuStat.AppendLine("  , NITTSUFREESEND")       '通運負担回送運賃
        sqlSeikyuStat.AppendLine("  , MANAGEFEE")            '運行管理料
        sqlSeikyuStat.AppendLine("  , SHIPBURDENFEE")        '荷主負担運賃
        sqlSeikyuStat.AppendLine("  , SHIPFEE")              '発送料
        sqlSeikyuStat.AppendLine("  , ARRIVEFEE")            '到着料
        sqlSeikyuStat.AppendLine("  , PICKUPFEE")            '集荷料
        sqlSeikyuStat.AppendLine("  , DELIVERYFEE")          '配達料
        sqlSeikyuStat.AppendLine("  , OTHER1FEE")            'その他１
        sqlSeikyuStat.AppendLine("  , OTHER2FEE")            'その他２
        sqlSeikyuStat.AppendLine("  , FREESENDFEE")          '回送運賃
        sqlSeikyuStat.AppendLine("  , TAXKBN")               '税区分
        sqlSeikyuStat.AppendLine("  , TAXRATE")              '税率
        sqlSeikyuStat.AppendLine("  , BILLINGFEE")           '請求額
        sqlSeikyuStat.AppendLine("  , OUTINVTYPE")           '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG") '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , REMARKS")              '備考
        sqlSeikyuStat.AppendLine("  , DELFLG")               '削除フラグ
        sqlSeikyuStat.AppendLine("  , INITYMD")              '登録年月日
        sqlSeikyuStat.AppendLine("  , INITUSER")             '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , INITTERMID")           '登録端末
        sqlSeikyuStat.AppendLine("  , INITPGID")             '登録プログラムID
        sqlSeikyuStat.AppendLine("  , RECEIVEYMD")           '集信日時
        sqlSeikyuStat.AppendLine(")")
        sqlSeikyuStat.AppendLine(" VALUES(")
        sqlSeikyuStat.AppendLine("    @KEIJOYM")              '計上年月
        sqlSeikyuStat.AppendLine("  , @INVOICENUMBER")        '請求番号
        sqlSeikyuStat.AppendLine("  , @INVOICEORGCODE")       '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , @TORICODE")             '取引先コード
        sqlSeikyuStat.AppendLine("  , @INVOICETYPE")          '請求書種類
        sqlSeikyuStat.AppendLine("  , @INVSUBCD")             '細分コード
        sqlSeikyuStat.AppendLine("  , @SHIPYMD")              '発送年月日
        sqlSeikyuStat.AppendLine("  , @CTNTYPE")              'コンテナ記号
        sqlSeikyuStat.AppendLine("  , @CTNNO")                'コンテナ番号
        sqlSeikyuStat.AppendLine("  , @SAMEDAYCNT")           '同日内回数
        sqlSeikyuStat.AppendLine("  , @CTNLINENO")            '行番
        sqlSeikyuStat.AppendLine("  , @JOTDEPBRANCHCD")       'JOT発組織コード
        sqlSeikyuStat.AppendLine("  , @DEPSTATION")           '発駅コード
        sqlSeikyuStat.AppendLine("  , @DEPTRUSTEECD")         '発受託人コード
        sqlSeikyuStat.AppendLine("  , @DEPTRUSTEESUBCD")      '発受託人サブ
        sqlSeikyuStat.AppendLine("  , @JOTARRBRANCHCD")       'JOT着組織コード
        sqlSeikyuStat.AppendLine("  , @ARRSTATION")           '着駅コード
        sqlSeikyuStat.AppendLine("  , @ARRTRUSTEECD")         '着受託人コード
        sqlSeikyuStat.AppendLine("  , @ARRTRUSTEESUBCD")      '着受託人サブ
        sqlSeikyuStat.AppendLine("  , @JRITEMCD")             'JR品目コード
        sqlSeikyuStat.AppendLine("  , @USEFEE")               '使用料金額
        sqlSeikyuStat.AppendLine("  , @OWNDISCOUNTFEE")       '私有割引相当額
        sqlSeikyuStat.AppendLine("  , @RETURNFARE")           '割戻し運賃
        sqlSeikyuStat.AppendLine("  , @NITTSUFREESEND")       '運賃負担回送運賃
        sqlSeikyuStat.AppendLine("  , @MANAGEFEE")            '運行管理料
        sqlSeikyuStat.AppendLine("  , @SHIPBURDENFEE")        '荷主負担運賃
        sqlSeikyuStat.AppendLine("  , @SHIPFEE")              '発送料
        sqlSeikyuStat.AppendLine("  , @ARRIVEFEE")            '到着料
        sqlSeikyuStat.AppendLine("  , @PICKUPFEE")            '集荷料
        sqlSeikyuStat.AppendLine("  , @DELIVERYFEE")          '配達料
        sqlSeikyuStat.AppendLine("  , @OTHER1FEE")            'その他１
        sqlSeikyuStat.AppendLine("  , @OTHER2FEE")            'その他２
        sqlSeikyuStat.AppendLine("  , @FREESENDFEE")          '回送運賃
        sqlSeikyuStat.AppendLine("  , @TAXKBN")               '税区分
        sqlSeikyuStat.AppendLine("  , @TAXRATE")              '税率
        sqlSeikyuStat.AppendLine("  , @BILLINGFEE")           '請求額
        sqlSeikyuStat.AppendLine("  , @OUTINVTYPE")           '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , @INVOICEEXCLUSIONFLAG") '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , @REMARKS")              '備考
        sqlSeikyuStat.AppendLine("  , @DELFLG")               '削除フラグ
        sqlSeikyuStat.AppendLine("  , @INITYMD")              '登録年月日
        sqlSeikyuStat.AppendLine("  , @INITUSER")             '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , @INITTERMID")           '登録端末
        sqlSeikyuStat.AppendLine("  , @INITPGID")             '登録プログラムID
        sqlSeikyuStat.AppendLine("  , @RECEIVEYMD")           '集信日時

        sqlSeikyuStat.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htRentData(RENTAL_INSTPARAM.IP_KEIJOYM)                                                     '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICENUMBER))                     '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICEORGCODE))                   '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_TORICODE))                               '取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICETYPE))                         '請求書種類
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVSUBCD))                                    '細分コード
                .Add("SHIPYMD", MySqlDbType.Date).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_SHIPYMD))                                     '発送年月日
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_CTNTYPE))                                 'コンテナ記号
                .Add("CTNNO", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_CTNNO))                                          'コンテナ番号
                .Add("SAMEDAYCNT", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_SAMEDAYCNT))                                '同日内回数
                .Add("CTNLINENO", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_CTNLINENO))                                  '行番
                .Add("JOTDEPBRANCHCD", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_JOTDEPBRANCHCD))                   'JOT発組織コード
                .Add("DEPSTATION", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_DEPSTATION))                                '発駅コード
                .Add("DEPTRUSTEECD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_DEPTRUSTEECD))                            '発受託人コード
                .Add("DEPTRUSTEESUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_DEPTRUSTEESUBCD))                      '発受託人サブ
                .Add("JOTARRBRANCHCD", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_JOTARRBRANCHCD))                   'JOT着組織コード
                .Add("ARRSTATION", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_ARRSTATION))                                '着駅コード
                .Add("ARRTRUSTEECD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_ARRTRUSTEECD))                            '着受託人コード
                .Add("ARRTRUSTEESUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_ARRTRUSTEESUBCD))                      '着受託人サブ
                .Add("JRITEMCD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_JRITEMCD))                                    'JR品目コード
                .Add("USEFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_USEFEE))                                      '使用料金額
                .Add("OWNDISCOUNTFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_OWNDISCOUNTFEE))                      '私有割引相当額
                .Add("RETURNFARE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_RETURNFARE))                              '割戻し運賃
                .Add("NITTSUFREESEND", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_NITTSUFREESEND))                      '通運負担回送運賃
                .Add("MANAGEFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_MANAGEFEE))                                '運行管理料
                .Add("SHIPBURDENFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_SHIPBURDENFEE))                        '荷主負担運賃
                .Add("SHIPFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_SHIPFEE))                                    '発送料
                .Add("ARRIVEFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_ARRIVEFEE))                                '到着料
                .Add("PICKUPFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_PICKUPFEE))                                '集荷料
                .Add("DELIVERYFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_DELIVERYFEE))                            '配達料
                .Add("OTHER1FEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_OTHER1FEE))                                'その他１
                .Add("OTHER2FEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_OTHER2FEE))                                'その他２
                .Add("FREESENDFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_FREESENDFEE))                            '回送運賃
                .Add("TAXKBN", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_TAXKBN))                                        '税区分
                .Add("TAXRATE", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_TAXRATE))                                      '税率
                .Add("BILLINGFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_BILLINGFEE))                              '請求額
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_OUTINVTYPE))                           '出力先請求書区分
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICEEXCLUSIONFLAG))       '請求除外フラグ
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_REMARKS))                                 '備考
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_DELFLG))                                        '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITYMD))                                 '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITUSER))                               '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITTERMID))                           '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITPGID))                               '登録プログラムID
                .Add("RECEIVEYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_RECEIVEYMD))                           '集信日時

            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0067_INVOICEDATA_RENT]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()

        End Using

    End Sub

    ''' <summary>
    ''' 請求明細リースデータTBL追加処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求ヘッダーデータ</param>
    Public Shared Sub InsertSeikyuData_Lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0068_INVOICEDATA_LEASE (")
        sqlSeikyuStat.AppendLine("    KEIJOYM")              '請求年月
        sqlSeikyuStat.AppendLine("  , INVOICENUMBER")        '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICEORGCODE")       '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , TORICODE")             '請求取引先コード
        sqlSeikyuStat.AppendLine("  , INVOICETYPE")          '請求書種類
        sqlSeikyuStat.AppendLine("  , INVSUBCD")             '細分コード
        sqlSeikyuStat.AppendLine("  , LEASENO")              'リース登録番号
        sqlSeikyuStat.AppendLine("  , CTNTYPE")              'コンテナ形式
        sqlSeikyuStat.AppendLine("  , CTNNO")                'コンテナ番号
        sqlSeikyuStat.AppendLine("  , LEASEYM")              'リース年月
        sqlSeikyuStat.AppendLine("  , CLOSINGDATE")          '締年月日
        sqlSeikyuStat.AppendLine("  , LEASESTARTYMD")        'リース開始日
        sqlSeikyuStat.AppendLine("  , LEASEENDYMD")          'リース終了日
        sqlSeikyuStat.AppendLine("  , MONTHLEASEFEE")        '月額リース料
        sqlSeikyuStat.AppendLine("  , TAXKBN")               '税区分
        sqlSeikyuStat.AppendLine("  , ROUNDKBN")             '日割端数処理区分
        sqlSeikyuStat.AppendLine("  , LEASEAPPLYKBN")        'リース適用区分
        sqlSeikyuStat.AppendLine("  , CANCELYMD")            '途中解約日
        sqlSeikyuStat.AppendLine("  , DAILYRATE")            'リース額（日割）
        sqlSeikyuStat.AppendLine("  , DAILYRATEROUND")       'リース額（日割）丸め前
        sqlSeikyuStat.AppendLine("  , LEASEMONTHSTARTYMD")   '当月のリース期間 開始日
        sqlSeikyuStat.AppendLine("  , LEASEMONTHENDYMD")     '当月のリース期間 終了日
        sqlSeikyuStat.AppendLine("  , OUTINVTYPE")           '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG") '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , REMARKS")              '備考
        sqlSeikyuStat.AppendLine("  , DELFLG")               '削除フラグ
        sqlSeikyuStat.AppendLine("  , INITYMD")              '登録年月日
        sqlSeikyuStat.AppendLine("  , INITUSER")             '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , INITTERMID")           '登録端末
        sqlSeikyuStat.AppendLine("  , INITPGID")             '登録プログラムID
        sqlSeikyuStat.AppendLine("  , RECEIVEYMD")           '集信日時
        sqlSeikyuStat.AppendLine(")")
        sqlSeikyuStat.AppendLine(" VALUES(")
        sqlSeikyuStat.AppendLine("    @KEIJOYM")              '請求年月
        sqlSeikyuStat.AppendLine("  , @INVOICENUMBER")        '請求番号
        sqlSeikyuStat.AppendLine("  , @INVOICEORGCODE")       '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , @TORICODE")             '請求取引先コード
        sqlSeikyuStat.AppendLine("  , @INVOICETYPE")          '請求書種類
        sqlSeikyuStat.AppendLine("  , @INVSUBCD")             '細分コード
        sqlSeikyuStat.AppendLine("  , @LEASENO")              'リース登録番号
        sqlSeikyuStat.AppendLine("  , @CTNTYPE")              'コンテナ形式
        sqlSeikyuStat.AppendLine("  , @CTNNO")                'コンテナ番号
        sqlSeikyuStat.AppendLine("  , @LEASEYM")              'リース年月
        sqlSeikyuStat.AppendLine("  , @CLOSINGDATE")          '締年月日
        sqlSeikyuStat.AppendLine("  , @LEASESTARTYMD")        'リース開始日
        sqlSeikyuStat.AppendLine("  , @LEASEENDYMD")          'リース終了日
        sqlSeikyuStat.AppendLine("  , @MONTHLEASEFEE")        '月額リース料
        sqlSeikyuStat.AppendLine("  , @TAXKBN")               '税区分
        sqlSeikyuStat.AppendLine("  , @ROUNDKBN")             '日割端数処理区分
        sqlSeikyuStat.AppendLine("  , @LEASEAPPLYKBN")        'リース適用区分
        sqlSeikyuStat.AppendLine("  , @CANCELYMD")            '途中解約日
        sqlSeikyuStat.AppendLine("  , @DAILYRATE")            'リース額（日割）
        sqlSeikyuStat.AppendLine("  , @DAILYRATEROUND")       'リース額（日割）丸め前
        sqlSeikyuStat.AppendLine("  , @LEASEMONTHSTARTYMD")   '当月のリース期間 開始日
        sqlSeikyuStat.AppendLine("  , @LEASEMONTHENDYMD")     '当月のリース期間 終了日
        sqlSeikyuStat.AppendLine("  , @OUTINVTYPE")           '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , @INVOICEEXCLUSIONFLAG") '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , @REMARKS")              '備考
        sqlSeikyuStat.AppendLine("  , @DELFLG")               '削除フラグ
        sqlSeikyuStat.AppendLine("  , @INITYMD")              '登録年月日
        sqlSeikyuStat.AppendLine("  , @INITUSER")             '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , @INITTERMID")           '登録端末
        sqlSeikyuStat.AppendLine("  , @INITPGID")             '登録プログラムID
        sqlSeikyuStat.AppendLine("  , @RECEIVEYMD")           '集信日時
        sqlSeikyuStat.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htLeaseData(LEASE_INSTPARAM.IP_KEIJOYM)                                                 '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICENUMBER))                 '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICEORGCODE))               '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_TORICODE))                           '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICETYPE))                     '請求書種類
                .Add("INVSUBCD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVSUBCD))                           '細分コード
                .Add("LEASENO", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASENO))                             'リース登録番号
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_CTNTYPE))                             'コンテナ形式
                .Add("CTNNO", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_CTNNO))                                      'コンテナ番号
                .Add("LEASEYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASEYM))                                  'リース年月
                .Add("CLOSINGDATE", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_CLOSINGDATE))                         '締年月日
                .Add("LEASESTARTYMD", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASESTARTYMD))                     'リース開始日
                .Add("LEASEENDYMD", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASEENDYMD))                         'リース終了日
                .Add("MONTHLEASEFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_MONTHLEASEFEE))                    '月額リース料
                .Add("TAXKBN", MySqlDbType.VarChar).Value = htLeaseData(LEASE_INSTPARAM.IP_TAXKBN)                                              '税区分
                .Add("ROUNDKBN", MySqlDbType.Int32).Value = htLeaseData(LEASE_INSTPARAM.IP_ROUNDKBN)                                               '日割端数処理区分
                .Add("LEASEAPPLYKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASEAPPLYKBN))                 'リース適用区分
                .Add("CANCELYMD", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_CANCELYMD))                             '途中解約日
                .Add("DAILYRATE", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_DAILYRATE))                            'リース額（日割）
                .Add("DAILYRATEROUND", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_DAILYRATEROUND))                  'リース額（日割）丸め前
                .Add("LEASEMONTHSTARTYMD", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASEMONTHSTARTYMD))           '当月のリース期間 開始日
                .Add("LEASEMONTHENDYMD", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASEMONTHENDYMD))               '当月のリース期間 終了日
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_OUTINVTYPE))                       '出力先請求書区分
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICEEXCLUSIONFLAG))   '請求除外フラグ
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_REMARKS))                             '備考
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_DELFLG))                                    '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITYMD))                             '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITUSER))                           '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITTERMID))                       '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITPGID))                           '登録プログラムID
                .Add("RECEIVEYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_RECEIVEYMD))                       '集信日時

            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0068_INVOICEDATA_LEASE]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細売却在庫データTBL追加処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求ヘッダーデータ</param>
    Public Shared Sub InsertSeikyuData_Container(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0104_INVOICEDATA_CONTAINER (")
        sqlSeikyuStat.AppendLine("    KEIJOYM")
        sqlSeikyuStat.AppendLine("  , INVOICENUMBER")
        sqlSeikyuStat.AppendLine("  , INVOICEORGCODE")
        sqlSeikyuStat.AppendLine("  , TORICODE")
        sqlSeikyuStat.AppendLine("  , INVOICETYPE")
        sqlSeikyuStat.AppendLine("  , INVSUBCD")
        sqlSeikyuStat.AppendLine("  , CTNTYPE")
        sqlSeikyuStat.AppendLine("  , CTNNO")
        sqlSeikyuStat.AppendLine("  , CONFIRMFLG")
        sqlSeikyuStat.AppendLine("  , STOCKBRANCHCODE")
        sqlSeikyuStat.AppendLine("  , BRANCHCODE")
        sqlSeikyuStat.AppendLine("  , STATIONCODE")
        sqlSeikyuStat.AppendLine("  , STOCKSTATUS")
        sqlSeikyuStat.AppendLine("  , BEFMONTHBALANCE")
        sqlSeikyuStat.AppendLine("  , BOOKVALUE")
        sqlSeikyuStat.AppendLine("  , COSTOFGOODSSALES")
        sqlSeikyuStat.AppendLine("  , FRACTIONAMOUNT")
        sqlSeikyuStat.AppendLine("  , CURRENTMONTHPAYOUT")
        sqlSeikyuStat.AppendLine("  , MONTHBALANCE")
        sqlSeikyuStat.AppendLine("  , SALESAMOUNT")
        sqlSeikyuStat.AppendLine("  , SALESAMOUNTTAXRATE")
        sqlSeikyuStat.AppendLine("  , SALESAMOUNTTAXCODE")
        sqlSeikyuStat.AppendLine("  , POSTAGE")
        sqlSeikyuStat.AppendLine("  , POSTAGETAXRATE")
        sqlSeikyuStat.AppendLine("  , POSTAGETAXCODE")
        sqlSeikyuStat.AppendLine("  , CLEANINGFEE")
        sqlSeikyuStat.AppendLine("  , CLEANINGFEETAXRATE")
        sqlSeikyuStat.AppendLine("  , CLEANINGFEETAXCODE")
        sqlSeikyuStat.AppendLine("  , MAINTENANCEFEE")
        sqlSeikyuStat.AppendLine("  , MAINTENANCEFEETAXRATE")
        sqlSeikyuStat.AppendLine("  , MAINTENANCEFEETAXCODE")
        sqlSeikyuStat.AppendLine("  , OTHERFEE")
        sqlSeikyuStat.AppendLine("  , OTHERFEETAXRATE")
        sqlSeikyuStat.AppendLine("  , OTHERFEETAXCODE")
        sqlSeikyuStat.AppendLine("  , TAXAMOUNT")
        sqlSeikyuStat.AppendLine("  , TAXKBN")
        sqlSeikyuStat.AppendLine("  , STOCKREGISTRATIONDATE")
        sqlSeikyuStat.AppendLine("  , EXCEPTIONDATE")
        sqlSeikyuStat.AppendLine("  , SALESCONTRACTDATE")
        sqlSeikyuStat.AppendLine("  , DELIVERYLOCATION")
        sqlSeikyuStat.AppendLine("  , INVKESAIKBN")
        sqlSeikyuStat.AppendLine("  , SCHEDATEPAYMENT")
        sqlSeikyuStat.AppendLine("  , INACCOUNTCD")
        sqlSeikyuStat.AppendLine("  , ACCOUNTINGMONTH")
        sqlSeikyuStat.AppendLine("  , CLOSINGDAY")
        sqlSeikyuStat.AppendLine("  , DEPOSITDAY")
        sqlSeikyuStat.AppendLine("  , DEPOSITMONTHKBN")
        sqlSeikyuStat.AppendLine("  , ACC_DEBIT_ACCOUNT")
        sqlSeikyuStat.AppendLine("  , ACC_DEBIT_ORGCD")
        sqlSeikyuStat.AppendLine("  , ACC_DEBIT_SEGMENTCODE1")
        sqlSeikyuStat.AppendLine("  , ACC_DEBIT_SEGMENTCODE2")
        sqlSeikyuStat.AppendLine("  , ACC_DEBIT_SEGMENTCODE3")
        sqlSeikyuStat.AppendLine("  , ACC_CREDIT_ACCOUNT")
        sqlSeikyuStat.AppendLine("  , ACC_CREDIT_ORGCD")
        sqlSeikyuStat.AppendLine("  , ACC_CREDIT_SEGMENTCODE1")
        sqlSeikyuStat.AppendLine("  , ACC_CREDIT_SEGMENTCODE2")
        sqlSeikyuStat.AppendLine("  , ACC_CREDIT_SEGMENTCODE3")
        sqlSeikyuStat.AppendLine("  , STOCKREGISTRATID")
        sqlSeikyuStat.AppendLine("  , STOCKUPDATEID")
        sqlSeikyuStat.AppendLine("  , REQUESTID")
        sqlSeikyuStat.AppendLine("  , REQUESTDATE")
        sqlSeikyuStat.AppendLine("  , REMARK")
        sqlSeikyuStat.AppendLine("  , DISPOSALFLG")
        sqlSeikyuStat.AppendLine("  , NOOPERATINGFLG")
        sqlSeikyuStat.AppendLine("  , WFREQUESTFLG")
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG")
        sqlSeikyuStat.AppendLine("  , DELFLG")
        sqlSeikyuStat.AppendLine("  , INITYMD")
        sqlSeikyuStat.AppendLine("  , INITUSER")
        sqlSeikyuStat.AppendLine("  , INITTERMID")
        sqlSeikyuStat.AppendLine("  , INITPGID")
        sqlSeikyuStat.AppendLine("  , RECEIVEYMD")
        sqlSeikyuStat.AppendLine(")")
        sqlSeikyuStat.AppendLine(" VALUES(")
        sqlSeikyuStat.AppendLine("    @KEIJOYM")
        sqlSeikyuStat.AppendLine("  , @INVOICENUMBER")
        sqlSeikyuStat.AppendLine("  , @INVOICEORGCODE")
        sqlSeikyuStat.AppendLine("  , @TORICODE")
        sqlSeikyuStat.AppendLine("  , @INVOICETYPE")
        sqlSeikyuStat.AppendLine("  , @INVSUBCD")
        sqlSeikyuStat.AppendLine("  , @CTNTYPE")
        sqlSeikyuStat.AppendLine("  , @CTNNO")
        sqlSeikyuStat.AppendLine("  , @CONFIRMFLG")
        sqlSeikyuStat.AppendLine("  , @STOCKBRANCHCODE")
        sqlSeikyuStat.AppendLine("  , @BRANCHCODE")
        sqlSeikyuStat.AppendLine("  , @STATIONCODE")
        sqlSeikyuStat.AppendLine("  , @STOCKSTATUS")
        sqlSeikyuStat.AppendLine("  , @BEFMONTHBALANCE")
        sqlSeikyuStat.AppendLine("  , @BOOKVALUE")
        sqlSeikyuStat.AppendLine("  , @COSTOFGOODSSALES")
        sqlSeikyuStat.AppendLine("  , @FRACTIONAMOUNT")
        sqlSeikyuStat.AppendLine("  , @CURRENTMONTHPAYOUT")
        sqlSeikyuStat.AppendLine("  , @MONTHBALANCE")
        sqlSeikyuStat.AppendLine("  , @SALESAMOUNT1") '2024/07/23 伊藤 CHG
        sqlSeikyuStat.AppendLine("  , @SALESAMOUNTTAXRATE")
        sqlSeikyuStat.AppendLine("  , @SALESAMOUNTTAXCODE")
        sqlSeikyuStat.AppendLine("  , @POSTAGE1") '2024/07/23 伊藤 CHG
        sqlSeikyuStat.AppendLine("  , @POSTAGETAXRATE")
        sqlSeikyuStat.AppendLine("  , @POSTAGETAXCODE")
        sqlSeikyuStat.AppendLine("  , @CLEANINGFEE1") '2024/07/23 伊藤 CHG
        sqlSeikyuStat.AppendLine("  , @CLEANINGFEETAXRATE")
        sqlSeikyuStat.AppendLine("  , @CLEANINGFEETAXCODE")
        sqlSeikyuStat.AppendLine("  , @MAINTENANCEFEE1") '2024/07/23 伊藤 CHG
        sqlSeikyuStat.AppendLine("  , @MAINTENANCEFEETAXRATE")
        sqlSeikyuStat.AppendLine("  , @MAINTENANCEFEETAXCODE")
        sqlSeikyuStat.AppendLine("  , @OTHERFEE1") '2024/07/23 伊藤 CHG
        sqlSeikyuStat.AppendLine("  , @OTHERFEETAXRATE")
        sqlSeikyuStat.AppendLine("  , @OTHERFEETAXCODE")
        sqlSeikyuStat.AppendLine("  , @TAXAMOUNT")
        sqlSeikyuStat.AppendLine("  , @TAXKBN")
        sqlSeikyuStat.AppendLine("  , @STOCKREGISTRATIONDATE")
        sqlSeikyuStat.AppendLine("  , @EXCEPTIONDATE")
        sqlSeikyuStat.AppendLine("  , @SALESCONTRACTDATE")
        sqlSeikyuStat.AppendLine("  , @DELIVERYLOCATION")
        sqlSeikyuStat.AppendLine("  , @INVKESAIKBN")
        sqlSeikyuStat.AppendLine("  , @SCHEDATEPAYMENT")
        sqlSeikyuStat.AppendLine("  , @INACCOUNTCD")
        sqlSeikyuStat.AppendLine("  , @ACCOUNTINGMONTH")
        sqlSeikyuStat.AppendLine("  , @CLOSINGDAY")
        sqlSeikyuStat.AppendLine("  , @DEPOSITDAY")
        sqlSeikyuStat.AppendLine("  , @DEPOSITMONTHKBN")
        sqlSeikyuStat.AppendLine("  , @ACC_DEBIT_ACCOUNT")
        sqlSeikyuStat.AppendLine("  , @ACC_DEBIT_ORGCD")
        sqlSeikyuStat.AppendLine("  , @ACC_DEBIT_SEGMENTCODE1")
        sqlSeikyuStat.AppendLine("  , @ACC_DEBIT_SEGMENTCODE2")
        sqlSeikyuStat.AppendLine("  , @ACC_DEBIT_SEGMENTCODE3")
        sqlSeikyuStat.AppendLine("  , @ACC_CREDIT_ACCOUNT")
        sqlSeikyuStat.AppendLine("  , @ACC_CREDIT_ORGCD")
        sqlSeikyuStat.AppendLine("  , @ACC_CREDIT_SEGMENTCODE1")
        sqlSeikyuStat.AppendLine("  , @ACC_CREDIT_SEGMENTCODE2")
        sqlSeikyuStat.AppendLine("  , @ACC_CREDIT_SEGMENTCODE3")
        sqlSeikyuStat.AppendLine("  , @STOCKREGISTRATID")
        sqlSeikyuStat.AppendLine("  , @STOCKUPDATEID")
        sqlSeikyuStat.AppendLine("  , @REQUESTID")
        sqlSeikyuStat.AppendLine("  , @REQUESTDATE")
        sqlSeikyuStat.AppendLine("  , @REMARK")
        sqlSeikyuStat.AppendLine("  , @DISPOSALFLG")
        sqlSeikyuStat.AppendLine("  , @NOOPERATINGFLG")
        sqlSeikyuStat.AppendLine("  , @WFREQUESTFLG")
        sqlSeikyuStat.AppendLine("  , @INVOICEEXCLUSIONFLAG")
        sqlSeikyuStat.AppendLine("  , @DELFLG")
        sqlSeikyuStat.AppendLine("  , @INITYMD")
        sqlSeikyuStat.AppendLine("  , @INITUSER")
        sqlSeikyuStat.AppendLine("  , @INITTERMID")
        sqlSeikyuStat.AppendLine("  , @INITPGID")
        sqlSeikyuStat.AppendLine("  , @RECEIVEYMD")
        sqlSeikyuStat.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_KEIJOYM)
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INVOICENUMBER)
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INVOICEORGCODE)
                .Add("TORICODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_TORICODE)
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INVOICETYPE)
                .Add("INVSUBCD", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_INVSUBCD)
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_CTNTYPE)
                .Add("CTNNO", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_CTNNO)
                .Add("CONFIRMFLG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_CONFIRMFLG))
                .Add("STOCKBRANCHCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_STOCKBRANCHCODE)
                .Add("BRANCHCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_BRANCHCODE)
                .Add("STATIONCODE", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_STATIONCODE)
                .Add("STOCKSTATUS", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_STOCKSTATUS)
                .Add("BEFMONTHBALANCE", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_BEFMONTHBALANCE))
                .Add("BOOKVALUE", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_BOOKVALUE))
                .Add("COSTOFGOODSSALES", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_COSTOFGOODSSALES))
                .Add("FRACTIONAMOUNT", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_FRACTIONAMOUNT))
                .Add("CURRENTMONTHPAYOUT", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_CURRENTMONTHPAYOUT))
                .Add("MONTHBALANCE", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_MONTHBALANCE))
                .Add("SALESAMOUNT1", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_SALESAMOUNT)) '2024/07/23 伊藤 CHG
                .Add("SALESAMOUNTTAXRATE", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_SALESAMOUNTTAXRATE)
                .Add("SALESAMOUNTTAXCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_SALESAMOUNTTAXCODE)
                .Add("POSTAGE1", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_POSTAGE)) '2024/07/23 伊藤 CHG
                .Add("POSTAGETAXRATE", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_POSTAGETAXRATE)
                .Add("POSTAGETAXCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_POSTAGETAXCODE)
                .Add("CLEANINGFEE1", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_CLEANINGFEE)) '2024/07/23 伊藤 CHG
                .Add("CLEANINGFEETAXRATE", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_CLEANINGFEETAXRATE)
                .Add("CLEANINGFEETAXCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_CLEANINGFEETAXCODE)
                .Add("MAINTENANCEFEE1", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_MAINTENANCEFEE)) '2024/07/23 伊藤 CHG
                .Add("MAINTENANCEFEETAXRATE", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_MAINTENANCEFEETAXRATE)
                .Add("MAINTENANCEFEETAXCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_MAINTENANCEFEETAXCODE)
                .Add("OTHERFEE1", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_OTHERFEE)) '2024/07/23 伊藤 CHG
                .Add("OTHERFEETAXRATE", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_OTHERFEETAXRATE)
                .Add("OTHERFEETAXCODE", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_OTHERFEETAXCODE)
                .Add("TAXAMOUNT", MySqlDbType.Decimal).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_TAXAMOUNT))
                .Add("TAXKBN", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_TAXKBN)
                .Add("STOCKREGISTRATIONDATE", MySqlDbType.Date).Value = htLeaseData(CTN_INSTPARAM.IP_STOCKREGISTRATIONDATE)
                .Add("EXCEPTIONDATE", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_EXCEPTIONDATE))
                .Add("SALESCONTRACTDATE", MySqlDbType.Date).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_SALESCONTRACTDATE))
                .Add("DELIVERYLOCATION", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_DELIVERYLOCATION))
                .Add("INVKESAIKBN", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_INVKESAIKBN)
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = htLeaseData(CTN_INSTPARAM.IP_SCHEDATEPAYMENT)
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INACCOUNTCD)
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_ACCOUNTINGMONTH)
                .Add("CLOSINGDAY", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_CLOSINGDAY)
                .Add("DEPOSITDAY", MySqlDbType.Int32).Value = htLeaseData(CTN_INSTPARAM.IP_DEPOSITDAY)
                .Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_DEPOSITMONTHKBN)
                .Add("ACC_DEBIT_ACCOUNT", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_DEBIT_ACCOUNT))
                .Add("ACC_DEBIT_ORGCD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_DEBIT_ORGCD))
                .Add("ACC_DEBIT_SEGMENTCODE1", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_DEBIT_SEGMENTCODE1))
                .Add("ACC_DEBIT_SEGMENTCODE2", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_DEBIT_SEGMENTCODE2))
                .Add("ACC_DEBIT_SEGMENTCODE3", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_DEBIT_SEGMENTCODE3))
                .Add("ACC_CREDIT_ACCOUNT", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_CREDIT_ACCOUNT))
                .Add("ACC_CREDIT_ORGCD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_CREDIT_ORGCD))
                .Add("ACC_CREDIT_SEGMENTCODE1", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_CREDIT_SEGMENTCODE1))
                .Add("ACC_CREDIT_SEGMENTCODE2", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_CREDIT_SEGMENTCODE2))
                .Add("ACC_CREDIT_SEGMENTCODE3", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_ACC_CREDIT_SEGMENTCODE3))
                .Add("STOCKREGISTRATID", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_STOCKREGISTRATID)
                .Add("STOCKUPDATEID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_STOCKUPDATEID))
                .Add("REQUESTID", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_REQUESTID)
                .Add("REQUESTDATE", MySqlDbType.DateTime).Value = htLeaseData(CTN_INSTPARAM.IP_REQUESTDATE)
                .Add("REMARK", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_REMARKS))
                .Add("DISPOSALFLG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_DISPOSALFLG))
                .Add("NOOPERATINGFLG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_NOOPERATINGFLG))
                .Add("WFREQUESTFLG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_WFREQUESTFLG))
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INVOICEEXCLUSIONFLAG))
                .Add("DELFLG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_DELFLG))
                .Add("INITYMD", MySqlDbType.DateTime).Value = htLeaseData(CTN_INSTPARAM.IP_INITYMD)
                .Add("INITUSER", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INITUSER)
                .Add("INITTERMID", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INITTERMID)
                .Add("INITPGID", MySqlDbType.VarChar).Value = htLeaseData(CTN_INSTPARAM.IP_INITPGID)
                .Add("RECEIVEYMD", MySqlDbType.DateTime).Value = htLeaseData(CTN_INSTPARAM.IP_RECEIVEYMD)

            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                ElseIf TypeOf paramValue Is Double OrElse TypeOf paramValue Is Decimal Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString().Replace(",", "."))
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0104_INVOICEDATA_CONTAINER]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求書発行履歴データTBL追加処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLogData">請求書発行履歴データ</param>
    Public Shared Sub InsertInvoiceLog(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLogData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0069_INVOICELOG (")
        sqlSeikyuStat.AppendLine("    KEIJOYM")             '請求年月
        sqlSeikyuStat.AppendLine("  , INVOICENUMBER")       '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICEORGCODE")      '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , TORICODE")            '請求取引先コード
        sqlSeikyuStat.AppendLine("  , INVOICETYPE")         '請求書種類
        sqlSeikyuStat.AppendLine("  , INVSUBCD")            '細分コード
        sqlSeikyuStat.AppendLine("  , REQUESTSTATUS")       '請求申請状態
        sqlSeikyuStat.AppendLine("  , RQSTAFF")             '担当ユーザID
        sqlSeikyuStat.AppendLine("  , RQDATE")              '確認提出日
        sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER")      '確認ユーザID
        sqlSeikyuStat.AppendLine("  , RQACKNDATE")          '確認者確認日
        sqlSeikyuStat.AppendLine("  , SENDBACKDATE")        '確認者差戻日
        sqlSeikyuStat.AppendLine("  , ISSUEDATE")           '請求書発行日
        sqlSeikyuStat.AppendLine("  , INVOICECANCELER")     '取消ユーザID
        sqlSeikyuStat.AppendLine("  , INVOICECANCELDATE")   '取消年月日
        sqlSeikyuStat.AppendLine("  , DELFLG")              '削除フラグ
        sqlSeikyuStat.AppendLine("  , INITYMD")             '登録年月日
        sqlSeikyuStat.AppendLine("  , INITUSER")            '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , INITTERMID")          '登録端末
        sqlSeikyuStat.AppendLine("  , INITPGID")            '登録プログラムID
        sqlSeikyuStat.AppendLine("  , RECEIVEYMD")          '集信日時
        sqlSeikyuStat.AppendLine(")")
        sqlSeikyuStat.AppendLine(" VALUES(")
        sqlSeikyuStat.AppendLine("    @KEIJOYM")            '請求年月
        sqlSeikyuStat.AppendLine("  , @INVOICENUMBER")      '請求番号
        sqlSeikyuStat.AppendLine("  , @INVOICEORGCODE")     '請求担当部店コード
        sqlSeikyuStat.AppendLine("  , @TORICODE")           '請求取引先コード
        sqlSeikyuStat.AppendLine("  , @INVOICETYPE")        '請求書種類
        sqlSeikyuStat.AppendLine("  , @INVSUBCD")           '細分コード
        sqlSeikyuStat.AppendLine("  , @REQUESTSTATUS")      '請求申請状態
        sqlSeikyuStat.AppendLine("  , @RQSTAFF")            '担当ユーザID
        sqlSeikyuStat.AppendLine("  , @RQDATE")             '確認提出日
        sqlSeikyuStat.AppendLine("  , @RQACKNOWLEDGER")     '確認ユーザID
        sqlSeikyuStat.AppendLine("  , @RQACKNDATE")         '確認者確認日
        sqlSeikyuStat.AppendLine("  , @SENDBACKDATE")       '確認者差戻日
        sqlSeikyuStat.AppendLine("  , @ISSUEDATE")          '請求書発行日
        sqlSeikyuStat.AppendLine("  , @INVOICECANCELER")    '取消ユーザID
        sqlSeikyuStat.AppendLine("  , @INVOICECANCELDATE")  '取消年月日
        sqlSeikyuStat.AppendLine("  , @DELFLG")             '削除フラグ
        sqlSeikyuStat.AppendLine("  , @INITYMD")            '登録年月日
        sqlSeikyuStat.AppendLine("  , @INITUSER")           '登録ユーザーID
        sqlSeikyuStat.AppendLine("  , @INITTERMID")         '登録端末
        sqlSeikyuStat.AppendLine("  , @INITPGID")           '登録プログラムID
        sqlSeikyuStat.AppendLine("  , @RECEIVEYMD")         '集信日時
        sqlSeikyuStat.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htLogData(INVOICELOG_PARM.IP_KEIJOYM)                                            '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICENUMBER))            '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICEORGCODE))          '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_TORICODE))                      '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICETYPE))                '請求書種類
                .Add("INVSUBCD", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVSUBCD))                      '細分コード
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_REQUESTSTATUS))            '請求申請状態
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_RQSTAFF))                        '担当ユーザID
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_RQDATE))                          '確認提出日
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_RQACKNOWLEDGER))          '確認ユーザID
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_RQACKNDATE))                  '確認者確認日
                .Add("SENDBACKDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_SENDBACKDATE))              '確認者差戻日
                .Add("ISSUEDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_ISSUEDATE))                    '請求書発行日
                .Add("INVOICECANCELER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICECANCELER))        '取消ユーザID
                .Add("INVOICECANCELDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICECANCELDATE))    '取消年月日
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_DELFLG))                               '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INITYMD))                        '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INITUSER))                      '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INITTERMID))                  '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INITPGID))                      '登録プログラムID
                .Add("RECEIVEYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_RECEIVEYMD))                  '集信日時

            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0069_INVOICELOG]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

#End Region

#Region "更新処理部"
    ''' <summary>
    ''' 請求ヘッダーデータTBL更新処理(収入管理(詳細)画面用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceIncome(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, skipflg As String, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        '金額更新ボタンにより登録されたデータの処理
        If htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "1" Then
            sqlSeikyuStat.AppendLine("  , INACCOUNTCD = @INACCOUNTCD")                  '社内口座コード
            sqlSeikyuStat.AppendLine("  , ACCOUNTINGMONTH = @ACCOUNTINGMONTH")          '計上月区分
            'sqlSeikyuStat.AppendLine("  , CLOSINGDAY = @CLOSINGDAY")                    '計上締日
            sqlSeikyuStat.AppendLine("  , DEPOSITDAY = @DEPOSITDAY")                    '入金日
            'sqlSeikyuStat.AppendLine("  , DEPOSITMONTHKBN = @DEPOSITMONTHKBN")          '入金月区分
            sqlSeikyuStat.AppendLine("  , SLIPDESCRIPTION1 = @SLIPDESCRIPTION1")        '伝票摘要１
            sqlSeikyuStat.AppendLine("  , SLIPDESCRIPTION2 = @SLIPDESCRIPTION2")        '伝票摘要２
        End If
        If htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "1" OrElse htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "2" Then
            'レンタル料
            If htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "2" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = @RENTALQTY")                  'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = @RENTALTOTAL")              'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = @RENTALCTAX")                'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                'リース料
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "3" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = @LEASEQTY")                    'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = @LEASETOTAL")                'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = @LEASECTAX")                  'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                '手書き料
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "4" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = @WRITEQTY")                    '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = @WRITETOTAL")                '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = @WRITECTAX")                  '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                '売却在庫
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "5" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = @CTNQTY")                        '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = @CTNTOTAL")                    '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = @CTNCTAX")                       '売却在庫消費税
            End If
        End If

        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                      '請求書種類
        If htHeadData(SEIKYU_UPDDTLPARAM.DP_REQUESTSTATUS).ToString = "1" Then
            sqlSeikyuStat.AppendLine("  , INVOICELINK = '0'")                           '請求連携状態
            sqlSeikyuStat.AppendLine("  , ACNTLINK = '0'")                              '経理連携状態
        End If
        sqlSeikyuStat.AppendLine("  , REQUESTSTATUS = @REQUESTSTATUS")                  '請求申請状態
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQSTAFF).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQSTAFF = @RQSTAFF")                          '担当ユーザーID
        End If
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQDATE = @RQDATE")                            '担当処理日時
        End If
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNOWLEDGER).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER = @RQACKNOWLEDGER")            '確認ユーザーID
        End If
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNDATE = @RQACKNDATE")                    '確認処理日時
        End If
        If skipflg = "0" Then
            sqlSeikyuStat.AppendLine("  , PRINTDATE = @PRINTDATE")                          '印字発行日
            sqlSeikyuStat.AppendLine("  , DETAILKBN = @DETAILKBN")                          '明細有無区分
            sqlSeikyuStat.AppendLine("  , HEADERCOMMENT = @HEADERCOMMENT")                  '請求ヘッダーコメント
            sqlSeikyuStat.AppendLine("  , FOOTERCOMMENT = @FOOTERCOMMENT")                  '請求フッターコメント
        End If
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE)                           '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_REQUESTSTATUS))        '請求申請状態
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INACCOUNTCD))              '社内口座コード
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_ACCOUNTINGMONTH))      '計上月区分
                .Add("DEPOSITDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_DEPOSITDAY))                '入金日
                .Add("SLIPDESCRIPTION1", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION1))    '伝票摘要１
                .Add("SLIPDESCRIPTION2", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION2))    '伝票摘要２
                .Add("RENTALQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALQTY))                     'レンタル個数
                .Add("RENTALTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALTOTAL))               'レンタル使用料合計
                .Add("RENTALCTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALCTAX))                 'レンタル使用料消費税
                .Add("LEASEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASEQTY))                       'リース個数
                .Add("LEASETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASETOTAL))                 'リース料合計
                .Add("LEASECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASECTAX))                   'リース料消費税
                .Add("WRITEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITEQTY))                       '手書き個数
                .Add("WRITETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITETOTAL))                 '手書き合計
                .Add("WRITECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITECTAX))                   '手書き消費税
                .Add("CTNQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNQTY))                           '売却在庫個数
                .Add("CTNTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNTOTAL))                     '売却在庫合計
                .Add("CTNCTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNCTAX))                       '売却在庫消費税
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQSTAFF))                    '担当ユーザーID
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQDATE))                      '担当処理日時
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNOWLEDGER))      '確認ユーザーID
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNDATE))              '確認処理日時
                .Add("PRINTDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_PRINTDATE))                '印字発行日
                .Add("DETAILKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_DETAILKBN))                '明細有無区分
                .Add("HEADERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_HEADERCOMMENT))        '請求ヘッダーコメント
                .Add("FOOTERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_FOOTERCOMMENT))        '請求フッターコメント
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
                .Add("RECEIVEYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RECEIVEYMD))              '集信日時
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                '.Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_DEPOSITMONTHKBN)                   '入金月区分
                '.Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CLOSINGDAY))              '締日
            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0064_INVOICEHEAD]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求ヘッダーデータTBL更新処理(収入管理(詳細)画面用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceIncome_Save(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        If htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "1" OrElse htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "2" Then
            'レンタル料
            If htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "2" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = @RENTALQTY")                  'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = @RENTALTOTAL")              'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = @RENTALCTAX")                'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                'リース料
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "3" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = @LEASEQTY")                    'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = @LEASETOTAL")                'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = @LEASECTAX")                  'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                '手書き料
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "4" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = @WRITEQTY")                    '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = @WRITETOTAL")                '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = @WRITECTAX")                  '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                '売却在庫
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "5" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = @CTNQTY")                        '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = @CTNTOTAL")                    '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = @CTNTAX")                        '売却在庫消費税
            End If
        End If

        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                      '請求書種類
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQSTAFF).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQSTAFF = @RQSTAFF")                          '担当ユーザーID
        End If
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNOWLEDGER).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER = @RQACKNOWLEDGER")            '確認ユーザーID
        End If
        sqlSeikyuStat.AppendLine("  , PRINTDATE = @PRINTDATE")                          '印字発行日
        sqlSeikyuStat.AppendLine("  , DETAILKBN = @DETAILKBN")                          '明細有無区分
        sqlSeikyuStat.AppendLine("  , HEADERCOMMENT = @HEADERCOMMENT")                  '請求ヘッダーコメント
        sqlSeikyuStat.AppendLine("  , FOOTERCOMMENT = @FOOTERCOMMENT")                  '請求フッターコメント
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE)                           '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_REQUESTSTATUS))        '請求申請状態
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INACCOUNTCD))              '社内口座コード
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_ACCOUNTINGMONTH))      '計上月区分
                .Add("DEPOSITDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_DEPOSITDAY))                '入金日
                .Add("SLIPDESCRIPTION1", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION1))    '伝票摘要１
                .Add("SLIPDESCRIPTION2", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION2))    '伝票摘要２
                .Add("RENTALQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALQTY))                     'レンタル個数
                .Add("RENTALTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALTOTAL))               'レンタル使用料合計
                .Add("RENTALCTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALCTAX))                 'レンタル使用料消費税
                .Add("LEASEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASEQTY))                       'リース個数
                .Add("LEASETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASETOTAL))                 'リース料合計
                .Add("LEASECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASECTAX))                   'リース料消費税
                .Add("WRITEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITEQTY))                       '手書き個数
                .Add("WRITETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITETOTAL))                 '手書き合計
                .Add("WRITECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITECTAX))                   '手書き消費税
                .Add("CTNQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNQTY))                           '売却在庫個数
                .Add("CTNTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNTOTAL))                     '売却在庫合計
                .Add("CTNTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNCTAX))                        '売却在庫消費税
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQSTAFF))                    '担当ユーザーID
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQDATE))                      '担当処理日時
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNOWLEDGER))      '確認ユーザーID
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNDATE))              '確認処理日時
                .Add("PRINTDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_PRINTDATE))                '印字発行日
                .Add("DETAILKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_DETAILKBN))                '明細有無区分
                .Add("HEADERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_HEADERCOMMENT))        '請求ヘッダーコメント
                .Add("FOOTERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_FOOTERCOMMENT))        '請求フッターコメント
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
                .Add("RECEIVEYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RECEIVEYMD))              '集信日時
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                '.Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_DEPOSITMONTHKBN)                   '入金月区分
                '.Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CLOSINGDAY))              '締日
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求ヘッダーデータTBL更新処理(取り下げ、差し戻し)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceIncome_RE(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, skipflg As String, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICETYPE = @INVOICETYPE")                      '請求書種類
        sqlSeikyuStat.AppendLine("  , REQUESTSTATUS = @REQUESTSTATUS")                  '請求申請状態
        If skipflg = "0" Then
            sqlSeikyuStat.AppendLine("  , PRINTDATE = @PRINTDATE")                      '印字発行日
            sqlSeikyuStat.AppendLine("  , DETAILKBN = @DETAILKBN")                      '明細有無区分
            sqlSeikyuStat.AppendLine("  , HEADERCOMMENT = @HEADERCOMMENT")              '請求ヘッダーコメント
            sqlSeikyuStat.AppendLine("  , FOOTERCOMMENT = @FOOTERCOMMENT")              '請求フッターコメント
        End If
        sqlSeikyuStat.AppendLine("  , RQDATE = @RQDATE")                                '担当処理日時
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE)                           '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_REQUESTSTATUS))        '請求申請状態
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQDATE))                      '担当処理日時
                .Add("PRINTDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_PRINTDATE))                '印字発行日
                .Add("DETAILKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_DETAILKBN))                '明細有無区分
                .Add("HEADERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_HEADERCOMMENT))        '請求ヘッダーコメント
                .Add("FOOTERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_FOOTERCOMMENT))        '請求フッターコメント
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
                .Add("RECEIVEYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RECEIVEYMD))              '集信日時
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0064_INVOICEHEAD]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求ヘッダーデータTBL更新処理(収入管理(詳細)画面用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceIncome_UpdFlg(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, requestflg As String)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        If htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "1" OrElse htHeadData(SEIKYU_UPDDTLPARAM.DP_MONEYFLG).ToString = "2" Then
            'レンタル料
            If htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "2" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = @RENTALQTY")                  'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = @RENTALTOTAL")              'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = @RENTALCTAX")                'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                'リース料
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "3" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = @LEASEQTY")                    'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = @LEASETOTAL")                'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = @LEASECTAX")                  'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                '手書き料
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "4" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = @WRITEQTY")                    '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = @WRITETOTAL")                '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = @WRITECTAX")                  '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = '0'")                            '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = '0'")                          '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = '0'")                            '売却在庫消費税
                '売却在庫
            ElseIf htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE).ToString = "5" Then
                sqlSeikyuStat.AppendLine("  , RENTALQTY = '0'")                         'レンタル個数
                sqlSeikyuStat.AppendLine("  , RENTALTOTAL = '0'")                       'レンタル使用料合計
                sqlSeikyuStat.AppendLine("  , RENTALCTAX = '0'")                        'レンタル使用料消費税
                sqlSeikyuStat.AppendLine("  , LEASEQTY = '0'")                          'リース個数
                sqlSeikyuStat.AppendLine("  , LEASETOTAL = '0'")                        'リース料合計
                sqlSeikyuStat.AppendLine("  , LEASECTAX = '0'")                         'リース料消費税
                sqlSeikyuStat.AppendLine("  , WRITEQTY = '0'")                          '手書き個数
                sqlSeikyuStat.AppendLine("  , WRITETOTAL = '0'")                        '手書き合計
                sqlSeikyuStat.AppendLine("  , WRITECTAX = '0'")                         '手書き消費税
                sqlSeikyuStat.AppendLine("  , CTNQTY = @CTNQTY")                        '売却在庫個数
                sqlSeikyuStat.AppendLine("  , CTNTOTAL = @CTNTOTAL")                    '売却在庫合計
                sqlSeikyuStat.AppendLine("  , CTNTAX = @CTNTAX")                        '売却在庫消費税
            End If
        End If

        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                      '請求書種類
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQSTAFF).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQSTAFF = @RQSTAFF")                          '担当ユーザーID
        End If
        If Not String.IsNullOrEmpty(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNOWLEDGER).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER = @RQACKNOWLEDGER")            '確認ユーザーID
        End If
        sqlSeikyuStat.AppendLine("  , INVOICELINK = '0'")                               '請求連携状態
        sqlSeikyuStat.AppendLine("  , ACNTLINK = '0'")                                  '経理連携状態
        If requestflg = "1" Then
            sqlSeikyuStat.AppendLine("  , REQUESTSTATUS = @REQUESTSTATUS")                  '請求申請状態
        End If
        sqlSeikyuStat.AppendLine("  , PRINTDATE = @PRINTDATE")                          '印字発行日
        sqlSeikyuStat.AppendLine("  , DETAILKBN = @DETAILKBN")                          '明細有無区分
        sqlSeikyuStat.AppendLine("  , HEADERCOMMENT = @HEADERCOMMENT")                  '請求ヘッダーコメント
        sqlSeikyuStat.AppendLine("  , FOOTERCOMMENT = @FOOTERCOMMENT")                  '請求フッターコメント
        sqlSeikyuStat.AppendLine("  , UPDATEFLG = '0'")                                 '変更有りフラグ
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE)                           '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_REQUESTSTATUS))        '請求申請状態
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_INACCOUNTCD))              '社内口座コード
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_ACCOUNTINGMONTH))      '計上月区分
                .Add("DEPOSITDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_DEPOSITDAY))                '入金日
                .Add("SLIPDESCRIPTION1", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION1))    '伝票摘要１
                .Add("SLIPDESCRIPTION2", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_INSTPARAM.IP_SLIPDESCRIPTION2))    '伝票摘要２
                .Add("RENTALQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALQTY))                     'レンタル個数
                .Add("RENTALTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALTOTAL))               'レンタル使用料合計
                .Add("RENTALCTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALCTAX))                 'レンタル使用料消費税
                .Add("LEASEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASEQTY))                       'リース個数
                .Add("LEASETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASETOTAL))                 'リース料合計
                .Add("LEASECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASECTAX))                   'リース料消費税
                .Add("WRITEQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITEQTY))                       '手書き個数
                .Add("WRITETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITETOTAL))                 '手書き合計
                .Add("WRITECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_WRITECTAX))                   '手書き消費税
                .Add("CTNQTY", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNQTY))                           '売却在庫個数
                .Add("CTNTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNTOTAL))                     '売却在庫合計
                .Add("CTNTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CTNCTAX))                        '売却在庫消費税
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQSTAFF))                    '担当ユーザーID
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQDATE))                      '担当処理日時
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNOWLEDGER))      '確認ユーザーID
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RQACKNDATE))              '確認処理日時
                .Add("PRINTDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_PRINTDATE))                '印字発行日
                .Add("DETAILKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_DETAILKBN))                '明細有無区分
                .Add("HEADERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_HEADERCOMMENT))        '請求ヘッダーコメント
                .Add("FOOTERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_FOOTERCOMMENT))        '請求フッターコメント
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
                .Add("RECEIVEYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RECEIVEYMD))              '集信日時
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                '.Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_DEPOSITMONTHKBN)                   '入金月区分
                '.Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CLOSINGDAY))              '締日
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求ヘッダーデータTBL更新処理(金額更新ボタン用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceIncomeMoney(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        sqlSeikyuStat.AppendLine("  , RENTALTOTAL = @RENTALTOTAL")                      'レンタル使用料合計
        sqlSeikyuStat.AppendLine("  , RENTALCTAX = @RENTALCTAX")                        'レンタル使用料消費税
        sqlSeikyuStat.AppendLine("  , LEASETOTAL = @LEASETOTAL")                        'リース料合計
        sqlSeikyuStat.AppendLine("  , LEASECTAX = @LEASECTAX")                          'リース料消費税
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        'sqlSeikyuStat.AppendLine("AND coalesce(DEPOSITMONTHKBN, '') = @DEPOSITMONTHKBN")  '入金月区分
        'sqlSeikyuStat.AppendLine("AND CLOSINGDAY = @CLOSINGDAY")                        '締日
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("RENTALTOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALTOTAL))               'レンタル使用料合計
                .Add("RENTALCTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_RENTALCTAX))                 'レンタル使用料消費税
                .Add("LEASETOTAL", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASETOTAL))                 'リース料合計
                .Add("LEASECTAX", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_LEASECTAX))                   'リース料消費税
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                '.Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_DEPOSITMONTHKBN)                   '入金月区分
                '.Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CLOSINGDAY))              '締日
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求ヘッダーデータTBL更新処理(収入管理(詳細)画面用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceIncome_History(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        sqlSeikyuStat.AppendLine("  , PRINTDATE = @PRINTDATE")                          '印字発行日
        sqlSeikyuStat.AppendLine("  , DETAILKBN = @DETAILKBN")                          '明細有無区分
        sqlSeikyuStat.AppendLine("  , HEADERCOMMENT = @HEADERCOMMENT")                  '請求ヘッダーコメント
        sqlSeikyuStat.AppendLine("  , FOOTERCOMMENT = @FOOTERCOMMENT")                  '請求フッターコメント
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICETYPE   = @INVOICETYPE")                    '請求種類
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND INVSUBCD = @INVSUBCD")                            '細分コード
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICETYPE)                           '請求書種類
                .Add("PRINTDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_PRINTDATE))                '印字発行日
                .Add("DETAILKBN", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_DETAILKBN))                '明細有無区分
                .Add("HEADERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_HEADERCOMMENT))        '請求ヘッダーコメント
                .Add("FOOTERCOMMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_FOOTERCOMMENT))        '請求フッターコメント
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVSUBCD))                       '細分コード
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求追加金額明細データTBL更新処理(サブスク調整額)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateSeikyuAddAmountData_Subscadjust(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0080_INVOICEDATA_ADDAMOUNT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        sqlSeikyuStat.AppendLine("  , RENTSUBSCADJUST = @RENTSUBSCADJUST")              'サブスク調整額
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND INVKEIJYOBRANCHCD = @INVKEIJYOBRANCHCD")          '計上支店コード
        sqlSeikyuStat.AppendLine("AND AMOUNTTYPE = @AMOUNTTYPE")                        '金額種類
        sqlSeikyuStat.AppendLine("AND INVOICETYPE = @INVOICETYPE")                      '請求書種類
        sqlSeikyuStat.AppendLine("AND ACCOUNTCODE = @ACCOUNTCODE")                      '科目コード
        sqlSeikyuStat.AppendLine("AND SEGMENTCODE = @SEGMENTCODE")                      'セグメント
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("RENTSUBSCADJUST", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_RENTSUBSCADJUST))         'サブスク調整額
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_UPDYMD))                        '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_UPDUSER))                      '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_UPDTERMID))                  '更新端末
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_KEIJOYM))                           '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_INVOICENUMBER))          '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_INVOICEORGCODE))        '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_TORICODE))                    '取引先コード
                .Add("INVKEIJYOBRANCHCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_INVKEIJYOBRANCHCD))  '計上支店コード
                .Add("AMOUNTTYPE", MySqlDbType.VarChar).Value = htHeadData(UPDATE_ADDAMOUNT.DP_AMOUNTTYPE)                               '金額種類
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_INVOICETYPE))              '請求書種類
                .Add("ACCOUNTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_ACCOUNTCODE))              '科目コード
                .Add("SEGMENTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT.DP_SEGMENTCODE))              'セグメント
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求追加金額明細データTBL更新処理(請求番号)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateSeikyuAddAmountData_Request(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0080_INVOICEDATA_ADDAMOUNT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        If htHeadData(UPDATE_ADDAMOUNT2.DP_INVOICETYPE).ToString = "2" Then
            sqlSeikyuStat.AppendLine("  , INVOICENUMBER = @INVOICENUMBER_RENTAL")       '請求番号(レンタル)
        Else
            sqlSeikyuStat.AppendLine("  , INVOICENUMBER = @INVOICENUMBER_LEASE")        '請求番号(リース)
        End If

        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        If htHeadData(UPDATE_ADDAMOUNT2.DP_INVOICETYPE).ToString = "2" Then
            sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_LEASE")      '請求番号(リース)
        Else
            sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_RENTAL")     '請求番号(レンタル)
        End If
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND INVOICETYPE = @INVOICETYPE")                      '請求書種類
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_UPDYMD))                               '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_UPDUSER))                             '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_UPDTERMID))                         '更新端末
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_KEIJOYM))                                  '請求年月
                .Add("INVOICENUMBER_RENTAL", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_INVOICENUMBER_RENTAL))   '請求番号(レンタル)
                .Add("INVOICENUMBER_LEASE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_INVOICENUMBER_LEASE))     '請求番号(リース)
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_INVOICEORGCODE))               '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_TORICODE))                           '取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(UPDATE_ADDAMOUNT2.DP_INVOICETYPE))                     '請求書種類
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求追加金額明細データTBL更新処理(備考)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateSeikyuAddAmountData(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0080_INVOICEDATA_ADDAMOUNT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICENUMBER = @INVOICENUMBER")                  '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                      '請求書種類
        sqlSeikyuStat.AppendLine("  , RENTALINCENTIVE = @RENTALINCENTIVE")              'ボリュームインセンティブ
        sqlSeikyuStat.AppendLine("  , RENTADJUSTMENT = @RENTADJUSTMENT")                '使用料加減額
        sqlSeikyuStat.AppendLine("  , RENTALATEFEE = @RENTALATEFEE")                    '使用料延滞料金
        sqlSeikyuStat.AppendLine("  , RENTSUBSCADJUST = @RENTSUBSCADJUST")              '使用料サブスク調整額
        sqlSeikyuStat.AppendLine("  , LEASEADJUSTMENT = @LEASEADJUSTMENT")              'リース料加減額
        sqlSeikyuStat.AppendLine("  , MISCELLANEOUSEXPENSE = @MISCELLANEOUSEXPENSE")    '雑費
        sqlSeikyuStat.AppendLine("  , WRITEFEE = @WRITEFEE")                            '手書き料
        sqlSeikyuStat.AppendLine("  , SHIPYMD = @SHIPYMD")                              '発送年月日
        sqlSeikyuStat.AppendLine("  , CTNTYPE = @CTNTYPE")                              'コンテナ記号
        sqlSeikyuStat.AppendLine("  , CTNNO = @CTNNO")                                  'コンテナ番号
        sqlSeikyuStat.AppendLine("  , DEPSTATION = @DEPSTATION")                        '発駅コード
        sqlSeikyuStat.AppendLine("  , ARRSTATION = @ARRSTATION")                        '着駅コード
        sqlSeikyuStat.AppendLine("  , LEASESTARTYMD = @LEASESTARTYMD")                  '全体契約開始日
        sqlSeikyuStat.AppendLine("  , LEASEENDYMD = @LEASEENDYMD")                      '全体契約終了日
        sqlSeikyuStat.AppendLine("  , INPUTDATE = @INPUTDATE")                          '日付
        sqlSeikyuStat.AppendLine("  , DETAILS = @DETAILS")                              '明細内容
        sqlSeikyuStat.AppendLine("  , OUTINVTYPE = @OUTINVTYPE")                        '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , REMARKS = @REMARKS")                              '備考
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND INVKEIJYOBRANCHCD = @INVKEIJYOBRANCHCD")          '計上支店コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND AMOUNTTYPE = @AMOUNTTYPE")                        '金額種類
        sqlSeikyuStat.AppendLine("AND BEFOREINVOICETYPE = @BEFOREINVOICETYPE")          '変更前請求書種類
        sqlSeikyuStat.AppendLine("AND ACCOUNTCODE = @ACCOUNTCODE")                      '科目コード
        sqlSeikyuStat.AppendLine("AND SEGMENTCODE = @SEGMENTCODE")                      'セグメント
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htHeadData(INSERT_ADDAMOUNT.IP_KEIJOYM)                                          '計上年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVOICENUMBER)                         '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVOICEORGCODE)                       '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_TORICODE)                                   '取引先コード
                .Add("INVKEIJYOBRANCHCD", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVKEIJYOBRANCHCD)                 '計上支店コード
                .Add("AMOUNTTYPE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_AMOUNTTYPE)                               '金額種類
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_INVOICETYPE)                             '請求書種類
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SCHEDATEPAYMENT))          '入金予定日
                .Add("INACCOUNTCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INACCOUNTCD))              '社内口座コード
                .Add("ACCOUNTINGMONTH", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_ACCOUNTINGMONTH))      '計上月区分
                .Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_CLOSINGDAY))                '計上締日
                .Add("DEPOSITDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DEPOSITDAY))                '入金日
                .Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(INSERT_ADDAMOUNT.IP_DEPOSITMONTHKBN)                     '入金月区分
                .Add("SLIPDESCRIPTION1", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SLIPDESCRIPTION1))    '伝票摘要１
                .Add("SLIPDESCRIPTION2", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SLIPDESCRIPTION2))    '伝票摘要２
                .Add("RENTALINCENTIVE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTALINCENTIVE))           'ボリュームインセンティブ
                .Add("RENTADJUSTMENT", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTADJUSTMENT))           '加減額
                .Add("RENTALATEFEE", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTALATEFEE))               '延滞料金
                .Add("RENTSUBSCADJUST", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_RENTSUBSCADJUST))         'サブスク調整額
                .Add("LEASEADJUSTMENT", MySqlDbType.Decimal).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_LEASEADJUSTMENT))         'リース料加減額
                .Add("SHIPYMD", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SHIPYMD))                          '発送年月日
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_CTNTYPE))                      'コンテナ記号
                .Add("CTNNO", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_CTNNO))                               'コンテナ番号
                .Add("DEPSTATION", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DEPSTATION))                '発駅コード
                .Add("ARRSTATION", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_ARRSTATION))                     '着駅コード
                .Add("LEASESTARTYMD", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_LEASESTARTYMD))              '全体契約開始日
                .Add("LEASEENDYMD", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_LEASEENDYMD))                  '全体契約終了日
                .Add("MISCELLANEOUSEXPENSE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_MISCELLANEOUSEXPENSE)) '雑費
                .Add("INPUTDATE", MySqlDbType.Date).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_INPUTDATE))                      '日付
                .Add("WRITEFEE", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_WRITEFEE))                         '手書き料
                .Add("ACCOUNTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_ACCOUNTCODE))              '科目コード
                .Add("SEGMENTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SEGMENTCODE))              'セグメント
                .Add("SEGMENTBRANCHCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_SEGMENTBRANCHCODE))  'セグメント枝番
                .Add("DETAILS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DETAILS))                      '明細内容
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_OUTINVTYPE))                '出力先請求書区分
                .Add("BEFOREINVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_BEFOREINVOICETYPE))  '変更前請求書種類
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_REMARKS))                      '備考
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_DELFLG))                             '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_UPDYMD))                        '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_UPDUSER))                      '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INSERT_ADDAMOUNT.IP_UPDTERMID))                  '更新端末
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細使用料データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0067_INVOICEDATA_RENT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICENUMBER = @INVOICENUMBER_NEW")          '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                  '請求書種類
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_OLD")        '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND OUTINVTYPE = @OUTINVTYPE")                    '出力先請求書区分
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER_NEW", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICENUMBER_NEW))          '請求番号(新)
                .Add("INVOICENUMBER_OLD", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICENUMBER_OLD))          '請求番号(旧)
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_TORICODE))                            '請求取引先コード
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_OUTINVTYPE))                        '出力先請求書区分
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDYMD))                                '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDUSER))                              '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDTERMID))                          '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDPGID))                              '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細使用料データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_rent_add(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0067_INVOICEDATA_RENT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICENUMBER = @INVOICENUMBER_NEW")          '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                  '請求書種類
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_OLD")        '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND OUTINVTYPE = @OUTINVTYPE")                    '出力先請求書区分
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER_NEW", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICENUMBER_NEW))          '請求番号(新)
                .Add("INVOICENUMBER_OLD", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICENUMBER_OLD))          '請求番号(旧)
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_TORICODE))                            '請求取引先コード
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_OUTINVTYPE))                        '出力先請求書区分
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDYMD))                                '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDUSER))                              '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDTERMID))                          '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETAIL_UPDPARAM.DP_UPDPGID))                              '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細使用料データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_rent_remarks(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0067_INVOICEDATA_RENT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    OUTINVTYPE = @OUTINVTYPE")                     '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , REMARKS = @REMARKS")                           '備考
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG = @INVOICEEXCLUSIONFLAG") '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , INVSUBCD = @INVSUBCD")                         '細分コード
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                             '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                           '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                       '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                           '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                           '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")             '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")           '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                         '請求取引先コード
        sqlSeikyuStat.AppendLine("AND SHIPYMD = @SHIPYMD")                           '発送年月日
        sqlSeikyuStat.AppendLine("AND CTNTYPE = @CTNTYPE")                           'コンテナ記号
        sqlSeikyuStat.AppendLine("AND CTNNO = @CTNNO")                               'コンテナ番号
        sqlSeikyuStat.AppendLine("AND SAMEDAYCNT = @SAMEDAYCNT")                     '同日内回数
        sqlSeikyuStat.AppendLine("AND CTNLINENO = @CTNLINENO")                       '行番
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                             '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICENUMBER))                  '請求番号
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_TORICODE))                            '請求取引先コード
                .Add("SHIPYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_SHIPYMD))                              '発送年月日
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_CTNTYPE))                              'コンテナ記号
                .Add("CTNNO", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_CTNNO))                                  'コンテナ番号
                .Add("SAMEDAYCNT", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_SAMEDAYCNT))                        '同日内回数
                .Add("CTNLINENO", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_CTNLINENO))                          '行番
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_REMARKS))                              '備考
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_OUTINVTYPE))                        '出力先請求書区分
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVOICEEXCLUSIONFLAG))    '請求除外フラグ
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INVSUBCD))                                 '細分コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITYMD))                               '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITUSER))                             '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITTERMID))                         '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(RENTAL_INSTPARAM.IP_INITPGID))                             '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細リース料データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_lease_remarks(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0068_INVOICEDATA_LEASE ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    OUTINVTYPE = @OUTINVTYPE")                         '出力先請求書区分
        sqlSeikyuStat.AppendLine("  , REMARKS = @REMARKS")                               '備考
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG = @INVOICEEXCLUSIONFLAG")     '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , INVSUBCD = @INVSUBCD")                             '細分コード
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                                 '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                               '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                           '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                               '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                               '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                 '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")               '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                             '請求取引先コード
        sqlSeikyuStat.AppendLine("AND LEASENO = @LEASENO")                               'リース登録番号
        sqlSeikyuStat.AppendLine("AND CTNTYPE = @CTNTYPE")                               'コンテナ記号
        sqlSeikyuStat.AppendLine("AND CTNNO = @CTNNO")                                   'コンテナ番号
        sqlSeikyuStat.AppendLine("AND LEASEMONTHSTARTYMD = @LEASEMONTHSTARTYMD")         'リース開始日
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                                 '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICENUMBER))                  '請求番号
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_TORICODE))                            '請求取引先コード
                .Add("LEASENO", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASENO))                              'リース登録番号
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_CTNTYPE))                              'コンテナ記号
                .Add("CTNNO", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_CTNNO))                                  'コンテナ番号
                .Add("LEASEMONTHSTARTYMD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_LEASEMONTHSTARTYMD))        'リース開始日
                .Add("REMARKS", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_REMARKS))                              '備考
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_OUTINVTYPE))                        '出力先請求書区分
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVOICEEXCLUSIONFLAG))    '請求除外フラグ
                .Add("INVSUBCD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INVSUBCD))                            '細分コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITYMD))                               '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITUSER))                             '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITTERMID))                         '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(LEASE_INSTPARAM.IP_INITPGID))                             '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細リース料データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0068_INVOICEDATA_LEASE ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICENUMBER = @INVOICENUMBER_NEW")          '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                  '請求書種類
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_OLD")        '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND OUTINVTYPE = @OUTINVTYPE")                    '出力先請求書区分
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER_NEW", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICENUMBER_NEW))         '請求番号(新)
                .Add("INVOICENUMBER_OLD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICENUMBER_OLD))        '請求番号(旧)
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_TORICODE))                            '請求取引先コード
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_OUTINVTYPE))                        '出力先請求書区分
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDYMD))                                '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDUSER))                              '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDTERMID))                          '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDPGID))                              '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細リース料データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_lease_add(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0068_INVOICEDATA_LEASE ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICENUMBER = @INVOICENUMBER_NEW")          '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                  '請求書種類
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_OLD")        '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND OUTINVTYPE = @OUTINVTYPE")                    '出力先請求書区分
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER_NEW", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICENUMBER_NEW))         '請求番号(新)
                .Add("INVOICENUMBER_OLD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICENUMBER_OLD))        '請求番号(旧)
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_TORICODE))                            '請求取引先コード
                .Add("OUTINVTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_OUTINVTYPE))                        '出力先請求書区分
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDYMD))                                '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDUSER))                              '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDTERMID))                          '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDPGID))                              '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細売却在庫データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_Container_remarks(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0104_INVOICEDATA_CONTAINER ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    REMARK = @REMARK")                                 '備考
        sqlSeikyuStat.AppendLine("  , INVOICEEXCLUSIONFLAG = @INVOICEEXCLUSIONFLAG")     '請求除外フラグ
        sqlSeikyuStat.AppendLine("  , INVSUBCD = @INVSUBCD")                             '細分コード
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                                 '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                               '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                           '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                               '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                               '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                 '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")               '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                             '請求取引先コード
        sqlSeikyuStat.AppendLine("AND CTNTYPE = @CTNTYPE")                               'コンテナ記号
        sqlSeikyuStat.AppendLine("AND CTNNO = @CTNNO")                                   'コンテナ番号
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                                 '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INVOICENUMBER))                  '請求番号
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_TORICODE))                            '請求取引先コード
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INVSUBCD))                                 '細分コード
                .Add("CTNTYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_CTNTYPE))                              'コンテナ記号
                .Add("CTNNO", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_CTNNO))                                  'コンテナ番号
                .Add("REMARK", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_REMARKS))                               '備考
                .Add("INVOICEEXCLUSIONFLAG", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INVOICEEXCLUSIONFLAG))    '請求除外フラグ
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INITYMD))                               '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INITUSER))                             '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INITTERMID))                         '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(CTN_INSTPARAM.IP_INITPGID))                             '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細売却在庫データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細リース料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateSeikyuData_Container(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0104_INVOICEDATA_CONTAINER")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICENUMBER = @INVOICENUMBER_NEW")          '請求番号
        sqlSeikyuStat.AppendLine("  , INVOICETYPE = @INVOICETYPE")                  '請求書種類
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER_OLD")        '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_KEIJOYM))                                   '請求年月
                .Add("INVOICENUMBER_NEW", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICENUMBER_NEW))          '請求番号(新)
                .Add("INVOICENUMBER_OLD", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICENUMBER_OLD))          '請求番号(旧)
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICETYPE))                      '請求書種類
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_INVOICEORGCODE))                '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_TORICODE))                            '請求取引先コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_DELFLG))                                     '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDYMD))                                '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDUSER))                              '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDTERMID))                          '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETAIL_UPDPARAM.DP_UPDPGID))                              '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求書発行履歴データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceLog(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0069_INVOICELOG ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICETYPE = @INVOICETYPE")                  '請求書種類
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS).ToString) Then
            sqlSeikyuStat.AppendLine("  , REQUESTSTATUS = @REQUESTSTATUS")          '請求申請状態
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQSTAFF).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQSTAFF = @RQSTAFF")                      '担当ユーザID
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQDATE = @RQDATE")                        '確認提出日
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQACKNOWLEDGER).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER = @RQACKNOWLEDGER")        '確認ユーザID
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQACKNDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNDATE = @RQACKNDATE")                '確認者確認日
        End If
        sqlSeikyuStat.AppendLine("  , SENDBACKDATE = ''")                           '確認者差戻日
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_ISSUEDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , ISSUEDATE = @ISSUEDATE")                  '請求書発行日
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELER).ToString) Then
            sqlSeikyuStat.AppendLine("  , INVOICECANCELER = @INVOICECANCELER")      '取消ユーザID
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , INVOICECANCELDATE = @INVOICECANCELDATE")  '取消年月日
        End If
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htHeadData(INVOICELOG_PARM.IP_KEIJOYM)                                           '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICENUMBER))           '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICEORGCODE))         '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_TORICODE))                     '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICETYPE))               '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS))           '請求申請状態
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQSTAFF))                       '担当ユーザID
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQDATE))                         '確認提出日
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQACKNOWLEDGER))         '確認ユーザID
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQACKNDATE))                 '確認者確認日
                .Add("SENDBACKDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_SENDBACKDATE))             '確認者差戻日
                .Add("ISSUEDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_ISSUEDATE))                   '請求書発行日
                .Add("INVOICECANCELER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELER))       '取消ユーザID
                .Add("INVOICECANCELDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELDATE))   '取消年月日
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDYMD))                         '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDUSER))                       '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDTERMID))                   '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDPGID))                       '更新プログラムID
            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0069_INVOICELOG]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求書発行履歴データ 更新処理(取り下げ、差し戻し用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceLog_RE(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0069_INVOICELOG ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICETYPE = @INVOICETYPE")                  '請求書種類
        sqlSeikyuStat.AppendLine("  , REQUESTSTATUS = @REQUESTSTATUS")              '請求申請状態
        If htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS).ToString = "0" Then
            sqlSeikyuStat.AppendLine("  , RQDATE = @RQDATE")                        '確認提出日
        End If
        sqlSeikyuStat.AppendLine("  , RQACKNDATE = @RQACKNDATE")                    '確認者確認日
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_SENDBACKDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , SENDBACKDATE = @SENDBACKDATE")            '確認者差戻日
        End If
        If htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS).ToString = "1" Then
            sqlSeikyuStat.AppendLine("  , ISSUEDATE = NULL")                        '請求書発行日
        End If
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htHeadData(INVOICELOG_PARM.IP_KEIJOYM)                                           '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICENUMBER))           '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICEORGCODE))         '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_TORICODE))                     '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICETYPE))               '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS))           '請求申請状態
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQDATE))                         '確認提出日
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQACKNDATE))                 '確認者確認日
                .Add("SENDBACKDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_SENDBACKDATE))             '確認者差戻日
                .Add("INVOICECANCELER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELER))       '取消ユーザID
                .Add("INVOICECANCELDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELDATE))   '取消年月日
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDYMD))                         '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDUSER))                       '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDTERMID))                   '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDPGID))                       '更新プログラムID
            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0069_INVOICELOG]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub


    ''' <summary>
    ''' 請求書発行履歴データ 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub UpdateInvoiceLog_chg(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0069_INVOICELOG ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    RQACKNDATE = NULL")                           '確認者確認日
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS).ToString) Then
            sqlSeikyuStat.AppendLine("  , REQUESTSTATUS = @REQUESTSTATUS")          '請求申請状態
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQSTAFF).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQSTAFF = @RQSTAFF")                      '担当ユーザID
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQDATE).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQDATE = @RQDATE")                        '確認提出日
        End If
        If Not String.IsNullOrEmpty(htHeadData(INVOICELOG_PARM.IP_RQACKNOWLEDGER).ToString) Then
            sqlSeikyuStat.AppendLine("  , RQACKNOWLEDGER = @RQACKNOWLEDGER")        '確認ユーザID
        End If
        sqlSeikyuStat.AppendLine("  , SENDBACKDATE = ''")                           '確認者差戻日
        sqlSeikyuStat.AppendLine("  , ISSUEDATE = NULL")                            '請求書発行日
        sqlSeikyuStat.AppendLine("  , INVOICECANCELER = NULL")                      '取消ユーザID
        sqlSeikyuStat.AppendLine("  , INVOICECANCELDATE = NULL")                    '取消年月日
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htHeadData(INVOICELOG_PARM.IP_KEIJOYM)                                           '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICENUMBER))           '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICEORGCODE))         '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_TORICODE))                     '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICETYPE))               '請求書種類
                .Add("REQUESTSTATUS", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_REQUESTSTATUS))           '請求申請状態
                .Add("RQSTAFF", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQSTAFF))                       '担当ユーザID
                .Add("RQDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQDATE))                         '確認提出日
                .Add("RQACKNOWLEDGER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQACKNOWLEDGER))         '確認ユーザID
                .Add("RQACKNDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_RQACKNDATE))                 '確認者確認日
                .Add("SENDBACKDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_SENDBACKDATE))             '確認者差戻日
                .Add("ISSUEDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_ISSUEDATE))                   '請求書発行日
                .Add("INVOICECANCELER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELER))       '取消ユーザID
                .Add("INVOICECANCELDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_INVOICECANCELDATE))   '取消年月日
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDYMD))                         '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDUSER))                       '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDTERMID))                   '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(INVOICELOG_PARM.IP_UPDPGID))                       '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

#End Region

#Region "削除処理部"

#Region "論理削除"
    ''' <summary>
    ''' 請求ヘッダーデータ 削除処理(論理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteInvoiceHead(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    DELFLG = 1")                                  '削除フラグ
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")          '入金予定日
        'sqlSeikyuStat.AppendLine("AND DEPOSITMONTHKBN = @DEPOSITMONTHKBN")          '入金月区分
        'sqlSeikyuStat.AppendLine("AND CLOSINGDAY = @CLOSINGDAY")                    '締日
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '請求取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                '.Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_DEPOSITMONTHKBN)                   '入金月区分
                '.Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CLOSINGDAY))              '締日
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_DELFLG))                           '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細使用料データ 削除処理(論理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteSeikyuData_Rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0067_INVOICEDATA_RENT ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    DELFLG = 1")                                  '削除フラグ
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_KEIJOYM))                       '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_INVOICENUMBER))      '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_INVOICEORGCODE))    '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_TORICODE))                '請求取引先コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_DELFLG))                         '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_UPDYMD))                    '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_UPDUSER))                  '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_UPDTERMID))              '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_UPDPGID))                  '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求リース明細データ 削除処理(論理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteSeikyuData_Lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0068_INVOICEDATA_LEASE ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    DELFLG = 1")                                  '削除フラグ
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_KEIJOYM))                      '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_INVOICENUMBER))     '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_INVOICEORGCODE))   '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_TORICODE))               '請求取引先コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_DELFLG))                        '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_UPDYMD))                   '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_UPDUSER))                 '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_UPDTERMID))             '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_UPDPGID))                 '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求書発行履歴データ 削除処理(論理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLogData">請求書発行履歴データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteInvoiceLog(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLogData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0069_INVOICELOG ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    DELFLG = 1")                                  '削除フラグ
        sqlSeikyuStat.AppendLine("  , INVOICECANCELER = @INVOICECANCELER")          '取消ユーザーID
        sqlSeikyuStat.AppendLine("  , INVOICECANCELDATE = @INVOICECANCELDATE")      '取消年月日
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                          '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")            '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_KEIJOYM))                             '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICENUMBER))            '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICEORGCODE))          '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_TORICODE))                      '請求取引先コード
                .Add("INVOICECANCELER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICECANCELER))        '取消ユーザーID
                .Add("INVOICECANCELDATE", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_INVOICECANCELDATE))    '取消年月日
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_DELFLG))                               '削除フラグ
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_UPDYMD))                          '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_UPDUSER))                        '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_UPDTERMID))                    '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLogData(INVOICELOG_PARM.IP_UPDPGID))                        '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

#End Region

#Region "物理削除"
    ''' <summary>
    ''' 請求追加金額明細データTBL削除処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub DeleteSeikyuAddAmountData(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine(" DELETE FROM LNG.LNT0080_INVOICEDATA_ADDAMOUNT")
        sqlSeikyuStat.AppendLine("    WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        'sqlSeikyuStat.AppendLine("AND INVKEIJYOBRANCHCD = @INVKEIJYOBRANCHCD")          '計上支店コード
        'sqlSeikyuStat.AppendLine("AND AMOUNTTYPE = @AMOUNTTYPE")                        '金額種類
        'sqlSeikyuStat.AppendLine("AND INVOICENUMBER   = @INVOICENUMBER")                '請求番号
        'sqlSeikyuStat.AppendLine("AND INVOICETYPE = @INVOICETYPE")                      '請求書種類
        'sqlSeikyuStat.AppendLine("AND ACCOUNTCODE = @ACCOUNTCODE")                      '科目コード
        'sqlSeikyuStat.AppendLine("AND SEGMENTCODE = @SEGMENTCODE")                      'セグメント
        'sqlSeikyuStat.AppendLine("AND BEFOREINVOICETYPE = @BEFOREINVOICETYPE")          '変更前請求書種類

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_KEIJOYM))                           '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_INVOICENUMBER))          '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_INVOICEORGCODE))        '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_TORICODE))                    '取引先コード
                .Add("INVKEIJYOBRANCHCD", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_INVKEIJYOBRANCHCD))  '計上支店コード
                .Add("AMOUNTTYPE", MySqlDbType.VarChar).Value = htHeadData(DELETE_ADDAMOUNT.DP_AMOUNTTYPE)                               '金額種類
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = htHeadData(DELETE_ADDAMOUNT.DP_SCHEDATEPAYMENT)                     '入金予定日
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_INVOICETYPE))              '請求書種類
                .Add("ACCOUNTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_ACCOUNTCODE))              '科目コード
                .Add("SEGMENTCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_SEGMENTCODE))              'セグメント
                .Add("BEFOREINVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_BEFOREINVOICETYPE))  '変更前請求書種類

            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求追加金額明細データTBL削除処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    Public Shared Sub DeleteSeikyuAddAmountData_Type(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine(" DELETE FROM LNG.LNT0080_INVOICEDATA_ADDAMOUNT")
        sqlSeikyuStat.AppendLine("    WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE   = @INVOICEORGCODE")              '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND INVOICETYPE = @INVOICETYPE")                      '請求書種類

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_KEIJOYM))                           '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_INVOICEORGCODE))        '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_TORICODE))                    '取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = htHeadData(DELETE_ADDAMOUNT.DP_SCHEDATEPAYMENT)                     '入金予定日
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(DELETE_ADDAMOUNT.DP_INVOICETYPE))              '請求書種類

            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求明細使用料データ 削除処理(物理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteSeikyuDataPhysical_Rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("DELETE A01 ")
        sqlSeikyuStat.AppendLine("FROM LNG.LNT0067_INVOICEDATA_RENT A01")
        sqlSeikyuStat.AppendLine("LEFT JOIN LNG.LNT0064_INVOICEHEAD A02")
        sqlSeikyuStat.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        sqlSeikyuStat.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        sqlSeikyuStat.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        sqlSeikyuStat.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    A01.KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND A01.INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND A01.TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND A02.SCHEDATEPAYMENT = @SCHEDATEPAYMENT")          '入金予定日
        sqlSeikyuStat.AppendLine("AND A01.DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_KEIJOYM))                       '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_INVOICEORGCODE))    '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_TORICODE))                '請求取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = htRentData(DETALI_DELTPARAM.DP_SCHEDATEPAYMENT)                     '入金予定日
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htRentData(DETALI_DELTPARAM.DP_DELFLG))                         '削除フラグ
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求リース明細データ 削除処理(物理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteSeikyuDataPhysical_Lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("DELETE A01 ")
        sqlSeikyuStat.AppendLine("FROM LNG.LNT0068_INVOICEDATA_LEASE A01")
        sqlSeikyuStat.AppendLine("LEFT JOIN LNG.LNT0064_INVOICEHEAD A02")
        sqlSeikyuStat.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        sqlSeikyuStat.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        sqlSeikyuStat.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        sqlSeikyuStat.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    A01.KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND A01.INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND A01.TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND A02.SCHEDATEPAYMENT = @SCHEDATEPAYMENT")          '入金予定日
        sqlSeikyuStat.AppendLine("AND A01.DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_KEIJOYM))                       '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_INVOICEORGCODE))    '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_TORICODE))                '請求取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = htLeaseData(DETALI_DELTPARAM.DP_SCHEDATEPAYMENT)                     '入金予定日
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_DELFLG))                         '削除フラグ
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求売却在庫明細データ 削除処理(物理削除)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLeaseData">請求明細売却在庫データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub DeleteSeikyuDataPhysical_Container(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLeaseData As Hashtable)
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("DELETE A01 ")
        sqlSeikyuStat.AppendLine("FROM LNG.LNT0104_INVOICEDATA_CONTAINER A01")
        sqlSeikyuStat.AppendLine("LEFT JOIN LNG.LNT0064_INVOICEHEAD A02")
        sqlSeikyuStat.AppendLine("    ON A01.KEIJOYM = A02.KEIJOYM")
        sqlSeikyuStat.AppendLine("    AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        sqlSeikyuStat.AppendLine("    AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        sqlSeikyuStat.AppendLine("    AND A01.TORICODE = A02.TORICODE")
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    A01.KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND A01.INVOICEORGCODE   = @INVOICEORGCODE")          '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND A01.TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND A02.SCHEDATEPAYMENT = @SCHEDATEPAYMENT")          '入金予定日
        sqlSeikyuStat.AppendLine("AND A01.DELFLG = @DELFLG")                            '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_KEIJOYM))                       '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_INVOICEORGCODE))    '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_TORICODE))                '請求取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = htLeaseData(DETALI_DELTPARAM.DP_SCHEDATEPAYMENT)                     '入金予定日
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htLeaseData(DETALI_DELTPARAM.DP_DELFLG))                         '削除フラグ
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

#End Region

#End Region

#Region "請求書連携関連"
    ''' <summary>
    ''' コンテナ清算ファイル 更新処理(請求連携用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htInvData">コンテナ清算ファイル</param>
    Public Shared Sub UpdateRessnfRenkei(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htInvData As Hashtable)

        '◯コンテナ清算ファイル
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0017_RESSNF")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    BILLLINK = CASE BILLLINK")                        '請求連携状態
        sqlSeikyuStat.AppendLine("        WHEN '0' THEN '1'")                           '　請求連携状態 = '0'の場合、'1'
        sqlSeikyuStat.AppendLine("        WHEN '1' THEN '2'")                           '　請求連携状態 = '1'の場合、'2'
        sqlSeikyuStat.AppendLine("        WHEN '2' THEN '2'")                           '　請求連携状態 = '2'の場合、'2'
        sqlSeikyuStat.AppendLine("        ELSE '1'")                                    '　上記以外の場合、'1'
        sqlSeikyuStat.AppendLine("        END")
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                                '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                              '更新ユーザーID
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                          '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                              '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                              '計上年月
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                            '取引先コード
        sqlSeikyuStat.AppendLine("AND INVFILINGDEPT = @INVKEIJYOBRANCHCD")              '請求項目 請求書提出部店
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")              '入金予定日
        sqlSeikyuStat.AppendLine("AND INVSUBCD = @INVSUBCD")                            '細分コード
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htInvData(UPDATE_INVRENKEI_PARM.DP_KEIJOYM)                                      '計上年月
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_TORICODE))                '取引先コード
                .Add("INVKEIJYOBRANCHCD", MySqlDbType.VarChar).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_KEIJYOBRANCHCD)) '請求項目 計上店コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_DEPOSITYMD))           '入金予定日
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_INVSUBCD))                     '細分コード
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_UPDYMD))                    '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_UPDUSER))                  '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_UPDTERMID))              '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htInvData(UPDATE_INVRENKEI_PARM.DP_UPDPGID))                  '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' リース明細データ 更新処理(請求連携用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htLesData">リース明細データ</param>
    Public Shared Sub UpdateLeaseRenkei(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htLesData As Hashtable)

        '◯リース明細データ
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0042_LEASEDATA")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    BILLLINK = CASE BILLLINK")                            '請求連携状態
        sqlSeikyuStat.AppendLine("        WHEN '0' THEN '1'")                               '　請求連携状態 = '0'の場合、'1'
        sqlSeikyuStat.AppendLine("        WHEN '1' THEN '2'")                               '　請求連携状態 = '1'の場合、'2'
        sqlSeikyuStat.AppendLine("        WHEN '2' THEN '2'")                               '　請求連携状態 = '2'の場合、'2'
        sqlSeikyuStat.AppendLine("        ELSE '1'")                                        '　上記以外の場合、'1'
        sqlSeikyuStat.AppendLine("        END")
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                                    '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                                  '更新ユーザーID
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                              '更新端末
        sqlSeikyuStat.AppendLine("  , UPDPGID = @UPDPGID")                                  '更新プログラムID
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                                  '計上年月
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                                '請求取引先コード
        sqlSeikyuStat.AppendLine("AND INVOICEOUTORGCD = @INVOICEOUTORGCD")                  '計上先組織コード
        sqlSeikyuStat.AppendLine("AND DEPOSITYMD = @DEPOSITYMD")                            '入金予定日
        sqlSeikyuStat.AppendLine("AND INVSUBCD = @INVSUBCD")                                '細分コード
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htLesData(UPDATE_INVRENKEI_PARM.DP_KEIJOYM)                                      '計上年月
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_TORICODE))                '取引先コード
                .Add("INVOICEOUTORGCD", MySqlDbType.VarChar).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_KEIJYOBRANCHCD))   '請求項目 計上店コード
                .Add("DEPOSITYMD", MySqlDbType.Date).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_DEPOSITYMD))                '入金予定日
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_INVSUBCD))                     '細分コード
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_UPDYMD))                    '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_UPDUSER))                  '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_UPDTERMID))              '更新端末
                .Add("UPDPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htLesData(UPDATE_INVRENKEI_PARM.DP_UPDPGID))                  '更新プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 請求ヘッダーデータ 更新処理(請求書連携)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htHeadData">請求ヘッダーデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateRenkeiHead(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htHeadData As Hashtable, ByRef exesql As String) '2024/07/23 伊藤 CHG
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0064_INVOICEHEAD ")
        sqlSeikyuStat.AppendLine("SET")
        sqlSeikyuStat.AppendLine("    INVOICELINK = CASE INVOICELINK")              '請求連携状態
        sqlSeikyuStat.AppendLine("        WHEN '0' THEN '1'")                       '　請求連携状態 = '0'の場合、'1'
        sqlSeikyuStat.AppendLine("        WHEN '1' THEN '2'")                       '　請求連携状態 = '1'の場合、'2'
        sqlSeikyuStat.AppendLine("        WHEN '2' THEN '2'")                       '　請求連携状態 = '2'の場合、'2'
        sqlSeikyuStat.AppendLine("        ELSE '1'")                                '　上記以外の場合、'1'
        sqlSeikyuStat.AppendLine("        END")
        sqlSeikyuStat.AppendLine("  , UPDYMD = @UPDYMD")                            '更新年月日
        sqlSeikyuStat.AppendLine("  , UPDUSER = @UPDUSER")                          '更新ユーザーＩＤ
        sqlSeikyuStat.AppendLine("  , UPDTERMID = @UPDTERMID")                      '更新端末
        sqlSeikyuStat.AppendLine("WHERE")
        sqlSeikyuStat.AppendLine("    KEIJOYM = @KEIJOYM")                          '請求年月
        sqlSeikyuStat.AppendLine("AND INVOICENUMBER = @INVOICENUMBER")              '請求番号
        sqlSeikyuStat.AppendLine("AND INVOICEORGCODE = @INVOICEORGCODE")            '請求担当部店コード
        sqlSeikyuStat.AppendLine("AND TORICODE = @TORICODE")                        '請求取引先コード
        sqlSeikyuStat.AppendLine("AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT")          '入金予定日
        'sqlSeikyuStat.AppendLine("AND DEPOSITMONTHKBN = @DEPOSITMONTHKBN")          '入金月区分
        'sqlSeikyuStat.AppendLine("AND CLOSINGDAY = @CLOSINGDAY")                    '締日
        sqlSeikyuStat.AppendLine("AND DELFLG = '0'")                                '削除フラグ

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_KEIJOYM))                         '請求年月
                .Add("INVOICENUMBER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICENUMBER))        '請求番号
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_INVOICEORGCODE))      '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_TORICODE))                  '請求取引先コード
                .Add("SCHEDATEPAYMENT", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_SCHEDATEPAYMENT))    '入金予定日
                '.Add("DEPOSITMONTHKBN", MySqlDbType.VarChar).Value = htHeadData(SEIKYU_UPDDTLPARAM.DP_DEPOSITMONTHKBN)                   '入金月区分
                '.Add("CLOSINGDAY", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_CLOSINGDAY))              '締日
                .Add("UPDYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDYMD))                      '更新年月日
                .Add("UPDUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDUSER))                    '更新ユーザーID
                .Add("UPDTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htHeadData(SEIKYU_UPDDTLPARAM.DP_UPDTERMID))                '更新端末
            End With

            '2024/07/23 伊藤 ADD START
            Dim sqlOrderCmdText As String = sqlSeikyuStat.ToString()
            For Each param As MySqlParameter In sqlOrderCmd.Parameters
                Dim paramValue As Object = param.Value

                If paramValue Is DBNull.Value Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "NULL")
                ElseIf TypeOf paramValue Is String OrElse TypeOf paramValue Is Date Then
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, "'" & paramValue.ToString() & "'")
                Else
                    sqlOrderCmdText = sqlOrderCmdText.Replace("@" & param.ParameterName, paramValue.ToString())
                End If
            Next
            If exesql = "" Then
                exesql = "[LNT0067_INVOICEDATA_RENT]" & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            Else
                exesql = exesql & ControlChars.NewLine & ControlChars.Tab & sqlOrderCmdText
            End If
            '2024/07/23 伊藤 ADD END

            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' 支払先マスタ連携テーブル 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectPayeeCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    TORICODE AS 外部コード")                             '外部コード
        SQLBldr.AppendLine("    , CLIENTCODE AS 顧客コード")                         '顧客コード
        SQLBldr.AppendLine("    , INVOICENUMBER AS インボイス登録番号")              'インボイス登録番号
        SQLBldr.AppendLine("    , CLIENTNAME AS 顧客名")                             '顧客名
        SQLBldr.AppendLine("    , PAYBANKCODE AS 振込先銀行コード")                  '振込先銀行コード
        SQLBldr.AppendLine("    , PAYBANKNAME AS 振込先銀行名")                      '振込先銀行名
        SQLBldr.AppendLine("    , PAYBANKNAMEKANA AS 振込先銀行名カナ")              '振込先銀行名カナ
        SQLBldr.AppendLine("    , PAYBANKBRANCHCODE AS 振込先支店コード")            '振込先支店コード
        SQLBldr.AppendLine("    , PAYBANKBRANCHNAME AS 振込先支店名")                '振込先支店名
        SQLBldr.AppendLine("    , PAYBANKBRANCHNAMEKANA AS 振込先支店名カナ")        '振込先支店名カナ
        SQLBldr.AppendLine("    , PAYACCOUNTTYPENAME AS 預金種別")                   '預金種別
        SQLBldr.AppendLine("    , PAYACCOUNTTYPE AS 預金種別コード")                 '預金種別コード
        SQLBldr.AppendLine("    , PAYACCOUNT AS 口座番号")                           '口座番号
        SQLBldr.AppendLine("    , PAYACCOUNTNAME AS 口座名義")                       '口座名義
        SQLBldr.AppendLine("    , PAYORBANKCODE AS 支払元銀行コード")                '支払元銀行コード
        SQLBldr.AppendLine("    , PAYTAXCALCUNIT AS 消費税計算処理区分")             '消費税計算処理区分
        SQLBldr.AppendLine("FROM")
        'メイン [テーブル]支払先マスタ連携テーブル
        SQLBldr.AppendLine("    lng.LNT0072_PAYEE")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    LINKSTATUS = '0'")
        SQLBldr.AppendLine("    AND DELFLG = '0'")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function
#End Region

#Region "請求連携"
    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRentalCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN D02.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(D02.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                   '発行日
        SQLBldr.AppendLine("    , D01.TORICODE + '-' + CAST(D01.KEIJOYM AS NVARCHAR) + '-' + D01.INVFILINGDEPT + '-'")
        SQLBldr.AppendLine("    + D01.INVSUBCD + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")                '請求仮番号
        SQLBldr.AppendLine("    , D01.CLOSINGDATE AS 計上日付")                                                                                                   '計上日付
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   , '01' + '-' + D01.TORICODE + '-' + '1' AS 顧客コード")                                                                        '顧客コード
        Else
            SQLBldr.AppendLine("   , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.SUM_USEFEE,0) + coalesce(D03.ADDFEE01,0), '0') AS 税抜金額")                                                                             '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D03.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(D03.SUM_USEFEE,0) * @P03  + coalesce(D03.TAXADDFEE01,0) , 0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                               '消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) + coalesce(D03.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(D03.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0) + coalesce(D03.ADDFEE01,0) + coalesce(D03.TAXADDFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                             '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D13.SUM_USEFEE,0) + coalesce(D03.ADDFEE02,0), '0') AS 経過措置税抜金額")                                            '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D13.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(D03.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                                       '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(D13.SUM_USEFEE,0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D13.SUM_USEFEE,0) + coalesce(D13.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(D13.SUM_USEFEE,0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(D03.ADDFEE02,0) + coalesce(D03.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                                     '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.ADDFEE11,0) + coalesce(D03.ADDFEE12,0), '0') AS 課税対象外金額")                                                                                                           '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) +coalesce(D13.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) +coalesce(D13.SUM_USEFEE,0) +coalesce(D03.SUM_USEFEE_DTL,0) + coalesce(D13.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("       ELSE FORMAT(coalesce(D03.SUM_USEFEE, 0) +coalesce(D13.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(D03.ADDFEE01,0) + coalesce(D03.TAXADDFEE01,0) + ")
        SQLBldr.AppendLine("                   coalesce(D03.ADDFEE02,0) + coalesce(D03.TAXADDFEE02,0) +coalesce(D03.ADDFEE11,0) + coalesce(D03.ADDFEE12,0), '0')")
        SQLBldr.AppendLine("      END  AS 請求書合計金額 ")                                                                                                       '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                             '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.ADDFEE11,0),'0') AS 非課税売上小計")                                                                               '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.ADDFEE12,0),'0') AS 不課税売上小計")                                                                               '不課税売上小計
        SQLBldr.AppendLine("    , FORMAT(D02.SCHEDATEPAYMENT, 'yyyy/MM/dd') AS '請求サイト（支払期日）'")                                                         '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                         '発行部署コード
        SQLBldr.AppendLine("    , D07.STAFFNAMEL AS 発行担当者")                                                                                                  '発行担当者
        SQLBldr.AppendLine("    , '01-' + D06.INACCOUNTCD AS 請求入金銀行コード")                                                                                 '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(D01.CLOSINGDATE, 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN D14.SLIPDESCRIPTION IS NOT NULL THEN ' ' + D14.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(D02.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(D02.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'")
        SQLBldr.AppendLine("       END AS 宛名欄付記1")                                                                                                           '宛名欄付記1
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記2")                                                                                                           '宛名欄付記2
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記3")                                                                                                           '宛名欄付記3
        SQLBldr.AppendLine("    , D02.FOOTERCOMMENT AS 通信欄")                                                                                                   '通信欄
        SQLBldr.AppendLine("    , '19' AS 帳票種別")                                                                                                              '帳票種別
        SQLBldr.AppendLine("    , D04.NAMES AS 発駅名")                                                                                                            '発駅名
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("          ELSE D05.NAMES")
        SQLBldr.AppendLine("      END AS 着駅名")                                                                                                                 '着駅名
        SQLBldr.AppendLine("    , D01.SHIPYMD AS 発送年月日")                                                                                                     '発送年月日
        SQLBldr.AppendLine("    , D01.CTNTYPE AS コンテナ記号")                                                                                                   'コンテナ記号
        SQLBldr.AppendLine("    , D01.CTNNO AS コンテナ番号")                                                                                                     'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                                   '個数
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.JRFIXEDFARE,0), '0') AS JR所定運賃")                                                                                    'JR所定運賃
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.OWNDISCOUNTFEE,0), '0') AS 私有割引相当額")                                                                             '私有割引相当額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.RETURNFARE,0), '0') AS 割戻運賃")                                                                                       '割戻運賃
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.USEFEE,0), '0') AS 使用料金額")                                                                                         '使用料金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.NITTSUFREESEND,0), '0') AS 通運負担回送運賃")                                                                           '通運負担回送運賃
        SQLBldr.AppendLine("    , coalesce(D01.KENSU,0) AS 発駅合計個数")                                                                                                     '発駅合計個数
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.SUM_USEFEE,0), '0') AS 発駅合計使用料")                                                                                 '発駅合計使用料
        SQLBldr.AppendLine("FROM")
        'メイン レンタル料一覧データ
        SQLBldr.AppendLine("    ( ")
        '〇明細行データ
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            A01.SHIPYMD AS SHIPYMD")
        SQLBldr.AppendLine("            , A01.TORICODE AS TORICODE")
        SQLBldr.AppendLine("            , CONVERT(NVARCHAR, A01.KEIJOYM) AS KEIJOYM")
        SQLBldr.AppendLine("            , A01.INVFILINGDEPT AS INVFILINGDEPT")
        SQLBldr.AppendLine("            , FORMAT(A01.INVKESAIKBN, '00') AS INVKESAIKBN")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                  WHEN R02.INVSUBCD IS NOT NULL THEN FORMAT(R02.INVSUBCD, '00')")
        SQLBldr.AppendLine("                  ELSE FORMAT(A01.INVSUBCD, '00')")
        SQLBldr.AppendLine("              END AS INVSUBCD")
        SQLBldr.AppendLine("            , A01.CLOSINGDATE AS CLOSINGDATE")
        SQLBldr.AppendLine("            , A01.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("            , A01.DEPOSITMONTHKBN")
        SQLBldr.AppendLine("            , FORMAT(A01.CLOSINGDATE, 'dd') AS CLOSINGDAY")
        SQLBldr.AppendLine("            , A01.CTNTYPE AS CTNTYPE")
        SQLBldr.AppendLine("            , CONVERT(VARCHAR, A01.CTNNO) AS CTNNO")
        SQLBldr.AppendLine("            , A01.SAMEDAYCNT AS SAMEDAYCNT")
        SQLBldr.AppendLine("            , A01.CTNLINENO AS CTNLINENO")
        SQLBldr.AppendLine("            , A01.DEPSTATION AS DEPSTATION")
        SQLBldr.AppendLine("            , A01.ARRSTATION AS ARRSTATION")
        SQLBldr.AppendLine("            , coalesce(A02.KENSU,0) AS KENSU")
        SQLBldr.AppendLine("            , coalesce(A03.SUM_USEFEE,0) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.JRFIXEDFARE, 0) AS JRFIXEDFARE")
        SQLBldr.AppendLine("            , coalesce(A01.OWNDISCOUNTFEE, 0) AS OWNDISCOUNTFEE")
        SQLBldr.AppendLine("            , coalesce(A01.RETURNFARE, 0) AS RETURNFARE")
        SQLBldr.AppendLine("            , coalesce(A01.TOTALINCOME, 0) - coalesce(A01.NITTSUFREESEND, 0) AS USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.NITTSUFREESEND, 0) AS NITTSUFREESEND")
        SQLBldr.AppendLine("            , A01.INACCOUNTCD AS INACCOUNTCD")
        SQLBldr.AppendLine("        FROM")
        '[テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF A01 ")
        SQLBldr.AppendLine("        LEFT JOIN lng.LNT0064_INVOICEHEAD R01")
        SQLBldr.AppendLine("            ON R01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R01.DELFLG = @P01")
        SQLBldr.AppendLine("        INNER JOIN lng.LNT0067_INVOICEDATA_RENT R02")
        SQLBldr.AppendLine("            ON R02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R02.SHIPYMD = A01.SHIPYMD")
        SQLBldr.AppendLine("            AND R02.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("            AND R02.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("            AND R02.SAMEDAYCNT = A01.SAMEDAYCNT")
        SQLBldr.AppendLine("            AND R02.CTNLINENO = A01.CTNLINENO")
        SQLBldr.AppendLine("            AND R02.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("            AND R02.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("            AND R02.DELFLG = @P01")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END AS INVSUBCD")
        SQLBldr.AppendLine("                    , COUNT(A11.SHIPYMD) AS KENSU")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    lng.LNT0017_RESSNF A11")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                INNER JOIN lng.LNT0067_INVOICEDATA_RENT A12")
        SQLBldr.AppendLine("                   ON A12.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.SHIPYMD = A11.SHIPYMD")
        SQLBldr.AppendLine("                   AND A12.CTNTYPE = A11.CTNTYPE")
        SQLBldr.AppendLine("                   AND A12.CTNNO = A11.CTNNO")
        SQLBldr.AppendLine("                   AND A12.SAMEDAYCNT = A11.SAMEDAYCNT")
        SQLBldr.AppendLine("                   AND A12.CTNLINENO = A11.CTNLINENO")
        SQLBldr.AppendLine("                   AND A12.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                   AND A12.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                   AND A12.DELFLG = @P01")
        SQLBldr.AppendLine("                LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                    LNG.LNM0002_RECONM A13                                                                                                ")
        SQLBldr.AppendLine("                ON                                                                                                                        ")
        SQLBldr.AppendLine("                    A13.CTNTYPE = A11.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                AND A13.CTNNO   = A11.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                AND A13.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                WHERE")
        SQLBldr.AppendLine("                    A11.DELFLG = @P01")
        SQLBldr.AppendLine("                    AND A11.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                    AND coalesce(A13.DUMMYKBN, '00')  = '00'                                                                                ")
        SQLBldr.AppendLine("                    AND A11.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END")
        SQLBldr.AppendLine("            ) A02")
        SQLBldr.AppendLine("                ON A01.DEPSTATION = A02.DEPSTATION")
        SQLBldr.AppendLine("                AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A02.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A02.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("                    , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    (")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A21.DEPSTATION")
        SQLBldr.AppendLine("                       , A21.TORICODE")
        SQLBldr.AppendLine("                       , A21.KEIJOYM")
        SQLBldr.AppendLine("                       , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                             ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                          END AS INVSUBCD")
        SQLBldr.AppendLine("                       , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                     INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                        ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                        AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                        AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                        AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                        AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                        AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                        AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("                     LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                         LNG.LNM0002_RECONM A23                                                                                                ")
        SQLBldr.AppendLine("                     ON                                                                                                                        ")
        SQLBldr.AppendLine("                         A23.CTNTYPE = A21.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                     AND A23.CTNNO   = A21.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                     AND A23.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                         A21.DELFLG = @P01")
        SQLBldr.AppendLine("                         AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                         AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                     UNION ALL")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A31.DEPSTATION")
        SQLBldr.AppendLine("                       , A31.TORICODE")
        SQLBldr.AppendLine("                       , A31.KEIJOYM")
        SQLBldr.AppendLine("                       , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                         END AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                        A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                        AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("                )A11 ")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("            ) A03")
        SQLBldr.AppendLine("                ON A01.DEPSTATION = A03.DEPSTATION")
        SQLBldr.AppendLine("                AND A01.TORICODE = A03.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A03.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A03.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A03.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A03.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            A01.DELFLG = @P01")
        SQLBldr.AppendLine("            AND A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("            AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("    ) D01")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD D02")
        SQLBldr.AppendLine("        ON D02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D02.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * @P03) ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE01, 0)) AS ADDFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDFEE01, 0)) AS TAXADDFEE01")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDFEE02, 0)) AS ADDFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.TAXADDFEE02, 0)) AS TAXADDFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDFEE11, 0)) AS ADDFEE11")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDFEE12, 0)) AS ADDFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("			   , 0 AS TOTALINCOME")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE01")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE02")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("						 END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE02")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '11' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE11")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '12' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) D03 ")
        SQLBldr.AppendLine("        ON D03.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D03.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D03.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND D03.INVSUBCD = D01.INVSUBCD")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D04")
        SQLBldr.AppendLine("        ON D04.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D04.STATION = D01.DEPSTATION")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D05")
        SQLBldr.AppendLine("        ON D05.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D05.STATION = D01.ARRSTATION ")
        SQLBldr.AppendLine("        AND D05.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM D06")
        SQLBldr.AppendLine("        ON D06.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D06.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(D06.INVKESAIKBN, '00') = D01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND D06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) D07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        D07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0067_INVOICEDATA_RENT D09")
        SQLBldr.AppendLine("        ON D09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D09.SHIPYMD = D01.SHIPYMD")
        SQLBldr.AppendLine("        AND D09.CTNTYPE = D01.CTNTYPE")
        SQLBldr.AppendLine("        AND D09.CTNNO = D01.CTNNO")
        SQLBldr.AppendLine("        AND D09.SAMEDAYCNT = D01.SAMEDAYCNT")
        SQLBldr.AppendLine("        AND D09.CTNLINENO = D01.CTNLINENO")
        SQLBldr.AppendLine("        AND D09.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("        AND D09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND D09.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM D10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        D10.CTNTYPE = D01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND D10.CTNNO   = D01.CTNNO       ")
        SQLBldr.AppendLine("    AND D10.DELFLG = @P01             ")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 D21.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF D21")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            D21.KEIJOYM = D01.KEIJOYM")
        SQLBldr.AppendLine("        AND D21.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D21.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND D21.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("        AND D21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("        AND D21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("        AND D21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("        AND D21.DELFLG = @P01")
        SQLBldr.AppendLine("    ) D11")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM D12")
        SQLBldr.AppendLine("        ON D12.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D12.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(D12.INVKESAIKBN, '00') = D11.INVKESAIKBN")
        SQLBldr.AppendLine("        AND D12.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * 8) / 100 ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) D13 ")
        SQLBldr.AppendLine("        ON D13.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D13.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D13.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND D13.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION D14")
        SQLBldr.AppendLine("        ON D14.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D14.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D14.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("        AND D14.INVOICETYPE = '2'")
        SQLBldr.AppendLine("        AND D14.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVFILINGDEPT = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    D01.INVSUBCD")
        SQLBldr.AppendLine("    , D01.DEPSTATION")
        SQLBldr.AppendLine("    , D01.ARRSTATION")
        SQLBldr.AppendLine("    , D01.SHIPYMD")
        SQLBldr.AppendLine("    , D01.CTNNO")
        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.VarChar)  '会社コード
            Dim PARA03 As MySqlParameter = SQLcmd.Parameters.Add("@P03", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_CORPCD).ToString
            PARA03.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(リース))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectLeaseCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN A03.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(A03.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , CASE WHEN A09.INVSUBCD IS NOT NULL")
        SQLBldr.AppendLine("        THEN A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("             + FORMAT(coalesce(A09.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')")
        SQLBldr.AppendLine("        ELSE A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("             + FORMAT(coalesce(A01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')")
        SQLBldr.AppendLine("      END AS 請求仮番号")                                                                                                                       '請求仮番号 
        SQLBldr.AppendLine("    , CASE")                                                                                                                                    '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '0' THEN A01.CLOSINGDATE")
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '1' THEN A01.LEASEMONTHSTARTYMD")                                                                '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付 2024/09/10 伊藤 CHG 
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + A01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE01,0), '0') AS 税抜金額")                                               '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0) + coalesce(R01.TAXADDLEASEFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                                         '消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02 + coalesce(R01.ADDLEASEFEE01,0) + coalesce(R01.TAXADDLEASEFEE01,0), 0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                                       '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE02,0), '0') AS 経過措置税抜金額")       　　　　                           '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                                                 '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE02,0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                                               '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0) + coalesce(R01.ADDLEASEFEE12,0),'0') AS 課税対象外金額")                                                                                                                     '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) +coalesce(R01.SUM_MONTHLEASEFEE_DTL,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE01, 0) + coalesce(R01.TAXADDLEASEFEE01, 0) + ")
        SQLBldr.AppendLine("		            coalesce(R01.ADDLEASEFEE02, 0) + coalesce(R01.TAXADDLEASEFEE02, 0) + coalesce(R01.ADDLEASEFEE11, 0) + coalesce(R01.ADDLEASEFEE12, 0), '0')")
        SQLBldr.AppendLine("      END AS 請求書合計金額")                                                                                                                   '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0),'0') AS 非課税売上小計")                                                                               '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE12,0),'0') AS 不課税売上小計")                                                                               '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, A03.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                                                 '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , A07.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + A04.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(CONVERT(DATE, CAST(A01.KEIJOYM AS NVARCHAR) + '01'), 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN R05.SLIPDESCRIPTION IS NOT NULL THEN ' ' + R05.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(A03.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(A03.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'")
        SQLBldr.AppendLine("      END AS 宛名欄付記1")                                                                                                                      '宛名欄付記1
        SQLBldr.AppendLine("    ,  '' AS 宛名欄付記2")                                                                                                                      '宛名欄付記2
        SQLBldr.AppendLine("    ,  '' AS 宛名欄付記3")                                                                                                                      '宛名欄付記3
        SQLBldr.AppendLine("    , A03.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '11' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , REPLACE(TRIM(A06.KANJI1),'　','') + 'コンテナ' AS 品名")                                                                                  '品名
        SQLBldr.AppendLine("    , A01.CTNTYPE AS コンテナ記号")                                                                                                             'コンテナ記号
        SQLBldr.AppendLine("    , CONVERT(VARCHAR, A01.CTNNO) AS コンテナ番号")                                                                                             'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(A10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                                             '個数
        SQLBldr.AppendLine("    , A05.CARGOWEIGHT AS トン数")                                                                                                               'トン数
        SQLBldr.AppendLine("    , FORMAT(A01.LEASEMONTHSTARTYMD, 'yyyy/M/d') AS '使用期間（自）'")                                                                          '使用期間（自）
        SQLBldr.AppendLine("    , FORMAT(A01.LEASEMONTHENDYMD, 'yyyy/M/d') AS '使用期間（至）'")                                                                            '使用期間（至）
        SQLBldr.AppendLine("    , DATEDIFF(day, CONVERT(date, A01.LEASEMONTHSTARTYMD), DATEADD(DAY,1,CONVERT(date, A01.LEASEMONTHENDYMD))) AS '使用期間（日数）'")          '使用期間（日数）
        SQLBldr.AppendLine("    , FORMAT(coalesce(A01.MONTHLEASEFEE,0), '0') AS 単価")                                                                                        '単価
        SQLBldr.AppendLine("    , FORMAT(coalesce(A01.MONTHLEASEFEE,0), '0') AS 金額")                                                                                        '金額
        SQLBldr.AppendLine("    , A01.TAXRATE AS 税率")                                                                                                                     '税率
        SQLBldr.AppendLine("    , FORMAT(coalesce(A08.SUM_LEASEFEE,0), '0') AS 品名の小計")                                                                                   '品名の小計
        SQLBldr.AppendLine("    , '' AS 備考")                                                                                                                              '備考
        SQLBldr.AppendLine("    , REPLACE(TRIM(A06.KANJI1),'　','') + 'コンテナ' AS LK65")                                                                                  'LK65
        SQLBldr.AppendLine("    , '' AS 単位")                                                                                                                              '単位
        SQLBldr.AppendLine("    , '' AS 請求書用税区分名")                                                                                                                  '請求書用税区分名
        SQLBldr.AppendLine("FROM")
        'メイン リース明細データ
        SQLBldr.AppendLine("    lng.LNT0042_LEASEDATA A01")
        SQLBldr.AppendLine("INNER JOIN")
        SQLBldr.AppendLine("    LNG.LNT0041_LEASEAPPLY T41")
        SQLBldr.AppendLine("ON")
        SQLBldr.AppendLine("    T41.LEASENO  = A01.LEASENO")
        SQLBldr.AppendLine("AND T41.CTNTYPE  = A01.CTNTYPE")
        SQLBldr.AppendLine("AND T41.CTNNO    = A01.CTNNO")
        SQLBldr.AppendLine("AND A01.LEASEMONTHSTARTYMD BETWEEN T41.APPLYSTARTYMD AND T41.APPLYENDYMD")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD A03")
        SQLBldr.AppendLine("       ON A03.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("       AND A03.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("       AND A03.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("       AND A03.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("       AND A03.DELFLG = @P01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A09")
        SQLBldr.AppendLine("        ON A09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND A09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND A09.LEASENO = A01.LEASENO")
        SQLBldr.AppendLine("        AND A09.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A09.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A09.LEASEMONTHSTARTYMD = A01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("        AND A09.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("        AND A09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND A09.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM A04")
        SQLBldr.AppendLine("        ON A04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND A04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(A04.INVKESAIKBN, '00') = A01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND A04.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0002_RECONM A05")
        SQLBldr.AppendLine("        ON A05.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A05.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A05.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0022_CLASS A06")
        SQLBldr.AppendLine("        ON A06.BIGCTNCD = A05.BIGCTNCD")
        SQLBldr.AppendLine("        AND A06.MIDDLECTNCD = A05.MIDDLECTNCD")
        SQLBldr.AppendLine("        AND A06.SMALLCTNCD = A05.SMALLCTNCD")
        SQLBldr.AppendLine("        AND A06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) A07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        A07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]リース明細(品名の小計)
        SQLBldr.AppendLine("    LEFT JOIN (")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , B01.INVSUBCD")
        SQLBldr.AppendLine("            , B01.KANJI1")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("            , SUM(coalesce(B01.MONTHLEASEFEE,0)) AS SUM_LEASEFEE")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("           (")
        SQLBldr.AppendLine("            SELECT")
        SQLBldr.AppendLine("                B01.KEIJOYM")
        SQLBldr.AppendLine("              , B01.TORICODE")
        SQLBldr.AppendLine("              , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("              , B01.DEPOSITYMD")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                     WHEN B02.INVSUBCD IS NOT NULL THEN B02.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE B01.INVSUBCD")
        SQLBldr.AppendLine("                END AS INVSUBCD")
        SQLBldr.AppendLine("              , B04.KANJI1")
        SQLBldr.AppendLine("              , B01.DELFLG")
        SQLBldr.AppendLine("              , coalesce(B01.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("            FROM")
        SQLBldr.AppendLine("                lng.LNT0042_LEASEDATA B01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("            INNER JOIN lng.LNT0068_INVOICEDATA_LEASE B02")
        SQLBldr.AppendLine("                ON B02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND B02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND B02.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("                AND B02.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("                AND B02.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("                AND B02.LEASEMONTHSTARTYMD = B01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND B02.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND B02.INVOICEEXCLUSIONFLAG = '0'")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0002_RECONM B03")
        SQLBldr.AppendLine("                ON B03.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("                AND B03.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("                AND B03.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0022_CLASS B04")
        SQLBldr.AppendLine("                ON B04.BIGCTNCD = B03.BIGCTNCD")
        SQLBldr.AppendLine("                AND B04.MIDDLECTNCD = B03.MIDDLECTNCD")
        SQLBldr.AppendLine("                AND B04.SMALLCTNCD = B03.SMALLCTNCD")
        SQLBldr.AppendLine("                AND B04.DELFLG = @P01")
        SQLBldr.AppendLine("            UNION ALL")
        SQLBldr.AppendLine("            SELECT")
        SQLBldr.AppendLine("                A21.KEIJOYM")
        SQLBldr.AppendLine("              , A21.TORICODE")
        SQLBldr.AppendLine("              , A21.INVFILINGDEPT AS INVOICEOUTORGCD")
        SQLBldr.AppendLine("              , A21.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                END AS INVSUBCD")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                    WHEN coalesce(A23.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("                    ELSE A24.KANJI1")
        SQLBldr.AppendLine("                END AS KANJI1")
        SQLBldr.AppendLine("              , A21.DELFLG")
        SQLBldr.AppendLine("              , coalesce(A21.TOTALINCOME, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("            FROM")
        SQLBldr.AppendLine("                lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("            INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0002_RECONM A23")
        SQLBldr.AppendLine("                ON A23.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A23.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A23.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0022_CLASS A24")
        SQLBldr.AppendLine("                ON A24.BIGCTNCD = A23.BIGCTNCD")
        SQLBldr.AppendLine("                AND A24.MIDDLECTNCD = A23.MIDDLECTNCD")
        SQLBldr.AppendLine("                AND A24.SMALLCTNCD = A23.SMALLCTNCD")
        SQLBldr.AppendLine("                AND A24.DELFLG = @P01")
        SQLBldr.AppendLine("            WHERE")
        SQLBldr.AppendLine("                A21.DELFLG = @P01")
        SQLBldr.AppendLine("                AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("            UNION ALL")
        SQLBldr.AppendLine("            SELECT")
        SQLBldr.AppendLine("                A31.KEIJOYM")
        SQLBldr.AppendLine("              , A31.TORICODE")
        SQLBldr.AppendLine("              , A31.INVOICEORGCODE AS INVOICEOUTORGCD")
        SQLBldr.AppendLine("              , A31.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("              , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("              , A31.DETAILS AS KANJI1")
        SQLBldr.AppendLine("              , A31.DELFLG")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                    WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                    WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                    WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                END AS MONTHLEASEFEE")
        SQLBldr.AppendLine("            FROM")
        SQLBldr.AppendLine("                lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("            WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )B01")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , B01.INVSUBCD")
        SQLBldr.AppendLine("            , B01.KANJI1")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("    ) A08")
        SQLBldr.AppendLine("        ON  A01.KEIJOYM = A08.KEIJOYM")
        SQLBldr.AppendLine("        AND A01.TORICODE = A08.TORICODE")
        SQLBldr.AppendLine("        AND A01.INVOICEOUTORGCD = A08.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND A01.DEPOSITYMD = A08.DEPOSITYMD")
        SQLBldr.AppendLine("        AND A08.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("        AND A06.KANJI1 = A08.KANJI1")
        SQLBldr.AppendLine("        AND A08.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM A10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        A10.CTNTYPE = A01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND A10.CTNNO   = A01.CTNNO       ")
        SQLBldr.AppendLine("    AND A10.DELFLG = @P01             ")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * @P02) ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE01, 0)) AS ADDLEASEFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDLEASEFEE01, 0)) AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE02, 0)) AS ADDLEASEFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDLEASEFEE02, 0)) AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE11, 0)) AS ADDLEASEFEE11")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE12, 0)) AS ADDLEASEFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("               , 0 AS MONTHLEASEFEE")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("                        CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '11' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '12' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R01 ")
        SQLBldr.AppendLine("        ON R01.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R01.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R01.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R01.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 R12.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA R12")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            R12.KEIJOYM = A01.KEIJOYM")
        SQLBldr.AppendLine("        AND R12.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R12.DEPOSITYMD = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R12.INVOICEOUTORGCD = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R12.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("        AND R12.DELFLG = @P01")
        SQLBldr.AppendLine("    ) R02")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM R03")
        SQLBldr.AppendLine("        ON R03.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R03.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(R03.INVKESAIKBN, '00') = R02.INVKESAIKBN")
        SQLBldr.AppendLine("        AND R03.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * 8) / 100 ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R04 ")
        SQLBldr.AppendLine("        ON R04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R04.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R04.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION R05")
        SQLBldr.AppendLine("        ON R05.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R05.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R05.INVSUBCD = A01.INVSUBCD")
        SQLBldr.AppendLine("        AND R05.INVOICETYPE = '3'")
        SQLBldr.AppendLine("        AND R05.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.DELFLG = @P01")
        SQLBldr.AppendLine("    AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVOICEOUTORGCD = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND CASE")
        SQLBldr.AppendLine("            WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("            ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("        END = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    A01.INVSUBCD")
        SQLBldr.AppendLine("    , CASE T41.CONTRALNTYPE")
        SQLBldr.AppendLine("         WHEN '1' THEN 1")
        SQLBldr.AppendLine("         WHEN '3' THEN 2")
        SQLBldr.AppendLine("         WHEN '2' THEN 3")
        SQLBldr.AppendLine("      END               ")
        SQLBldr.AppendLine("    , A01.CTNTYPE")
        SQLBldr.AppendLine("    , A01.CTNNO")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(使用料→リース))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectLeaseCsv_Rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN D02.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(D02.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                      '発行日
        SQLBldr.AppendLine("    , D01.TORICODE + '-' + CAST(D01.KEIJOYM AS NVARCHAR) + '-' + D01.INVFILINGDEPT + '-'")
        SQLBldr.AppendLine("    + D01.INVSUBCD + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")   '請求仮番号
        SQLBldr.AppendLine("    , D01.CLOSINGDATE AS 計上日付")                                                                                      '計上日付
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   , '01' + '-' + D01.TORICODE + '-' + '1' AS 顧客コード")                                                           '顧客コード
        Else
            SQLBldr.AppendLine("   , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE01,0), '0') AS 税抜金額")                         '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0) + coalesce(R01.TAXADDLEASEFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                   '消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * 0.1, 0) + coalesce(R01.ADDLEASEFEE01,0) + coalesce(R01.TAXADDLEASEFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE02,0), '0') AS 経過措置税抜金額")                   '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                          '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE02,0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                        '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0) + coalesce(R01.ADDLEASEFEE12,0),'0') AS 課税対象外金額")                                                                                              '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) +coalesce(R01.SUM_MONTHLEASEFEE_DTL,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * 0.1, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE01,0) + coalesce(R01.TAXADDLEASEFEE01,0) + ")
        SQLBldr.AppendLine("		            coalesce(R01.ADDLEASEFEE02,0) + coalesce(R01.TAXADDLEASEFEE02,0) + coalesce(R01.ADDLEASEFEE11,0) + coalesce(R01.ADDLEASEFEE12,0), '0')")
        SQLBldr.AppendLine("      END AS 請求書合計金額")                                                                                            '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0),'0') AS 非課税売上小計")                                                                                              '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE12,0),'0') AS 不課税売上小計")                                                                                              '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, D02.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                          '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                            '発行部署コード
        SQLBldr.AppendLine("    , D07.STAFFNAMEL AS 発行担当者")                                                                                     '発行担当者
        SQLBldr.AppendLine("    , '01-' + D06.INACCOUNTCD AS 請求入金銀行コード")                                                                    '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(D01.CLOSINGDATE, 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN D12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + D12.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(D02.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(D02.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'")
        SQLBldr.AppendLine("       END AS 宛名欄付記1")                                                                                               '宛名欄付記1
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記2")                                                                                               '宛名欄付記2
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記3")                                                                                               '宛名欄付記3
        SQLBldr.AppendLine("    , D02.FOOTERCOMMENT AS 通信欄")                                                                                      '通信欄
        SQLBldr.AppendLine("    , '11' AS 帳票種別")                                                                                                 '帳票種別
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("          ELSE REPLACE(TRIM(D11.KANJI1),'　','') + 'コンテナ'")
        SQLBldr.AppendLine("      END AS 品名")                                                                                                      '品名
        SQLBldr.AppendLine("    , D01.CTNTYPE AS コンテナ記号")                                                                                      'コンテナ記号
        SQLBldr.AppendLine("    , D01.CTNNO AS コンテナ番号")                                                                                        'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                      '個数
        SQLBldr.AppendLine("    , D10.CARGOWEIGHT AS トン数")                                                                                        'トン数
        SQLBldr.AppendLine("    , FORMAT(D01.SHIPYMD, 'yyyy/M/d') AS '使用期間（自）'")                                                              '使用期間（自）
        SQLBldr.AppendLine("    , FORMAT(D01.ARRPLANYMD, 'yyyy/M/d') AS '使用期間（至）'")                                                           '使用期間（至）
        SQLBldr.AppendLine("    , DATEDIFF(day, CONVERT(date, D01.SHIPYMD), DATEADD(DAY,1,CONVERT(date, D01.ARRPLANYMD))) AS '使用期間（日数）'")    '使用期間（日数）
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.USEFEE,0), '0') AS 単価")                                                                        '単価
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.USEFEE,0), '0') AS 金額")                                                                        '金額
        SQLBldr.AppendLine("    , '10' AS 税率")                                                                                                     '税率
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.SUM_USEFEE,0), '0') AS 品名の小計")                                                              '品名の小計
        SQLBldr.AppendLine("    , '' AS 備考")                                                                                                       '備考
        SQLBldr.AppendLine("    , REPLACE(TRIM(D11.KANJI1),'　','') + 'コンテナ' AS LK65")                                                           'LK65
        SQLBldr.AppendLine("    , '' AS 単位")                                                                                                       '単位
        SQLBldr.AppendLine("    , '' AS 請求書用税区分名")                                                                                           '請求書用税区分名
        SQLBldr.AppendLine("FROM")
        'メイン レンタル料一覧データ
        SQLBldr.AppendLine("    ( ")
        '〇明細行データ
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            A01.SHIPYMD AS SHIPYMD")
        SQLBldr.AppendLine("            , A01.TORICODE AS TORICODE")
        SQLBldr.AppendLine("            , CONVERT(NVARCHAR, A01.KEIJOYM) AS KEIJOYM")
        SQLBldr.AppendLine("            , A01.INVFILINGDEPT AS INVFILINGDEPT")
        SQLBldr.AppendLine("            , FORMAT(A01.INVKESAIKBN, '00') AS INVKESAIKBN")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                  WHEN R02.INVSUBCD IS NOT NULL THEN FORMAT(R02.INVSUBCD, '00')")
        SQLBldr.AppendLine("                  ELSE FORMAT(A01.INVSUBCD, '00')")
        SQLBldr.AppendLine("              END AS INVSUBCD")
        SQLBldr.AppendLine("            , A01.CLOSINGDATE AS CLOSINGDATE")
        SQLBldr.AppendLine("            , A01.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("            , A01.DEPOSITMONTHKBN")
        SQLBldr.AppendLine("            , FORMAT(A01.CLOSINGDATE, 'dd') AS CLOSINGDAY")
        SQLBldr.AppendLine("            , A01.CTNTYPE AS CTNTYPE")
        SQLBldr.AppendLine("            , CONVERT(VARCHAR, A01.CTNNO) AS CTNNO")
        SQLBldr.AppendLine("            , A01.SAMEDAYCNT AS SAMEDAYCNT")
        SQLBldr.AppendLine("            , A01.CTNLINENO AS CTNLINENO")
        SQLBldr.AppendLine("            , A01.BIGCTNCD AS BIGCTNCD")
        SQLBldr.AppendLine("            , A01.MIDDLECTNCD AS MIDDLECTNCD")
        SQLBldr.AppendLine("            , A01.SMALLCTNCD AS SMALLCTNCD")
        SQLBldr.AppendLine("            , A01.DEPSTATION AS DEPSTATION")
        SQLBldr.AppendLine("            , A01.ARRSTATION AS ARRSTATION")
        SQLBldr.AppendLine("            , A01.ARRPLANYMD AS ARRPLANYMD")
        SQLBldr.AppendLine("            , coalesce(A02.KENSU,0) AS KENSU")
        SQLBldr.AppendLine("            , coalesce(A05.SUM_USEFEE,0) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.JRFIXEDFARE, 0) AS JRFIXEDFARE")
        SQLBldr.AppendLine("            , coalesce(A01.OWNDISCOUNTFEE, 0) AS OWNDISCOUNTFEE")
        SQLBldr.AppendLine("            , coalesce(A01.RETURNFARE, 0) AS RETURNFARE")
        SQLBldr.AppendLine("            , coalesce(A01.TOTALINCOME, 0) AS USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.NITTSUFREESEND, 0) AS NITTSUFREESEND")
        SQLBldr.AppendLine("            , A01.INACCOUNTCD AS INACCOUNTCD")
        SQLBldr.AppendLine("        FROM")
        '[テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF A01 ")
        SQLBldr.AppendLine("        LEFT JOIN lng.LNT0064_INVOICEHEAD R01")
        SQLBldr.AppendLine("            ON R01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R01.DELFLG = @P01")
        SQLBldr.AppendLine("        INNER JOIN lng.LNT0067_INVOICEDATA_RENT R02")
        SQLBldr.AppendLine("            ON R02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R02.SHIPYMD = A01.SHIPYMD")
        SQLBldr.AppendLine("            AND R02.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("            AND R02.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("            AND R02.SAMEDAYCNT = A01.SAMEDAYCNT")
        SQLBldr.AppendLine("            AND R02.CTNLINENO = A01.CTNLINENO")
        SQLBldr.AppendLine("            AND R02.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("            AND R02.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("            AND R02.DELFLG = @P01")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END AS INVSUBCD")
        SQLBldr.AppendLine("                    , COUNT(A11.SHIPYMD) AS KENSU")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    lng.LNT0017_RESSNF A11")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                INNER JOIN lng.LNT0067_INVOICEDATA_RENT A12")
        SQLBldr.AppendLine("                   ON A12.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.SHIPYMD = A11.SHIPYMD")
        SQLBldr.AppendLine("                   AND A12.CTNTYPE = A11.CTNTYPE")
        SQLBldr.AppendLine("                   AND A12.CTNNO = A11.CTNNO")
        SQLBldr.AppendLine("                   AND A12.SAMEDAYCNT = A11.SAMEDAYCNT")
        SQLBldr.AppendLine("                   AND A12.CTNLINENO = A11.CTNLINENO")
        SQLBldr.AppendLine("                   AND A12.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                   AND A12.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                   AND A12.DELFLG = @P01")
        SQLBldr.AppendLine("                LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                    LNG.LNM0002_RECONM A13                                                                                                ")
        SQLBldr.AppendLine("                ON                                                                                                                        ")
        SQLBldr.AppendLine("                    A13.CTNTYPE = A11.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                AND A13.CTNNO   = A11.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                AND A13.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                WHERE")
        SQLBldr.AppendLine("                    A11.DELFLG = @P01")
        SQLBldr.AppendLine("                    AND A11.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                    AND coalesce(A13.DUMMYKBN, '00')  = '00'                                                                                ")
        SQLBldr.AppendLine("                    AND A11.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END")
        SQLBldr.AppendLine("            ) A02")
        SQLBldr.AppendLine("                ON A01.DEPSTATION = A02.DEPSTATION")
        SQLBldr.AppendLine("                AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A02.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A02.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        SQLBldr.AppendLine("            LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                LNG.LNM0002_RECONM A03                                                                                                ")
        SQLBldr.AppendLine("            ON                                                                                                                        ")
        SQLBldr.AppendLine("                A03.CTNTYPE = A01.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("            AND A03.CTNNO   = A01.CTNNO                                                                                               ")
        SQLBldr.AppendLine("            AND A03.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0022_CLASS A04                                                                                         ")
        SQLBldr.AppendLine("            ON A04.BIGCTNCD = A03.BIGCTNCD                                                                                            ")
        SQLBldr.AppendLine("            AND A04.MIDDLECTNCD = A03.MIDDLECTNCD                                                                                     ")
        SQLBldr.AppendLine("            AND A04.SMALLCTNCD = A03.SMALLCTNCD                                                                                       ")
        SQLBldr.AppendLine("            AND A04.DELFLG  = @P01                                                                                                    ")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.KANJI1")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("                    , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    (")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN coalesce(A23.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("                             ELSE A24.KANJI1")
        SQLBldr.AppendLine("                         END AS KANJI1")
        SQLBldr.AppendLine("                       , A21.TORICODE")
        SQLBldr.AppendLine("                       , A21.KEIJOYM")
        SQLBldr.AppendLine("                       , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                             ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                          END AS INVSUBCD")
        SQLBldr.AppendLine("                       , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                     INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                        ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                        AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                        AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                        AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                        AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                        AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                        AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("                     LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                         LNG.LNM0002_RECONM A23                                                                                                ")
        SQLBldr.AppendLine("                     ON                                                                                                                        ")
        SQLBldr.AppendLine("                         A23.CTNTYPE = A21.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                     AND A23.CTNNO   = A21.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                     AND A23.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                     LEFT JOIN lng.LNM0022_CLASS A24                                                                                         ")
        SQLBldr.AppendLine("                     ON A24.BIGCTNCD = A23.BIGCTNCD                                                                                            ")
        SQLBldr.AppendLine("                     AND A24.MIDDLECTNCD = A23.MIDDLECTNCD                                                                                     ")
        SQLBldr.AppendLine("                     AND A24.SMALLCTNCD = A23.SMALLCTNCD                                                                                       ")
        SQLBldr.AppendLine("                     AND A24.DELFLG = @P01                                                                                                     ")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                         A21.DELFLG = @P01")
        SQLBldr.AppendLine("                         AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                         AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                     UNION ALL")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A34.KANJI1")
        SQLBldr.AppendLine("                       , A31.TORICODE")
        SQLBldr.AppendLine("                       , A31.KEIJOYM")
        SQLBldr.AppendLine("                       , A31.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A31.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A32.INVSUBCD IS NOT NULL THEN A32.INVSUBCD")
        SQLBldr.AppendLine("                             ELSE A31.INVSUBCD")
        SQLBldr.AppendLine("                         END AS INVSUBCD")
        SQLBldr.AppendLine("                       , coalesce(A31.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0042_LEASEDATA A31")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("                     INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A32")
        SQLBldr.AppendLine("                        ON A32.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.LEASENO = A31.LEASENO")
        SQLBldr.AppendLine("                        AND A32.CTNTYPE = A31.CTNTYPE")
        SQLBldr.AppendLine("                        AND A32.CTNNO = A31.CTNNO")
        SQLBldr.AppendLine("                        AND A32.LEASEMONTHSTARTYMD = A31.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                        AND A32.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                        AND A32.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A32.DELFLG = @P01")
        SQLBldr.AppendLine("                     LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                         LNG.LNM0002_RECONM A33                                                                                                ")
        SQLBldr.AppendLine("                     ON                                                                                                                        ")
        SQLBldr.AppendLine("                         A33.CTNTYPE = A31.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                     AND A33.CTNNO   = A31.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                     AND A33.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                     LEFT JOIN lng.LNM0022_CLASS A34                                                                                         ")
        SQLBldr.AppendLine("                     ON A34.BIGCTNCD = A33.BIGCTNCD                                                                                            ")
        SQLBldr.AppendLine("                     AND A34.MIDDLECTNCD = A33.MIDDLECTNCD                                                                                     ")
        SQLBldr.AppendLine("                     AND A34.SMALLCTNCD = A33.SMALLCTNCD                                                                                       ")
        SQLBldr.AppendLine("                     AND A34.DELFLG = @P01                                                                                                     ")
        SQLBldr.AppendLine("                     UNION ALL")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A41.DETAILS AS KANJI1")
        SQLBldr.AppendLine("                       , A41.TORICODE")
        SQLBldr.AppendLine("                       , A41.KEIJOYM")
        SQLBldr.AppendLine("                       , A41.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A41.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , A41.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A41.AMOUNTTYPE = '5' THEN coalesce(A41.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A41.AMOUNTTYPE = '2' AND A41.RENTADJUSTMENT IS NOT NULL THEN coalesce(A41.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A41.AMOUNTTYPE = '2' AND A41.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A41.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                         END AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0080_INVOICEDATA_ADDAMOUNT A41")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                        A41.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                        AND A41.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A41.DELFLG = @P01")
        SQLBldr.AppendLine("                )A11 ")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.KANJI1")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("            ) A05")
        SQLBldr.AppendLine("                ON  CASE WHEN A03.DUMMYKBN = '00' ")
        SQLBldr.AppendLine("                         THEN A04.KANJI1")
        SQLBldr.AppendLine("                         ELSE '加減額'")
        SQLBldr.AppendLine("                         END = A05.KANJI1")
        SQLBldr.AppendLine("                AND A01.TORICODE = A05.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A05.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A05.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A05.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A05.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            A01.DELFLG = @P01")
        SQLBldr.AppendLine("            AND A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("            AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("    ) D01")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD D02")
        SQLBldr.AppendLine("        ON D02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D02.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * @P03) ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE01, 0)) AS ADDLEASEFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDLEASEFEE01, 0)) AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDLEASEFEE02, 0)) AS ADDLEASEFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.TAXADDLEASEFEE02, 0)) AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDLEASEFEE11, 0)) AS ADDLEASEFEE11")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDLEASEFEE12, 0)) AS ADDLEASEFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("			   , 0 AS MONTHLEASEFEE ")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '11' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '12' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R01 ")
        SQLBldr.AppendLine("        ON R01.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND R01.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R01.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R01.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 R12.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF R12")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            R12.KEIJOYM = D01.KEIJOYM")
        SQLBldr.AppendLine("        AND R12.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R12.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R12.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND R12.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("        AND R12.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("        AND R12.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("        AND R12.TOTALINCOME <> 0")
        SQLBldr.AppendLine("        AND R12.DELFLG = @P01")
        SQLBldr.AppendLine("    ) R02")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM R03")
        SQLBldr.AppendLine("        ON R03.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R03.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(R03.INVKESAIKBN, '00') = R02.INVKESAIKBN")
        SQLBldr.AppendLine("        AND R03.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * 8) / 100 ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R04 ")
        SQLBldr.AppendLine("        ON R04.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND R04.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R04.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R04.INVSUBCD = D01.INVSUBCD")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D04")
        SQLBldr.AppendLine("        ON D04.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D04.STATION = D01.DEPSTATION")
        SQLBldr.AppendLine("        AND D04.DELFLG = @P01")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D05")
        SQLBldr.AppendLine("        ON D05.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D05.STATION = D01.ARRSTATION ")
        SQLBldr.AppendLine("        AND D05.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM D06")
        SQLBldr.AppendLine("        ON D06.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D06.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(D06.INVKESAIKBN, '00') = D01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND D06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) D07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        D07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0067_INVOICEDATA_RENT D09")
        SQLBldr.AppendLine("        ON D09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D09.SHIPYMD = D01.SHIPYMD")
        SQLBldr.AppendLine("        AND D09.CTNTYPE = D01.CTNTYPE")
        SQLBldr.AppendLine("        AND D09.CTNNO = D01.CTNNO")
        SQLBldr.AppendLine("        AND D09.SAMEDAYCNT = D01.SAMEDAYCNT")
        SQLBldr.AppendLine("        AND D09.CTNLINENO = D01.CTNLINENO")
        SQLBldr.AppendLine("        AND D09.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("        AND D09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND D09.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM D10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        D10.CTNTYPE = D01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND D10.CTNNO   = D01.CTNNO       ")
        SQLBldr.AppendLine("    AND D10.DELFLG = @P01             ")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0022_CLASS D11")
        SQLBldr.AppendLine("        ON D11.BIGCTNCD = D10.BIGCTNCD")
        SQLBldr.AppendLine("        AND D11.MIDDLECTNCD = D10.MIDDLECTNCD")
        SQLBldr.AppendLine("        AND D11.SMALLCTNCD = D10.SMALLCTNCD")
        SQLBldr.AppendLine("        AND D11.DELFLG = @P01")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION D12")
        SQLBldr.AppendLine("        ON D12.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D12.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D12.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("        AND D12.INVOICETYPE = '3'")
        SQLBldr.AppendLine("        AND D12.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVFILINGDEPT = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    D01.INVSUBCD")
        SQLBldr.AppendLine("    , D01.CTNTYPE")
        SQLBldr.AppendLine("    , D01.CTNNO")
        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.VarChar)  '会社コード
            Dim PARA03 As MySqlParameter = SQLcmd.Parameters.Add("@P03", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_CORPCD).ToString
            PARA03.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(リース→使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRentalCsv_Lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN A03.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(A03.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , CASE WHEN A09.INVSUBCD IS NOT NULL")
        SQLBldr.AppendLine("        THEN A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("             + FORMAT(coalesce(A09.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')")
        SQLBldr.AppendLine("        ELSE A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("             + FORMAT(coalesce(A01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')")
        SQLBldr.AppendLine("      END AS 請求仮番号")                                                                                                                       '請求仮番号 
        SQLBldr.AppendLine("    , CASE")                                                                                                                                    '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '0' THEN A01.CLOSINGDATE")
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '1' THEN A01.LEASEMONTHSTARTYMD")                                                                '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付 2024/09/10 伊藤 CHG  
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + A01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("	, FORMAT(coalesce(R01.SUM_USEFEE,0) + coalesce(R01.ADDFEE01,0), '0') AS 税抜金額")                                                         '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0) + coalesce(R01.TAXADDFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                                         '消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) + coalesce(R01.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * @P02 + coalesce(R01.ADDFEE01,0) + coalesce(R01.TAXADDFEE01,0), 0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                                       '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R04.SUM_USEFEE,0) + coalesce(R01.ADDFEE02,0), '0') AS 経過措置税抜金額")                                                      '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(R01.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                                                 '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R04.SUM_USEFEE,0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_USEFEE,0) + coalesce(R04.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R04.SUM_USEFEE,0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDFEE02,0) + coalesce(R01.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                                               '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDFEE11,0) + coalesce(R01.ADDFEE12,0), '0') AS 課税対象外金額")                                                          '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) +coalesce(R04.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) +coalesce(R04.SUM_USEFEE,0) +coalesce(R01.SUM_USEFEE_DTL,0) + coalesce(R04.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_USEFEE,0) +coalesce(R04.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * 0.1, 0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDFEE01, 0) + coalesce(R01.TAXADDFEE01, 0) + ")
        SQLBldr.AppendLine("		            coalesce(R01.ADDFEE02, 0) + coalesce(R01.TAXADDFEE02, 0)+ coalesce(R01.ADDFEE11, 0) + coalesce(R01.ADDFEE12, 0), '0')")
        SQLBldr.AppendLine("      END AS 請求書合計金額")                                                                                                                   '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                   '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                   '不課税売上小計
        SQLBldr.AppendLine("    , FORMAT(A03.SCHEDATEPAYMENT, 'yyyy/MM/dd') AS '請求サイト（支払期日）'")                                                                   '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , A07.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + A04.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(CONVERT(DATE, CAST(A01.KEIJOYM AS NVARCHAR) + '01'), 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN R05.SLIPDESCRIPTION IS NOT NULL THEN ' ' + R05.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(A03.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(A03.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'")
        SQLBldr.AppendLine("      END AS 宛名欄付記1")                                                                                                                      '宛名欄付記1
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記2")                                                                                                                     '宛名欄付記2
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記3")                                                                                                                     '宛名欄付記3
        SQLBldr.AppendLine("    , A03.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '19' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , '' AS 発駅名")                                                                                                                            '発駅名
        SQLBldr.AppendLine("    , '' AS 着駅名")                                                                                                                            '着駅名
        SQLBldr.AppendLine("    , A01.LEASEMONTHSTARTYMD AS 発送年月日")                                                                                                    '発送年月日
        SQLBldr.AppendLine("    , A01.CTNTYPE AS コンテナ記号")                                                                                                             'コンテナ記号
        SQLBldr.AppendLine("    , CONVERT(VARCHAR, A01.CTNNO) AS コンテナ番号")                                                                                             'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(A10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                                             '個数
        SQLBldr.AppendLine("    , 0 AS JR所定運賃")                                                                                                                         'JR所定運賃
        SQLBldr.AppendLine("    , 0 AS 私有割引相当額")                                                                                                                     '私有割引相当額
        SQLBldr.AppendLine("    , 0 AS 割戻運賃")                                                                                                                           '割戻運賃
        SQLBldr.AppendLine("    , FORMAT(coalesce(A01.MONTHLEASEFEE,0), '0') AS 使用料金額")                                                                                  '使用料金額
        SQLBldr.AppendLine("    , 0 AS 通運負担回送運賃")                                                                                                                   '通運負担回送運賃
        SQLBldr.AppendLine("    , coalesce(A02.KENSU,0) AS 発駅合計個数")                                                                                                     '発駅合計個数
        SQLBldr.AppendLine("    , FORMAT(coalesce(A02.SUM_LEASEFEE,0), '0') AS 発駅合計使用料")                                                                               '発駅合計使用料
        SQLBldr.AppendLine("FROM")
        'メイン リース明細データ
        SQLBldr.AppendLine("    lng.LNT0042_LEASEDATA A01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A09")
        SQLBldr.AppendLine("        ON A09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND A09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND A09.LEASENO = A01.LEASENO")
        SQLBldr.AppendLine("        AND A09.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A09.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A09.LEASEMONTHSTARTYMD = A01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("        AND A09.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("        AND A09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND A09.DELFLG = @P01")
        '[結合テーブル]リース明細(金額合計)
        SQLBldr.AppendLine("    LEFT JOIN (")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                   WHEN B02.INVSUBCD IS NOT NULL THEN B02.INVSUBCD")
        SQLBldr.AppendLine("                   ELSE B01.INVSUBCD")
        SQLBldr.AppendLine("              END AS INVSUBCD")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("            , COUNT(B01.LEASENO) AS KENSU")
        SQLBldr.AppendLine("            , SUM(coalesce(B01.MONTHLEASEFEE,0)) AS SUM_LEASEFEE")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA B01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("            INNER JOIN lng.LNT0068_INVOICEDATA_LEASE B02")
        SQLBldr.AppendLine("                ON B02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND B02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND B02.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("                AND B02.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("                AND B02.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("                AND B02.LEASEMONTHSTARTYMD = B01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND B02.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND B02.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("            LNG.LNM0002_RECONM B03                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                        ")
        SQLBldr.AppendLine("            B03.CTNTYPE = B01.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("        AND B03.CTNNO   = B01.CTNNO                                                                                               ")
        SQLBldr.AppendLine("        AND B03.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("        WHERE                                                                                                                     ")
        SQLBldr.AppendLine("            coalesce(B03.DUMMYKBN, '00')  = '00'                                                                                    ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                   WHEN B02.INVSUBCD IS NOT NULL THEN B02.INVSUBCD")
        SQLBldr.AppendLine("                   ELSE B01.INVSUBCD")
        SQLBldr.AppendLine("              END")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("    ) A02")
        SQLBldr.AppendLine("        ON  A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("        AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("        AND A01.INVOICEOUTORGCD = A02.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND A01.DEPOSITYMD = A02.DEPOSITYMD")
        SQLBldr.AppendLine("        AND A02.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("        AND A02.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD A03")
        SQLBldr.AppendLine("        ON A03.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND A03.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND A03.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND A03.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND A03.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM A04")
        SQLBldr.AppendLine("        ON A04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND A04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(A04.INVKESAIKBN, '00') = A01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND A04.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0002_RECONM A05")
        SQLBldr.AppendLine("        ON A05.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A05.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A05.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0022_CLASS A06")
        SQLBldr.AppendLine("        ON A06.BIGCTNCD = A05.BIGCTNCD")
        SQLBldr.AppendLine("        AND A06.MIDDLECTNCD = A05.MIDDLECTNCD")
        SQLBldr.AppendLine("        AND A06.SMALLCTNCD = A05.SMALLCTNCD")
        SQLBldr.AppendLine("        AND A06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) A07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        A07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM A10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        A10.CTNTYPE = A01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND A10.CTNNO   = A01.CTNNO       ")
        SQLBldr.AppendLine("    AND A10.DELFLG = @P01             ")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * @P02) ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE01, 0)) AS ADDFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDFEE01, 0)) AS TAXADDFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE02, 0)) AS ADDFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDFEE02, 0)) AS TAXADDFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE11, 0)) AS ADDFEE11")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE12, 0)) AS ADDFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , 0 AS ADDFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDFEE12")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , 0 AS ADDFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDFEE12")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '11' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE11")
        SQLBldr.AppendLine("      　　　　 , CASE")
        SQLBldr.AppendLine("	  　　　　       WHEN A31.TAXKBN = '12' THEN ")
        SQLBldr.AppendLine("		　　　　	     CASE")
        SQLBldr.AppendLine("      　　　　               WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("      　　　　               WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("      　　　　               WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("		　　　　	     END")
        SQLBldr.AppendLine("      　　　　   END AS ADDFEE12")
        SQLBldr.AppendLine("               , 0 AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R01 ")
        SQLBldr.AppendLine("        ON R01.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R01.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R01.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R01.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 R12.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA R12")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            R12.KEIJOYM = A01.KEIJOYM")
        SQLBldr.AppendLine("        AND R12.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R12.DEPOSITYMD = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R12.INVOICEOUTORGCD = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R12.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("        AND R12.DELFLG = @P01")
        SQLBldr.AppendLine("    ) R02")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM R03")
        SQLBldr.AppendLine("        ON R03.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R03.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(R03.INVKESAIKBN, '00') = R02.INVKESAIKBN")
        SQLBldr.AppendLine("        AND R03.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * 8) / 100 ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R04 ")
        SQLBldr.AppendLine("        ON R04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R04.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R04.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION R05")
        SQLBldr.AppendLine("        ON R05.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R05.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R05.INVSUBCD = A01.INVSUBCD")
        SQLBldr.AppendLine("        AND R05.INVOICETYPE = '2'")
        SQLBldr.AppendLine("        AND R05.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.DELFLG = @P01")
        SQLBldr.AppendLine("    AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVOICEOUTORGCD = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND CASE")
        SQLBldr.AppendLine("            WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("            ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("        END = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    A01.INVSUBCD")
        SQLBldr.AppendLine("    , A01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("    , A01.CTNTYPE")
        SQLBldr.AppendLine("    , A01.CTNNO")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' その他(明細有り)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectOtherOnDetailCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 その他(明細有り)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + '4'    AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                          ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                      ")
        SQLBldr.AppendLine("             + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T13.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T13.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN coalesce(T8.DUMMYKBN, '00') = '01' THEN '加減額'                                                                           ")
        SQLBldr.AppendLine("        WHEN coalesce(T2.MANAGEFEE,0) <> 0 THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                           ")
        SQLBldr.AppendLine("        WHEN coalesce(T2.SHIPBURDENFEE,0) <> 0 THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                       ")
        SQLBldr.AppendLine("        WHEN coalesce(T2.PICKUPFEE,0) <> 0 THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                           ")
        SQLBldr.AppendLine("        ELSE '使用料'                                                                                                                 ")
        SQLBldr.AppendLine("    END                                                                                                    AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T2.SHIPYMD IS NOT NULL                                                                                                   ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.SHIPYMD, 'yyyy/MM/dd'), '')                                                                             ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        SQLBldr.AppendLine("   ,FORMAT((coalesce(T2.BILLINGFEE, 0)), '0')                                                                AS 単価                    ")
        SQLBldr.AppendLine("   ,FORMAT((coalesce(T2.BILLINGFEE, 0)), '0')                                                                AS 金額                    ")
        SQLBldr.AppendLine("   ,T2.TAXRATE                                                                                             AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単位                    ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T2.TAXRATE = 10 THEN '標準税率10%'                                                                                       ")
        SQLBldr.AppendLine("        WHEN T2.TAXRATE =  8 THEN '経過措置税率8％'                                                                                   ")
        SQLBldr.AppendLine("        WHEN T2.TAXRATE =  0 THEN '非課税'                                                                                            ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0067_INVOICEDATA_RENT T2                                                                                                   ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("AND T2.INVOICETYPE   = T1.INVOICETYPE                                                                                                 ")
        SQLBldr.AppendLine("AND T2.BILLINGFEE <> 0                                                                                                                ")
        SQLBldr.AppendLine("AND T2.INVOICEEXCLUSIONFLAG = '0'                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("		        END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)    ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0002_RECONM T8                                                                                                     ")
        SQLBldr.AppendLine("    ON T8.CTNTYPE = T2.CTNTYPE                                                                                                        ")
        SQLBldr.AppendLine("    AND T8.CTNNO = T2.CTNNO                                                                                                           ")
        SQLBldr.AppendLine("    AND T8.DELFLG = @P01                                                                                                              ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                             ")
        SQLBldr.AppendLine("    LNG.LNT0017_RESSNF T12                                                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                                                     ")
        SQLBldr.AppendLine("    T12.KEIJOYM            = T2.KEIJOYM                                                                                                ")
        SQLBldr.AppendLine("AND T12.SHIPYMD            = T2.SHIPYMD                                                                                                ")
        SQLBldr.AppendLine("AND T12.CTNTYPE            = T2.CTNTYPE                                                                                                ")
        SQLBldr.AppendLine("AND T12.CTNNO              = T2.CTNNO                                                                                                  ")
        SQLBldr.AppendLine("AND T12.SAMEDAYCNT         = T2.SAMEDAYCNT                                                                                             ")
        SQLBldr.AppendLine("AND T12.CTNLINENO          = T2.CTNLINENO                                                                                              ")
        SQLBldr.AppendLine("AND T12.TORICODE           = T2.TORICODE                                                                                               ")
        SQLBldr.AppendLine("AND T12.INVFILINGDEPT      = T2.INVOICEORGCODE                                                                                         ")
        SQLBldr.AppendLine("AND T12.SCHEDATEPAYMENT    = T1.SCHEDATEPAYMENT                                                                                        ")
        SQLBldr.AppendLine("AND T12.DELFLG             = @P01                                                                                                      ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T13                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T13.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T13.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T13.INVSUBCD = T12.INVSUBCD                                                                         ")
        SQLBldr.AppendLine("AND T13.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T13.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
        SQLBldr.AppendLine("UNION ALL                                                                                                                             ")
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + 4      AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ") '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("        WHEN coalesce(T3.CLOSINGDAYKBN,'0') = '0' THEN                                                                                  ") '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("            CASE                                                                                                                      ") '2024/09/10 伊藤 CHG START
        SQLBldr.AppendLine("                WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                  ")
        SQLBldr.AppendLine("                THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                          ")
        SQLBldr.AppendLine("                WHEN T1.CLOSINGDAY >= 31                                                                                              ")
        SQLBldr.AppendLine("                THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                          ")
        SQLBldr.AppendLine("                ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                              ")
        SQLBldr.AppendLine("                     + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                             ")
        SQLBldr.AppendLine("            END                                                                                                                       ") '2024/09/10 伊藤 CHG END
        SQLBldr.AppendLine("        WHEN coalesce(T3.CLOSINGDAYKBN,'0') = '1' THEN T3.LEASEMONTHSTARTYMD                                                            ") '2024/09/10 伊藤 ADD
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ") '2024/09/10 伊藤 CHG
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) +ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                      ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T12.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                                          AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T2.LEASESTARTYMD IS NOT NULL                                                                                             ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASESTARTYMD, 'yyyy/MM/dd'), '')                                                                       ")
        SQLBldr.AppendLine("        WHEN T2.LEASEENDYMD IS NOT NULL                                                                                               ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASEENDYMD, 'yyyy/MM/dd'), '')                                                                         ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        SQLBldr.AppendLine("   ,FORMAT(T2.MONTHLEASEFEE, '0')                                                                          AS 単価                    ")
        SQLBldr.AppendLine("   ,FORMAT(T2.MONTHLEASEFEE, '0')                                                                          AS 金額                    ")
        SQLBldr.AppendLine("   ,T3.TAXRATE                                                                                             AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単位                    ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T3.TAXRATE = 10 THEN '標準税率10%'                                                                                       ")
        SQLBldr.AppendLine("        WHEN T3.TAXRATE =  8 THEN '経過措置税率8％'                                                                                   ")
        SQLBldr.AppendLine("        WHEN T3.TAXRATE =  0 THEN '非課税'                                                                                            ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0068_INVOICEDATA_LEASE T2                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("AND T2.INVOICETYPE   = T1.INVOICETYPE                                                                                                 ")
        SQLBldr.AppendLine("AND T2.INVOICEEXCLUSIONFLAG = '0'                                                                                                     ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0042_LEASEDATA T3                                                                                                          ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T3.KEIJOYM            = T2.KEIJOYM                                                                                                ")
        SQLBldr.AppendLine("AND T3.LEASENO            = T2.LEASENO                                                                                                ")
        SQLBldr.AppendLine("AND T3.CTNTYPE            = T2.CTNTYPE                                                                                                ")
        SQLBldr.AppendLine("AND T3.CTNNO              = T2.CTNNO                                                                                                  ")
        SQLBldr.AppendLine("AND T3.LEASEMONTHSTARTYMD = T2.LEASEMONTHSTARTYMD                                                                                     ")
        SQLBldr.AppendLine("AND T3.TORICODE           = T2.TORICODE                                                                                               ")
        SQLBldr.AppendLine("AND T3.INVOICEOUTORGCD    = T2.INVOICEORGCODE                                                                                         ")
        SQLBldr.AppendLine("AND T3.DEPOSITYMD         = T1.SCHEDATEPAYMENT                                                                                        ")
        SQLBldr.AppendLine("AND T3.DELFLG             = @P01                                                                                                      ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("		        END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX01             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T12                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T12.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T12.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T12.INVSUBCD = T3.INVSUBCD                                                                          ")
        SQLBldr.AppendLine("AND T12.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T12.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
        SQLBldr.AppendLine("UNION ALL                                                                                                                             ")
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + 4      AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                          ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                      ")
        SQLBldr.AppendLine("             + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                                       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')      ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                                       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')      ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                      ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T12.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.ACCOUNTCODE = '41010101' AND T2.CTNTYPE IS NOT NULL AND T2.CTNNO IS NOT NULL                     ")
        SQLBldr.AppendLine("        THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                                                            ")
        SQLBldr.AppendLine("        ELSE coalesce(T2.DETAILS, '')                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,CASE WHEN coalesce(T2.QUANTITY,'0') = '0' THEN                                                                                      ")
        SQLBldr.AppendLine("        CASE                                                                                                                          ")
        SQLBldr.AppendLine("            WHEN AMOUNTTYPE = '2' THEN NULL                                                                                           ")
        SQLBldr.AppendLine("            WHEN AMOUNTTYPE = '5' THEN '1'                                                                                            ")
        SQLBldr.AppendLine("        END                                                                                                                           ")
        SQLBldr.AppendLine("	ELSE                                                                                                                              ")
        SQLBldr.AppendLine("	    coalesce(T2.QUANTITY,'0')                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.SHIPYMD IS NOT NULL                                                                              ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.SHIPYMD, 'yyyy/MM/dd'), '')                                                                             ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.LEASESTARTYMD IS NOT NULL                                                                        ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASESTARTYMD, 'yyyy/MM/dd'), '')                                                                       ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.LEASEENDYMD IS NOT NULL                                                                          ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASEENDYMD, 'yyyy/MM/dd'), '')                                                                         ")
        SQLBldr.AppendLine("        ELSE FORMAT(EOMONTH(CAST((T2.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("    END                                                                                                    AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        'SQLBldr.AppendLine("   ,CASE                                                                                                                              ")                             2024/09/06 伊藤 DEL START
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '1' THEN FORMAT(T2.RENTALINCENTIVE, '0')                                                                    ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '3' THEN FORMAT(T2.RENTALATEFEE, '0')                                                                       ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '4' THEN FORMAT(T2.RENTSUBSCADJUST, '0')                                                                    ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' THEN FORMAT(T2.MISCELLANEOUSEXPENSE, '0')                                                               ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '6' THEN FORMAT(T2.WRITEFEE, '0')                                                                           ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '7' THEN FORMAT(T2.SPOTLEASEFEE, '0')                                                                       ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '8' THEN FORMAT(T2.FIXEDFEE, '0')                                                                           ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.RENTADJUSTMENT IS NOT NULL                                                                       ")
        'SQLBldr.AppendLine("        THEN FORMAT(T2.RENTADJUSTMENT, '0')                                                                                           ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.LEASEADJUSTMENT IS NOT NULL                                                                      ")
        'SQLBldr.AppendLine("        THEN FORMAT(T2.LEASEADJUSTMENT, '0')                                                                                          ")
        'SQLBldr.AppendLine("    END / CASE                                                                                                                        ") '2024/09/05 伊藤 CHG
        'SQLBldr.AppendLine("			  WHEN coalesce(T2.QUANTITY,0) = 0 THEN 1                                                                                    ") '2024/09/05 伊藤 ADD START
        'SQLBldr.AppendLine("              ELSE coalesce(T2.QUANTITY,0)                                                                                              ")
        'SQLBldr.AppendLine("          END                                                                                                   AS 単価               ") '2024/09/05 伊藤 ADD END    2024/09/06 伊藤 DEL END
        SQLBldr.AppendLine("   ,FORMAT(T2.UNITPRICE, '0')                                                                                   AS 単価               ") '2024/09/06 伊藤 ADD
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '1' THEN FORMAT(T2.RENTALINCENTIVE, '0')                                                                    ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '3' THEN FORMAT(T2.RENTALATEFEE, '0')                                                                       ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '4' THEN FORMAT(T2.RENTSUBSCADJUST, '0')                                                                    ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' THEN FORMAT(T2.MISCELLANEOUSEXPENSE, '0')                                                               ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '6' THEN FORMAT(T2.WRITEFEE, '0')                                                                           ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '7' THEN FORMAT(T2.SPOTLEASEFEE, '0')                                                                       ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '8' THEN FORMAT(T2.FIXEDFEE, '0')                                                                           ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.RENTADJUSTMENT IS NOT NULL                                                                       ")
        SQLBldr.AppendLine("        THEN FORMAT(T2.RENTADJUSTMENT, '0')                                                                                           ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.LEASEADJUSTMENT IS NOT NULL                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(T2.LEASEADJUSTMENT, '0')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 金額                    ")
        SQLBldr.AppendLine("   ,T2.TAXRATE                                                                                             AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,CASE T2.INVOICETYPE                                                                                                               ")
        SQLBldr.AppendLine("        WHEN '4' THEN coalesce(T2.UNITNAME, '')                                                                                         ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 単位                    ")
        SQLBldr.AppendLine("   ,CASE  WHEN T2.TAXKBN = '01' THEN '標準税率10%'                                                                                    ")
        SQLBldr.AppendLine("		  WHEN T2.TAXKBN = '02' THEN '経過措置税率8％'                                                                                ")
        SQLBldr.AppendLine("		  WHEN T2.TAXKBN = '11' THEN '非課税'                                                                                         ")
        SQLBldr.AppendLine("		  WHEN T2.TAXKBN = '12' THEN '不課税'  END                                                         AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT T2                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("AND T2.INVOICETYPE   = T1.INVOICETYPE                                                                                                 ")
        SQLBldr.AppendLine("AND T2.INVOICEEXCLUSIONFLAG = '0'                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX01             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)    ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T12                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T12.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T12.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T12.INVSUBCD = '0'                                                                                  ")
        SQLBldr.AppendLine("AND T12.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T12.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' その他(明細無し)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectOtherOnDetailCsv_NoDetail(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 その他(明細無し)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + '4'    AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                          ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                      ")
        SQLBldr.AppendLine("             + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                                       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')      ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0), '0')                                        ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0), '0')       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T12.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,3                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単価                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 金額                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単位                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX01             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)  ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T12                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T12.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T12.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T12.INVSUBCD = '0'                                                                                  ")
        SQLBldr.AppendLine("AND T12.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T12.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 売却コンテナ(明細有り)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectCtnSaleOnDetailCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable, Optional ByVal draftflg As String = "0") As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 売却コンテナ(明細有り)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                                            ")
        SQLBldr.AppendLine("    CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                     ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                                                      ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                                              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("    + '-' + '00' + '-' + FORMAT(" & CInt(htParm(SELECT_SEIKYU_KEY.SP_SEQ).ToString) & ", '000000')         AS 請求仮番号                                          ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                             ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                                            ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust04' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T3.AMOUNTWITHOUTTAX, 0), '0')                                                            AS 税抜金額                                            ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T1.KEIJOYM <= 202306                                                                                                                                 ")
        SQLBldr.AppendLine("            THEN (CASE T6.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T3.TAXAMOUNT, 0), '0')                                                                                              ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T3.DETAILTAXAMOUNT, 0), '0')                                                                                        ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T3.TAXAMOUNT, 0), '0')                                                                                                                 ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                                              ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T6.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T3.AMOUNTINCLUDINGTAX, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T3.DETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                               ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T3.AMOUNTINCLUDINGTAX, 0), '0')                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                                            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T3.OLDAMOUNTWITHOUTTAX, 0), '0')                                                         AS 経過措置税抜金額                                    ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T6.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T3.OLDTAXAMOUNT, 0), '0')                                                                                           ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T3.OLDDETAILTAXAMOUNT, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T3.OLDTAXAMOUNT, 0), '0')                                                                                                              ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T6.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T3.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                  ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T3.OLDDETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                            ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T3.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                                    ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額                                    ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T3.NONTAXABLEAMOUNTS, 0), '0')                                                           AS 課税対象外金額                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T6.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T3.AMOUNTINCLUDINGTAX, 0) + coalesce(T3.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T3.NONTAXABLEAMOUNTS, 0), '0')             ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T3.DETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T3.OLDDETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T3.NONTAXABLEAMOUNTS, 0), '0') ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T3.AMOUNTINCLUDINGTAX, 0) + coalesce(T3.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T3.NONTAXABLEAMOUNTS, 0), '0')                               ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額                                      ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計                                        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T3.TAXFREESALES, 0), '0')                                                                AS 非課税売上小計                                      ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T3.NONTAXABLESALES, 0), '0')                                                             AS 不課税売上小計                                      ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS 支払期日                                            ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行側部署コード                                    ")
        SQLBldr.AppendLine("   ,T4.STAFFNAMEL                                                                                          AS 発行担当者名                                        ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード                                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                            ")
        SQLBldr.AppendLine("    END + ' コンテナご購入代 ' + CAST(T3.CTNCOUNT AS NVARCHAR) + '個'                                      AS 見出しエリア1用フリーコメント１                     ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T7.SLIPDESCRIPTION IS NOT NULL THEN T7.SLIPDESCRIPTION                                                                                               ")
        SQLBldr.AppendLine("        WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN SUBSTRING(T1.HEADERCOMMENT, 1, 32)                                                                     ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 見出しエリア1用フリーコメント２                     ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 見出しエリア1用フリーコメント３                     ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS フッター用フリーコメント                            ")
        If draftflg = "0" Then
            SQLBldr.AppendLine("   ,35                                                                                                     AS 帳票種別                                            ")
        Else
            SQLBldr.AppendLine("   ,36                                                                                                     AS 帳票種別                                            ")
        End If
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T2.SALESCONTRACTDATE, 'yyyy/MM/dd'), '')                                                 AS 日付                                                ")
        SQLBldr.AppendLine("   ,T2.CTNNO                                                                                               AS 内訳                                                ")
        SQLBldr.AppendLine("   ,CASE WHEN T2.SORT1 = 1 THEN 1 ELSE 0 END                                                               AS 数量                                                ")
        SQLBldr.AppendLine("   ,FORMAT(T2.SALESAMOUNT, '0')                                                                            AS 本体価格                                            ")
        SQLBldr.AppendLine("   ,FORMAT(T2.POSTAGE, '0')                                                                                AS 送料                                                ")
        SQLBldr.AppendLine("   ,FORMAT(T2.CLEANINGFEE, '0')                                                                            AS 整備費                                              ")
        SQLBldr.AppendLine("   ,FORMAT(T2.MAINTENANCEFEE, '0')                                                                         AS 洗浄費                                              ")
        SQLBldr.AppendLine("   ,FORMAT(T2.OTHERFEE, '0')                                                                               AS その他                                              ")
        SQLBldr.AppendLine("   ,FORMAT(T2.TOTALAMOUNT, '0')                                                                            AS 合計                                                ")
        SQLBldr.AppendLine("   ,T2.TAXKBNNAME                                                                                          AS 請求書区分名                                        ")
        SQLBldr.AppendLine("FROM                                                                                                                                                              ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                                                    ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("(                                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                        ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                                                                          ")
        SQLBldr.AppendLine("       ,T1.CTNNO                                                                                                                                                  ")
        SQLBldr.AppendLine("       ,ROW_NUMBER() OVER (PARTITION BY T1.CTNNO ORDER BY T1.TAXKBN, T1.CTNNO) AS SORT1                                                                           ")
        SQLBldr.AppendLine("       ,T1.SALESCONTRACTDATE                                                                                                                                      ")
        SQLBldr.AppendLine("       ,T1.SALESAMOUNT                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.POSTAGE                                                                                                                                                ")
        SQLBldr.AppendLine("       ,T1.CLEANINGFEE                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.MAINTENANCEFEE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.OTHERFEE                                                                                                                                               ")
        SQLBldr.AppendLine("       ,T1.TOTALAMOUNT                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.TAXKBN                                                                                                                                                 ")
        SQLBldr.AppendLine("       ,CASE                                                                                                                                                      ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 1 THEN '標準税率10%'                                                                                                                    ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 2 THEN '経過措置税率8%'                                                                                                                 ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 3 THEN '非課税'                                                                                                                         ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 4 THEN '不課税'                                                                                                                         ")
        SQLBldr.AppendLine("        END AS TAXKBNNAME                                                                                                                                         ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("    (                                                                                                                                                             ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            INVOICENUMBER                                                                                                                                         ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,1                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0104_INVOICEDATA_CONTAINER                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            INVOICENUMBER        = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                  ")
        SQLBldr.AppendLine("        AND INVOICETYPE          = '5'                                                                                                                            ")
        SQLBldr.AppendLine("        AND INVOICEEXCLUSIONFLAG = '0'                                                                                                                            ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                                                 ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            INVOICENUMBER                                                                                                                                         ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,2                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0104_INVOICEDATA_CONTAINER                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            INVOICENUMBER        = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                  ")
        SQLBldr.AppendLine("        AND INVOICETYPE          = '5'                                                                                                                            ")
        SQLBldr.AppendLine("        AND INVOICEEXCLUSIONFLAG = '0'                                                                                                                            ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                                                 ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            INVOICENUMBER                                                                                                                                         ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,3                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0104_INVOICEDATA_CONTAINER                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            INVOICENUMBER        = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                  ")
        SQLBldr.AppendLine("        AND INVOICETYPE          = '5'                                                                                                                            ")
        SQLBldr.AppendLine("        AND INVOICEEXCLUSIONFLAG = '0'                                                                                                                            ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                                                 ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            INVOICENUMBER                                                                                                                                         ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,4                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0104_INVOICEDATA_CONTAINER                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            INVOICENUMBER        = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                  ")
        SQLBldr.AppendLine("        AND INVOICETYPE          = '5'                                                                                                                            ")
        SQLBldr.AppendLine("        AND INVOICEEXCLUSIONFLAG = '0'                                                                                                                            ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("    ) T1                                                                                                                                                          ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T1.TOTALAMOUNT <> 0                                                                                                                                       ")
        SQLBldr.AppendLine(") T2                                                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                                                           ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                        ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                           AS INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("       ,COUNT(T1.CTNTYPE)                                                          AS CTNCOUNT                                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                   AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))                                   AS DETAILTAXAMOUNT                                                             ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                   AS TAXAMOUNT                                                                   ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))        AS DETAILAMOUNTINCLUDINGTAX                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)        AS AMOUNTINCLUDINGTAX                                                          ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX)                                                AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0))                               AS OLDDETAILTAXAMOUNT                                                          ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0)                               AS OLDTAXAMOUNT                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0)) AS OLDDETAILAMOUNTINCLUDINGTAX                                                 ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0) AS OLDAMOUNTINCLUDINGTAX                                                       ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES)                                                       AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.NONTAXABLESALES)                                                    AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES + T1.NONTAXABLESALES)                                  AS NONTAXABLEAMOUNTS                                                           ")
        SQLBldr.AppendLine("    FROM (                                                                                                                                                        ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            INVOICENUMBER                                                          AS INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("           ,CTNTYPE                                                                AS CTNTYPE                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END        AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END        AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END        AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END        AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0104_INVOICEDATA_CONTAINER                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            INVOICENUMBER        = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                  ")
        SQLBldr.AppendLine("        AND INVOICETYPE          = '5'                                                                                                                            ")
        SQLBldr.AppendLine("        AND INVOICEEXCLUSIONFLAG = '0'                                                                                                                            ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("    )  T1                                                                                                                                                         ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                                                     ")
        SQLBldr.AppendLine(")  T3                                                                                                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T3.INVOICENUMBER = T1.INVOICENUMBER                                                                                                                           ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                                                       ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                                                 ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                                                 ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                                             ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                                                       ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                                                       ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                                                  ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                                                         ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                                                      ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                                             ")
        SQLBldr.AppendLine(") T4                                                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T4.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                                                           ")
        SQLBldr.AppendLine("OUTER APPLY(                                                                                                                                                      ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                                                  ")
        SQLBldr.AppendLine("         T4.INVKESAIKBN                                                                                                                                           ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("        LNG.LNT0089_CONTAINER_STOCK T4                                                                                                                            ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T4.KEIJOYM          = T1.KEIJOYM                                                                                                                          ")
        SQLBldr.AppendLine("    AND T4.TORICODE         = T1.TORICODE                                                                                                                         ")
        SQLBldr.AppendLine("    AND T4.SCHEDATEPAYMENT  = T1.SCHEDATEPAYMENT                                                                                                                  ")
        SQLBldr.AppendLine("    AND T4.INVOICEORGCODE   = T1.INVOICEORGCODE                                                                                                                   ")
        SQLBldr.AppendLine("    AND T4.REQUESTFLG       = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("    AND T4.DELFLG           = @P01                                                                                                                                ")
        SQLBldr.AppendLine("    AND (T4.SALESAMOUNT + T4.POSTAGE + T4.CLEANINGFEE + T4.MAINTENANCEFEE + T4.OTHERFEE) <> 0                                                                     ")
        SQLBldr.AppendLine(") T5                                                                                                                                                              ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0024_KEKKJM T6                                                                                                                                         ")
        SQLBldr.AppendLine("ON  T6.TORICODE      = T1.TORICODE                                                                                                                                ")
        SQLBldr.AppendLine("AND T6.INVFILINGDEPT = T1.INVOICEORGCODE                                                                                                                          ")
        SQLBldr.AppendLine("AND T6.INVKESAIKBN   = (CASE                                                                                                                                      ")
        SQLBldr.AppendLine("                             WHEN T5.INVKESAIKBN IS NOT NULL THEN T5.INVKESAIKBN                                                                                  ")
        SQLBldr.AppendLine("                             ELSE '1'                                                                                                                             ")
        SQLBldr.AppendLine("                         END)                                                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T7                                                                                                                                ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T7.TORICODE       = T1.TORICODE                                                                                                                               ")
        SQLBldr.AppendLine("AND T7.INVFILINGDEPT  = T1.INVOICEORGCODE                                                                                                                         ")
        SQLBldr.AppendLine("AND T7.INVSUBCD       = '0'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T7.INVOICETYPE    = '5'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T7.DELFLG         = @P01                                                                                                                                      ")
        SQLBldr.AppendLine("WHERE                                                                                                                                                             ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                              ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '5'                                                                                                                                        ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                                                       ")
        SQLBldr.AppendLine("ORDER BY T2.TAXKBN, T2.CTNNO                                                                                                                                      ")
#End Region
        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 売却コンテナ明細無し)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectCtnSaleOffDetailCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable, Optional ByVal draftflg As String = "0") As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 売却コンテナ(明細無し)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                                            ")
        SQLBldr.AppendLine("    CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                     ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                                                      ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                                              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("    + '-' + '00' + '-' + FORMAT(" & CInt(htParm(SELECT_SEIKYU_KEY.SP_SEQ).ToString) & ", '000000')         AS 請求仮番号                                          ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                             ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                                            ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust04' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.AMOUNTWITHOUTTAX, 0), '0')                                                            AS 税抜金額                                            ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T1.KEIJOYM <= 202306                                                                                                                                 ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.TAXAMOUNT, 0), '0')                                                                                              ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.DETAILTAXAMOUNT, 0), '0')                                                                                        ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T2.TAXAMOUNT, 0), '0')                                                                                                                 ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                                              ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.DETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                               ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0), '0')                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                                            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.OLDAMOUNTWITHOUTTAX, 0), '0')                                                         AS 経過措置税抜金額                                    ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.OLDTAXAMOUNT, 0), '0')                                                                                           ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.OLDDETAILTAXAMOUNT, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T2.OLDTAXAMOUNT, 0), '0')                                                                                                              ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                  ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.OLDDETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                            ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                                    ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額                                    ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.NONTAXABLEAMOUNTS, 0), '0')                                                           AS 課税対象外金額                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0) + coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T2.NONTAXABLEAMOUNTS, 0), '0')             ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.DETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T2.OLDDETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T2.NONTAXABLEAMOUNTS, 0), '0') ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0) + coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T2.NONTAXABLEAMOUNTS, 0), '0')                               ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額                                      ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計                                        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.TAXFREESALES, 0), '0')                                                                AS 非課税売上小計                                      ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.NONTAXABLESALES, 0), '0')                                                             AS 不課税売上小計                                      ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS 支払期日                                            ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行側部署コード                                    ")
        SQLBldr.AppendLine("   ,T3.STAFFNAMEL                                                                                          AS 発行担当者名                                        ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード                                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                            ")
        SQLBldr.AppendLine("    END + ' コンテナご購入代 ' + CAST(T2.CTNCOUNT AS NVARCHAR) + '個'                                      AS 見出しエリア1用フリーコメント１                     ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T6.SLIPDESCRIPTION IS NOT NULL THEN T6.SLIPDESCRIPTION                                                                                               ")
        SQLBldr.AppendLine("        WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN SUBSTRING(T1.HEADERCOMMENT, 1, 32)                                                                     ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 見出しエリア1用フリーコメント２                     ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 見出しエリア1用フリーコメント３                     ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS フッター用フリーコメント                            ")
        If draftflg = "0" Then
            SQLBldr.AppendLine("   ,3                                                                                                      AS 帳票種別                                            ")
        Else
            SQLBldr.AppendLine("   ,5                                                                                                      AS 帳票種別                                            ")
        End If
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 日付                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 内訳                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 数量                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 本体価格                                            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 送料                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 整備費                                              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 洗浄費                                              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS その他                                              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 合計                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 請求書区分名                                        ")
        SQLBldr.AppendLine("FROM                                                                                                                                                              ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                                                    ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                        ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                           AS INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("       ,COUNT(T1.CTNTYPE)                                                          AS CTNCOUNT                                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                   AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))                                   AS DETAILTAXAMOUNT                                                             ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                   AS TAXAMOUNT                                                                   ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))        AS DETAILAMOUNTINCLUDINGTAX                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)        AS AMOUNTINCLUDINGTAX                                                          ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX)                                                AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0))                               AS OLDDETAILTAXAMOUNT                                                          ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0)                               AS OLDTAXAMOUNT                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0)) AS OLDDETAILAMOUNTINCLUDINGTAX                                                 ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0) AS OLDAMOUNTINCLUDINGTAX                                                       ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES)                                                       AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.NONTAXABLESALES)                                                    AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES + T1.NONTAXABLESALES)                                  AS NONTAXABLEAMOUNTS                                                           ")
        SQLBldr.AppendLine("    FROM (                                                                                                                                                        ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            INVOICENUMBER                                                          AS INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("           ,CTNTYPE                                                                AS CTNTYPE                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END        AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END        AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END        AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END        AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0104_INVOICEDATA_CONTAINER                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            INVOICENUMBER        = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                  ")
        SQLBldr.AppendLine("        AND INVOICETYPE          = '5'                                                                                                                            ")
        SQLBldr.AppendLine("        AND INVOICEEXCLUSIONFLAG = '0'                                                                                                                            ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("    )  T1                                                                                                                                                         ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                                                     ")
        SQLBldr.AppendLine(")  T2                                                                                                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                                                           ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                                                       ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                                                 ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                                                 ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                                             ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                                                       ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                                                       ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                                                  ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                                                         ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                                                      ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                                             ")
        SQLBldr.AppendLine(") T3                                                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T3.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                                                           ")
        SQLBldr.AppendLine("OUTER APPLY(                                                                                                                                                      ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                                                  ")
        SQLBldr.AppendLine("         T4.INVKESAIKBN                                                                                                                                           ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("        LNG.LNT0089_CONTAINER_STOCK T4                                                                                                                            ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T4.KEIJOYM          = T1.KEIJOYM                                                                                                                          ")
        SQLBldr.AppendLine("    AND T4.TORICODE         = T1.TORICODE                                                                                                                         ")
        SQLBldr.AppendLine("    AND T4.SCHEDATEPAYMENT  = T1.SCHEDATEPAYMENT                                                                                                                  ")
        SQLBldr.AppendLine("    AND T4.INVOICEORGCODE   = T1.INVOICEORGCODE                                                                                                                   ")
        SQLBldr.AppendLine("    AND T4.REQUESTFLG       = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("    AND T4.DELFLG           = @P01                                                                                                                                ")
        SQLBldr.AppendLine("    AND (T4.SALESAMOUNT + T4.POSTAGE + T4.CLEANINGFEE + T4.MAINTENANCEFEE + T4.OTHERFEE) <> 0                                                                     ")
        SQLBldr.AppendLine(") T4                                                                                                                                                              ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0024_KEKKJM T5                                                                                                                                         ")
        SQLBldr.AppendLine("ON  T5.TORICODE      = T1.TORICODE                                                                                                                                ")
        SQLBldr.AppendLine("AND T5.INVFILINGDEPT = T1.INVOICEORGCODE                                                                                                                          ")
        SQLBldr.AppendLine("AND T5.INVKESAIKBN   = (CASE                                                                                                                                      ")
        SQLBldr.AppendLine("                             WHEN T4.INVKESAIKBN IS NOT NULL THEN T4.INVKESAIKBN                                                                                  ")
        SQLBldr.AppendLine("                             ELSE '1'                                                                                                                             ")
        SQLBldr.AppendLine("                         END)                                                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T6                                                                                                                                ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T6.TORICODE       = T1.TORICODE                                                                                                                               ")
        SQLBldr.AppendLine("AND T6.INVFILINGDEPT  = T1.INVOICEORGCODE                                                                                                                         ")
        SQLBldr.AppendLine("AND T6.INVSUBCD       = '0'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T6.INVOICETYPE    = '5'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T6.DELFLG         = @P01                                                                                                                                      ")
        SQLBldr.AppendLine("WHERE                                                                                                                                                             ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                                              ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '5'                                                                                                                                        ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                                                       ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

#End Region

#Region "雑費金額取得"
    ''' <summary>
    ''' 請求追加金額明細データ 金額種類別総額取得(レンタル)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRentalCsv_AddRental(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT                                                                                                  ")
        SQLBldr.AppendLine("      ''                                                  AS 発行日                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '2' THEN MAX(D02.NAMES)                                                 ")
        SQLBldr.AppendLine("          ELSE D01.DETAILS                                                                              ")
        SQLBldr.AppendLine("      END                                                 AS 発駅名                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' THEN MAX(D03.NAMES)                                                 ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '2' THEN D01.DETAILS                                                    ")
        SQLBldr.AppendLine("          WHEN MAX(SUBSTRING(D01.REMARKS,1,6)) <> '' THEN MAX(SUBSTRING(D01.REMARKS,1,6))               ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS 着駅名                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' AND D01.SHIPYMD IS NOT NULL THEN FORMAT(D01.SHIPYMD, 'yyyy/MM/dd')  ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' AND D01.SHIPYMD IS NULL THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')  ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                 AS 発送年月日                                 ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(D01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS コンテナ記号                               ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(D01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS コンテナ番号                               ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN '0'                                                                             ")
        SQLBldr.AppendLine("          WHEN '5' THEN '1'                                                                             ")
        SQLBldr.AppendLine("      END                                                 AS 個数                                       ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(D01.RENTADJUSTMENT),0) + coalesce(SUM(D01.LEASEADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(D01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                 AS 使用料                                     ")
        SQLBldr.AppendLine("    , coalesce(D04.ADDFEE,0)                                AS 発駅合計使用料                             ")
        SQLBldr.AppendLine("FROM                                                                                                    ")
        'メイン 請求追加金額明細データ
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT D01                                                               ")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    com.LNS0020_STATION D02                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.DEPSTATION = D02.STATION                                                                        ")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    com.LNS0020_STATION D03                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.ARRSTATION = D03.STATION                                                                        ")
        '[結合テーブル]請求追加金額明細データ(発駅別合計使用料)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.DEPSTATION                                                                                ")
        SQLBldr.AppendLine("        , D11.AMOUNTTYPE                                                                                ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , CASE D11.AMOUNTTYPE                                                                           ")
        SQLBldr.AppendLine("             WHEN '2' THEN coalesce(SUM(D11.RENTADJUSTMENT),0) + coalesce(SUM(D11.LEASEADJUSTMENT),0)       ")
        SQLBldr.AppendLine("             WHEN '5' THEN coalesce(SUM(D11.MISCELLANEOUSEXPENSE),0)                                      ")
        SQLBldr.AppendLine("           END AS ADDFEE                                                                                ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        LNG.LNT0080_INVOICEDATA_ADDAMOUNT D11                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                               ")
        SQLBldr.AppendLine("        D11.DELFLG = @P01                                                                               ")
        SQLBldr.AppendLine("    AND D11.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                         ")
        SQLBldr.AppendLine("    AND D11.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'             ")
        SQLBldr.AppendLine("    AND D11.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                       ")
        SQLBldr.AppendLine("    AND D11.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'           ")
        SQLBldr.AppendLine("    AND D11.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'              ")
        SQLBldr.AppendLine("    AND D11.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                         ")
        SQLBldr.AppendLine("    AND D11.INVOICETYPE = '2'                                                                           ")
        SQLBldr.AppendLine("    AND D11.INVOICEEXCLUSIONFLAG = '0'                                                                  ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.DEPSTATION                                                                                ")
        SQLBldr.AppendLine("        , D11.AMOUNTTYPE                                                                                ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )D04                                                                                                ")
        SQLBldr.AppendLine("    ON D01.KEIJOYM = D04.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND D01.INVOICEORGCODE = D04.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND D01.TORICODE = D04.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND D01.SCHEDATEPAYMENT = D04.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND coalesce(D01.DEPSTATION,0) = coalesce(D04.DEPSTATION,0)                                             ")
        SQLBldr.AppendLine("    AND D01.AMOUNTTYPE = D04.AMOUNTTYPE                                                                 ")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = D04.INVSUBCD                                                                     ")
        '抽出条件
        SQLBldr.AppendLine("WHERE                                                                                                   ")
        SQLBldr.AppendLine("    D01.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("AND D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                             ")
        SQLBldr.AppendLine("AND D01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'                 ")
        SQLBldr.AppendLine("AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                           ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'               ")
        SQLBldr.AppendLine("AND D01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                  ")
        SQLBldr.AppendLine("AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                             ")
        SQLBldr.AppendLine("AND D01.INVOICETYPE = '2'                                                                               ")
        SQLBldr.AppendLine("AND D01.INVOICEEXCLUSIONFLAG = '0'                                                                      ")
        ' グルーピング条件
        SQLBldr.AppendLine("GROUP BY                                                                                                ")
        SQLBldr.AppendLine("    D01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,D01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,D01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,D01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,D01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,D01.DETAILS                                                                                         ")
        SQLBldr.AppendLine("   ,D01.SHIPYMD                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,D01.DEPSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.ARRSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D04.ADDFEE                                                                                          ")
        ' ソート条件
        SQLBldr.AppendLine("ORDER BY                                                                                                ")
        SQLBldr.AppendLine("    D01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,D01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,D01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,D01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,D01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,D01.DEPSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.ARRSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.SHIPYMD                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,D01.DETAILS                                                                                         ")


        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 請求追加金額明細データ 金額種類別総額取得(リース)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRentalCsv_AddLease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT                                                                                                  ")
        SQLBldr.AppendLine("      ''                                                               AS 発行日                        ")
        SQLBldr.AppendLine("    , A01.DETAILS                                                      AS 品名                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(A01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          WHEN '7' THEN CAST(A01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                              AS コンテナ記号                  ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(A01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          WHEN '7' THEN CAST(A01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                              AS コンテナ番号                  ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        'SQLBldr.AppendLine("          WHEN '5' THEN CAST(MAX(A02.CARGOWEIGHT) AS nvarchar)                                          ")
        SQLBldr.AppendLine("          WHEN '5' THEN MAX(coalesce(A02.CARGOWEIGHT,0))                                                  ")
        SQLBldr.AppendLine("          WHEN '7' THEN MAX(coalesce(A02.CARGOWEIGHT,0))                                                  ")
        SQLBldr.AppendLine("          ELSE 0                                                                                        ")
        SQLBldr.AppendLine("      END                                                              AS トン数                        ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN FORMAT(A01.LEASESTARTYMD, 'yyyy/M/d')                                           ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（自）'              ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN FORMAT(A01.LEASEENDYMD, 'yyyy/M/d')                                             ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（至）'              ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN A01.LEASESTARTYMD IS NULL OR A01.LEASEENDYMD IS NULL                                     ")
        SQLBldr.AppendLine("          THEN 0                                                                                        ")
        SQLBldr.AppendLine("          WHEN A01.AMOUNTTYPE = '5'                                                                     ")
        SQLBldr.AppendLine("          THEN DATEDIFF(DAY, CONVERT(date, A01.LEASESTARTYMD),                                          ")
        SQLBldr.AppendLine("               DATEADD(DAY,1,CONVERT(date, A01.LEASEENDYMD)))                                           ")
        SQLBldr.AppendLine("          ELSE 0                                                                                        ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（日数）'            ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN '0'                                                                             ")
        SQLBldr.AppendLine("          WHEN '5' THEN '1'                                                                             ")
        SQLBldr.AppendLine("      END                                                              AS 個数                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 品名の小計                    ")
        SQLBldr.AppendLine("    , MAX(SUBSTRING(A01.REMARKS,1,6))                                  AS 備考                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN REPLACE(TRIM(MAX(A03.KANJI1)),'　','') + 'コンテナ'                             ")
        SQLBldr.AppendLine("          WHEN '7' THEN REPLACE(TRIM(MAX(A03.KANJI1)),'　','') + 'コンテナ'                             ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS LK65                          ")
        SQLBldr.AppendLine("	, A01.TAXRATE                                                      AS 税率                          ")
        SQLBldr.AppendLine("	, CASE A01.TAXKBN                                                                                   ")
        SQLBldr.AppendLine("	      WHEN '01' THEN '標準税率10%'                                                                  ")
        SQLBldr.AppendLine("	      WHEN '02' THEN '経過措置税率8％'                                                              ")
        SQLBldr.AppendLine("	      WHEN '11' THEN '非課税'                                                                       ")
        SQLBldr.AppendLine("	      WHEN '12' THEN '不課税'                                                                       ")
        SQLBldr.AppendLine("	      ELSE ''                                                                                       ")
        SQLBldr.AppendLine("	  END                                                              AS 請求書用税区分名              ")
        SQLBldr.AppendLine("FROM                                                                                                    ")
        'メイン 請求追加金額明細データ
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT A01                                                               ")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("LEFT JOIN LNG.LNM0002_RECONM A02                                                                        ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A02.CTNTYPE     = A01.CTNTYPE                                                                       ")
        SQLBldr.AppendLine("AND A02.CTNNO       = A01.CTNNO                                                                         ")
        SQLBldr.AppendLine("")
        '[結合テーブル]大中小分類マスタ
        SQLBldr.AppendLine("LEFT JOIN LNG.LNM0022_CLASS A03                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A03.BIGCTNCD    = A02.BIGCTNCD                                                                      ")
        SQLBldr.AppendLine("AND A03.MIDDLECTNCD = A02.MIDDLECTNCD                                                                   ")
        SQLBldr.AppendLine("AND A03.SMALLCTNCD  = A02.SMALLCTNCD                                                                    ")
        SQLBldr.AppendLine("AND A03.DELFLG      = '0'                                                                               ")
        '抽出条件
        SQLBldr.AppendLine("WHERE                                                                                                   ")
        SQLBldr.AppendLine("    A01.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                             ")
        SQLBldr.AppendLine("AND A01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'                 ")
        SQLBldr.AppendLine("AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                           ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'               ")
        SQLBldr.AppendLine("AND A01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                  ")
        SQLBldr.AppendLine("AND A01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                             ")
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '3'                                                                               ")
        SQLBldr.AppendLine("AND A01.INVOICEEXCLUSIONFLAG = '0'                                                                      ")
        ' グルーピング条件
        SQLBldr.AppendLine("GROUP BY                                                                                                ")
        SQLBldr.AppendLine("    A01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,A01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,A01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,A01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,A01.DETAILS                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,A01.LEASESTARTYMD                                                                                   ")
        SQLBldr.AppendLine("   ,A01.LEASEENDYMD                                                                                     ")
        SQLBldr.AppendLine("   ,A01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,A01.TAXRATE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.TAXKBN                                                                                          ")
        ' ソート条件
        SQLBldr.AppendLine("ORDER BY                                                                                                ")
        SQLBldr.AppendLine("    A01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,A01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,A01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,A01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,A01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,A01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,A01.LEASESTARTYMD                                                                                   ")
        SQLBldr.AppendLine("   ,A01.DETAILS                                                                                         ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function
#End Region

#Region "ドラフト版請求連携"
    ''' <summary>
    ''' 請求ヘッダーデータ 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftInvoiceHead(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable, ByVal invoiceType As String) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    INVOICENUMBER")                                               '請求年月
        SQLBldr.AppendLine("   ,coalesce(DETAILKBN, '0') AS DETAILKBN")                                      '明細有無区分
        SQLBldr.AppendLine("FROM")
        'メイン 請求ヘッダーデータ
        SQLBldr.AppendLine("    lng.LNT0064_INVOICEHEAD")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        '検索条件追加
        '請求年月
        SQLBldr.AppendLine("    KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        '請求担当部店コード
        If Not String.IsNullOrEmpty(htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString) Then
            SQLBldr.AppendLine("    AND INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        End If
        '請求取引先コード
        If Not String.IsNullOrEmpty(htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString) Then
            SQLBldr.AppendLine("    AND TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        End If
        '入金予定日
        If Not String.IsNullOrEmpty(htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString) Then
            SQLBldr.AppendLine("    AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        End If
        '細分コード
        If Not String.IsNullOrEmpty(htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString) Then
            SQLBldr.AppendLine("    AND INVSUBCD = '" & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "'")
        End If
        '請求書種類
        If Not String.IsNullOrEmpty(invoiceType) Then
            SQLBldr.AppendLine("    AND INVOICETYPE = '" & invoiceType & "'")
        End If
        SQLBldr.AppendLine("    AND DELFLG = '0'")

        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    KEIJOYM")
        SQLBldr.AppendLine("    , INVOICEORGCODE")
        SQLBldr.AppendLine("    , TORICODE")
        SQLBldr.AppendLine("    , INVOICETYPE")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 精算ファイル 合計金額算出
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRessnfUseFee(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("     R01.KEIJOYM    AS KEIJOYM")
        SQLBldr.AppendLine("    ,R01.INVFILINGDEPT    AS INVFILINGDEPT")
        SQLBldr.AppendLine("    ,R01.TORICODE         AS TORICODE")
        SQLBldr.AppendLine("    ,R01.SCHEDATEPAYMENT  AS SCHEDATEPAYMEN ")
        SQLBldr.AppendLine("    ,R01.INVSUBCD  AS INVSUBCD ")
        SQLBldr.AppendLine("    ,R01.TORICODE + '-' + CAST(R01.KEIJOYM AS NVARCHAR) + '-' + R01.INVFILINGDEPT + '-'")
        SQLBldr.AppendLine("    +FORMAT(R01.INVSUBCD, '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")
        SQLBldr.AppendLine("    ,SUM(coalesce(R01.TOTALINCOME,0)) AS SUM_USEFEE ")
        SQLBldr.AppendLine("    ,SUM(ROUND((coalesce(R01.TOTALINCOME,0) * @P02) ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("FROM")
        'メイン 精算ファイル
        SQLBldr.AppendLine("    lng.LNT0017_RESSNF R01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    R01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND R01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND R01.INVFILINGDEPT = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND R01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND R01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        SQLBldr.AppendLine("    AND R01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("    AND R01.DELFLG = @P01")
        SQLBldr.AppendLine("GROUP BY")
        SQLBldr.AppendLine("    R01.KEIJOYM")
        SQLBldr.AppendLine("   ,R01.INVFILINGDEPT")
        SQLBldr.AppendLine("   ,R01.TORICODE")
        SQLBldr.AppendLine("   ,R01.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("   ,R01.INVSUBCD")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 精算ファイル 発駅別合計金額算出
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRessnfUseFee_DepSta(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("     MAX(R01.TORICODE) + '-' + MAX(CAST(R01.KEIJOYM AS NVARCHAR)) + '-' + MAX(R01.INVFILINGDEPT) + '-'")
        SQLBldr.AppendLine("     + FORMAT(coalesce(R01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') + MAX(R04.NAMES)  AS 請求仮番号")
        SQLBldr.AppendLine("    ,MAX(R04.NAMES) AS DEPSTATIONNAME")
        SQLBldr.AppendLine("    ,R01.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("    ,MAX(coalesce(R02.KENSU,0)) AS KENSU")
        SQLBldr.AppendLine("    ,MAX(coalesce(R03.SUM_USEFEE,0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("FROM")
        'メイン 精算ファイル
        SQLBldr.AppendLine("    lng.LNT0017_RESSNF R01")
        SQLBldr.AppendLine("LEFT JOIN(")
        SQLBldr.AppendLine("    SELECT")
        SQLBldr.AppendLine("        R01.DEPSTATION                AS DEPSTATION")
        SQLBldr.AppendLine("       ,R01.TORICODE                  AS TORICODE")
        SQLBldr.AppendLine("       ,R01.KEIJOYM                   AS KEIJOYM")
        SQLBldr.AppendLine("       ,R01.INVFILINGDEPT             AS INVFILINGDEPT")
        SQLBldr.AppendLine("       ,R01.SCHEDATEPAYMENT           AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("       ,R01.INVSUBCD                  AS INVSUBCD")
        SQLBldr.AppendLine("       ,COUNT(R01.SHIPYMD)            AS KENSU")
        SQLBldr.AppendLine("    FROM")
        SQLBldr.AppendLine("        lng.LNT0017_RESSNF R01")
        SQLBldr.AppendLine("    LEFT JOIN")
        SQLBldr.AppendLine("        lng.LNM0002_RECONM R02")
        SQLBldr.AppendLine("    ON")
        SQLBldr.AppendLine("        R02.CTNTYPE = R01.CTNTYPE")
        SQLBldr.AppendLine("    AND R02.CTNNO   = R01.CTNNO")
        SQLBldr.AppendLine("    AND R02.DELFLG  = @P01 ")
        SQLBldr.AppendLine("    WHERE")
        SQLBldr.AppendLine("        R01.DELFLG                  = @P01")
        SQLBldr.AppendLine("    AND R01.JURISDICTIONCD          = '14'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTINGASSETSKBN     = '1'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTSTATUSKBN       <> '8'")
        SQLBldr.AppendLine("    AND coalesce(R02.DUMMYKBN, '00')  = '00'")
        SQLBldr.AppendLine("    AND R01.TOTALINCOME            <> 0")
        SQLBldr.AppendLine("    GROUP BY")
        SQLBldr.AppendLine("        R01.DEPSTATION")
        SQLBldr.AppendLine("       ,R01.TORICODE")
        SQLBldr.AppendLine("       ,R01.KEIJOYM")
        SQLBldr.AppendLine("       ,R01.INVFILINGDEPT")
        SQLBldr.AppendLine("       ,R01.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("       ,R01.INVSUBCD")
        SQLBldr.AppendLine("    )R02")
        SQLBldr.AppendLine("     ON  R01.DEPSTATION      = R02.DEPSTATION")
        SQLBldr.AppendLine("     AND R01.TORICODE        = R02.TORICODE")
        SQLBldr.AppendLine("     AND R01.KEIJOYM         = R02.KEIJOYM")
        SQLBldr.AppendLine("     AND R01.INVFILINGDEPT   = R02.INVFILINGDEPT")
        SQLBldr.AppendLine("     AND R01.SCHEDATEPAYMENT = R02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("     AND R01.INVSUBCD        = R02.INVSUBCD")
        SQLBldr.AppendLine("LEFT JOIN(")
        SQLBldr.AppendLine("    SELECT")
        SQLBldr.AppendLine("        R01.DEPSTATION                AS DEPSTATION")
        SQLBldr.AppendLine("       ,R01.TORICODE                  AS TORICODE")
        SQLBldr.AppendLine("       ,R01.KEIJOYM                   AS KEIJOYM")
        SQLBldr.AppendLine("       ,R01.INVFILINGDEPT             AS INVFILINGDEPT")
        SQLBldr.AppendLine("       ,R01.SCHEDATEPAYMENT           AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("       ,R01.INVSUBCD                  AS INVSUBCD")
        SQLBldr.AppendLine("       ,SUM(coalesce(R01.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("    FROM")
        SQLBldr.AppendLine("        lng.LNT0017_RESSNF R01")
        SQLBldr.AppendLine("    WHERE")
        SQLBldr.AppendLine("        R01.DELFLG                  = @P01")
        SQLBldr.AppendLine("    AND R01.JURISDICTIONCD          = '14'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTINGASSETSKBN     = '1'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTSTATUSKBN       <> '8'")
        SQLBldr.AppendLine("    AND R01.TOTALINCOME            <> 0")
        SQLBldr.AppendLine("    GROUP BY")
        SQLBldr.AppendLine("        R01.DEPSTATION")
        SQLBldr.AppendLine("       ,R01.TORICODE")
        SQLBldr.AppendLine("       ,R01.KEIJOYM")
        SQLBldr.AppendLine("       ,R01.INVFILINGDEPT")
        SQLBldr.AppendLine("       ,R01.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("       ,R01.INVSUBCD")
        SQLBldr.AppendLine("    )R03")
        SQLBldr.AppendLine("     ON  R01.DEPSTATION      = R03.DEPSTATION")
        SQLBldr.AppendLine("     AND R01.TORICODE        = R03.TORICODE")
        SQLBldr.AppendLine("     AND R01.KEIJOYM         = R03.KEIJOYM")
        SQLBldr.AppendLine("     AND R01.INVFILINGDEPT   = R03.INVFILINGDEPT")
        SQLBldr.AppendLine("     AND R01.SCHEDATEPAYMENT = R03.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("     AND R01.INVSUBCD        = R03.INVSUBCD")
        SQLBldr.AppendLine("LEFT JOIN")
        SQLBldr.AppendLine("    com.LNS0020_STATION R04")
        SQLBldr.AppendLine("ON")
        SQLBldr.AppendLine("    R01.DEPSTATION = R04.STATION")
        SQLBldr.AppendLine("AND R04.CAMPCODE = @P02")
        SQLBldr.AppendLine("AND R04.DELFLG = @P01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    R01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND R01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND R01.INVFILINGDEPT = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND R01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND R01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        SQLBldr.AppendLine("    AND R01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("    AND R01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("    AND R01.TOTALINCOME      <> 0")
        SQLBldr.AppendLine("    AND R01.DELFLG = @P01")
        SQLBldr.AppendLine("GROUP BY")
        SQLBldr.AppendLine("    R01.DEPSTATION")
        SQLBldr.AppendLine("   ,R01.INVSUBCD")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.VarChar)  '会社コード

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_CORPCD).ToString

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftRentalCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN D02.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(D02.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                   '発行日
        SQLBldr.AppendLine("    , D01.TORICODE + '-' + CAST(D01.KEIJOYM AS NVARCHAR) + '-' + D01.INVFILINGDEPT + '-'")
        SQLBldr.AppendLine("    + D01.INVSUBCD + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")                '請求仮番号
        SQLBldr.AppendLine("    , D01.CLOSINGDATE AS 計上日付")                                                                                                   '計上日付
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   , '01' + '-' + D01.TORICODE + '-' + '1' AS 顧客コード")                                                                        '顧客コード
        Else
            SQLBldr.AppendLine("   , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.SUM_USEFEE,0) + coalesce(D03.ADDFEE01,0), '0') AS 税抜金額")                                                                             '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D03.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(D03.SUM_USEFEE,0) * @P03  + coalesce(D03.TAXADDFEE01,0) , 0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                               '消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) + coalesce(D03.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(D03.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0) + coalesce(D03.ADDFEE01,0) + coalesce(D03.TAXADDFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                             '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D13.SUM_USEFEE,0) + coalesce(D03.ADDFEE02,0), '0') AS 経過措置税抜金額")                                            '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D13.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(D03.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                                       '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(D13.SUM_USEFEE,0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D13.SUM_USEFEE,0) + coalesce(D13.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(D13.SUM_USEFEE,0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(D03.ADDFEE02,0) + coalesce(D03.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                                     '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.ADDFEE11,0) + coalesce(D03.ADDFEE12,0), '0') AS 課税対象外金額")                                                                                                           '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE D12.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) +coalesce(D13.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(D03.SUM_USEFEE,0) +coalesce(D13.SUM_USEFEE,0) +coalesce(D03.SUM_USEFEE_DTL,0) + coalesce(D13.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("       ELSE FORMAT(coalesce(D03.SUM_USEFEE, 0) +coalesce(D13.SUM_USEFEE,0) + ROUND(coalesce(D03.SUM_USEFEE,0) * @P03, 0) + ROUND((coalesce(D13.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(D03.ADDFEE01,0) + coalesce(D03.TAXADDFEE01,0) + ")
        SQLBldr.AppendLine("                   coalesce(D03.ADDFEE02,0) + coalesce(D03.TAXADDFEE02,0) +coalesce(D03.ADDFEE11,0) + coalesce(D03.ADDFEE12,0), '0')")
        SQLBldr.AppendLine("      END  AS 請求書合計金額 ")                                                                                                       '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                             '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                                           '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D03.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                                           '不課税売上小計
        SQLBldr.AppendLine("    , FORMAT(D02.SCHEDATEPAYMENT, 'yyyy/MM/dd') AS '請求サイト（支払期日）'")                                                         '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                         '発行部署コード
        SQLBldr.AppendLine("    , D07.STAFFNAMEL AS 発行担当者")                                                                                                  '発行担当者
        SQLBldr.AppendLine("    , '01-' + D06.INACCOUNTCD AS 請求入金銀行コード")                                                                                 '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(D01.CLOSINGDATE, 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN D14.SLIPDESCRIPTION IS NOT NULL THEN ' ' + D14.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(D02.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(D02.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'")
        SQLBldr.AppendLine("       END AS 宛名欄付記1")                                                                                                           '宛名欄付記1
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記2")                                                                                                           '宛名欄付記2
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記3")                                                                                                           '宛名欄付記3
        SQLBldr.AppendLine("    , D02.FOOTERCOMMENT AS 通信欄")                                                                                                   '通信欄
        SQLBldr.AppendLine("    , '29' AS 帳票種別")                                                                                                              '帳票種別
        SQLBldr.AppendLine("    , D04.NAMES AS 発駅名")                                                                                                            '発駅名
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("          ELSE D05.NAMES")
        SQLBldr.AppendLine("      END AS 着駅名")                                                                                                                 '着駅名
        SQLBldr.AppendLine("    , D01.SHIPYMD AS 発送年月日")                                                                                                     '発送年月日
        SQLBldr.AppendLine("    , D01.CTNTYPE AS コンテナ記号")                                                                                                   'コンテナ記号
        SQLBldr.AppendLine("    , D01.CTNNO AS コンテナ番号")                                                                                                     'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                                   '個数
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.JRFIXEDFARE,0), '0') AS JR所定運賃")                                                                                    'JR所定運賃
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.OWNDISCOUNTFEE,0), '0') AS 私有割引相当額")                                                                             '私有割引相当額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.RETURNFARE,0), '0') AS 割戻運賃")                                                                                       '割戻運賃
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.USEFEE,0), '0') AS 使用料金額")                                                                                         '使用料金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.NITTSUFREESEND,0), '0') AS 通運負担回送運賃")                                                                           '通運負担回送運賃
        SQLBldr.AppendLine("    , coalesce(D01.KENSU,0) AS 発駅合計個数")                                                                                                     '発駅合計個数
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.SUM_USEFEE,0), '0') AS 発駅合計使用料")                                                                                 '発駅合計使用料
        SQLBldr.AppendLine("FROM")
        'メイン レンタル料一覧データ
        SQLBldr.AppendLine("    ( ")
        '〇明細行データ
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            A01.SHIPYMD AS SHIPYMD")
        SQLBldr.AppendLine("            , A01.TORICODE AS TORICODE")
        SQLBldr.AppendLine("            , CONVERT(NVARCHAR, A01.KEIJOYM) AS KEIJOYM")
        SQLBldr.AppendLine("            , A01.INVFILINGDEPT AS INVFILINGDEPT")
        SQLBldr.AppendLine("            , FORMAT(A01.INVKESAIKBN, '00') AS INVKESAIKBN")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                  WHEN R02.INVSUBCD IS NOT NULL THEN FORMAT(R02.INVSUBCD, '00')")
        SQLBldr.AppendLine("                  ELSE FORMAT(A01.INVSUBCD, '00')")
        SQLBldr.AppendLine("              END AS INVSUBCD")
        SQLBldr.AppendLine("            , A01.CLOSINGDATE AS CLOSINGDATE")
        SQLBldr.AppendLine("            , A01.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("            , A01.DEPOSITMONTHKBN")
        SQLBldr.AppendLine("            , FORMAT(A01.CLOSINGDATE, 'dd') AS CLOSINGDAY")
        SQLBldr.AppendLine("            , A01.CTNTYPE AS CTNTYPE")
        SQLBldr.AppendLine("            , CONVERT(VARCHAR, A01.CTNNO) AS CTNNO")
        SQLBldr.AppendLine("            , A01.SAMEDAYCNT AS SAMEDAYCNT")
        SQLBldr.AppendLine("            , A01.CTNLINENO AS CTNLINENO")
        SQLBldr.AppendLine("            , A01.DEPSTATION AS DEPSTATION")
        SQLBldr.AppendLine("            , A01.ARRSTATION AS ARRSTATION")
        SQLBldr.AppendLine("            , coalesce(A02.KENSU,0) AS KENSU")
        SQLBldr.AppendLine("            , coalesce(A03.SUM_USEFEE,0) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.JRFIXEDFARE, 0) AS JRFIXEDFARE")
        SQLBldr.AppendLine("            , coalesce(A01.OWNDISCOUNTFEE, 0) AS OWNDISCOUNTFEE")
        SQLBldr.AppendLine("            , coalesce(A01.RETURNFARE, 0) AS RETURNFARE")
        SQLBldr.AppendLine("            , coalesce(A01.TOTALINCOME, 0) - coalesce(A01.NITTSUFREESEND, 0) AS USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.NITTSUFREESEND, 0) AS NITTSUFREESEND")
        SQLBldr.AppendLine("            , A01.INACCOUNTCD AS INACCOUNTCD")
        SQLBldr.AppendLine("        FROM")
        '[テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF A01 ")
        SQLBldr.AppendLine("        LEFT JOIN lng.LNT0064_INVOICEHEAD R01")
        SQLBldr.AppendLine("            ON R01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R01.DELFLG = @P01")
        SQLBldr.AppendLine("        INNER JOIN lng.LNT0067_INVOICEDATA_RENT R02")
        SQLBldr.AppendLine("            ON R02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R02.SHIPYMD = A01.SHIPYMD")
        SQLBldr.AppendLine("            AND R02.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("            AND R02.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("            AND R02.SAMEDAYCNT = A01.SAMEDAYCNT")
        SQLBldr.AppendLine("            AND R02.CTNLINENO = A01.CTNLINENO")
        SQLBldr.AppendLine("            AND R02.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("            AND R02.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("            AND R02.DELFLG = @P01")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END AS INVSUBCD")
        SQLBldr.AppendLine("                    , COUNT(A11.SHIPYMD) AS KENSU")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    lng.LNT0017_RESSNF A11")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                INNER JOIN lng.LNT0067_INVOICEDATA_RENT A12")
        SQLBldr.AppendLine("                   ON A12.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.SHIPYMD = A11.SHIPYMD")
        SQLBldr.AppendLine("                   AND A12.CTNTYPE = A11.CTNTYPE")
        SQLBldr.AppendLine("                   AND A12.CTNNO = A11.CTNNO")
        SQLBldr.AppendLine("                   AND A12.SAMEDAYCNT = A11.SAMEDAYCNT")
        SQLBldr.AppendLine("                   AND A12.CTNLINENO = A11.CTNLINENO")
        SQLBldr.AppendLine("                   AND A12.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                   AND A12.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                   AND A12.DELFLG = @P01")
        SQLBldr.AppendLine("                LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                    LNG.LNM0002_RECONM A13                                                                                                ")
        SQLBldr.AppendLine("                ON                                                                                                                        ")
        SQLBldr.AppendLine("                    A13.CTNTYPE = A11.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                AND A13.CTNNO   = A11.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                AND A13.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                WHERE")
        SQLBldr.AppendLine("                    A11.DELFLG = @P01")
        SQLBldr.AppendLine("                    AND A11.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                    AND coalesce(A13.DUMMYKBN, '00')  = '00'                                                                                ")
        SQLBldr.AppendLine("                    AND A11.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END")
        SQLBldr.AppendLine("            ) A02")
        SQLBldr.AppendLine("                ON A01.DEPSTATION = A02.DEPSTATION")
        SQLBldr.AppendLine("                AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A02.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A02.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("                    , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    (")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A21.DEPSTATION")
        SQLBldr.AppendLine("                       , A21.TORICODE")
        SQLBldr.AppendLine("                       , A21.KEIJOYM")
        SQLBldr.AppendLine("                       , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                             ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                          END AS INVSUBCD")
        SQLBldr.AppendLine("                       , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                     INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                        ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                        AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                        AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                        AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                        AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                        AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                        AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("                     LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                         LNG.LNM0002_RECONM A23                                                                                                ")
        SQLBldr.AppendLine("                     ON                                                                                                                        ")
        SQLBldr.AppendLine("                         A23.CTNTYPE = A21.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                     AND A23.CTNNO   = A21.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                     AND A23.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                         A21.DELFLG = @P01")
        SQLBldr.AppendLine("                         AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                         AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                     UNION ALL")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A31.DEPSTATION")
        SQLBldr.AppendLine("                       , A31.TORICODE")
        SQLBldr.AppendLine("                       , A31.KEIJOYM")
        SQLBldr.AppendLine("                       , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                         END AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                        A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A31.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                        AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("                )A11 ")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("            ) A03")
        SQLBldr.AppendLine("                ON A01.DEPSTATION = A03.DEPSTATION")
        SQLBldr.AppendLine("                AND A01.TORICODE = A03.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A03.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A03.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A03.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A03.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            A01.DELFLG = @P01")
        SQLBldr.AppendLine("            AND A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("            AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("    ) D01")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD D02")
        SQLBldr.AppendLine("        ON D02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D02.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * @P03) ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE01, 0)) AS ADDFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDFEE01, 0)) AS TAXADDFEE01")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDFEE02, 0)) AS ADDFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.TAXADDFEE02, 0)) AS TAXADDFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDFEE11, 0)) AS ADDFEE11")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDFEE12, 0)) AS ADDFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("			   , 0 AS TOTALINCOME")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE01")
        SQLBldr.AppendLine("			   , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE01")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE02")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("						 END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE02")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '11' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE11")
        SQLBldr.AppendLine("			   , CASE ")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '12' THEN ")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) D03 ")
        SQLBldr.AppendLine("        ON D03.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D03.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D03.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND D03.INVSUBCD = D01.INVSUBCD")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D04")
        SQLBldr.AppendLine("        ON D04.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D04.STATION = D01.DEPSTATION")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D05")
        SQLBldr.AppendLine("        ON D05.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D05.STATION = D01.ARRSTATION ")
        SQLBldr.AppendLine("        AND D05.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM D06")
        SQLBldr.AppendLine("        ON D06.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D06.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(D06.INVKESAIKBN, '00') = D01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND D06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) D07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        D07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0067_INVOICEDATA_RENT D09")
        SQLBldr.AppendLine("        ON D09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D09.SHIPYMD = D01.SHIPYMD")
        SQLBldr.AppendLine("        AND D09.CTNTYPE = D01.CTNTYPE")
        SQLBldr.AppendLine("        AND D09.CTNNO = D01.CTNNO")
        SQLBldr.AppendLine("        AND D09.SAMEDAYCNT = D01.SAMEDAYCNT")
        SQLBldr.AppendLine("        AND D09.CTNLINENO = D01.CTNLINENO")
        SQLBldr.AppendLine("        AND D09.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("        AND D09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND D09.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM D10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        D10.CTNTYPE = D01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND D10.CTNNO   = D01.CTNNO       ")
        SQLBldr.AppendLine("    AND D10.DELFLG = @P01             ")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 D21.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF D21")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            D21.KEIJOYM = D01.KEIJOYM")
        SQLBldr.AppendLine("        AND D21.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D21.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND D21.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("        AND D21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("        AND D21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("        AND D21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("        AND D21.DELFLG = @P01")
        SQLBldr.AppendLine("    ) D11")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM D12")
        SQLBldr.AppendLine("        ON D12.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D12.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(D12.INVKESAIKBN, '00') = D11.INVKESAIKBN")
        SQLBldr.AppendLine("        AND D12.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * 8) / 100 ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) D13 ")
        SQLBldr.AppendLine("        ON D13.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D13.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D13.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND D13.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION D14")
        SQLBldr.AppendLine("        ON D14.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D14.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D14.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("        AND D14.INVOICETYPE = '2'")
        SQLBldr.AppendLine("        AND D14.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVFILINGDEPT = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    D01.INVSUBCD")
        SQLBldr.AppendLine("    , D01.DEPSTATION")
        SQLBldr.AppendLine("    , D01.ARRSTATION")
        SQLBldr.AppendLine("    , D01.SHIPYMD")
        SQLBldr.AppendLine("    , D01.CTNNO")
        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.VarChar)  '会社コード
            Dim PARA03 As MySqlParameter = SQLcmd.Parameters.Add("@P03", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_CORPCD).ToString
            PARA03.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(リース))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftLeaseCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN A03.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(A03.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , CASE WHEN A09.INVSUBCD IS NOT NULL")
        SQLBldr.AppendLine("        THEN A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("             + FORMAT(coalesce(A09.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')")
        SQLBldr.AppendLine("        ELSE A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("             + FORMAT(coalesce(A01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')")
        SQLBldr.AppendLine("      END AS 請求仮番号")                                                                                                                       '請求仮番号                                                          
        SQLBldr.AppendLine("    , CASE")                                                                                                                                    '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '0' THEN A01.CLOSINGDATE")
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '1' THEN A01.LEASEMONTHSTARTYMD")                                                                '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付 2024/09/10 伊藤 CHG                                                             
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + A01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE01,0), '0') AS 税抜金額")                                                                                '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0) + coalesce(R01.TAXADDLEASEFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                                         '消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02 + coalesce(R01.ADDLEASEFEE01,0) + coalesce(R01.TAXADDLEASEFEE01,0), 0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                                       '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE02,0), '0') AS 経過措置税抜金額")                                                                        '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                                                 '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE02,0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                                               '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0) + coalesce(R01.ADDLEASEFEE12,0),'0') AS 課税対象外金額")                                                                                                                     '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) +coalesce(R01.SUM_MONTHLEASEFEE_DTL,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P02, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE01, 0) + coalesce(R01.TAXADDLEASEFEE01, 0) + ")
        SQLBldr.AppendLine("		            coalesce(R01.ADDLEASEFEE02, 0) + coalesce(R01.TAXADDLEASEFEE02, 0) + coalesce(R01.ADDLEASEFEE11, 0) + coalesce(R01.ADDLEASEFEE12, 0), '0')")
        SQLBldr.AppendLine("      END AS 請求書合計金額")                                                                                                                   '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0),'0') AS 非課税売上小計")                                                                                                                     '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE12,0),'0') AS 不課税売上小計")                                                                                                                     '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, A03.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                                                 '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , A07.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + A04.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(CONVERT(DATE, CAST(A01.KEIJOYM AS NVARCHAR) + '01'), 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN R05.SLIPDESCRIPTION IS NOT NULL THEN ' ' + R05.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(A03.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(A03.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'")
        SQLBldr.AppendLine("      END AS 宛名欄付記1")                                                                                                                      '宛名欄付記1
        SQLBldr.AppendLine("    ,  '' AS 宛名欄付記2")                                                                                                                      '宛名欄付記2
        SQLBldr.AppendLine("    ,  '' AS 宛名欄付記3")                                                                                                                      '宛名欄付記3
        SQLBldr.AppendLine("    , A03.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '21' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , REPLACE(TRIM(A06.KANJI1),'　','') + 'コンテナ' AS 品名")                                                                                  '品名
        SQLBldr.AppendLine("    , A01.CTNTYPE AS コンテナ記号")                                                                                                             'コンテナ記号
        SQLBldr.AppendLine("    , CONVERT(VARCHAR, A01.CTNNO) AS コンテナ番号")                                                                                             'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(A10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                                             '個数
        SQLBldr.AppendLine("    , A05.CARGOWEIGHT AS トン数")                                                                                                               'トン数
        SQLBldr.AppendLine("    , FORMAT(A01.LEASEMONTHSTARTYMD, 'yyyy/M/d') AS '使用期間（自）'")                                                                          '使用期間（自）
        SQLBldr.AppendLine("    , FORMAT(A01.LEASEMONTHENDYMD, 'yyyy/M/d') AS '使用期間（至）'")                                                                            '使用期間（至）
        SQLBldr.AppendLine("    , DATEDIFF(day, CONVERT(date, A01.LEASEMONTHSTARTYMD), DATEADD(DAY,1,CONVERT(date, A01.LEASEMONTHENDYMD))) AS '使用期間（日数）'")          '使用期間（日数）
        SQLBldr.AppendLine("    , FORMAT(coalesce(A01.MONTHLEASEFEE,0), '0') AS 単価")                                                                                        '単価
        SQLBldr.AppendLine("    , FORMAT(coalesce(A01.MONTHLEASEFEE,0), '0') AS 金額")                                                                                        '金額
        SQLBldr.AppendLine("    , A01.TAXRATE AS 税率")                                                                                                                     '税率
        SQLBldr.AppendLine("    , FORMAT(coalesce(A08.SUM_LEASEFEE,0), '0') AS 品名の小計")                                                                                   '品名の小計
        SQLBldr.AppendLine("    , '' AS 備考")                                                                                                                              '備考
        SQLBldr.AppendLine("    , REPLACE(TRIM(A06.KANJI1),'　','') + 'コンテナ' AS LK65")                                                                                  'LK65
        SQLBldr.AppendLine("    , '' AS 単位")                                                                                                                              '単位
        SQLBldr.AppendLine("    , '' AS 請求書用税区分名")                                                                                                                  '請求書用税区分名
        SQLBldr.AppendLine("FROM")
        'メイン リース明細データ
        SQLBldr.AppendLine("    lng.LNT0042_LEASEDATA A01")
        SQLBldr.AppendLine("INNER JOIN")
        SQLBldr.AppendLine("    LNG.LNT0041_LEASEAPPLY T41")
        SQLBldr.AppendLine("ON")
        SQLBldr.AppendLine("    T41.LEASENO  = A01.LEASENO")
        SQLBldr.AppendLine("AND T41.CTNTYPE  = A01.CTNTYPE")
        SQLBldr.AppendLine("AND T41.CTNNO    = A01.CTNNO")
        SQLBldr.AppendLine("AND A01.LEASEMONTHSTARTYMD BETWEEN T41.APPLYSTARTYMD AND T41.APPLYENDYMD")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD A03")
        SQLBldr.AppendLine("       ON A03.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("       AND A03.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("       AND A03.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("       AND A03.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("       AND A03.DELFLG = @P01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A09")
        SQLBldr.AppendLine("        ON A09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND A09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND A09.LEASENO = A01.LEASENO")
        SQLBldr.AppendLine("        AND A09.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A09.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A09.LEASEMONTHSTARTYMD = A01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("        AND A09.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("        AND A09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND A09.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM A04")
        SQLBldr.AppendLine("        ON A04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND A04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(A04.INVKESAIKBN, '00') = A01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND A04.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0002_RECONM A05")
        SQLBldr.AppendLine("        ON A05.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A05.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A05.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0022_CLASS A06")
        SQLBldr.AppendLine("        ON A06.BIGCTNCD = A05.BIGCTNCD")
        SQLBldr.AppendLine("        AND A06.MIDDLECTNCD = A05.MIDDLECTNCD")
        SQLBldr.AppendLine("        AND A06.SMALLCTNCD = A05.SMALLCTNCD")
        SQLBldr.AppendLine("        AND A06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) A07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        A07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]リース明細(品名の小計)
        SQLBldr.AppendLine("    LEFT JOIN (")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , B01.INVSUBCD")
        SQLBldr.AppendLine("            , B01.KANJI1")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("            , SUM(coalesce(B01.MONTHLEASEFEE,0)) AS SUM_LEASEFEE")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("           (")
        SQLBldr.AppendLine("            SELECT")
        SQLBldr.AppendLine("                B01.KEIJOYM")
        SQLBldr.AppendLine("              , B01.TORICODE")
        SQLBldr.AppendLine("              , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("              , B01.DEPOSITYMD")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                     WHEN B02.INVSUBCD IS NOT NULL THEN B02.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE B01.INVSUBCD")
        SQLBldr.AppendLine("                END AS INVSUBCD")
        SQLBldr.AppendLine("              , B04.KANJI1")
        SQLBldr.AppendLine("              , B01.DELFLG")
        SQLBldr.AppendLine("              , coalesce(B01.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("            FROM")
        SQLBldr.AppendLine("                lng.LNT0042_LEASEDATA B01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("            INNER JOIN lng.LNT0068_INVOICEDATA_LEASE B02")
        SQLBldr.AppendLine("                ON B02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND B02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND B02.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("                AND B02.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("                AND B02.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("                AND B02.LEASEMONTHSTARTYMD = B01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND B02.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND B02.INVOICEEXCLUSIONFLAG = '0'")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0002_RECONM B03")
        SQLBldr.AppendLine("                ON B03.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("                AND B03.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("                AND B03.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0022_CLASS B04")
        SQLBldr.AppendLine("                ON B04.BIGCTNCD = B03.BIGCTNCD")
        SQLBldr.AppendLine("                AND B04.MIDDLECTNCD = B03.MIDDLECTNCD")
        SQLBldr.AppendLine("                AND B04.SMALLCTNCD = B03.SMALLCTNCD")
        SQLBldr.AppendLine("                AND B04.DELFLG = @P01")
        SQLBldr.AppendLine("            UNION ALL")
        SQLBldr.AppendLine("            SELECT")
        SQLBldr.AppendLine("                A21.KEIJOYM")
        SQLBldr.AppendLine("              , A21.TORICODE")
        SQLBldr.AppendLine("              , A21.INVFILINGDEPT AS INVOICEOUTORGCD")
        SQLBldr.AppendLine("              , A21.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                END AS INVSUBCD")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                    WHEN coalesce(A23.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("                    ELSE A24.KANJI1")
        SQLBldr.AppendLine("                END AS KANJI1")
        SQLBldr.AppendLine("              , A21.DELFLG")
        SQLBldr.AppendLine("              , coalesce(A21.TOTALINCOME, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("            FROM")
        SQLBldr.AppendLine("                lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("            INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0002_RECONM A23")
        SQLBldr.AppendLine("                ON A23.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A23.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A23.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0022_CLASS A24")
        SQLBldr.AppendLine("                ON A24.BIGCTNCD = A23.BIGCTNCD")
        SQLBldr.AppendLine("                AND A24.MIDDLECTNCD = A23.MIDDLECTNCD")
        SQLBldr.AppendLine("                AND A24.SMALLCTNCD = A23.SMALLCTNCD")
        SQLBldr.AppendLine("                AND A24.DELFLG = @P01")
        SQLBldr.AppendLine("            WHERE")
        SQLBldr.AppendLine("                A21.DELFLG = @P01")
        SQLBldr.AppendLine("                AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("            UNION ALL")
        SQLBldr.AppendLine("            SELECT")
        SQLBldr.AppendLine("                A31.KEIJOYM")
        SQLBldr.AppendLine("              , A31.TORICODE")
        SQLBldr.AppendLine("              , A31.INVOICEORGCODE AS INVOICEOUTORGCD")
        SQLBldr.AppendLine("              , A31.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("              , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("              , A31.DETAILS AS KANJI1")
        SQLBldr.AppendLine("              , A31.DELFLG")
        SQLBldr.AppendLine("              , CASE")
        SQLBldr.AppendLine("                    WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                    WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                    WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                END AS MONTHLEASEFEE")
        SQLBldr.AppendLine("            FROM")
        SQLBldr.AppendLine("                lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("            WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )B01")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , B01.INVSUBCD")
        SQLBldr.AppendLine("            , B01.KANJI1")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("    ) A08")
        SQLBldr.AppendLine("        ON  A01.KEIJOYM = A08.KEIJOYM")
        SQLBldr.AppendLine("        AND A01.TORICODE = A08.TORICODE")
        SQLBldr.AppendLine("        AND A01.INVOICEOUTORGCD = A08.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND A01.DEPOSITYMD = A08.DEPOSITYMD")
        SQLBldr.AppendLine("        AND A08.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("        AND A06.KANJI1 = A08.KANJI1")
        SQLBldr.AppendLine("        AND A08.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM A10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        A10.CTNTYPE = A01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND A10.CTNNO   = A01.CTNNO       ")
        SQLBldr.AppendLine("    AND A10.DELFLG = @P01             ")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * @P02) ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE01, 0)) AS ADDLEASEFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDLEASEFEE01, 0)) AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE02, 0)) AS ADDLEASEFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDLEASEFEE02, 0)) AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE11, 0)) AS ADDLEASEFEE11")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE12, 0)) AS ADDLEASEFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("               , 0 AS MONTHLEASEFEE")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("                        CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '11' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			        WHEN A31.TAXKBN = '12' THEN")
        SQLBldr.AppendLine("			            CASE")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                            WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                        END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R01 ")
        SQLBldr.AppendLine("        ON R01.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R01.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R01.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R01.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 R12.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA R12")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            R12.KEIJOYM = A01.KEIJOYM")
        SQLBldr.AppendLine("        AND R12.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R12.DEPOSITYMD = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R12.INVOICEOUTORGCD = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R12.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("        AND R12.DELFLG = @P01")
        SQLBldr.AppendLine("    ) R02")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM R03")
        SQLBldr.AppendLine("        ON R03.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R03.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(R03.INVKESAIKBN, '00') = R02.INVKESAIKBN")
        SQLBldr.AppendLine("        AND R03.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * 8) / 100 ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R04 ")
        SQLBldr.AppendLine("        ON R04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R04.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R04.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION R05")
        SQLBldr.AppendLine("        ON R05.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R05.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R05.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("        AND R05.INVOICETYPE = '3'")
        SQLBldr.AppendLine("        AND R05.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.DELFLG = @P01")
        SQLBldr.AppendLine("    AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVOICEOUTORGCD = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND CASE")
        SQLBldr.AppendLine("            WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("            ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("        END = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    A01.INVSUBCD")
        SQLBldr.AppendLine("    , CASE T41.CONTRALNTYPE")
        SQLBldr.AppendLine("         WHEN '1' THEN 1")
        SQLBldr.AppendLine("         WHEN '3' THEN 2")
        SQLBldr.AppendLine("         WHEN '2' THEN 3")
        SQLBldr.AppendLine("      END               ")
        SQLBldr.AppendLine("    , A01.CTNTYPE")
        SQLBldr.AppendLine("    , A01.CTNNO")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(使用料→リース))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftLeaseCsv_Rent(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN D02.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(D02.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                      '発行日
        SQLBldr.AppendLine("    , D01.TORICODE + '-' + CAST(D01.KEIJOYM AS NVARCHAR) + '-' + D01.INVFILINGDEPT + '-'")
        SQLBldr.AppendLine("    + D01.INVSUBCD + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")   '請求仮番号
        SQLBldr.AppendLine("    , D01.CLOSINGDATE AS 計上日付")                                                                                      '計上日付
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   , '01' + '-' + D01.TORICODE + '-' + '1' AS 顧客コード")                                                           '顧客コード
        Else
            SQLBldr.AppendLine("   , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE01,0), '0') AS 税抜金額")                         '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * 0.1, 0) + coalesce(R01.TAXADDLEASEFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                   '消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + coalesce(R01.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * 0.1, 0) + coalesce(R01.ADDLEASEFEE01,0) + coalesce(R01.TAXADDLEASEFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R01.ADDLEASEFEE02,0), '0') AS 経過措置税抜金額")                                                 '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                          '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE02,0) + coalesce(R01.TAXADDLEASEFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                        '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0) + coalesce(R01.ADDLEASEFEE12,0),'0') AS 課税対象外金額")                          '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN D01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * @P03, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) +coalesce(R01.SUM_MONTHLEASEFEE_DTL,0) + coalesce(R04.SUM_MONTHLEASEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_MONTHLEASEFEE,0) +coalesce(R04.SUM_MONTHLEASEFEE,0) + ROUND(coalesce(R01.SUM_MONTHLEASEFEE,0) * 0.1, 0) + ROUND((coalesce(R04.SUM_MONTHLEASEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDLEASEFEE01,0) + coalesce(R01.TAXADDLEASEFEE01,0) + ")
        SQLBldr.AppendLine("		            coalesce(R01.ADDLEASEFEE02,0) + coalesce(R01.TAXADDLEASEFEE02,0) + coalesce(R01.ADDLEASEFEE11,0) + coalesce(R01.ADDLEASEFEE12,0), '0')")
        SQLBldr.AppendLine("      END AS 請求書合計金額")                                                                                            '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE11,0),'0') AS 非課税売上小計")                                                        '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDLEASEFEE12,0),'0') AS 不課税売上小計")                                                        '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, D02.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                          '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                            '発行部署コード
        SQLBldr.AppendLine("    , D07.STAFFNAMEL AS 発行担当者")                                                                                     '発行担当者
        SQLBldr.AppendLine("    , '01-' + D06.INACCOUNTCD AS 請求入金銀行コード")                                                                    '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(D01.CLOSINGDATE, 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN D12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + D12.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(D02.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(D02.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'")
        SQLBldr.AppendLine("       END AS 宛名欄付記1")                                                                                               '宛名欄付記1
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記2")                                                                                               '宛名欄付記2
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記3")                                                                                               '宛名欄付記3
        SQLBldr.AppendLine("    , D02.FOOTERCOMMENT AS 通信欄")                                                                                      '通信欄
        SQLBldr.AppendLine("    , '21' AS 帳票種別")                                                                                                 '帳票種別
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("          ELSE REPLACE(TRIM(D11.KANJI1),'　','') + 'コンテナ'")
        SQLBldr.AppendLine("      END AS 品名")                                                                                                      '品名
        SQLBldr.AppendLine("    , D01.CTNTYPE AS コンテナ記号")                                                                                      'コンテナ記号
        SQLBldr.AppendLine("    , D01.CTNNO AS コンテナ番号")                                                                                        'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(D10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                      '個数
        SQLBldr.AppendLine("    , D10.CARGOWEIGHT AS トン数")                                                                                        'トン数
        SQLBldr.AppendLine("    , FORMAT(D01.SHIPYMD, 'yyyy/M/d') AS '使用期間（自）'")                                                              '使用期間（自）
        SQLBldr.AppendLine("    , FORMAT(D01.ARRPLANYMD, 'yyyy/M/d') AS '使用期間（至）'")                                                           '使用期間（至）
        SQLBldr.AppendLine("    , DATEDIFF(day, CONVERT(date, D01.SHIPYMD), DATEADD(DAY,1,CONVERT(date, D01.ARRPLANYMD))) AS '使用期間（日数）'")    '使用期間（日数）
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.USEFEE,0), '0') AS 単価")                                                                        '単価
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.USEFEE,0), '0') AS 金額")                                                                        '金額
        SQLBldr.AppendLine("    , '10' AS 税率")                                                                                                     '税率
        SQLBldr.AppendLine("    , FORMAT(coalesce(D01.SUM_USEFEE,0), '0') AS 品名の小計")                                                              '品名の小計
        SQLBldr.AppendLine("    , '' AS 備考")                                                                                                       '備考
        SQLBldr.AppendLine("    , REPLACE(TRIM(D11.KANJI1),'　','') + 'コンテナ' AS LK65")                                                           'LK65
        SQLBldr.AppendLine("    , '' AS 単位")                                                                                                       '単位
        SQLBldr.AppendLine("    , '' AS 請求書用税区分名")                                                                                           '請求書用税区分名
        SQLBldr.AppendLine("FROM")
        'メイン レンタル料一覧データ
        SQLBldr.AppendLine("    ( ")
        '〇明細行データ
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            A01.SHIPYMD AS SHIPYMD")
        SQLBldr.AppendLine("            , A01.TORICODE AS TORICODE")
        SQLBldr.AppendLine("            , CONVERT(NVARCHAR, A01.KEIJOYM) AS KEIJOYM")
        SQLBldr.AppendLine("            , A01.INVFILINGDEPT AS INVFILINGDEPT")
        SQLBldr.AppendLine("            , FORMAT(A01.INVKESAIKBN, '00') AS INVKESAIKBN")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                  WHEN R02.INVSUBCD IS NOT NULL THEN FORMAT(R02.INVSUBCD, '00')")
        SQLBldr.AppendLine("                  ELSE FORMAT(A01.INVSUBCD, '00')")
        SQLBldr.AppendLine("              END AS INVSUBCD")
        SQLBldr.AppendLine("            , A01.CLOSINGDATE AS CLOSINGDATE")
        SQLBldr.AppendLine("            , A01.SCHEDATEPAYMENT AS DEPOSITYMD")
        SQLBldr.AppendLine("            , A01.DEPOSITMONTHKBN")
        SQLBldr.AppendLine("            , FORMAT(A01.CLOSINGDATE, 'dd') AS CLOSINGDAY")
        SQLBldr.AppendLine("            , A01.CTNTYPE AS CTNTYPE")
        SQLBldr.AppendLine("            , CONVERT(VARCHAR, A01.CTNNO) AS CTNNO")
        SQLBldr.AppendLine("            , A01.SAMEDAYCNT AS SAMEDAYCNT")
        SQLBldr.AppendLine("            , A01.CTNLINENO AS CTNLINENO")
        SQLBldr.AppendLine("            , A01.BIGCTNCD AS BIGCTNCD")
        SQLBldr.AppendLine("            , A01.MIDDLECTNCD AS MIDDLECTNCD")
        SQLBldr.AppendLine("            , A01.SMALLCTNCD AS SMALLCTNCD")
        SQLBldr.AppendLine("            , A01.DEPSTATION AS DEPSTATION")
        SQLBldr.AppendLine("            , A01.ARRSTATION AS ARRSTATION")
        SQLBldr.AppendLine("            , A01.ARRPLANYMD AS ARRPLANYMD")
        SQLBldr.AppendLine("            , coalesce(A02.KENSU,0) AS KENSU")
        SQLBldr.AppendLine("            , coalesce(A05.SUM_USEFEE,0) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.JRFIXEDFARE, 0) AS JRFIXEDFARE")
        SQLBldr.AppendLine("            , coalesce(A01.OWNDISCOUNTFEE, 0) AS OWNDISCOUNTFEE")
        SQLBldr.AppendLine("            , coalesce(A01.RETURNFARE, 0) AS RETURNFARE")
        SQLBldr.AppendLine("            , coalesce(A01.TOTALINCOME, 0) AS USEFEE")
        SQLBldr.AppendLine("            , coalesce(A01.NITTSUFREESEND, 0) AS NITTSUFREESEND")
        SQLBldr.AppendLine("            , A01.INACCOUNTCD AS INACCOUNTCD")
        SQLBldr.AppendLine("        FROM")
        '[テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF A01 ")
        SQLBldr.AppendLine("        LEFT JOIN lng.LNT0064_INVOICEHEAD R01")
        SQLBldr.AppendLine("            ON R01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R01.DELFLG = @P01")
        SQLBldr.AppendLine("        INNER JOIN lng.LNT0067_INVOICEDATA_RENT R02")
        SQLBldr.AppendLine("            ON R02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("            AND R02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("            AND R02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("            AND R02.SHIPYMD = A01.SHIPYMD")
        SQLBldr.AppendLine("            AND R02.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("            AND R02.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("            AND R02.SAMEDAYCNT = A01.SAMEDAYCNT")
        SQLBldr.AppendLine("            AND R02.CTNLINENO = A01.CTNLINENO")
        SQLBldr.AppendLine("            AND R02.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("            AND R02.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("            AND R02.DELFLG = @P01")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END AS INVSUBCD")
        SQLBldr.AppendLine("                    , COUNT(A11.SHIPYMD) AS KENSU")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    lng.LNT0017_RESSNF A11")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                INNER JOIN lng.LNT0067_INVOICEDATA_RENT A12")
        SQLBldr.AppendLine("                   ON A12.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                   AND A12.SHIPYMD = A11.SHIPYMD")
        SQLBldr.AppendLine("                   AND A12.CTNTYPE = A11.CTNTYPE")
        SQLBldr.AppendLine("                   AND A12.CTNNO = A11.CTNNO")
        SQLBldr.AppendLine("                   AND A12.SAMEDAYCNT = A11.SAMEDAYCNT")
        SQLBldr.AppendLine("                   AND A12.CTNLINENO = A11.CTNLINENO")
        SQLBldr.AppendLine("                   AND A12.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                   AND A12.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                   AND A12.DELFLG = @P01")
        SQLBldr.AppendLine("                LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                    LNG.LNM0002_RECONM A13                                                                                                ")
        SQLBldr.AppendLine("                ON                                                                                                                        ")
        SQLBldr.AppendLine("                    A13.CTNTYPE = A11.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                AND A13.CTNNO   = A11.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                AND A13.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                WHERE")
        SQLBldr.AppendLine("                    A11.DELFLG = @P01")
        SQLBldr.AppendLine("                    AND A11.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                    AND A11.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                    AND coalesce(A13.DUMMYKBN, '00')  = '00'                                                                                ")
        SQLBldr.AppendLine("                    AND A11.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.DEPSTATION")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , CASE")
        SQLBldr.AppendLine("                          WHEN A12.INVSUBCD IS NOT NULL THEN A12.INVSUBCD")
        SQLBldr.AppendLine("                          ELSE A11.INVSUBCD")
        SQLBldr.AppendLine("                      END")
        SQLBldr.AppendLine("            ) A02")
        SQLBldr.AppendLine("                ON A01.DEPSTATION = A02.DEPSTATION")
        SQLBldr.AppendLine("                AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A02.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A02.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        SQLBldr.AppendLine("            LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                LNG.LNM0002_RECONM A03                                                                                                ")
        SQLBldr.AppendLine("            ON                                                                                                                        ")
        SQLBldr.AppendLine("                A03.CTNTYPE = A01.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("            AND A03.CTNNO   = A01.CTNNO                                                                                               ")
        SQLBldr.AppendLine("            AND A03.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("            LEFT JOIN lng.LNM0022_CLASS A04                                                                                         ")
        SQLBldr.AppendLine("            ON A04.BIGCTNCD = A03.BIGCTNCD                                                                                            ")
        SQLBldr.AppendLine("            AND A04.MIDDLECTNCD = A03.MIDDLECTNCD                                                                                     ")
        SQLBldr.AppendLine("            AND A04.SMALLCTNCD = A03.SMALLCTNCD                                                                                       ")
        SQLBldr.AppendLine("            AND A04.DELFLG  = @P01                                                                                                    ")
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("            LEFT JOIN ( ")
        SQLBldr.AppendLine("                SELECT")
        SQLBldr.AppendLine("                    A11.KANJI1")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("                    , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("                FROM")
        SQLBldr.AppendLine("                    (")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN coalesce(A23.DUMMYKBN, '00') = '01' THEN '加減額'")
        SQLBldr.AppendLine("                             ELSE A24.KANJI1")
        SQLBldr.AppendLine("                         END AS KANJI1")
        SQLBldr.AppendLine("                       , A21.TORICODE")
        SQLBldr.AppendLine("                       , A21.KEIJOYM")
        SQLBldr.AppendLine("                       , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                             ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                          END AS INVSUBCD")
        SQLBldr.AppendLine("                       , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("                     INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                        ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                        AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                        AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                        AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                        AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                        AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                        AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("                     LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                         LNG.LNM0002_RECONM A23                                                                                                ")
        SQLBldr.AppendLine("                     ON                                                                                                                        ")
        SQLBldr.AppendLine("                         A23.CTNTYPE = A21.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                     AND A23.CTNNO   = A21.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                     AND A23.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                     LEFT JOIN lng.LNM0022_CLASS A24                                                                                         ")
        SQLBldr.AppendLine("                     ON A24.BIGCTNCD = A23.BIGCTNCD                                                                                            ")
        SQLBldr.AppendLine("                     AND A24.MIDDLECTNCD = A23.MIDDLECTNCD                                                                                     ")
        SQLBldr.AppendLine("                     AND A24.SMALLCTNCD = A23.SMALLCTNCD                                                                                       ")
        SQLBldr.AppendLine("                     AND A24.DELFLG = @P01                                                                                                     ")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                         A21.DELFLG = @P01")
        SQLBldr.AppendLine("                         AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                         AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                         AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("                     UNION ALL")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A34.KANJI1")
        SQLBldr.AppendLine("                       , A31.TORICODE")
        SQLBldr.AppendLine("                       , A31.KEIJOYM")
        SQLBldr.AppendLine("                       , A31.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A31.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A32.INVSUBCD IS NOT NULL THEN A32.INVSUBCD")
        SQLBldr.AppendLine("                             ELSE A31.INVSUBCD")
        SQLBldr.AppendLine("                         END AS INVSUBCD")
        SQLBldr.AppendLine("                       , coalesce(A31.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0042_LEASEDATA A31")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("                     INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A32")
        SQLBldr.AppendLine("                        ON A32.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A32.LEASENO = A31.LEASENO")
        SQLBldr.AppendLine("                        AND A32.CTNTYPE = A31.CTNTYPE")
        SQLBldr.AppendLine("                        AND A32.CTNNO = A31.CTNNO")
        SQLBldr.AppendLine("                        AND A32.LEASEMONTHSTARTYMD = A31.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                        AND A32.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                        AND A32.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A32.DELFLG = @P01")
        SQLBldr.AppendLine("                     LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("                         LNG.LNM0002_RECONM A33                                                                                                ")
        SQLBldr.AppendLine("                     ON                                                                                                                        ")
        SQLBldr.AppendLine("                         A33.CTNTYPE = A31.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("                     AND A33.CTNNO   = A31.CTNNO                                                                                               ")
        SQLBldr.AppendLine("                     AND A33.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("                     LEFT JOIN lng.LNM0022_CLASS A34                                                                                         ")
        SQLBldr.AppendLine("                     ON A34.BIGCTNCD = A33.BIGCTNCD                                                                                            ")
        SQLBldr.AppendLine("                     AND A34.MIDDLECTNCD = A33.MIDDLECTNCD                                                                                     ")
        SQLBldr.AppendLine("                     AND A34.SMALLCTNCD = A33.SMALLCTNCD                                                                                       ")
        SQLBldr.AppendLine("                     AND A34.DELFLG = @P01                                                                                                     ")
        SQLBldr.AppendLine("                     UNION ALL")
        SQLBldr.AppendLine("                     SELECT")
        SQLBldr.AppendLine("                         A41.DETAILS AS KANJI1")
        SQLBldr.AppendLine("                       , A41.TORICODE")
        SQLBldr.AppendLine("                       , A41.KEIJOYM")
        SQLBldr.AppendLine("                       , A41.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("                       , A41.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                       , A41.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("                       , CASE")
        SQLBldr.AppendLine("                             WHEN A41.AMOUNTTYPE = '5' THEN coalesce(A41.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A41.AMOUNTTYPE = '2' AND A41.RENTADJUSTMENT IS NOT NULL THEN coalesce(A41.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A41.AMOUNTTYPE = '2' AND A41.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A41.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("                         END AS TOTALINCOME")
        SQLBldr.AppendLine("                     FROM")
        SQLBldr.AppendLine("                         lng.LNT0080_INVOICEDATA_ADDAMOUNT A41")
        SQLBldr.AppendLine("                     WHERE")
        SQLBldr.AppendLine("                        A41.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                        AND A41.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                        AND A41.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                        AND A41.DELFLG = @P01")
        SQLBldr.AppendLine("                )A11 ")
        SQLBldr.AppendLine("                GROUP BY")
        SQLBldr.AppendLine("                    A11.KANJI1")
        SQLBldr.AppendLine("                    , A11.TORICODE")
        SQLBldr.AppendLine("                    , A11.KEIJOYM")
        SQLBldr.AppendLine("                    , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("                    , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                    , A11.INVSUBCD")
        SQLBldr.AppendLine("            ) A05")
        SQLBldr.AppendLine("                ON  CASE WHEN A03.DUMMYKBN = '00' ")
        SQLBldr.AppendLine("                         THEN A04.KANJI1")
        SQLBldr.AppendLine("                         ELSE '加減額'")
        SQLBldr.AppendLine("                         END = A05.KANJI1")
        SQLBldr.AppendLine("                AND A01.TORICODE = A05.TORICODE")
        SQLBldr.AppendLine("                AND A01.KEIJOYM = A05.KEIJOYM")
        SQLBldr.AppendLine("                AND A01.INVFILINGDEPT = A05.INVFILINGDEPT")
        SQLBldr.AppendLine("                AND A01.SCHEDATEPAYMENT = A05.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("                AND A05.INVSUBCD = CASE")
        SQLBldr.AppendLine("                                       WHEN R02.INVSUBCD IS NOT NULL THEN R02.INVSUBCD")
        SQLBldr.AppendLine("                                       ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                                   END")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            A01.DELFLG = @P01")
        SQLBldr.AppendLine("            And A01.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND A01.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("            AND A01.TOTALINCOME <> 0")
        SQLBldr.AppendLine("    ) D01")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD D02")
        SQLBldr.AppendLine("        ON D02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D02.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * @P03) ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDLEASEFEE01, 0)) AS ADDLEASEFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDLEASEFEE01, 0)) AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDLEASEFEE02, 0)) AS ADDLEASEFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.TAXADDLEASEFEE02, 0)) AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDLEASEFEE11, 0)) AS ADDLEASEFEE11")
        SQLBldr.AppendLine("			, SUM(coalesce(A11.ADDLEASEFEE12, 0)) AS ADDLEASEFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE11")
        SQLBldr.AppendLine("			   , 0 AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("			   , 0 AS MONTHLEASEFEE ")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * coalesce(A31.TAXRATE, 0) * 0.01, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDLEASEFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '11' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE11")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '12' THEN")
        SQLBldr.AppendLine("                         CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDLEASEFEE12")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R01 ")
        SQLBldr.AppendLine("        ON R01.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND R01.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R01.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R01.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 R12.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF R12")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            R12.KEIJOYM = D01.KEIJOYM")
        SQLBldr.AppendLine("        AND R12.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R12.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R12.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND R12.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("        AND R12.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("        AND R12.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("        AND R12.TOTALINCOME <> 0")
        SQLBldr.AppendLine("        AND R12.DELFLG = @P01")
        SQLBldr.AppendLine("    ) R02")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM R03")
        SQLBldr.AppendLine("        ON R03.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R03.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(R03.INVKESAIKBN, '00') = R02.INVKESAIKBN")
        SQLBldr.AppendLine("        AND R03.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.MONTHLEASEFEE, 0)) AS SUM_MONTHLEASEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.MONTHLEASEFEE,0) * 8) / 100 ,0)) AS SUM_MONTHLEASEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                     WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                     ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS MONTHLEASEFEE")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R04 ")
        SQLBldr.AppendLine("        ON R04.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND R04.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND R04.SCHEDATEPAYMENT = D01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R04.INVSUBCD = D01.INVSUBCD")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D04")
        SQLBldr.AppendLine("        ON D04.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D04.STATION = D01.DEPSTATION")
        SQLBldr.AppendLine("        AND D04.DELFLG = @P01")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("    LEFT JOIN com.LNS0020_STATION D05")
        SQLBldr.AppendLine("        ON D05.CAMPCODE = @P02")
        SQLBldr.AppendLine("        AND D05.STATION = D01.ARRSTATION ")
        SQLBldr.AppendLine("        AND D05.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM D06")
        SQLBldr.AppendLine("        ON D06.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D06.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND FORMAT(D06.INVKESAIKBN, '00') = D01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND D06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) D07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        D07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0067_INVOICEDATA_RENT D09")
        SQLBldr.AppendLine("        ON D09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND D09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND D09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND D09.SHIPYMD = D01.SHIPYMD")
        SQLBldr.AppendLine("        AND D09.CTNTYPE = D01.CTNTYPE")
        SQLBldr.AppendLine("        AND D09.CTNNO = D01.CTNNO")
        SQLBldr.AppendLine("        AND D09.SAMEDAYCNT = D01.SAMEDAYCNT")
        SQLBldr.AppendLine("        AND D09.CTNLINENO = D01.CTNLINENO")
        SQLBldr.AppendLine("        AND D09.OUTINVTYPE = '2'")
        SQLBldr.AppendLine("        AND D09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND D09.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM D10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        D10.CTNTYPE = D01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND D10.CTNNO   = D01.CTNNO       ")
        SQLBldr.AppendLine("    AND D10.DELFLG = @P01             ")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0022_CLASS D11")
        SQLBldr.AppendLine("        ON D11.BIGCTNCD = D10.BIGCTNCD")
        SQLBldr.AppendLine("        AND D11.MIDDLECTNCD = D10.MIDDLECTNCD")
        SQLBldr.AppendLine("        AND D11.SMALLCTNCD = D10.SMALLCTNCD")
        SQLBldr.AppendLine("        AND D11.DELFLG = @P01")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION D12")
        SQLBldr.AppendLine("        ON D12.TORICODE = D01.TORICODE")
        SQLBldr.AppendLine("        AND D12.INVFILINGDEPT = D01.INVFILINGDEPT")
        SQLBldr.AppendLine("        AND D12.INVSUBCD = D01.INVSUBCD")
        SQLBldr.AppendLine("        AND D12.INVOICETYPE = '3'")
        SQLBldr.AppendLine("        AND D12.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVFILINGDEPT = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    D01.INVSUBCD")
        SQLBldr.AppendLine("    , D01.CTNTYPE")
        SQLBldr.AppendLine("    , D01.CTNNO")
        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.VarChar)  '会社コード
            Dim PARA03 As MySqlParameter = SQLcmd.Parameters.Add("@P03", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_CORPCD).ToString
            PARA03.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(請求連携用(リース→使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftRentalCsv_Lease(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN A03.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(A03.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEOUTORGCD + '-'")
        SQLBldr.AppendLine("    + FORMAT(coalesce(A01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号") '請求仮番号
        SQLBldr.AppendLine("    , CASE")                                                                                                                                    '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '0' THEN A01.CLOSINGDATE")
        SQLBldr.AppendLine("          WHEN coalesce(A01.CLOSINGDAYKBN,'0') = '1' THEN A01.LEASEMONTHSTARTYMD")                                                                '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付 2024/09/10 伊藤 CHG  
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + A01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("	, FORMAT(coalesce(R01.SUM_USEFEE,0) + coalesce(R01.ADDFEE01,0), '0') AS 税抜金額")                                                             '税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0) + coalesce(R01.TAXADDFEE01,0), '0')")
        SQLBldr.AppendLine("      END  AS 消費税 ")                                                                                                                         '消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) + coalesce(R01.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * @P02 + coalesce(R01.ADDFEE01,0) + coalesce(R01.TAXADDFEE01,0), 0), '0')")
        SQLBldr.AppendLine("      END  AS 税込金額 ")                                                                                                                       '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R04.SUM_USEFEE,0) + coalesce(R01.ADDFEE02,0), '0') AS 経過措置税抜金額")                                                      '経過措置税抜金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(R01.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置消費税 ")                                                                                                                 '経過措置消費税
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R04.SUM_USEFEE,0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R04.SUM_USEFEE,0) + coalesce(R04.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R04.SUM_USEFEE,0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDFEE02,0) + coalesce(R01.TAXADDFEE02,0), '0')")
        SQLBldr.AppendLine("      END  AS 経過措置税込金額 ")                                                                                                               '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDFEE11,0) + coalesce(R01.ADDFEE12,0), '0') AS 課税対象外金額")                                                                                                                     '課税対象外金額
        SQLBldr.AppendLine("    , CASE WHEN A01.KEIJOYM <= 202306")
        SQLBldr.AppendLine("        THEN (CASE R03.TAXCALCULATION")
        SQLBldr.AppendLine("                 WHEN '1' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) +coalesce(R04.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * @P02, 0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0), '0')")
        SQLBldr.AppendLine("                 WHEN '2' THEN FORMAT(coalesce(R01.SUM_USEFEE,0) +coalesce(R04.SUM_USEFEE,0) +coalesce(R01.SUM_USEFEE_DTL,0) + coalesce(R04.SUM_USEFEE_DTL,0), '0')")
        SQLBldr.AppendLine("              END)")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(R01.SUM_USEFEE,0) +coalesce(R04.SUM_USEFEE,0) + ROUND(coalesce(R01.SUM_USEFEE,0) * 0.1, 0) + ROUND((coalesce(R04.SUM_USEFEE,0) * 8) / 100, 0) + coalesce(R01.ADDFEE01, 0) + coalesce(R01.TAXADDFEE01, 0) + ")
        SQLBldr.AppendLine("		            coalesce(R01.ADDFEE02, 0) + coalesce(R01.TAXADDFEE02, 0)+ coalesce(R01.ADDFEE11, 0) + coalesce(R01.ADDFEE12, 0), '0')")
        SQLBldr.AppendLine("      END AS 請求書合計金額")                                                                                                                   '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                                                     '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(R01.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                                                     '不課税売上小計
        SQLBldr.AppendLine("    , FORMAT(A03.SCHEDATEPAYMENT, 'yyyy/MM/dd') AS '請求サイト（支払期日）'")                                                                   '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , A07.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + A04.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , FORMAT(CONVERT(DATE, CAST(A01.KEIJOYM AS NVARCHAR) + '01'), 'yyyy年M月分') + ")
        SQLBldr.AppendLine("        CASE WHEN R05.SLIPDESCRIPTION IS NOT NULL THEN ' ' + R05.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(A03.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(A03.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'")
        SQLBldr.AppendLine("      END AS 宛名欄付記1")                                                                                                                      '宛名欄付記1
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記2")                                                                                                                     '宛名欄付記2
        SQLBldr.AppendLine("     ,  '' AS 宛名欄付記3")                                                                                                                     '宛名欄付記3
        SQLBldr.AppendLine("    , A03.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '29' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , '' AS 発駅名")                                                                                                                            '発駅名
        SQLBldr.AppendLine("    , '' AS 着駅名")                                                                                                                            '着駅名
        SQLBldr.AppendLine("    , A01.LEASEMONTHSTARTYMD AS 発送年月日")                                                                                                    '発送年月日
        SQLBldr.AppendLine("    , A01.CTNTYPE AS コンテナ記号")                                                                                                             'コンテナ記号
        SQLBldr.AppendLine("    , CONVERT(VARCHAR, A01.CTNNO) AS コンテナ番号")                                                                                             'コンテナ番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN coalesce(A10.DUMMYKBN, '00') = '01' THEN '0'")
        SQLBldr.AppendLine("          ELSE '1'")
        SQLBldr.AppendLine("      END AS 個数")                                                                                                                             '個数
        SQLBldr.AppendLine("    , 0 AS JR所定運賃")                                                                                                                         'JR所定運賃
        SQLBldr.AppendLine("    , 0 AS 私有割引相当額")                                                                                                                     '私有割引相当額
        SQLBldr.AppendLine("    , 0 AS 割戻運賃")                                                                                                                           '割戻運賃
        SQLBldr.AppendLine("    , FORMAT(coalesce(A01.MONTHLEASEFEE,0), '0') AS 使用料金額")                                                                                  '使用料金額
        SQLBldr.AppendLine("    , 0 AS 通運負担回送運賃")                                                                                                                   '通運負担回送運賃
        SQLBldr.AppendLine("    , coalesce(A02.KENSU,0) AS 発駅合計個数")                                                                                                     '発駅合計個数
        SQLBldr.AppendLine("    , FORMAT(coalesce(A02.SUM_LEASEFEE,0), '0') AS 発駅合計使用料")                                                                               '発駅合計使用料
        SQLBldr.AppendLine("FROM")
        'メイン リース明細データ
        SQLBldr.AppendLine("    lng.LNT0042_LEASEDATA A01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("    INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A09")
        SQLBldr.AppendLine("        ON A09.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND A09.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND A09.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND A09.LEASENO = A01.LEASENO")
        SQLBldr.AppendLine("        AND A09.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A09.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A09.LEASEMONTHSTARTYMD = A01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("        AND A09.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("        AND A09.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        AND A09.DELFLG = @P01")
        '[結合テーブル]リース明細(金額合計)
        SQLBldr.AppendLine("    LEFT JOIN (")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                   WHEN B02.INVSUBCD IS NOT NULL THEN B02.INVSUBCD")
        SQLBldr.AppendLine("                   ELSE B01.INVSUBCD")
        SQLBldr.AppendLine("              END AS INVSUBCD")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("            , COUNT(B01.LEASENO) AS KENSU")
        SQLBldr.AppendLine("            , SUM(coalesce(B01.MONTHLEASEFEE,0)) AS SUM_LEASEFEE")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA B01")
        '[結合テーブル]請求明細リースデータ
        SQLBldr.AppendLine("            INNER JOIN lng.LNT0068_INVOICEDATA_LEASE B02")
        SQLBldr.AppendLine("                ON B02.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND B02.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND B02.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND B02.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("                AND B02.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("                AND B02.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("                AND B02.LEASEMONTHSTARTYMD = B01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND B02.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND B02.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("        LEFT JOIN                                                                                                                 ")
        SQLBldr.AppendLine("            LNG.LNM0002_RECONM B03                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                        ")
        SQLBldr.AppendLine("            B03.CTNTYPE = B01.CTNTYPE                                                                                             ")
        SQLBldr.AppendLine("        AND B03.CTNNO   = B01.CTNNO                                                                                               ")
        SQLBldr.AppendLine("        AND B03.DELFLG  = @P01                                                                                                    ")
        SQLBldr.AppendLine("        WHERE                                                                                                                     ")
        SQLBldr.AppendLine("            coalesce(B03.DUMMYKBN, '00')  = '00'                                                                                    ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              B01.KEIJOYM")
        SQLBldr.AppendLine("            , B01.TORICODE")
        SQLBldr.AppendLine("            , B01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("            , B01.DEPOSITYMD")
        SQLBldr.AppendLine("            , CASE")
        SQLBldr.AppendLine("                   WHEN B02.INVSUBCD IS NOT NULL THEN B02.INVSUBCD")
        SQLBldr.AppendLine("                   ELSE B01.INVSUBCD")
        SQLBldr.AppendLine("              END")
        SQLBldr.AppendLine("            , B01.DELFLG")
        SQLBldr.AppendLine("    ) A02")
        SQLBldr.AppendLine("        ON  A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("        AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("        AND A01.INVOICEOUTORGCD = A02.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND A01.DEPOSITYMD = A02.DEPOSITYMD")
        SQLBldr.AppendLine("        AND A02.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("        AND A02.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNT0064_INVOICEHEAD A03")
        SQLBldr.AppendLine("        ON A03.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("        AND A03.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("        AND A03.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("        AND A03.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("        AND A03.DELFLG = @P01")
        '[結合テーブル]営業収入決済条件マスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM A04")
        SQLBldr.AppendLine("        ON A04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND A04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(A04.INVKESAIKBN, '00') = A01.INVKESAIKBN")
        SQLBldr.AppendLine("        AND A04.DELFLG = @P01")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0002_RECONM A05")
        SQLBldr.AppendLine("        ON A05.CTNTYPE = A01.CTNTYPE")
        SQLBldr.AppendLine("        AND A05.CTNNO = A01.CTNNO")
        SQLBldr.AppendLine("        AND A05.DELFLG = @P01")
        '[結合テーブル]大中小分類
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0022_CLASS A06")
        SQLBldr.AppendLine("        ON A06.BIGCTNCD = A05.BIGCTNCD")
        SQLBldr.AppendLine("        AND A06.MIDDLECTNCD = A05.MIDDLECTNCD")
        SQLBldr.AppendLine("        AND A06.SMALLCTNCD = A05.SMALLCTNCD")
        SQLBldr.AppendLine("        AND A06.DELFLG = @P01")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) A07                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        A07.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("    LEFT OUTER JOIN                   ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM A10        ")
        SQLBldr.AppendLine("    ON                                ")
        SQLBldr.AppendLine("        A10.CTNTYPE = A01.CTNTYPE     ")
        SQLBldr.AppendLine("    AND A10.CTNNO   = A01.CTNNO       ")
        SQLBldr.AppendLine("    AND A10.DELFLG = @P01             ")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * @P02) ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE01, 0)) AS ADDFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDFEE01, 0)) AS TAXADDFEE01")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE02, 0)) AS ADDFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TAXADDFEE02, 0)) AS TAXADDFEE02")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE11, 0)) AS ADDFEE11")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.ADDFEE12, 0)) AS ADDFEE12")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , 0 AS ADDFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDFEE12")
        SQLBldr.AppendLine("               , coalesce(A21.TOTALINCOME, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0017_RESSNF A21")
        '[結合テーブル]請求明細使用料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0067_INVOICEDATA_RENT A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.SHIPYMD = A21.SHIPYMD")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.SAMEDAYCNT = A21.SAMEDAYCNT")
        SQLBldr.AppendLine("                AND A22.CTNLINENO = A21.CTNLINENO")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.JURISDICTIONCD = '14'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("                 AND A21.ACCOUNTSTATUSKBN <> '8'")
        SQLBldr.AppendLine("                 AND A21.TOTALINCOME <> 0")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , 0 AS ADDFEE01")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE01")
        SQLBldr.AppendLine("               , 0 AS ADDFEE02")
        SQLBldr.AppendLine("               , 0 AS TAXADDFEE02")
        SQLBldr.AppendLine("               , 0 AS ADDFEE11")
        SQLBldr.AppendLine("               , 0 AS ADDFEE12")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '10'")
        SQLBldr.AppendLine("             UNION ALL")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A31.TORICODE")
        SQLBldr.AppendLine("               , A31.KEIJOYM")
        SQLBldr.AppendLine("               , A31.INVOICEORGCODE AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A31.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , A31.INVSUBCD AS INVSUBCD")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '01' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE01")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '02' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN ROUND(coalesce(A31.MISCELLANEOUSEXPENSE, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.RENTADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(A31.LEASEADJUSTMENT, 0) * (coalesce(A31.TAXRATE, 0) * 0.01), 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS TAXADDFEE02")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("			         WHEN A31.TAXKBN = '11' THEN ")
        SQLBldr.AppendLine("					     CASE")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("                             WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("					     END")
        SQLBldr.AppendLine("                 END AS ADDFEE11")
        SQLBldr.AppendLine("      　　　　 , CASE")
        SQLBldr.AppendLine("	  　　　　       WHEN A31.TAXKBN = '12' THEN ")
        SQLBldr.AppendLine("		　　　　	     CASE")
        SQLBldr.AppendLine("      　　　　               WHEN A31.AMOUNTTYPE = '5' THEN coalesce(A31.MISCELLANEOUSEXPENSE, 0)")
        SQLBldr.AppendLine("      　　　　               WHEN A31.AMOUNTTYPE = '2' AND A31.RENTADJUSTMENT IS NOT NULL THEN coalesce(A31.RENTADJUSTMENT, 0)")
        SQLBldr.AppendLine("      　　　　               WHEN A31.AMOUNTTYPE = '2' AND A31.LEASEADJUSTMENT IS NOT NULL THEN coalesce(A31.LEASEADJUSTMENT, 0)")
        SQLBldr.AppendLine("		　　　　	     END")
        SQLBldr.AppendLine("      　　　　   END AS ADDFEE12")
        SQLBldr.AppendLine("               , 0 AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0080_INVOICEDATA_ADDAMOUNT A31")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                A31.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A31.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A31.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A31.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A31.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A31.DELFLG = @P01")
        SQLBldr.AppendLine("        )A11 ")
        SQLBldr.AppendLine("        GROUP BY")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R01 ")
        SQLBldr.AppendLine("        ON R01.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R01.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R01.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R01.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 R12.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA R12")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            R12.KEIJOYM = A01.KEIJOYM")
        SQLBldr.AppendLine("        AND R12.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R12.DEPOSITYMD = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R12.INVOICEOUTORGCD = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R12.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("        AND R12.DELFLG = @P01")
        SQLBldr.AppendLine("    ) R02")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0024_KEKKJM R03")
        SQLBldr.AppendLine("        ON R03.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R03.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND FORMAT(R03.INVKESAIKBN, '00') = R02.INVKESAIKBN")
        SQLBldr.AppendLine("        AND R03.DELFLG = @P01")
        '[結合テーブル]請求ヘッダーデータ(合計金額)
        '[結合テーブル]コンテナ清算ファイル
        SQLBldr.AppendLine("    LEFT JOIN ( ")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("              A11.TORICODE")
        SQLBldr.AppendLine("            , A11.KEIJOYM")
        SQLBldr.AppendLine("            , A11.INVFILINGDEPT")
        SQLBldr.AppendLine("            , A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            , A11.INVSUBCD")
        SQLBldr.AppendLine("            , SUM(coalesce(A11.TOTALINCOME, 0)) AS SUM_USEFEE")
        SQLBldr.AppendLine("            , SUM(ROUND((coalesce(A11.TOTALINCOME,0) * 8) / 100 ,0)) AS SUM_USEFEE_DTL")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            (")
        SQLBldr.AppendLine("             SELECT")
        SQLBldr.AppendLine("                 A21.TORICODE")
        SQLBldr.AppendLine("               , A21.KEIJOYM")
        SQLBldr.AppendLine("               , A21.INVOICEOUTORGCD AS INVFILINGDEPT")
        SQLBldr.AppendLine("               , A21.DEPOSITYMD AS SCHEDATEPAYMENT")
        SQLBldr.AppendLine("               , CASE")
        SQLBldr.AppendLine("                      WHEN A22.INVSUBCD IS NOT NULL THEN A22.INVSUBCD")
        SQLBldr.AppendLine("                      ELSE A21.INVSUBCD")
        SQLBldr.AppendLine("                 END AS INVSUBCD")
        SQLBldr.AppendLine("               , coalesce(A21.MONTHLEASEFEE, 0) AS TOTALINCOME")
        SQLBldr.AppendLine("             FROM")
        SQLBldr.AppendLine("                 lng.LNT0042_LEASEDATA A21")
        '[結合テーブル]請求明細リース料データ
        SQLBldr.AppendLine("             INNER JOIN lng.LNT0068_INVOICEDATA_LEASE A22")
        SQLBldr.AppendLine("                ON A22.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'")
        SQLBldr.AppendLine("                AND A22.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("                AND A22.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("                AND A22.LEASENO = A21.LEASENO")
        SQLBldr.AppendLine("                AND A22.CTNTYPE = A21.CTNTYPE")
        SQLBldr.AppendLine("                AND A22.CTNNO = A21.CTNNO")
        SQLBldr.AppendLine("                AND A22.LEASEMONTHSTARTYMD = A21.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("                AND A22.OUTINVTYPE = '1'")
        SQLBldr.AppendLine("                AND A22.INVOICEEXCLUSIONFLAG = '0'")
        SQLBldr.AppendLine("                AND A22.DELFLG = @P01")
        SQLBldr.AppendLine("             WHERE")
        SQLBldr.AppendLine("                 A21.DELFLG = @P01")
        SQLBldr.AppendLine("                 AND A21.LEASEAPPLYKBN <> '2'")
        SQLBldr.AppendLine("                 AND A21.TAXRATE = '8'")
        SQLBldr.AppendLine("        )A11  ")
        SQLBldr.AppendLine("        GROUP BY  ")
        SQLBldr.AppendLine("               A11.TORICODE")
        SQLBldr.AppendLine("              ,A11.KEIJOYM")
        SQLBldr.AppendLine("              ,A11.INVFILINGDEPT")
        SQLBldr.AppendLine("              ,A11.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("              ,A11.INVSUBCD")
        SQLBldr.AppendLine("    ) R04 ")
        SQLBldr.AppendLine("        ON R04.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R04.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R04.SCHEDATEPAYMENT = A01.DEPOSITYMD")
        SQLBldr.AppendLine("        AND R04.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("    LEFT JOIN lng.LNM0037_SLIPDESCRIPTION R05")
        SQLBldr.AppendLine("        ON R05.TORICODE = A01.TORICODE")
        SQLBldr.AppendLine("        AND R05.INVFILINGDEPT = A01.INVOICEOUTORGCD")
        SQLBldr.AppendLine("        AND R05.INVSUBCD = CASE")
        SQLBldr.AppendLine("                               WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("                               ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("                           END")
        SQLBldr.AppendLine("        AND R05.INVOICETYPE = '2'")
        SQLBldr.AppendLine("        AND R05.DELFLG = @P01")
        '抽出条件
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    A01.DELFLG = @P01")
        SQLBldr.AppendLine("    AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'")
        SQLBldr.AppendLine("    AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'")
        SQLBldr.AppendLine("    AND A01.INVOICEOUTORGCD = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'")
        SQLBldr.AppendLine("    AND A01.DEPOSITYMD = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'")
        SQLBldr.AppendLine("    AND CASE")
        SQLBldr.AppendLine("            WHEN A09.INVSUBCD IS NOT NULL THEN A09.INVSUBCD")
        SQLBldr.AppendLine("            ELSE A01.INVSUBCD")
        SQLBldr.AppendLine("        END = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString)
        '並び順
        SQLBldr.AppendLine("ORDER BY")
        SQLBldr.AppendLine("    A01.INVSUBCD")
        SQLBldr.AppendLine("    , A01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("    , A01.CTNTYPE")
        SQLBldr.AppendLine("    , A01.CTNNO")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 追加金額明細データ 検索処理(正式版請求連携用(使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectRentalCsv_Add(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN D07.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(D07.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , D01.TORICODE + '-' + CAST(D01.KEIJOYM AS NVARCHAR) + '-' + D01.INVOICEORGCODE + '-'")
        SQLBldr.AppendLine("    + FORMAT(coalesce(D01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")                                  '請求仮番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN CAST(D01.KEIJOYM AS NVARCHAR) LIKE '%02' AND D01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          WHEN D01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          ELSE FORMAT(CAST(CAST((D01.KEIJOYM * 100)")
        SQLBldr.AppendLine("               + D01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   , '01' + '-' + D01.TORICODE + '-' + '1' AS 顧客コード")                                                                                  '顧客コード
        Else
            SQLBldr.AppendLine("   , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE01,0), '0') AS 税抜金額")                                                                                         '税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.TAXADDFEE01,0), '0') AS 消費税")                                                                                        '消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE01,0) + coalesce(D05.TAXADDFEE01, 0), '0') AS 税込金額")                                                            '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE02,0), '0') AS 経過措置税抜金額")                                                                                 '経過措置税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.TAXADDFEE02,0), '0') AS 経過措置消費税")                                                                                '経過措置消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE02,0) + coalesce(D05.TAXADDFEE02,0), '0') AS 経過措置税込金額")                                                     '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE11,0) + coalesce(D05.ADDFEE12,0), '0') AS 課税対象外金額")                                                          '課税対象外金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE01,0) + coalesce(D05.TAXADDFEE01, 0) + coalesce(D05.ADDFEE02,0) + coalesce(D05.TAXADDFEE02,0) + ")
        SQLBldr.AppendLine("             coalesce(D05.ADDFEE11,0) + coalesce(D05.ADDFEE12,0), '0') AS 請求書合計金額")                                                          '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                   '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                   '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, D01.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                                                 '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , D06.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + D01.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("        WHEN CAST(D01.KEIJOYM AS NVARCHAR) LIKE '%02' AND D01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        WHEN D01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((D01.KEIJOYM * 100)")
        SQLBldr.AppendLine("             + D01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')")
        SQLBldr.AppendLine("      END + CASE")
        SQLBldr.AppendLine("             WHEN D08.SLIPDESCRIPTION IS NOT NULL THEN ' ' + D08.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(D07.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(D07.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'")
        SQLBldr.AppendLine("            END AS 宛名欄付記1")                                                                                                                '宛名欄付記1
        SQLBldr.AppendLine("    , '' AS 宛名欄付記2")                                                                                                                       '宛名欄付記2
        SQLBldr.AppendLine("    , '' AS 宛名欄付記3")                                                                                                                       '宛名欄付記3
        SQLBldr.AppendLine("    , D07.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '19' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '2' THEN MAX(D02.NAMES)                                                 ")
        SQLBldr.AppendLine("          ELSE D01.DETAILS                                                                              ")
        SQLBldr.AppendLine("      END                                                 AS 発駅名                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' THEN MAX(D03.NAMES)                                                 ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '2' THEN D01.DETAILS                                                    ")
        SQLBldr.AppendLine("          WHEN MAX(SUBSTRING(D01.REMARKS,1,6)) <> '' THEN MAX(SUBSTRING(D01.REMARKS,1,6))               ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS 着駅名                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' AND D01.SHIPYMD IS NOT NULL THEN FORMAT(D01.SHIPYMD, 'yyyy/MM/dd')  ")
        SQLBldr.AppendLine("          ELSE (CASE                                                                                    ")
        SQLBldr.AppendLine("                    WHEN CAST(D01.KEIJOYM AS NVARCHAR) LIKE '%02' AND D01.CLOSINGDAY >= 29              ")
        SQLBldr.AppendLine("                    THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')       ")
        SQLBldr.AppendLine("                    WHEN D01.CLOSINGDAY >= 31                                                           ")
        SQLBldr.AppendLine("                    THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')       ")
        SQLBldr.AppendLine("                    ELSE FORMAT(CAST(CAST((D01.KEIJOYM * 100)                                           ")
        SQLBldr.AppendLine("                         + D01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                          ")
        SQLBldr.AppendLine("                END)                                                                                    ")                                                                                                                         '計上日付
        SQLBldr.AppendLine("      END                                                 AS 発送年月日                                 ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(D01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS コンテナ記号                               ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(D01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS コンテナ番号                               ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN '0'                                                                             ")
        SQLBldr.AppendLine("          WHEN '5' THEN '1'                                                                             ")
        SQLBldr.AppendLine("      END                                                 AS 個数                                       ")
        SQLBldr.AppendLine("    , '0'                                                 AS JR所定運賃                                 ")
        SQLBldr.AppendLine("    , '0'                                                 AS 私有割引相当額                             ")
        SQLBldr.AppendLine("    , '0'                                                 AS 割戻運賃                                   ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(D01.RENTADJUSTMENT),0) + coalesce(SUM(D01.LEASEADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(D01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                 AS 使用料金額                                 ")
        SQLBldr.AppendLine("    , '0'                                                 AS 通運負担回送運賃                           ")
        SQLBldr.AppendLine("    , '0'                                                 AS 発駅合計個数                               ")
        SQLBldr.AppendLine("    , coalesce(D04.ADDFEE,0)                                AS 発駅合計使用料                             ")
        SQLBldr.AppendLine("FROM                                                                                                    ")
        'メイン 請求追加金額明細データ
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT D01                                                               ")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    com.LNS0020_STATION D02                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.DEPSTATION = D02.STATION                                                                        ")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    com.LNS0020_STATION D03                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.ARRSTATION = D03.STATION                                                                        ")
        '[結合テーブル]請求追加金額明細データ(発駅別合計使用料)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , D11.DEPSTATION                                                                                ")
        SQLBldr.AppendLine("        , D11.AMOUNTTYPE                                                                                ")
        SQLBldr.AppendLine("        , CASE D11.AMOUNTTYPE                                                                           ")
        SQLBldr.AppendLine("             WHEN '2' THEN coalesce(SUM(D11.RENTADJUSTMENT),0) + coalesce(SUM(D11.LEASEADJUSTMENT),0)       ")
        SQLBldr.AppendLine("             WHEN '5' THEN coalesce(SUM(D11.MISCELLANEOUSEXPENSE),0)                                      ")
        SQLBldr.AppendLine("           END AS ADDFEE                                                                                ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        LNG.LNT0080_INVOICEDATA_ADDAMOUNT D11                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                               ")
        SQLBldr.AppendLine("        D11.DELFLG = @P01                                                                               ")
        SQLBldr.AppendLine("    AND D11.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                         ")
        SQLBldr.AppendLine("    AND D11.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'             ")
        SQLBldr.AppendLine("    AND D11.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                       ")
        SQLBldr.AppendLine("    AND D11.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'           ")
        SQLBldr.AppendLine("    AND D11.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'              ")
        SQLBldr.AppendLine("    AND D11.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                         ")
        SQLBldr.AppendLine("    AND D11.INVOICETYPE = '2'                                                                           ")
        SQLBldr.AppendLine("    AND D11.INVOICEEXCLUSIONFLAG = '0'                                                                  ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.DEPSTATION                                                                                ")
        SQLBldr.AppendLine("        , D11.AMOUNTTYPE                                                                                ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )D04                                                                                                ")
        SQLBldr.AppendLine("    ON D01.KEIJOYM = D04.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND D01.INVOICEORGCODE = D04.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND D01.TORICODE = D04.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND D01.SCHEDATEPAYMENT = D04.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND coalesce(D01.DEPSTATION,0) = coalesce(D04.DEPSTATION,0)                                             ")
        SQLBldr.AppendLine("    AND D01.AMOUNTTYPE = D04.AMOUNTTYPE                                                                 ")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = D04.INVSUBCD                                                                     ")
        '[結合テーブル]請求追加金額明細データ(合計額)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE01, 0)) AS ADDFEE01                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.TAXADDFEE01, 0)) AS TAXADDFEE01                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE02, 0)) AS ADDFEE02                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.TAXADDFEE02, 0)) AS TAXADDFEE02                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE11, 0)) AS ADDFEE11                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE12, 0)) AS ADDFEE12                                                      ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        (                                                                                               ")
        SQLBldr.AppendLine("         SELECT                                                                                         ")
        SQLBldr.AppendLine("             D21.KEIJOYM                                                                                ")
        SQLBldr.AppendLine("             , D21.INVOICEORGCODE                                                                       ")
        SQLBldr.AppendLine("             , D21.TORICODE                                                                             ")
        SQLBldr.AppendLine("             , D21.SCHEDATEPAYMENT                                                                      ")
        SQLBldr.AppendLine("             , D21.INVSUBCD                                                                             ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '01' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE01                                                                          ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '01' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01) + coalesce(D21.LEASEADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0) * (coalesce(D21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS TAXADDFEE01                                                                       ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '02' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE02                                                                          ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '02' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01) + coalesce(D21.LEASEADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01)            ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0) * (coalesce(D21.TAXRATE,0) * 0.01)     ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS TAXADDFEE02                                                                       ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '11' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE11                                                                          ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '12' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE12                                                                          ")
        SQLBldr.AppendLine("         FROM                                                                                           ")
        SQLBldr.AppendLine("             LNG.LNT0080_INVOICEDATA_ADDAMOUNT D21                                                      ")
        SQLBldr.AppendLine("         WHERE                                                                                          ")
        SQLBldr.AppendLine("             D21.DELFLG = @P01                                                                          ")
        SQLBldr.AppendLine("         AND D21.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                    ")
        SQLBldr.AppendLine("         AND D21.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'        ")
        SQLBldr.AppendLine("         AND D21.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                  ")
        SQLBldr.AppendLine("         AND D21.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'      ")
        SQLBldr.AppendLine("         AND D21.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'         ")
        SQLBldr.AppendLine("         AND D21.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                    ")
        SQLBldr.AppendLine("         AND D21.INVOICETYPE = '2'                                                                      ")
        SQLBldr.AppendLine("         AND D21.INVOICEEXCLUSIONFLAG = '0'                                                             ")
        SQLBldr.AppendLine("    ) D11                                                                                               ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )D05                                                                                                ")
        SQLBldr.AppendLine("    ON D01.KEIJOYM = D05.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND D01.INVOICEORGCODE = D05.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND D01.TORICODE = D05.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND D01.SCHEDATEPAYMENT = D05.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = D05.INVSUBCD                                                                     ")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) D06                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        D06.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求ヘッダ
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD D07                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.KEIJOYM = D07.KEIJOYM                                                                           ")
        SQLBldr.AppendLine("AND D01.INVOICENUMBER = D07.INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = D07.INVOICEORGCODE                                                             ")
        SQLBldr.AppendLine("AND D01.TORICODE = D07.TORICODE                                                                         ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION D08                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.TORICODE = D08.TORICODE                                                                         ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = D08.INVFILINGDEPT                                                              ")
        SQLBldr.AppendLine("AND D08.INVSUBCD = D01.INVSUBCD                                                                         ")
        SQLBldr.AppendLine("AND D08.INVOICETYPE = '2'                                                                               ")
        SQLBldr.AppendLine("AND D08.DELFLG = @P01                                                                                   ")
        '抽出条件
        SQLBldr.AppendLine("WHERE                                                                                                   ")
        SQLBldr.AppendLine("    D01.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("AND D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                             ")
        SQLBldr.AppendLine("AND D01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'                 ")
        SQLBldr.AppendLine("AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                           ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'               ")
        SQLBldr.AppendLine("AND D01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                  ")
        SQLBldr.AppendLine("AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                             ")
        SQLBldr.AppendLine("AND D01.INVOICETYPE = '2'                                                                               ")
        SQLBldr.AppendLine("AND D01.INVOICEEXCLUSIONFLAG = '0'                                                                      ")
        ' グルーピング条件
        SQLBldr.AppendLine("GROUP BY                                                                                                ")
        SQLBldr.AppendLine("    D01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,D01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,D01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,D01.SCHEDATEPAYMENT                                                                                 ")
        SQLBldr.AppendLine("   ,D01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INACCOUNTCD                                                                                     ")
        SQLBldr.AppendLine("   ,D01.CLOSINGDAY                                                                                      ")
        SQLBldr.AppendLine("   ,D01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,D01.DETAILS                                                                                         ")
        SQLBldr.AppendLine("   ,D01.SHIPYMD                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,D01.DEPSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.ARRSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D04.ADDFEE                                                                                          ")
        SQLBldr.AppendLine("   ,D05.ADDFEE01                                                                                        ")
        SQLBldr.AppendLine("   ,D05.TAXADDFEE01                                                                                     ")
        SQLBldr.AppendLine("   ,D05.ADDFEE02                                                                                        ")
        SQLBldr.AppendLine("   ,D05.TAXADDFEE02                                                                                     ")
        SQLBldr.AppendLine("   ,D05.ADDFEE11                                                                                        ")
        SQLBldr.AppendLine("   ,D05.ADDFEE12                                                                                        ")
        SQLBldr.AppendLine("   ,D06.STAFFNAMEL                                                                                      ")
        SQLBldr.AppendLine("   ,D07.PRINTDATE                                                                                       ")
        SQLBldr.AppendLine("   ,D07.HEADERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,D07.FOOTERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,D08.SLIPDESCRIPTION                                                                                 ")
        ' ソート条件
        SQLBldr.AppendLine("ORDER BY                                                                                                ")
        SQLBldr.AppendLine("    D01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,D01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,D01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,D01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,D01.DEPSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.ARRSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.SHIPYMD                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,D01.DETAILS                                                                                         ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 追加金額明細データ 検索処理(ドラフト版請求連携用(使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftRentalCsv_Add(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN D07.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(D07.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , D01.TORICODE + '-' + CAST(D01.KEIJOYM AS NVARCHAR) + '-' + D01.INVOICEORGCODE + '-'")
        SQLBldr.AppendLine("    + FORMAT(coalesce(D01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")                                  '請求仮番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN CAST(D01.KEIJOYM AS NVARCHAR) LIKE '%02' AND D01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          WHEN D01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          ELSE FORMAT(CAST(CAST((D01.KEIJOYM * 100)")
        SQLBldr.AppendLine("               + D01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付
        If CS0050SESSION.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + D01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE01,0), '0') AS 税抜金額")                                                                                        '税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.TAXADDFEE01,0), '0') AS 消費税")                                                                                       '消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE01,0) + coalesce(D05.TAXADDFEE01, 0), '0') AS 税込金額")                                                            '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE02,0), '0') AS 経過措置税抜金額")                                                                                 '経過措置税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.TAXADDFEE02,0), '0') AS 経過措置消費税")                                                                                '経過措置消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE02,0) + coalesce(D05.TAXADDFEE02,0), '0') AS 経過措置税込金額")                                                     '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE11,0) + coalesce(D05.ADDFEE12,0), '0') AS 課税対象外金額")                                                          '課税対象外金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE01,0) + coalesce(D05.TAXADDFEE01, 0) + coalesce(D05.ADDFEE02,0) + coalesce(D05.TAXADDFEE02,0) + ")
        SQLBldr.AppendLine("             coalesce(D05.ADDFEE11,0) + coalesce(D05.ADDFEE12,0), '0') AS 請求書合計金額")                                                          '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                   '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(D05.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                   '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, D01.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                                                 '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , D06.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + D01.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("        WHEN CAST(D01.KEIJOYM AS NVARCHAR) LIKE '%02' AND D01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        WHEN D01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((D01.KEIJOYM * 100)")
        SQLBldr.AppendLine("             + D01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')")
        SQLBldr.AppendLine("      END + CASE")
        SQLBldr.AppendLine("             WHEN D08.SLIPDESCRIPTION IS NOT NULL THEN ' ' + D08.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(D07.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(D07.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'")
        SQLBldr.AppendLine("            END AS 宛名欄付記1")                                                                                                                '宛名欄付記1
        SQLBldr.AppendLine("    , '' AS 宛名欄付記2")                                                                                                                       '宛名欄付記2
        SQLBldr.AppendLine("    , '' AS 宛名欄付記3")                                                                                                                       '宛名欄付記3
        SQLBldr.AppendLine("    , D07.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '29' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '2' THEN MAX(D02.NAMES)                                                 ")
        SQLBldr.AppendLine("          ELSE D01.DETAILS                                                                              ")
        SQLBldr.AppendLine("      END                                                 AS 発駅名                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' THEN MAX(D03.NAMES)                                                 ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '2' THEN D01.DETAILS                                                    ")
        SQLBldr.AppendLine("          WHEN MAX(SUBSTRING(D01.REMARKS,1,6)) <> '' THEN MAX(SUBSTRING(D01.REMARKS,1,6))               ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS 着駅名                                     ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN D01.AMOUNTTYPE = '5' AND D01.SHIPYMD IS NOT NULL THEN FORMAT(D01.SHIPYMD, 'yyyy/MM/dd')  ")
        SQLBldr.AppendLine("          ELSE (CASE                                                                                    ")
        SQLBldr.AppendLine("                    WHEN CAST(D01.KEIJOYM AS NVARCHAR) LIKE '%02' AND D01.CLOSINGDAY >= 29              ")
        SQLBldr.AppendLine("                    THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')       ")
        SQLBldr.AppendLine("                    WHEN D01.CLOSINGDAY >= 31                                                           ")
        SQLBldr.AppendLine("                    THEN FORMAT(EOMONTH(CAST((D01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')       ")
        SQLBldr.AppendLine("                    ELSE FORMAT(CAST(CAST((D01.KEIJOYM * 100)                                           ")
        SQLBldr.AppendLine("                         + D01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                          ")
        SQLBldr.AppendLine("                END)                                                                                    ")                                                                                                                         '計上日付
        SQLBldr.AppendLine("      END                                                 AS 発送年月日                                 ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(D01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS コンテナ記号                               ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(D01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                 AS コンテナ番号                               ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN '0'                                                                             ")
        SQLBldr.AppendLine("          WHEN '5' THEN '1'                                                                             ")
        SQLBldr.AppendLine("      END                                                 AS 個数                                       ")
        SQLBldr.AppendLine("    , '0'                                                 AS JR所定運賃                                 ")
        SQLBldr.AppendLine("    , '0'                                                 AS 私有割引相当額                             ")
        SQLBldr.AppendLine("    , '0'                                                 AS 割戻運賃                                   ")
        SQLBldr.AppendLine("    , CASE D01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(D01.RENTADJUSTMENT),0) + coalesce(SUM(D01.LEASEADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(D01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                 AS 使用料金額                                 ")
        SQLBldr.AppendLine("    , '0'                                                 AS 通運負担回送運賃                           ")
        SQLBldr.AppendLine("    , '0'                                                 AS 発駅合計個数                               ")
        SQLBldr.AppendLine("    , coalesce(D04.ADDFEE,0)                                AS 発駅合計使用料                             ")
        SQLBldr.AppendLine("FROM                                                                                                    ")
        'メイン 請求追加金額明細データ
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT D01                                                               ")
        '[結合テーブル]駅マスタ(発駅)
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    com.LNS0020_STATION D02                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.DEPSTATION = D02.STATION                                                                        ")
        '[結合テーブル]駅マスタ(着駅)
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    com.LNS0020_STATION D03                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.ARRSTATION = D03.STATION                                                                        ")
        '[結合テーブル]請求追加金額明細データ(発駅別合計使用料)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , D11.DEPSTATION                                                                                ")
        SQLBldr.AppendLine("        , D11.AMOUNTTYPE                                                                                ")
        SQLBldr.AppendLine("        , CASE D11.AMOUNTTYPE                                                                           ")
        SQLBldr.AppendLine("             WHEN '2' THEN coalesce(SUM(D11.RENTADJUSTMENT),0) + coalesce(SUM(D11.LEASEADJUSTMENT),0)       ")
        SQLBldr.AppendLine("             WHEN '5' THEN coalesce(SUM(D11.MISCELLANEOUSEXPENSE),0)                                      ")
        SQLBldr.AppendLine("           END AS ADDFEE                                                                                ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        LNG.LNT0080_INVOICEDATA_ADDAMOUNT D11                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                               ")
        SQLBldr.AppendLine("        D11.DELFLG = @P01                                                                               ")
        SQLBldr.AppendLine("    AND D11.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                         ")
        SQLBldr.AppendLine("    AND D11.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'             ")
        SQLBldr.AppendLine("    AND D11.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                       ")
        SQLBldr.AppendLine("    AND D11.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'           ")
        SQLBldr.AppendLine("    AND D11.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'              ")
        SQLBldr.AppendLine("    AND D11.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                         ")
        SQLBldr.AppendLine("    AND D11.INVOICETYPE = '2'                                                                           ")
        SQLBldr.AppendLine("    AND D11.INVOICEEXCLUSIONFLAG = '0'                                                                  ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.DEPSTATION                                                                                ")
        SQLBldr.AppendLine("        , D11.AMOUNTTYPE                                                                                ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )D04                                                                                                ")
        SQLBldr.AppendLine("    ON D01.KEIJOYM = D04.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND D01.INVOICEORGCODE = D04.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND D01.TORICODE = D04.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND D01.SCHEDATEPAYMENT = D04.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND coalesce(D01.DEPSTATION,0) = coalesce(D04.DEPSTATION,0)                                             ")
        SQLBldr.AppendLine("    AND D01.AMOUNTTYPE = D04.AMOUNTTYPE                                                                 ")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = D04.INVSUBCD                                                                     ")
        '[結合テーブル]請求追加金額明細データ(合計額)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE01, 0)) AS ADDFEE01                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.TAXADDFEE01, 0)) AS TAXADDFEE01                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE02, 0)) AS ADDFEE02                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.TAXADDFEE02, 0)) AS TAXADDFEE02                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE11, 0)) AS ADDFEE11                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(D11.ADDFEE12, 0)) AS ADDFEE12                                                      ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        (                                                                                               ")
        SQLBldr.AppendLine("         SELECT                                                                                         ")
        SQLBldr.AppendLine("             D21.KEIJOYM                                                                                ")
        SQLBldr.AppendLine("             , D21.INVOICEORGCODE                                                                       ")
        SQLBldr.AppendLine("             , D21.TORICODE                                                                             ")
        SQLBldr.AppendLine("             , D21.SCHEDATEPAYMENT                                                                      ")
        SQLBldr.AppendLine("             , D21.INVSUBCD                                                                             ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '01' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE01                                                                          ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '01' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01) + coalesce(D21.LEASEADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0) * (coalesce(D21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS TAXADDFEE01                                                                       ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '02' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE02                                                                          ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '02' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01) + coalesce(D21.LEASEADJUSTMENT,0) * (coalesce(D21.TAXRATE,0) * 0.01)            ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0) * (coalesce(D21.TAXRATE,0) * 0.01)     ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS TAXADDFEE02                                                                       ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '11' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE11                                                                          ")
        SQLBldr.AppendLine("             , CASE                                                                                     ")
        SQLBldr.AppendLine("                  WHEN D21.TAXKBN = '12' THEN                                                           ")
        SQLBldr.AppendLine("                      CASE D21.AMOUNTTYPE                                                               ")
        SQLBldr.AppendLine("                          WHEN '2' THEN coalesce(D21.RENTADJUSTMENT,0) + coalesce(D21.LEASEADJUSTMENT,0)    ")
        SQLBldr.AppendLine("                          WHEN '5' THEN coalesce(D21.MISCELLANEOUSEXPENSE,0)                              ")
        SQLBldr.AppendLine("                      END                                                                               ")
        SQLBldr.AppendLine("               END AS ADDFEE12                                                                          ")
        SQLBldr.AppendLine("         FROM                                                                                           ")
        SQLBldr.AppendLine("             LNG.LNT0080_INVOICEDATA_ADDAMOUNT D21                                                      ")
        SQLBldr.AppendLine("         WHERE                                                                                          ")
        SQLBldr.AppendLine("             D21.DELFLG = @P01                                                                          ")
        SQLBldr.AppendLine("         AND D21.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                    ")
        SQLBldr.AppendLine("         AND D21.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'        ")
        SQLBldr.AppendLine("         AND D21.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                  ")
        SQLBldr.AppendLine("         AND D21.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'      ")
        SQLBldr.AppendLine("         AND D21.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'         ")
        SQLBldr.AppendLine("         AND D21.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                    ")
        SQLBldr.AppendLine("         AND D21.INVOICETYPE = '2'                                                                      ")
        SQLBldr.AppendLine("         AND D21.INVOICEEXCLUSIONFLAG = '0'                                                             ")
        SQLBldr.AppendLine("    ) D11                                                                                               ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        D11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , D11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , D11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , D11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , D11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )D05                                                                                                ")
        SQLBldr.AppendLine("    ON D01.KEIJOYM = D05.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND D01.INVOICEORGCODE = D05.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND D01.TORICODE = D05.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND D01.SCHEDATEPAYMENT = D05.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND D01.INVSUBCD = D05.INVSUBCD                                                                     ")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) D06                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        D06.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求ヘッダ
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD D07                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.KEIJOYM = D07.KEIJOYM                                                                           ")
        SQLBldr.AppendLine("AND D01.INVOICENUMBER = D07.INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = D07.INVOICEORGCODE                                                             ")
        SQLBldr.AppendLine("AND D01.TORICODE = D07.TORICODE                                                                         ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION D08                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    D01.TORICODE = D08.TORICODE                                                                         ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = D08.INVFILINGDEPT                                                              ")
        SQLBldr.AppendLine("AND D08.INVSUBCD = D01.INVSUBCD                                                                         ")
        SQLBldr.AppendLine("AND D08.INVOICETYPE = '2'                                                                               ")
        SQLBldr.AppendLine("AND D08.DELFLG = @P01                                                                                   ")
        '抽出条件
        SQLBldr.AppendLine("WHERE                                                                                                   ")
        SQLBldr.AppendLine("    D01.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("AND D01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                             ")
        SQLBldr.AppendLine("AND D01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'                 ")
        SQLBldr.AppendLine("AND D01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                           ")
        SQLBldr.AppendLine("AND D01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'               ")
        SQLBldr.AppendLine("AND D01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                  ")
        SQLBldr.AppendLine("AND D01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                             ")
        SQLBldr.AppendLine("AND D01.INVOICETYPE = '2'                                                                               ")
        SQLBldr.AppendLine("AND D01.INVOICEEXCLUSIONFLAG = '0'                                                                      ")
        ' グルーピング条件
        SQLBldr.AppendLine("GROUP BY                                                                                                ")
        SQLBldr.AppendLine("    D01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,D01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,D01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,D01.SCHEDATEPAYMENT                                                                                 ")
        SQLBldr.AppendLine("   ,D01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INACCOUNTCD                                                                                     ")
        SQLBldr.AppendLine("   ,D01.CLOSINGDAY                                                                                      ")
        SQLBldr.AppendLine("   ,D01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,D01.DETAILS                                                                                         ")
        SQLBldr.AppendLine("   ,D01.SHIPYMD                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,D01.DEPSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.ARRSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D04.ADDFEE                                                                                          ")
        SQLBldr.AppendLine("   ,D05.ADDFEE01                                                                                        ")
        SQLBldr.AppendLine("   ,D05.TAXADDFEE01                                                                                     ")
        SQLBldr.AppendLine("   ,D05.ADDFEE02                                                                                        ")
        SQLBldr.AppendLine("   ,D05.TAXADDFEE02                                                                                     ")
        SQLBldr.AppendLine("   ,D05.ADDFEE11                                                                                        ")
        SQLBldr.AppendLine("   ,D05.ADDFEE12                                                                                        ")
        SQLBldr.AppendLine("   ,D06.STAFFNAMEL                                                                                      ")
        SQLBldr.AppendLine("   ,D07.PRINTDATE                                                                                       ")
        SQLBldr.AppendLine("   ,D07.HEADERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,D07.FOOTERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,D08.SLIPDESCRIPTION                                                                                 ")
        ' ソート条件
        SQLBldr.AppendLine("ORDER BY                                                                                                ")
        SQLBldr.AppendLine("    D01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,D01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,D01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,D01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,D01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,D01.DEPSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.ARRSTATION                                                                                      ")
        SQLBldr.AppendLine("   ,D01.SHIPYMD                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,D01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,D01.DETAILS                                                                                         ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 追加金額明細データ 検索処理(正式版請求連携用(リース料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectLeaseCsv_Add(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN A06.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(A06.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEORGCODE + '-'")
        SQLBldr.AppendLine("    + FORMAT(coalesce(A01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")                                  '請求仮番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN CAST(A01.KEIJOYM AS NVARCHAR) LIKE '%02' AND A01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          WHEN A01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          ELSE FORMAT(CAST(CAST((A01.KEIJOYM * 100)")
        SQLBldr.AppendLine("               + A01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付
        If CS0050SESSION.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + A01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE01,0), '0') AS 税抜金額")                                                                                         '税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.TAXADDFEE01,0), '0') AS 消費税")                                                                                        '消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE01,0) + coalesce(A04.TAXADDFEE01,0), '0') AS 税込金額")                                                             '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE02,0), '0') AS 経過措置税抜金額")                                                                                 '経過措置税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.TAXADDFEE02,0), '0') AS 経過措置消費税")                                                                                '経過措置消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE02,0) + coalesce(A04.TAXADDFEE02,0), '0') AS 経過措置税込金額")                                                     '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE11,0) + coalesce(A04.ADDFEE12,0), '0') AS 課税対象外金額")                                                          '課税対象外金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE01,0) + coalesce(A04.TAXADDFEE01,0) + coalesce(A04.ADDFEE02,0) + coalesce(A04.TAXADDFEE02,0) +")
        SQLBldr.AppendLine("	         coalesce(A04.ADDFEE11,0) + coalesce(A04.ADDFEE12,0), '0') AS 請求書合計金額")                                                          '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                   '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                   '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, A01.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                                                 '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , A05.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + A01.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("        WHEN CAST(A01.KEIJOYM AS NVARCHAR) LIKE '%02' AND A01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        WHEN A01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((A01.KEIJOYM * 100)")
        SQLBldr.AppendLine("             + A01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')")
        SQLBldr.AppendLine("      END + CASE")
        SQLBldr.AppendLine("             WHEN A07.SLIPDESCRIPTION IS NOT NULL THEN ' ' + A07.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(A06.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(A06.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'")
        SQLBldr.AppendLine("            END AS 宛名欄付記1")                                                                                                                '宛名欄付記1
        SQLBldr.AppendLine("    , '' AS 宛名欄付記2")                                                                                                                       '宛名欄付記2
        SQLBldr.AppendLine("    , '' AS 宛名欄付記3")                                                                                                                       '宛名欄付記3
        SQLBldr.AppendLine("    , A06.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '11' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , A01.DETAILS                                                      AS 品名                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(A01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          WHEN '7' THEN CAST(A01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                              AS コンテナ記号                  ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(A01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          WHEN '7' THEN CAST(A01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                              AS コンテナ番号                  ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN '0'                                                                             ")
        SQLBldr.AppendLine("          WHEN '5' THEN '1'                                                                             ")
        SQLBldr.AppendLine("      END                                                              AS 個数                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN MAX(coalesce(A02.CARGOWEIGHT,0))                                                  ")
        SQLBldr.AppendLine("          WHEN '7' THEN MAX(coalesce(A02.CARGOWEIGHT,0))                                                  ")
        SQLBldr.AppendLine("          ELSE 0                                                                                        ")
        SQLBldr.AppendLine("      END                                                              AS トン数                        ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN FORMAT(A01.LEASESTARTYMD, 'yyyy/M/d')                                           ")
        SQLBldr.AppendLine("          WHEN '7' THEN FORMAT(A01.LEASESTARTYMD, 'yyyy/M/d')                                           ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（自）'              ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN FORMAT(A01.LEASEENDYMD, 'yyyy/M/d')                                             ")
        SQLBldr.AppendLine("          WHEN '7' THEN FORMAT(A01.LEASEENDYMD, 'yyyy/M/d')                                             ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（至）'              ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN A01.LEASESTARTYMD IS NULL OR A01.LEASEENDYMD IS NULL                                     ")
        SQLBldr.AppendLine("          THEN 0                                                                                        ")
        SQLBldr.AppendLine("          WHEN A01.AMOUNTTYPE = '5'                                                                     ")
        SQLBldr.AppendLine("          THEN DATEDIFF(DAY, CONVERT(date, A01.LEASESTARTYMD),                                          ")
        SQLBldr.AppendLine("               DATEADD(DAY,1,CONVERT(date, A01.LEASEENDYMD)))                                           ")
        SQLBldr.AppendLine("          WHEN A01.AMOUNTTYPE = '7'                                                                     ")
        SQLBldr.AppendLine("          THEN DATEDIFF(DAY, CONVERT(date, A01.LEASESTARTYMD),                                          ")
        SQLBldr.AppendLine("               DATEADD(DAY,1,CONVERT(date, A01.LEASEENDYMD)))                                           ")
        SQLBldr.AppendLine("          ELSE 0                                                                                        ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（日数）'            ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 単価                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 金額                          ")
        SQLBldr.AppendLine("    , A01.TAXRATE                                                      AS 税率                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 品名の小計                    ")
        SQLBldr.AppendLine("    , MAX(SUBSTRING(A01.REMARKS,1,6))                                  AS 備考                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN REPLACE(TRIM(MAX(A03.KANJI1)),'　','') + 'コンテナ'                             ")
        SQLBldr.AppendLine("          WHEN '7' THEN REPLACE(TRIM(MAX(A03.KANJI1)),'　','') + 'コンテナ'                             ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS LK65                          ")
        SQLBldr.AppendLine("    , ''                                                               AS 単位                          ")
        SQLBldr.AppendLine("　  ,CASE  WHEN A01.TAXKBN = '01' THEN '標準税率10%'                                                    ")
        SQLBldr.AppendLine("	　     WHEN A01.TAXKBN = '02' THEN '経過措置税率8％'                                                ")
        SQLBldr.AppendLine("	 　    WHEN A01.TAXKBN = '11' THEN '非課税'                                                         ")
        SQLBldr.AppendLine("	 　    WHEN A01.TAXKBN = '12' THEN '不課税'  END                   AS 請求書用税区分名              ")
        SQLBldr.AppendLine("FROM                                                                                                    ")
        'メイン 請求追加金額明細データ
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT A01                                                               ")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("LEFT JOIN LNG.LNM0002_RECONM A02                                                                        ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A02.CTNTYPE     = A01.CTNTYPE                                                                       ")
        SQLBldr.AppendLine("AND A02.CTNNO       = A01.CTNNO                                                                         ")
        SQLBldr.AppendLine("")
        '[結合テーブル]大中小分類マスタ
        SQLBldr.AppendLine("LEFT JOIN LNG.LNM0022_CLASS A03                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A03.BIGCTNCD    = A02.BIGCTNCD                                                                      ")
        SQLBldr.AppendLine("AND A03.MIDDLECTNCD = A02.MIDDLECTNCD                                                                   ")
        SQLBldr.AppendLine("AND A03.SMALLCTNCD  = A02.SMALLCTNCD                                                                    ")
        SQLBldr.AppendLine("AND A03.DELFLG      = '0'                                                                               ")
        '[結合テーブル]請求追加金額明細データ(合計額)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        A11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , A11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , A11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , A11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , A11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE01, 0)) AS ADDFEE01                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.TAXADDFEE01, 0)) AS TAXADDFEE01                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE02, 0)) AS ADDFEE02                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.TAXADDFEE02, 0)) AS TAXADDFEE02                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE11, 0)) AS ADDFEE11                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE12, 0)) AS ADDFEE12                                                      ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        (                                                                                               ")
        SQLBldr.AppendLine("         SELECT                                                                                         ")
        SQLBldr.AppendLine("             A21.KEIJOYM                                                                                ")
        SQLBldr.AppendLine("             , A21.INVOICEORGCODE                                                                       ")
        SQLBldr.AppendLine("             , A21.TORICODE                                                                             ")
        SQLBldr.AppendLine("             , A21.SCHEDATEPAYMENT                                                                      ")
        SQLBldr.AppendLine("             , A21.INVSUBCD                                                                             ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '01' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                      WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)        ")
        SQLBldr.AppendLine("                      WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                  ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE01                                                                          ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '01' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01) + coalesce(A21.LEASEADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0) * (coalesce(A21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS TAXADDFEE01                                                                       ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '02' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)       ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                 ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE02                                                                          ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '02' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01) + coalesce(A21.LEASEADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01)        ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0) * (coalesce(A21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS TAXADDFEE02                                                                       ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '11' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)       ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                 ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE11                                                                          ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '12' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)       ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                 ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE12                                                                          ")
        SQLBldr.AppendLine("         FROM                                                                                           ")
        SQLBldr.AppendLine("             LNG.LNT0080_INVOICEDATA_ADDAMOUNT A21                                                      ")
        SQLBldr.AppendLine("         WHERE                                                                                          ")
        SQLBldr.AppendLine("             A21.DELFLG = @P01                                                                          ")
        SQLBldr.AppendLine("         AND A21.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                    ")
        SQLBldr.AppendLine("         AND A21.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'        ")
        SQLBldr.AppendLine("         AND A21.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                  ")
        SQLBldr.AppendLine("         AND A21.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'      ")
        SQLBldr.AppendLine("         AND A21.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'         ")
        SQLBldr.AppendLine("         AND A21.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                    ")
        SQLBldr.AppendLine("         AND A21.INVOICETYPE = '3'                                                                      ")
        SQLBldr.AppendLine("         AND A21.INVOICEEXCLUSIONFLAG = '0'                                                             ")
        SQLBldr.AppendLine("    ) A11                                                                                               ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        A11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , A11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , A11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , A11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , A11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )A04                                                                                                ")
        SQLBldr.AppendLine("    ON A01.KEIJOYM = A04.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = A04.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND A01.TORICODE = A04.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND A01.SCHEDATEPAYMENT = A04.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND A01.INVSUBCD = A04.INVSUBCD                                                                     ")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) A05                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        A05.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求ヘッダ
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD A06                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A01.KEIJOYM = A06.KEIJOYM                                                                           ")
        SQLBldr.AppendLine("AND A01.INVOICENUMBER = A06.INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = A06.INVOICEORGCODE                                                             ")
        SQLBldr.AppendLine("AND A01.TORICODE = A06.TORICODE                                                                         ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION A07                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A01.TORICODE = A07.TORICODE                                                                         ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = A07.INVFILINGDEPT                                                              ")
        SQLBldr.AppendLine("AND A07.INVSUBCD = A01.INVSUBCD                                                                         ")
        SQLBldr.AppendLine("AND A07.INVOICETYPE = '3'                                                                               ")
        SQLBldr.AppendLine("AND A07.DELFLG = @P01                                                                                   ")
        '抽出条件
        SQLBldr.AppendLine("WHERE                                                                                                   ")
        SQLBldr.AppendLine("    A01.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                             ")
        SQLBldr.AppendLine("AND A01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'                 ")
        SQLBldr.AppendLine("AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                           ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'               ")
        SQLBldr.AppendLine("AND A01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                  ")
        SQLBldr.AppendLine("AND A01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                             ")
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '3'                                                                               ")
        SQLBldr.AppendLine("AND A01.INVOICEEXCLUSIONFLAG = '0'                                                                      ")
        ' グルーピング条件
        SQLBldr.AppendLine("GROUP BY                                                                                                ")
        SQLBldr.AppendLine("    A01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,A01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,A01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,A01.SCHEDATEPAYMENT                                                                                 ")
        SQLBldr.AppendLine("   ,A01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INACCOUNTCD                                                                                     ")
        SQLBldr.AppendLine("   ,A01.CLOSINGDAY                                                                                      ")
        SQLBldr.AppendLine("   ,A01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,A01.DETAILS                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,A01.LEASESTARTYMD                                                                                   ")
        SQLBldr.AppendLine("   ,A01.LEASEENDYMD                                                                                     ")
        SQLBldr.AppendLine("   ,A01.TAXKBN                                                                                          ")
        SQLBldr.AppendLine("   ,A01.TAXRATE                                                                                         ")
        SQLBldr.AppendLine("   ,A04.ADDFEE01                                                                                        ")
        SQLBldr.AppendLine("   ,A04.TAXADDFEE01                                                                                     ")
        SQLBldr.AppendLine("   ,A04.ADDFEE02                                                                                        ")
        SQLBldr.AppendLine("   ,A04.TAXADDFEE02                                                                                     ")
        SQLBldr.AppendLine("   ,A04.ADDFEE11                                                                                        ")
        SQLBldr.AppendLine("   ,A04.ADDFEE12                                                                                        ")
        SQLBldr.AppendLine("   ,A05.STAFFNAMEL                                                                                      ")
        SQLBldr.AppendLine("   ,A06.PRINTDATE                                                                                       ")
        SQLBldr.AppendLine("   ,A06.HEADERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,A06.FOOTERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,A07.SLIPDESCRIPTION                                                                                 ")
        ' ソート条件
        SQLBldr.AppendLine("ORDER BY                                                                                                ")
        SQLBldr.AppendLine("    A01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,A01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,A01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,A01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,A01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,A01.LEASESTARTYMD                                                                                   ")
        SQLBldr.AppendLine("   ,A01.DETAILS                                                                                         ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 追加金額明細データ 検索処理(ドラフト版請求連携用(リース料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftLeaseCsv_Add(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    CASE WHEN A06.PRINTDATE IS NOT NULL")
        SQLBldr.AppendLine("      THEN FORMAT(A06.PRINTDATE, 'yyyy/MM/dd') ")
        SQLBldr.AppendLine("      ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("    END AS 発行日")                                                                                                                             '発行日
        SQLBldr.AppendLine("    , A01.TORICODE + '-' + CAST(A01.KEIJOYM AS NVARCHAR) + '-' + A01.INVOICEORGCODE + '-'")
        SQLBldr.AppendLine("    + FORMAT(coalesce(A01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号")  '請求仮番号
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("          WHEN CAST(A01.KEIJOYM AS NVARCHAR) LIKE '%02' AND A01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          WHEN A01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("          THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("          ELSE FORMAT(CAST(CAST((A01.KEIJOYM * 100)")
        SQLBldr.AppendLine("               + A01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')")
        SQLBldr.AppendLine("      END AS 計上日付")                                                                                                                         '計上日付
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("    , '01' + '-' + A01.TORICODE + '-' + '1' AS 顧客コード")                                                                                 '顧客コード
        Else
            SQLBldr.AppendLine("    , '01-' + 'TestCust01' + '-1'           AS 顧客コード")
        End If
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE01,0), '0') AS 税抜金額")                                                                                         '税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.TAXADDFEE01,0), '0') AS 消費税")                                                                                        '消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE01,0) + coalesce(A04.TAXADDFEE01,0), '0') AS 税込金額")                                                             '税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE02,0), '0') AS 経過措置税抜金額")                                                                                 '経過措置税抜金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.TAXADDFEE02,0), '0') AS 経過措置消費税")                                                                                '経過措置消費税
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE02,0) + coalesce(A04.TAXADDFEE02,0), '0') AS 経過措置税込金額")                                                     '経過措置税込金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE11,0) + coalesce(A04.ADDFEE12,0), '0') AS 課税対象外金額")                                                          '課税対象外金額
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE01,0) + coalesce(A04.TAXADDFEE01,0) + coalesce(A04.ADDFEE02,0) + coalesce(A04.TAXADDFEE02,0) +")
        SQLBldr.AppendLine("	         coalesce(A04.ADDFEE11,0) + coalesce(A04.ADDFEE12,0), '0') AS 請求書合計金額")                                                          '請求書合計金額
        SQLBldr.AppendLine("    , 0 AS 免税売上小計")                                                                                                                       '免税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE11,0), '0') AS 非課税売上小計")                                                                                   '非課税売上小計
        SQLBldr.AppendLine("    , FORMAT(coalesce(A04.ADDFEE12,0), '0') AS 不課税売上小計")                                                                                   '不課税売上小計
        SQLBldr.AppendLine("    , CONVERT(NVARCHAR, A01.SCHEDATEPAYMENT, 111) AS '請求サイト（支払期日）'")                                                                 '請求サイト（支払期日）
        SQLBldr.AppendLine("    , '01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "' AS 発行部署コード")                                                   '発行部署コード
        SQLBldr.AppendLine("    , A05.STAFFNAMEL AS 発行担当者")                                                                                                            '発行担当者
        SQLBldr.AppendLine("    , '01-' + A01.INACCOUNTCD AS 請求入金銀行コード")                                                                                           '請求入金銀行コード
        SQLBldr.AppendLine("    , CASE")
        SQLBldr.AppendLine("        WHEN CAST(A01.KEIJOYM AS NVARCHAR) LIKE '%02' AND A01.CLOSINGDAY >= 29")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        WHEN A01.CLOSINGDAY >= 31")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((A01.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((A01.KEIJOYM * 100)")
        SQLBldr.AppendLine("             + A01.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')")
        SQLBldr.AppendLine("      END + CASE")
        SQLBldr.AppendLine("             WHEN A07.SLIPDESCRIPTION IS NOT NULL THEN ' ' + A07.SLIPDESCRIPTION")
        SQLBldr.AppendLine("             WHEN SUBSTRING(A06.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(A06.HEADERCOMMENT, 1, 32)")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'")
        SQLBldr.AppendLine("            END AS 宛名欄付記1")                                                                                                                '宛名欄付記1
        SQLBldr.AppendLine("    , '' AS 宛名欄付記2")                                                                                                                       '宛名欄付記2
        SQLBldr.AppendLine("    , '' AS 宛名欄付記3")                                                                                                                       '宛名欄付記3
        SQLBldr.AppendLine("    , A06.FOOTERCOMMENT AS 通信欄")                                                                                                             '通信欄
        SQLBldr.AppendLine("    , '21' AS 帳票種別")                                                                                                                        '帳票種別
        SQLBldr.AppendLine("    , A01.DETAILS                                                      AS 品名                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(A01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          WHEN '7' THEN CAST(A01.CTNTYPE AS nvarchar)                                                   ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                              AS コンテナ記号                  ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN CAST(A01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          WHEN '7' THEN CAST(A01.CTNNO AS nvarchar)                                                     ")
        SQLBldr.AppendLine("          ELSE ' '                                                                                      ")
        SQLBldr.AppendLine("      END                                                              AS コンテナ番号                  ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN '0'                                                                             ")
        SQLBldr.AppendLine("          WHEN '5' THEN '1'                                                                             ")
        SQLBldr.AppendLine("      END                                                              AS 個数                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN MAX(coalesce(A02.CARGOWEIGHT,0))                                                  ")
        SQLBldr.AppendLine("          WHEN '7' THEN MAX(coalesce(A02.CARGOWEIGHT,0))                                                  ")
        SQLBldr.AppendLine("          ELSE 0                                                                                        ")
        SQLBldr.AppendLine("      END                                                              AS トン数                        ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN FORMAT(A01.LEASESTARTYMD, 'yyyy/M/d')                                           ")
        SQLBldr.AppendLine("          WHEN '7' THEN FORMAT(A01.LEASESTARTYMD, 'yyyy/M/d')                                           ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（自）'              ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN FORMAT(A01.LEASEENDYMD, 'yyyy/M/d')                                             ")
        SQLBldr.AppendLine("          WHEN '7' THEN FORMAT(A01.LEASEENDYMD, 'yyyy/M/d')                                             ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（至）'              ")
        SQLBldr.AppendLine("    , CASE                                                                                              ")
        SQLBldr.AppendLine("          WHEN A01.LEASESTARTYMD IS NULL OR A01.LEASEENDYMD IS NULL                                     ")
        SQLBldr.AppendLine("          THEN 0                                                                                        ")
        SQLBldr.AppendLine("          WHEN A01.AMOUNTTYPE = '5'                                                                     ")
        SQLBldr.AppendLine("          THEN DATEDIFF(DAY, CONVERT(date, A01.LEASESTARTYMD),                                          ")
        SQLBldr.AppendLine("               DATEADD(DAY,1,CONVERT(date, A01.LEASEENDYMD)))                                           ")
        SQLBldr.AppendLine("          WHEN A01.AMOUNTTYPE = '7'                                                                     ")
        SQLBldr.AppendLine("          THEN DATEDIFF(DAY, CONVERT(date, A01.LEASESTARTYMD),                                          ")
        SQLBldr.AppendLine("               DATEADD(DAY,1,CONVERT(date, A01.LEASEENDYMD)))                                           ")
        SQLBldr.AppendLine("          ELSE 0                                                                                        ")
        SQLBldr.AppendLine("      END                                                              AS '使用期間（日数）'            ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 単価                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 金額                          ")
        SQLBldr.AppendLine("    , A01.TAXRATE                                                      AS 税率                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '2' THEN coalesce(SUM(A01.LEASEADJUSTMENT),0) + coalesce(SUM(A01.RENTADJUSTMENT),0)          ")
        SQLBldr.AppendLine("          WHEN '5' THEN coalesce(SUM(A01.MISCELLANEOUSEXPENSE),0)                                         ")
        SQLBldr.AppendLine("      END                                                              AS 品名の小計                    ")
        SQLBldr.AppendLine("    , MAX(SUBSTRING(A01.REMARKS,1,6))                                  AS 備考                          ")
        SQLBldr.AppendLine("    , CASE A01.AMOUNTTYPE                                                                               ")
        SQLBldr.AppendLine("          WHEN '5' THEN REPLACE(TRIM(MAX(A03.KANJI1)),'　','') + 'コンテナ'                             ")
        SQLBldr.AppendLine("          WHEN '7' THEN REPLACE(TRIM(MAX(A03.KANJI1)),'　','') + 'コンテナ'                             ")
        SQLBldr.AppendLine("          ELSE ''                                                                                       ")
        SQLBldr.AppendLine("      END                                                              AS LK65                          ")
        SQLBldr.AppendLine("    , ''                                                               AS 単位                          ")
        SQLBldr.AppendLine("　  ,CASE  WHEN A01.TAXKBN = '01' THEN '標準税率10%'                                                    ")
        SQLBldr.AppendLine("	　     WHEN A01.TAXKBN = '02' THEN '経過措置税率8％'                                                ")
        SQLBldr.AppendLine("	 　    WHEN A01.TAXKBN = '11' THEN '非課税'                                                         ")
        SQLBldr.AppendLine("	 　    WHEN A01.TAXKBN = '12' THEN '不課税'  END                   AS 請求書用税区分名              ")
        SQLBldr.AppendLine("FROM                                                                                                    ")
        'メイン 請求追加金額明細データ
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT A01                                                               ")
        '[結合テーブル]コンテナマスタ
        SQLBldr.AppendLine("LEFT JOIN LNG.LNM0002_RECONM A02                                                                        ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A02.CTNTYPE     = A01.CTNTYPE                                                                       ")
        SQLBldr.AppendLine("AND A02.CTNNO       = A01.CTNNO                                                                         ")
        SQLBldr.AppendLine("")
        '[結合テーブル]大中小分類マスタ
        SQLBldr.AppendLine("LEFT JOIN LNG.LNM0022_CLASS A03                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A03.BIGCTNCD    = A02.BIGCTNCD                                                                      ")
        SQLBldr.AppendLine("AND A03.MIDDLECTNCD = A02.MIDDLECTNCD                                                                   ")
        SQLBldr.AppendLine("AND A03.SMALLCTNCD  = A02.SMALLCTNCD                                                                    ")
        SQLBldr.AppendLine("AND A03.DELFLG      = '0'                                                                               ")
        '[結合テーブル]請求追加金額明細データ(合計額)
        SQLBldr.AppendLine("LEFT JOIN(                                                                                              ")
        SQLBldr.AppendLine("    SELECT                                                                                              ")
        SQLBldr.AppendLine("        A11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , A11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , A11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , A11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , A11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE01, 0)) AS ADDFEE01                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.TAXADDFEE01, 0)) AS TAXADDFEE01                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE02, 0)) AS ADDFEE02                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.TAXADDFEE02, 0)) AS TAXADDFEE02                                                ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE11, 0)) AS ADDFEE11                                                      ")
        SQLBldr.AppendLine("        , SUM(coalesce(A11.ADDFEE12, 0)) AS ADDFEE12                                                      ")
        SQLBldr.AppendLine("    FROM                                                                                                ")
        SQLBldr.AppendLine("        (                                                                                               ")
        SQLBldr.AppendLine("         SELECT                                                                                         ")
        SQLBldr.AppendLine("             A21.KEIJOYM                                                                                ")
        SQLBldr.AppendLine("             , A21.INVOICEORGCODE                                                                       ")
        SQLBldr.AppendLine("             , A21.TORICODE                                                                             ")
        SQLBldr.AppendLine("             , A21.SCHEDATEPAYMENT                                                                      ")
        SQLBldr.AppendLine("             , A21.INVSUBCD                                                                             ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '01' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                      WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)        ")
        SQLBldr.AppendLine("                      WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                  ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE01                                                                          ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '01' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01) + coalesce(A21.LEASEADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0) * (coalesce(A21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS TAXADDFEE01                                                                       ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '02' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)       ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                 ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE02                                                                          ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '02' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01) + coalesce(A21.LEASEADJUSTMENT,0) * (coalesce(A21.TAXRATE,0) * 0.01)        ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0) * (coalesce(A21.TAXRATE,0) * 0.01)")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS TAXADDFEE02                                                                       ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '11' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)       ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                 ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE11                                                                          ")
        SQLBldr.AppendLine("             , CASE WHEN A21.TAXKBN = '12' THEN                                                         ")
        SQLBldr.AppendLine("                   CASE A21.AMOUNTTYPE                                                                  ")
        SQLBldr.AppendLine("                       WHEN '2' THEN coalesce(A21.RENTADJUSTMENT,0) + coalesce(A21.LEASEADJUSTMENT,0)       ")
        SQLBldr.AppendLine("                       WHEN '5' THEN coalesce(A21.MISCELLANEOUSEXPENSE,0)                                 ")
        SQLBldr.AppendLine("                   END                                                                                  ")
        SQLBldr.AppendLine("               END AS ADDFEE12                                                                          ")
        SQLBldr.AppendLine("         FROM                                                                                           ")
        SQLBldr.AppendLine("             LNG.LNT0080_INVOICEDATA_ADDAMOUNT A21                                                      ")
        SQLBldr.AppendLine("         WHERE                                                                                          ")
        SQLBldr.AppendLine("             A21.DELFLG = @P01                                                                          ")
        SQLBldr.AppendLine("         AND A21.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                    ")
        SQLBldr.AppendLine("         AND A21.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'        ")
        SQLBldr.AppendLine("         AND A21.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                  ")
        SQLBldr.AppendLine("         AND A21.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'      ")
        SQLBldr.AppendLine("         AND A21.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'         ")
        SQLBldr.AppendLine("         AND A21.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                    ")
        SQLBldr.AppendLine("         AND A21.INVOICETYPE = '3'                                                                      ")
        SQLBldr.AppendLine("         AND A21.INVOICEEXCLUSIONFLAG = '0'                                                             ")
        SQLBldr.AppendLine("    ) A11                                                                                               ")
        SQLBldr.AppendLine("    GROUP BY                                                                                            ")
        SQLBldr.AppendLine("        A11.KEIJOYM                                                                                     ")
        SQLBldr.AppendLine("        , A11.INVOICEORGCODE                                                                            ")
        SQLBldr.AppendLine("        , A11.TORICODE                                                                                  ")
        SQLBldr.AppendLine("        , A11.SCHEDATEPAYMENT                                                                           ")
        SQLBldr.AppendLine("        , A11.INVSUBCD                                                                                  ")
        SQLBldr.AppendLine("    )A04                                                                                                ")
        SQLBldr.AppendLine("    ON A01.KEIJOYM = A04.KEIJOYM                                                                        ")
        SQLBldr.AppendLine("    AND A01.INVOICEORGCODE = A04.INVOICEORGCODE                                                         ")
        SQLBldr.AppendLine("    AND A01.TORICODE = A04.TORICODE                                                                     ")
        SQLBldr.AppendLine("    AND A01.SCHEDATEPAYMENT = A04.SCHEDATEPAYMENT                                                       ")
        SQLBldr.AppendLine("    AND A01.INVSUBCD = A04.INVSUBCD                                                                     ")
        '[結合テーブル]ユーザーマスタ
        SQLBldr.AppendLine("    LEFT JOIN(                                                                        ")
        SQLBldr.AppendLine("        SELECT TOP(1)                                                                 ")
        SQLBldr.AppendLine("            T1.USERID                                                                 ")
        SQLBldr.AppendLine("           ,T1.STAFFNAMEL                                                             ")
        SQLBldr.AppendLine("        FROM                                                                          ")
        SQLBldr.AppendLine("            COM.LNS0001_USER T1                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                         ")
        SQLBldr.AppendLine("            T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "' ")
        SQLBldr.AppendLine("        AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'        ")
        SQLBldr.AppendLine("        AND T1.DELFLG  = @P01                                                         ")
        SQLBldr.AppendLine("        ORDER BY                                                                      ")
        SQLBldr.AppendLine("            T1.STYMD DESC                                                             ")
        SQLBldr.AppendLine("    ) A05                                                                             ")
        SQLBldr.AppendLine("    ON                                                                                ")
        SQLBldr.AppendLine("        A05.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'    ")
        '[結合テーブル]請求ヘッダ
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD A06                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A01.KEIJOYM = A06.KEIJOYM                                                                           ")
        SQLBldr.AppendLine("AND A01.INVOICENUMBER = A06.INVOICENUMBER                                                               ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = A06.INVOICEORGCODE                                                             ")
        SQLBldr.AppendLine("AND A01.TORICODE = A06.TORICODE                                                                         ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION A07                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    A01.TORICODE = A07.TORICODE                                                                         ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = A07.INVFILINGDEPT                                                              ")
        SQLBldr.AppendLine("AND A07.INVSUBCD = A01.INVSUBCD                                                                         ")
        SQLBldr.AppendLine("AND A07.INVOICETYPE = '3'                                                                               ")
        SQLBldr.AppendLine("AND A07.DELFLG = @P01                                                                                   ")
        '抽出条件
        SQLBldr.AppendLine("WHERE                                                                                                   ")
        SQLBldr.AppendLine("    A01.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("AND A01.KEIJOYM = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                             ")
        SQLBldr.AppendLine("AND A01.INVOICENUMBER = '" & htParm(SELECT_INVOICE_COOP.SL_INVOICENUMBER).ToString & "'                 ")
        SQLBldr.AppendLine("AND A01.TORICODE = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                           ")
        SQLBldr.AppendLine("AND A01.INVOICEORGCODE = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'               ")
        SQLBldr.AppendLine("AND A01.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                  ")
        SQLBldr.AppendLine("AND A01.INVSUBCD = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                             ")
        SQLBldr.AppendLine("AND A01.INVOICETYPE = '3'                                                                               ")
        SQLBldr.AppendLine("AND A01.INVOICEEXCLUSIONFLAG = '0'                                                                      ")
        ' グルーピング条件
        SQLBldr.AppendLine("GROUP BY                                                                                                ")
        SQLBldr.AppendLine("    A01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,A01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,A01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,A01.SCHEDATEPAYMENT                                                                                 ")
        SQLBldr.AppendLine("   ,A01.INVSUBCD                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INACCOUNTCD                                                                                     ")
        SQLBldr.AppendLine("   ,A01.CLOSINGDAY                                                                                      ")
        SQLBldr.AppendLine("   ,A01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,A01.DETAILS                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,A01.LEASESTARTYMD                                                                                   ")
        SQLBldr.AppendLine("   ,A01.LEASEENDYMD                                                                                     ")
        SQLBldr.AppendLine("   ,A01.TAXKBN                                                                                          ")
        SQLBldr.AppendLine("   ,A01.TAXRATE                                                                                         ")
        SQLBldr.AppendLine("   ,A04.ADDFEE01                                                                                        ")
        SQLBldr.AppendLine("   ,A04.TAXADDFEE01                                                                                     ")
        SQLBldr.AppendLine("   ,A04.ADDFEE02                                                                                        ")
        SQLBldr.AppendLine("   ,A04.TAXADDFEE02                                                                                     ")
        SQLBldr.AppendLine("   ,A04.ADDFEE11                                                                                        ")
        SQLBldr.AppendLine("   ,A04.ADDFEE12                                                                                        ")
        SQLBldr.AppendLine("   ,A05.STAFFNAMEL                                                                                      ")
        SQLBldr.AppendLine("   ,A06.PRINTDATE                                                                                       ")
        SQLBldr.AppendLine("   ,A06.HEADERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,A06.FOOTERCOMMENT                                                                                   ")
        SQLBldr.AppendLine("   ,A07.SLIPDESCRIPTION                                                                                 ")
        ' ソート条件
        SQLBldr.AppendLine("ORDER BY                                                                                                ")
        SQLBldr.AppendLine("    A01.KEIJOYM                                                                                         ")
        SQLBldr.AppendLine("   ,A01.INVOICENUMBER                                                                                   ")
        SQLBldr.AppendLine("   ,A01.TORICODE                                                                                        ")
        SQLBldr.AppendLine("   ,A01.INVOICEORGCODE                                                                                  ")
        SQLBldr.AppendLine("   ,A01.AMOUNTTYPE                                                                                      ")
        SQLBldr.AppendLine("   ,A01.CTNTYPE                                                                                         ")
        SQLBldr.AppendLine("   ,A01.CTNNO                                                                                           ")
        SQLBldr.AppendLine("   ,A01.LEASESTARTYMD                                                                                   ")
        SQLBldr.AppendLine("   ,A01.DETAILS                                                                                         ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' その他(明細有り)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectDraftOtherOnDetailCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 その他(明細有り)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + '4'    AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                          ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                      ")
        SQLBldr.AppendLine("             + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額   　　　　　　 ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T2.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T13.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T13.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,4                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN coalesce(T8.DUMMYKBN, '00') = '01' THEN '加減額'                                                                           ")
        SQLBldr.AppendLine("        WHEN coalesce(T2.MANAGEFEE,0) <> 0 THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                           ")
        SQLBldr.AppendLine("        WHEN coalesce(T2.SHIPBURDENFEE,0) <> 0 THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                       ")
        SQLBldr.AppendLine("        WHEN coalesce(T2.PICKUPFEE,0) <> 0 THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                           ")
        SQLBldr.AppendLine("        ELSE '使用料'                                                                                                                 ")
        SQLBldr.AppendLine("    END                                                                                                    AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T2.SHIPYMD IS NOT NULL                                                                                                   ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.SHIPYMD, 'yyyy/MM/dd'), '')                                                                             ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        SQLBldr.AppendLine("   ,FORMAT((coalesce(T2.BILLINGFEE, 0)), '0')                                                                AS 単価                    ")
        SQLBldr.AppendLine("   ,FORMAT((coalesce(T2.BILLINGFEE, 0)), '0')                                                                AS 金額                    ")
        SQLBldr.AppendLine("   ,T2.TAXRATE                                                                                             AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単位                    ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T2.TAXRATE = 10 THEN '標準税率10%'                                                                                       ")
        SQLBldr.AppendLine("        WHEN T2.TAXRATE =  8 THEN '経過措置税率8％'                                                                                   ")
        SQLBldr.AppendLine("        WHEN T2.TAXRATE =  0 THEN '非課税'                                                                                            ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0067_INVOICEDATA_RENT T2                                                                                                   ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("AND T2.INVOICETYPE   = T1.INVOICETYPE                                                                                                 ")
        SQLBldr.AppendLine("AND T2.BILLINGFEE <> 0                                                                                                                ")
        SQLBldr.AppendLine("AND T2.INVOICEEXCLUSIONFLAG = '0'                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("		        END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)    ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0002_RECONM T8                                                                                                     ")
        SQLBldr.AppendLine("    ON T8.CTNTYPE = T2.CTNTYPE                                                                                                        ")
        SQLBldr.AppendLine("    AND T8.CTNNO = T2.CTNNO                                                                                                           ")
        SQLBldr.AppendLine("    AND T8.DELFLG = @P01                                                                                                              ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                             ")
        SQLBldr.AppendLine("    LNG.LNT0017_RESSNF T12                                                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                                                     ")
        SQLBldr.AppendLine("    T12.KEIJOYM            = T2.KEIJOYM                                                                                                ")
        SQLBldr.AppendLine("AND T12.SHIPYMD            = T2.SHIPYMD                                                                                                ")
        SQLBldr.AppendLine("AND T12.CTNTYPE            = T2.CTNTYPE                                                                                                ")
        SQLBldr.AppendLine("AND T12.CTNNO              = T2.CTNNO                                                                                                  ")
        SQLBldr.AppendLine("AND T12.SAMEDAYCNT         = T2.SAMEDAYCNT                                                                                             ")
        SQLBldr.AppendLine("AND T12.CTNLINENO          = T2.CTNLINENO                                                                                              ")
        SQLBldr.AppendLine("AND T12.TORICODE           = T2.TORICODE                                                                                               ")
        SQLBldr.AppendLine("AND T12.INVFILINGDEPT      = T2.INVOICEORGCODE                                                                                         ")
        SQLBldr.AppendLine("AND T12.SCHEDATEPAYMENT    = T1.SCHEDATEPAYMENT                                                                                        ")
        SQLBldr.AppendLine("AND T12.DELFLG             = @P01                                                                                                      ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T13                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T13.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T13.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T13.INVSUBCD = T12.INVSUBCD                                                                         ")
        SQLBldr.AppendLine("AND T13.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T13.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
        SQLBldr.AppendLine("UNION ALL                                                                                                                             ")
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + 4      AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ") '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("        WHEN coalesce(T3.CLOSINGDAYKBN,'0') = '0' THEN                                                                                  ") '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("            CASE                                                                                                                      ") '2024/09/10 伊藤 CHG START
        SQLBldr.AppendLine("                WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                  ")
        SQLBldr.AppendLine("                THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                          ")
        SQLBldr.AppendLine("                WHEN T1.CLOSINGDAY >= 31                                                                                              ")
        SQLBldr.AppendLine("                THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                          ")
        SQLBldr.AppendLine("                ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                              ")
        SQLBldr.AppendLine("                     + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                             ")
        SQLBldr.AppendLine("            END                                                                                                                       ") '2024/09/10 伊藤 CHG END
        SQLBldr.AppendLine("        WHEN coalesce(T3.CLOSINGDAYKBN,'0') = '1' THEN T3.LEASEMONTHSTARTYMD                                                            ") '2024/09/10 伊藤 ADD
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ") '2024/09/10 伊藤 CHG
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) +ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * T3.TAXRATE / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                      ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T12.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,4                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                                          AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,1                                                                                                      AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T2.LEASESTARTYMD IS NOT NULL                                                                                             ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASESTARTYMD, 'yyyy/MM/dd'), '')                                                                       ")
        SQLBldr.AppendLine("        WHEN T2.LEASEENDYMD IS NOT NULL                                                                                               ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASEENDYMD, 'yyyy/MM/dd'), '')                                                                         ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        SQLBldr.AppendLine("   ,FORMAT(T2.MONTHLEASEFEE, '0')                                                                          AS 単価                    ")
        SQLBldr.AppendLine("   ,FORMAT(T2.MONTHLEASEFEE, '0')                                                                          AS 金額                    ")
        SQLBldr.AppendLine("   ,T3.TAXRATE                                                                                             AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単位                    ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T3.TAXRATE = 10 THEN '標準税率10%'                                                                                       ")
        SQLBldr.AppendLine("        WHEN T3.TAXRATE =  8 THEN '経過措置税率8％'                                                                                   ")
        SQLBldr.AppendLine("        WHEN T3.TAXRATE =  0 THEN '非課税'                                                                                            ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0068_INVOICEDATA_LEASE T2                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("AND T2.INVOICETYPE   = T1.INVOICETYPE                                                                                                 ")
        SQLBldr.AppendLine("AND T2.INVOICEEXCLUSIONFLAG = '0'                                                                                                     ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0042_LEASEDATA T3                                                                                                          ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T3.KEIJOYM            = T2.KEIJOYM                                                                                                ")
        SQLBldr.AppendLine("AND T3.LEASENO            = T2.LEASENO                                                                                                ")
        SQLBldr.AppendLine("AND T3.CTNTYPE            = T2.CTNTYPE                                                                                                ")
        SQLBldr.AppendLine("AND T3.CTNNO              = T2.CTNNO                                                                                                  ")
        SQLBldr.AppendLine("AND T3.LEASEMONTHSTARTYMD = T2.LEASEMONTHSTARTYMD                                                                                     ")
        SQLBldr.AppendLine("AND T3.TORICODE           = T2.TORICODE                                                                                               ")
        SQLBldr.AppendLine("AND T3.INVOICEOUTORGCD    = T2.INVOICEORGCODE                                                                                         ")
        SQLBldr.AppendLine("AND T3.DEPOSITYMD         = T1.SCHEDATEPAYMENT                                                                                        ")
        SQLBldr.AppendLine("AND T3.DELFLG             = @P01                                                                                                      ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("		        END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX01             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T12                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T12.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T12.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T12.INVSUBCD = T3.INVSUBCD                                                                          ")
        SQLBldr.AppendLine("AND T12.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T12.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
        SQLBldr.AppendLine("UNION ALL                                                                                                                             ")
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + 4      AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                          ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                      ")
        SQLBldr.AppendLine("             + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                                       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')      ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                                       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')      ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                               ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                      ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T12.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,4                                                                                                      AS 帳票種別                ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.ACCOUNTCODE = '41010101' AND T2.CTNTYPE IS NOT NULL AND T2.CTNNO IS NOT NULL                     ")
        SQLBldr.AppendLine("        THEN T2.CTNTYPE + '-' + CAST(T2.CTNNO AS nvarchar)                                                                            ")
        SQLBldr.AppendLine("        ELSE coalesce(T2.DETAILS, '')                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,CASE WHEN coalesce(T2.QUANTITY,'0') = '0' THEN                                                                                      ")
        SQLBldr.AppendLine("        CASE                                                                                                                          ")
        SQLBldr.AppendLine("            WHEN AMOUNTTYPE = '2' THEN NULL                                                                                           ")
        SQLBldr.AppendLine("            WHEN AMOUNTTYPE = '5' THEN '1'                                                                                            ")
        SQLBldr.AppendLine("        END                                                                                                                           ")
        SQLBldr.AppendLine("	ELSE                                                                                                                              ")
        SQLBldr.AppendLine("	    coalesce(T2.QUANTITY,'0')                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.SHIPYMD IS NOT NULL                                                                              ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.SHIPYMD, 'yyyy/MM/dd'), '')                                                                             ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.LEASESTARTYMD IS NOT NULL                                                                        ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASESTARTYMD, 'yyyy/MM/dd'), '')                                                                       ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' AND T2.LEASEENDYMD IS NOT NULL                                                                          ")
        SQLBldr.AppendLine("        THEN coalesce(FORMAT(T2.LEASEENDYMD, 'yyyy/MM/dd'), '')                                                                         ")
        SQLBldr.AppendLine("        ELSE FORMAT(EOMONTH(CAST((T2.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("    END                                                                                                    AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        'SQLBldr.AppendLine("   ,CASE                                                                                                                              ")                            2024/09/06 伊藤 DEL START
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '1' THEN FORMAT(T2.RENTALINCENTIVE, '0')                                                                    ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '3' THEN FORMAT(T2.RENTALATEFEE, '0')                                                                       ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '4' THEN FORMAT(T2.RENTSUBSCADJUST, '0')                                                                    ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' THEN FORMAT(T2.MISCELLANEOUSEXPENSE, '0')                                                               ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '6' THEN FORMAT(T2.WRITEFEE, '0')                                                                           ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '7' THEN FORMAT(T2.SPOTLEASEFEE, '0')                                                                       ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '8' THEN FORMAT(T2.FIXEDFEE, '0')                                                                           ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.RENTADJUSTMENT IS NOT NULL                                                                       ")
        'SQLBldr.AppendLine("        THEN FORMAT(T2.RENTADJUSTMENT, '0')                                                                                           ")
        'SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.LEASEADJUSTMENT IS NOT NULL                                                                      ")
        'SQLBldr.AppendLine("        THEN FORMAT(T2.LEASEADJUSTMENT, '0')                                                                                          ")
        'SQLBldr.AppendLine("    END / CASE                                                                                                                        ") '2024/09/05 伊藤 CHG
        'SQLBldr.AppendLine("			  WHEN coalesce(T2.QUANTITY,0) = 0 THEN 1                                                                                    ") '2024/09/05 伊藤 ADD START
        'SQLBldr.AppendLine("              ELSE coalesce(T2.QUANTITY,0)                                                                                              ")
        'SQLBldr.AppendLine("          END                                                                                                   AS 単価               ") '2024/09/05 伊藤 ADD END   2024/09/06 伊藤 DEL END
        SQLBldr.AppendLine("   ,FORMAT(T2.UNITPRICE, '0')                                                                                   AS 単価               ") '2024/09/06 伊藤 ADD
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '1' THEN FORMAT(T2.RENTALINCENTIVE, '0')                                                                    ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '3' THEN FORMAT(T2.RENTALATEFEE, '0')                                                                       ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '4' THEN FORMAT(T2.RENTSUBSCADJUST, '0')                                                                    ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '5' THEN FORMAT(T2.MISCELLANEOUSEXPENSE, '0')                                                               ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '6' THEN FORMAT(T2.WRITEFEE, '0')                                                                           ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '7' THEN FORMAT(T2.SPOTLEASEFEE, '0')                                                                       ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '8' THEN FORMAT(T2.FIXEDFEE, '0')                                                                           ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.RENTADJUSTMENT IS NOT NULL                                                                       ")
        SQLBldr.AppendLine("        THEN FORMAT(T2.RENTADJUSTMENT, '0')                                                                                           ")
        SQLBldr.AppendLine("        WHEN AMOUNTTYPE = '2' AND T2.LEASEADJUSTMENT IS NOT NULL                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(T2.LEASEADJUSTMENT, '0')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 金額                    ")
        SQLBldr.AppendLine("   ,T2.TAXRATE                                                                                             AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,CASE T2.INVOICETYPE                                                                                                               ")
        SQLBldr.AppendLine("        WHEN '4' THEN coalesce(T2.UNITNAME, '')                                                                                         ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 単位                    ")
        SQLBldr.AppendLine("   ,CASE  WHEN T2.TAXKBN = '01' THEN '標準税率10%'                                                                                    ")
        SQLBldr.AppendLine("		  WHEN T2.TAXKBN = '02' THEN '経過措置税率8％'                                                                                ")
        SQLBldr.AppendLine("		  WHEN T2.TAXKBN = '11' THEN '非課税'                                                                                         ")
        SQLBldr.AppendLine("		  WHEN T2.TAXKBN = '12' THEN '不課税'  END                                                         AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                            ")
        SQLBldr.AppendLine("    LNG.LNT0080_INVOICEDATA_ADDAMOUNT T2                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T2.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("AND T2.INVOICETYPE   = T1.INVOICETYPE                                                                                                 ")
        SQLBldr.AppendLine("AND T2.INVOICEEXCLUSIONFLAG = '0'                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX01             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)    ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T12                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T12.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T12.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T12.INVSUBCD = '0'                                                                                  ")
        SQLBldr.AppendLine("AND T12.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T12.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' その他(明細無し)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectDraftOtherOnDetailCsv_NoDetail(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 その他(明細無し)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                ")
        SQLBldr.AppendLine("    CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.PRINTDATE IS NOT NULL                                                                                                 ")
        SQLBldr.AppendLine("        THEN FORMAT(T1.PRINTDATE, 'yyyy/MM/dd')                                                                                       ")
        SQLBldr.AppendLine("        ELSE FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                          ")
        SQLBldr.AppendLine("    END                                                                                                    AS 発行日                  ")
        'SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE + '-' + '00' + '-' + '4'    AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                        ")
        SQLBldr.AppendLine("    + '-' + '0' + CAST(T1.INVOICENUMBER AS NVARCHAR)                                                       AS 請求仮番号              ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                          ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                      ")
        SQLBldr.AppendLine("             + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0), '0')                      AS 税抜金額                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')                                       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                  ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0), '0')      ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT_RENT, 0) + coalesce(T4.TAXAMOUNT_LEASE, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT02, 0), '0')                                AS 経過措置税抜金額        ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0), '0')                                        ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.TAXAMOUNT, 0), '0')                                                                  ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0), '0')       ")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                                 ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + coalesce(T4.TAXAMOUNT02, 0) + coalesce(T4.AMOUNTWITHOUTTAX02, 0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0) + coalesce(T4.TAXAMOUNT12, 0), '0')   AS 課税対象外金額          ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                    ")
        SQLBldr.AppendLine("            THEN (CASE T11.TAXCALCULATION                                                                                             ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T4.AMOUNTWITHOUTTAX,0) * 10 / 100, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0), '0')")
        SQLBldr.AppendLine("   	              WHEN '2' THEN FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.TAXAMOUNT, 0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + coalesce(T5.TAXAMOUNT, 0), '0')                      ")
        SQLBldr.AppendLine("   	        END)                                                                                                                      ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T4.AMOUNTWITHOUTTAX, 0) + coalesce(T4.ADDAMOUNTWITHOUTTAX01, 0) + coalesce(T4.TAXADDAMOUNT01,0) + coalesce(T4.TAXAMOUNT_RENT,0) + coalesce(T4.TAXAMOUNT_LEASE,0) + coalesce(T5.AMOUNTWITHOUTTAX, 0) + ROUND(coalesce(T5.AMOUNTWITHOUTTAX,0) * 8 / 100, 0) + ")
        SQLBldr.AppendLine("		             coalesce(T4.AMOUNTWITHOUTTAX02, 0) + coalesce(T4.TAXAMOUNT02,0) + coalesce(T4.TAXAMOUNT11,0) + coalesce(T4.TAXAMOUNT12,0), '0')")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額          ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T6.NONTAXABLEAMOUNTS, 0) + coalesce(T4.TAXAMOUNT11, 0), '0')                               AS 非課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(T4.TAXAMOUNT12, 0)                                                                              AS 不課税売上小計          ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS '請求サイト(支払期日)'  ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行部署コード          ")
        SQLBldr.AppendLine("   ,T7.STAFFNAMEL                                                                                          AS 発行担当者              ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード      ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                              ")
        SQLBldr.AppendLine("      WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                            ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      WHEN T1.CLOSINGDAY >= 31                                                                                                        ")
        SQLBldr.AppendLine("      THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                   ")
        SQLBldr.AppendLine("      ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100)                                                                                        ")
        SQLBldr.AppendLine("           + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                                      ")
        SQLBldr.AppendLine("      END + CASE                                                                                                                      ")
        SQLBldr.AppendLine("             WHEN T12.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T12.SLIPDESCRIPTION                                                      ")
        SQLBldr.AppendLine("             WHEN SUBSTRING(T1.HEADERCOMMENT, 1, 32) <> '' THEN ' ' + SUBSTRING(T1.HEADERCOMMENT, 1, 32)                              ")
        SQLBldr.AppendLine("             ELSE ''                                                                                                                  ")
        SQLBldr.AppendLine("            END                                                                                            AS 宛名欄付記1             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記2             ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 宛名欄付記3             ")
        SQLBldr.AppendLine("   ,T1.FOOTERCOMMENT                                                                                       AS 通信欄                  ")
        SQLBldr.AppendLine("   ,13                                                                                                     AS 帳票種別                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ記号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS コンテナ番号            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 個数                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS トン数                  ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(自)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(至)'          ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS '使用期間(日数)'        ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単価                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 金額                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 税率                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 品名の小計              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 備考                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS LK65                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 単位                    ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 請求書用税区分名        ")
        SQLBldr.AppendLine("FROM                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0064_INVOICEHEAD T1                                                                                                        ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.1), 0))                                                         AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_RENT)                                                                             AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXAMOUNT_LEASE)                                                                            AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTWITHOUTTAX01)                                                                      AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("       ,SUM(T1.ADDAMOUNTTAX01)                                                                             AS TAXADDAMOUNT01          ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX02)                                                                                AS TAXAMOUNT02             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX02)                                                                         AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX11)                                                                                AS TAXAMOUNT11             ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTTAX12)                                                                                AS TAXAMOUNT12             ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,ROUND((T1.BILLINGFEE * 0.1), 0)                                                                AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,ROUND(coalesce(T1.MONTHLEASEFEE, 0) * (T3.TAXRATE * 0.01), 0)                                    AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTWITHOUTTAX01   ")
        SQLBldr.AppendLine("           ,0                                                                                              AS ADDAMOUNTTAX01          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX11             ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTTAX12             ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 10                                                                                                     ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,0                                                                                              AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_RENT          ")
        SQLBldr.AppendLine("           ,0                                                                                              AS TAXAMOUNT_LEASE         ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                         ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                       ")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX01      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '01' THEN                                                                                           ")
        SQLBldr.AppendLine("                CASE                                                                                                                  ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                          ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                     ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                                 ")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("                    WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("				END                                                                                                                   ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX01             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX02      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '02' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN ROUND(coalesce(T1.RENTALINCENTIVE, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN ROUND(coalesce(T1.RENTALATEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN ROUND(coalesce(T1.RENTSUBSCADJUST, 0) * (T1.TAXRATE * 0.01), 0)                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN ROUND(coalesce(T1.MISCELLANEOUSEXPENSE, 0) * (T1.TAXRATE * 0.01), 0)                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN ROUND(coalesce(T1.WRITEFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN ROUND(coalesce(T1.SPOTLEASEFEE, 0) * (T1.TAXRATE * 0.01), 0)                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN ROUND(coalesce(T1.FIXEDFEE, 0) * (T1.TAXRATE * 0.01), 0)                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.RENTADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)  ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN ROUND(coalesce(T1.LEASEADJUSTMENT, 0) * (T1.TAXRATE * 0.01), 0)")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTTAX02             ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '11' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX11      ")
        SQLBldr.AppendLine("           ,CASE WHEN T1.TAXKBN = '12' THEN                                                                                           ")
        SQLBldr.AppendLine("		            CASE                                                                                                              ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '1' THEN coalesce(T1.RENTALINCENTIVE, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '3' THEN coalesce(T1.RENTALATEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '4' THEN coalesce(T1.RENTSUBSCADJUST, 0)                                                      ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '5' THEN coalesce(T1.MISCELLANEOUSEXPENSE, 0)                                                 ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '6' THEN coalesce(T1.WRITEFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '7' THEN coalesce(T1.SPOTLEASEFEE, 0)                                                         ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '8' THEN coalesce(T1.FIXEDFEE, 0)                                                             ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.RENTADJUSTMENT IS NOT NULL THEN coalesce(T1.RENTADJUSTMENT, 0)                     ")
        SQLBldr.AppendLine("                        WHEN AMOUNTTYPE = '2' AND T1.LEASEADJUSTMENT IS NOT NULL THEN coalesce(T1.LEASEADJUSTMENT, 0)                   ")
        SQLBldr.AppendLine("					END                                                                                                               ")
        SQLBldr.AppendLine("            END                                                                                            AS AMOUNTWITHOUTTAX12      ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT T1                                                                                      ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T4                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T4.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT                                                                                                                            ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                                           AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.AMOUNTWITHOUTTAX * 0.08), 0))                                                        AS TAXAMOUNT               ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.08, 0)                               AS AMOUNTINCLUDINGTAX      ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS AMOUNTWITHOUTTAX        ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 8                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T5                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T5.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                     ")
        SQLBldr.AppendLine("    SELECT TOP 1                                                                                                                      ")
        SQLBldr.AppendLine("        T1.INVOICENUMBER                                                                                   AS INVOICENUMBER           ")
        SQLBldr.AppendLine("       ,SUM(coalesce(T1.NONTAXABLEAMOUNTS, 0))                                                               AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("    FROM (                                                                                                                            ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.BILLINGFEE, 0)                                                                       AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT T1                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T1.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                     ")
        SQLBldr.AppendLine("        SELECT                                                                                                                        ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER                                                                               AS INVOICENUMBER           ")
        SQLBldr.AppendLine("           ,coalesce(T1.MONTHLEASEFEE, 0)                                                                    AS NONTAXABLEAMOUNTS       ")
        SQLBldr.AppendLine("        FROM                                                                                                                          ")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE T1                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0064_INVOICEHEAD T2                                                                                                ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T2.KEIJOYM         = T1.KEIJOYM                                                                                           ")
        SQLBldr.AppendLine("        AND T2.INVOICENUMBER   = T1.INVOICENUMBER                                                                                     ")
        SQLBldr.AppendLine("        AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("        AND T2.TORICODE        = T1.TORICODE                                                                                          ")
        SQLBldr.AppendLine("        INNER JOIN                                                                                                                    ")
        SQLBldr.AppendLine("            LNG.LNT0042_LEASEDATA T3                                                                                                  ")
        SQLBldr.AppendLine("        ON                                                                                                                            ")
        SQLBldr.AppendLine("            T3.KEIJOYM            = T1.KEIJOYM                                                                                        ")
        SQLBldr.AppendLine("        AND T3.LEASENO            = T1.LEASENO                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNTYPE            = T1.CTNTYPE                                                                                        ")
        SQLBldr.AppendLine("        AND T3.CTNNO              = T1.CTNNO                                                                                          ")
        SQLBldr.AppendLine("        AND T3.LEASEMONTHSTARTYMD = T1.LEASEMONTHSTARTYMD                                                                             ")
        SQLBldr.AppendLine("        AND T3.TORICODE           = T1.TORICODE                                                                                       ")
        SQLBldr.AppendLine("        AND T3.INVOICEOUTORGCD    = T1.INVOICEORGCODE                                                                                 ")
        SQLBldr.AppendLine("        AND T3.DEPOSITYMD         = T2.SCHEDATEPAYMENT                                                                                ")
        SQLBldr.AppendLine("        AND T3.DELFLG             = @P01                                                                                              ")
        SQLBldr.AppendLine("        WHERE                                                                                                                         ")
        SQLBldr.AppendLine("            T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                          ")
        SQLBldr.AppendLine("        AND T3.TAXRATE       = 0                                                                                                      ")
        SQLBldr.AppendLine("        AND T1.INVOICETYPE   = '4'                                                                                                    ")
        SQLBldr.AppendLine("        AND T1.INVOICEEXCLUSIONFLAG = '0'                                                                                             ")
        SQLBldr.AppendLine("        AND T1.DELFLG        = @P01                                                                                                   ")
        SQLBldr.AppendLine("    )  T1                                                                                                                             ")
        SQLBldr.AppendLine("    GROUP BY T1.INVOICENUMBER                                                                                                         ")
        SQLBldr.AppendLine(")  T6                                                                                                                                 ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T6.INVOICENUMBER = T1.INVOICENUMBER                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                           ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                     ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                              ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                           ")
        SQLBldr.AppendLine("    WHERE                                                                                                                             ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                           ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                      ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                          ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                 ")
        SQLBldr.AppendLine(") T7                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                    ")
        SQLBldr.AppendLine("    T7.USERID  = '" & htParm(SELECT_SEIKYU_KEY.SP_USERID).ToString & "'                                                               ")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0017_RESSNF T19")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T19.KEIJOYM                 = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T19.TORICODE            = T1.TORICODE")
        SQLBldr.AppendLine("            AND T19.SCHEDATEPAYMENT     = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T19.INVFILINGDEPT       = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T19.JURISDICTIONCD      = '14'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTINGASSETSKBN = '1'")
        SQLBldr.AppendLine("            AND T19.ACCOUNTSTATUSKBN    <> '8'")
        SQLBldr.AppendLine("            AND T19.TOTALINCOME         <> 0")
        SQLBldr.AppendLine("            AND T19.DELFLG              = @P01")
        SQLBldr.AppendLine("    ) T9")
        SQLBldr.AppendLine("OUTER APPLY(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            TOP 1 T20.INVKESAIKBN")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T20")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("            T20.KEIJOYM             = T1.KEIJOYM")
        SQLBldr.AppendLine("            AND T20.TORICODE        = T1.TORICODE")
        SQLBldr.AppendLine("            AND T20.DEPOSITYMD      = T1.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("            AND T20.INVOICEOUTORGCD = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("            AND T20.LEASEAPPLYKBN   <> '2'")
        SQLBldr.AppendLine("            AND T20.DELFLG          = @P01")
        SQLBldr.AppendLine("    ) T10")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T11")
        SQLBldr.AppendLine("    ON  T11.TORICODE      = T1.TORICODE")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T1.INVOICEORGCODE")
        SQLBldr.AppendLine("    AND T11.INVKESAIKBN   = (CASE WHEN T9.INVKESAIKBN IS NOT NULL THEN T9.INVKESAIKBN")
        SQLBldr.AppendLine("                                WHEN T10.INVKESAIKBN IS NOT NULL THEN T10.INVKESAIKBN")
        SQLBldr.AppendLine("                                ELSE '1' END)")
        SQLBldr.AppendLine("LEFT JOIN                                                                                               ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T12                                                                     ")
        SQLBldr.AppendLine("ON                                                                                                      ")
        SQLBldr.AppendLine("    T1.TORICODE = T12.TORICODE                                                                          ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE = T12.INVFILINGDEPT                                                               ")
        SQLBldr.AppendLine("AND T12.INVSUBCD = '0'                                                                                  ")
        SQLBldr.AppendLine("AND T12.INVOICETYPE = '4'                                                                               ")
        SQLBldr.AppendLine("AND T12.DELFLG = @P01                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                 ")
        SQLBldr.AppendLine("    T1.INVOICENUMBER = '" & htParm(SELECT_SEIKYU_KEY.SP_INVOICENUMBER).ToString & "'                                                  ")
        SQLBldr.AppendLine("AND T1.INVOICETYPE   = '4'                                                                                                            ")
        SQLBldr.AppendLine("AND T1.DELFLG        = @P01                                                                                                           ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 売却コンテナ(明細有り)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectDraftCtnSaleOnDetailCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 売却コンテナ(明細有り)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                                            ")
        SQLBldr.AppendLine("    FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                        AS 発行日                                              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("    + '-' + '00' + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')       AS 請求仮番号                                          ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                             ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                                            ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust04' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.AMOUNTWITHOUTTAX, 0), '0')                                                            AS 税抜金額                                            ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T1.KEIJOYM <= 202306                                                                                                                                 ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.TAXAMOUNT, 0), '0')                                                                                              ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.DETAILTAXAMOUNT, 0), '0')                                                                                        ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T2.TAXAMOUNT, 0), '0')                                                                                                                 ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                                              ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.DETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                               ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0), '0')                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                                            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.OLDAMOUNTWITHOUTTAX, 0), '0')                                                         AS 経過措置税抜金額                                    ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.OLDTAXAMOUNT, 0), '0')                                                                                           ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.OLDDETAILTAXAMOUNT, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T2.OLDTAXAMOUNT, 0), '0')                                                                                                              ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                  ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.OLDDETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                            ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                                    ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額                                    ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.NONTAXABLEAMOUNTS, 0), '0')                                                           AS 課税対象外金額                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T5.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0) + coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T2.NONTAXABLEAMOUNTS, 0), '0')             ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T2.DETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T2.OLDDETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T2.NONTAXABLEAMOUNTS, 0), '0') ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T2.AMOUNTINCLUDINGTAX, 0) + coalesce(T2.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T2.NONTAXABLEAMOUNTS, 0), '0')                               ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額                                      ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計                                        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.TAXFREESALES, 0), '0')                                                                AS 非課税売上小計                                      ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T2.NONTAXABLESALES, 0), '0')                                                             AS 不課税売上小計                                      ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS 支払期日                                            ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行側部署コード                                    ")
        SQLBldr.AppendLine("   ,T3.STAFFNAMEL                                                                                          AS 発行担当者名                                        ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード                                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                            ")
        SQLBldr.AppendLine("    END + ' コンテナご購入代 ' + CAST(T2.CTNCOUNT AS NVARCHAR) + '個'                                      AS 見出しエリア1用フリーコメント１                     ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T6.SLIPDESCRIPTION IS NOT NULL THEN T6.SLIPDESCRIPTION                                                                                               ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 見出しエリア1用フリーコメント２                     ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 見出しエリア1用フリーコメント３                     ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS フッター用フリーコメント                            ")
        SQLBldr.AppendLine("   ,36                                                                                                     AS 帳票種別                                            ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SALESCONTRACTDATE, 'yyyy/MM/dd'), '')                                                 AS 日付                                                ")
        SQLBldr.AppendLine("   ,T1.CTNNO                                                                                               AS 内訳                                                ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.SORT1 = 1 THEN 1 ELSE 0 END                                                               AS 数量                                                ")
        SQLBldr.AppendLine("   ,FORMAT(T1.SALESAMOUNT, '0')                                                                            AS 本体価格                                            ")
        SQLBldr.AppendLine("   ,FORMAT(T1.POSTAGE, '0')                                                                                AS 送料                                                ")
        SQLBldr.AppendLine("   ,FORMAT(T1.CLEANINGFEE, '0')                                                                            AS 整備費                                              ")
        SQLBldr.AppendLine("   ,FORMAT(T1.MAINTENANCEFEE, '0')                                                                         AS 洗浄費                                              ")
        SQLBldr.AppendLine("   ,FORMAT(T1.OTHERFEE, '0')                                                                               AS その他                                              ")
        SQLBldr.AppendLine("   ,FORMAT(T1.TOTALAMOUNT, '0')                                                                            AS 合計                                                ")
        SQLBldr.AppendLine("   ,T1.TAXKBNNAME                                                                                          AS 請求書区分名                                        ")
        SQLBldr.AppendLine("FROM                                                                                                                                                              ")
        SQLBldr.AppendLine("(                                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                        ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                                ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                               ")
        SQLBldr.AppendLine("       ,T1.INVOICEORGCODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.SCHEDATEPAYMENT                                                                                                                                        ")
        SQLBldr.AppendLine("       ,T1.INVKESAIKBN                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.CLOSINGDAY                                                                                                                                             ")
        SQLBldr.AppendLine("       ,T1.INACCOUNTCD                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.CTNNO                                                                                                                                                  ")
        SQLBldr.AppendLine("       ,ROW_NUMBER() OVER (PARTITION BY T1.CTNNO ORDER BY T1.TAXKBN, T1.CTNNO) AS SORT1                                                                           ")
        SQLBldr.AppendLine("       ,T1.SALESCONTRACTDATE                                                                                                                                      ")
        SQLBldr.AppendLine("       ,T1.SALESAMOUNT                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.POSTAGE                                                                                                                                                ")
        SQLBldr.AppendLine("       ,T1.CLEANINGFEE                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.MAINTENANCEFEE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.OTHERFEE                                                                                                                                               ")
        SQLBldr.AppendLine("       ,T1.TOTALAMOUNT                                                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.TAXKBN                                                                                                                                                 ")
        SQLBldr.AppendLine("       ,CASE                                                                                                                                                      ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 1 THEN '標準税率10%'                                                                                                                    ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 2 THEN '経過措置税率8%'                                                                                                                 ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 3 THEN '非課税'                                                                                                                         ")
        SQLBldr.AppendLine("            WHEN TAXKBN = 4 THEN '不課税'                                                                                                                         ")
        SQLBldr.AppendLine("        END AS TAXKBNNAME                                                                                                                                         ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("    (                                                                                                                                                             ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            KEIJOYM                                                                                                                                               ")
        SQLBldr.AppendLine("           ,TORICODE                                                                                                                                              ")
        SQLBldr.AppendLine("           ,INVOICEORGCODE                                                                                                                                        ")
        SQLBldr.AppendLine("           ,SCHEDATEPAYMENT                                                                                                                                       ")
        SQLBldr.AppendLine("           ,INVKESAIKBN                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CLOSINGDAY                                                                                                                                            ")
        SQLBldr.AppendLine("           ,INACCOUNTCD                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,1                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0089_CONTAINER_STOCK                                                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                           ")
        SQLBldr.AppendLine("        AND TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                          ")
        SQLBldr.AppendLine("        AND INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                    ")
        SQLBldr.AppendLine("        AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                        ")
        SQLBldr.AppendLine("        AND REQUESTFLG      = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("        AND DELFLG          = @P01                                                                                                                                ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                                                 ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            KEIJOYM                                                                                                                                               ")
        SQLBldr.AppendLine("           ,TORICODE                                                                                                                                              ")
        SQLBldr.AppendLine("           ,INVOICEORGCODE                                                                                                                                        ")
        SQLBldr.AppendLine("           ,SCHEDATEPAYMENT                                                                                                                                       ")
        SQLBldr.AppendLine("           ,INVKESAIKBN                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CLOSINGDAY                                                                                                                                            ")
        SQLBldr.AppendLine("           ,INACCOUNTCD                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,2                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0089_CONTAINER_STOCK                                                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                           ")
        SQLBldr.AppendLine("        AND TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                          ")
        SQLBldr.AppendLine("        AND INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                    ")
        SQLBldr.AppendLine("        AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                        ")
        SQLBldr.AppendLine("        AND REQUESTFLG      = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("        AND DELFLG          = @P01                                                                                                                                ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                                                 ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            KEIJOYM                                                                                                                                               ")
        SQLBldr.AppendLine("           ,TORICODE                                                                                                                                              ")
        SQLBldr.AppendLine("           ,INVOICEORGCODE                                                                                                                                        ")
        SQLBldr.AppendLine("           ,SCHEDATEPAYMENT                                                                                                                                       ")
        SQLBldr.AppendLine("           ,INVKESAIKBN                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CLOSINGDAY                                                                                                                                            ")
        SQLBldr.AppendLine("           ,INACCOUNTCD                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,3                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0089_CONTAINER_STOCK                                                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                           ")
        SQLBldr.AppendLine("        AND TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                          ")
        SQLBldr.AppendLine("        AND INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                    ")
        SQLBldr.AppendLine("        AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                        ")
        SQLBldr.AppendLine("        AND REQUESTFLG      = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("        AND DELFLG          = @P01                                                                                                                                ")
        SQLBldr.AppendLine("        UNION ALL                                                                                                                                                 ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            KEIJOYM                                                                                                                                               ")
        SQLBldr.AppendLine("           ,TORICODE                                                                                                                                              ")
        SQLBldr.AppendLine("           ,INVOICEORGCODE                                                                                                                                        ")
        SQLBldr.AppendLine("           ,SCHEDATEPAYMENT                                                                                                                                       ")
        SQLBldr.AppendLine("           ,INVKESAIKBN                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CLOSINGDAY                                                                                                                                            ")
        SQLBldr.AppendLine("           ,INACCOUNTCD                                                                                                                                           ")
        SQLBldr.AppendLine("           ,CTNTYPE + '-' + CAST(CTNNO AS NVARCHAR)                                         AS CTNNO                                                              ")
        SQLBldr.AppendLine("           ,SALESCONTRACTDATE                                                                                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END              AS SALESAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END                  AS POSTAGE                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END              AS CLEANINGFEE                                                        ")
        SQLBldr.AppendLine("           ,CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END           AS MAINTENANCEFEE                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END                 AS OTHERFEE                                                           ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END                 AS TOTALAMOUNT                                                        ")
        SQLBldr.AppendLine("           ,4                                                                               AS TAXKBN                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0089_CONTAINER_STOCK                                                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                           ")
        SQLBldr.AppendLine("        AND TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                          ")
        SQLBldr.AppendLine("        AND INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                    ")
        SQLBldr.AppendLine("        AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                        ")
        SQLBldr.AppendLine("        AND REQUESTFLG      = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("        AND DELFLG          = @P01                                                                                                                                ")
        SQLBldr.AppendLine("    ) T1                                                                                                                                                          ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T1.TOTALAMOUNT <> 0                                                                                                                                       ")
        SQLBldr.AppendLine(") T1                                                                                                                                                              ")
        SQLBldr.AppendLine("LEFT OUTER JOIN (                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                        ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                 AS KEIJOYM                                                                     ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                AS TORICODE                                                                    ")
        SQLBldr.AppendLine("       ,T1.INVOICEORGCODE                                                          AS INVOICEORGCODE                                                              ")
        SQLBldr.AppendLine("       ,T1.SCHEDATEPAYMENT                                                         AS SCHEDATEPAYMENT                                                             ")
        SQLBldr.AppendLine("       ,COUNT(T1.CTNTYPE)                                                          AS CTNCOUNT                                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                   AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))                                   AS DETAILTAXAMOUNT                                                             ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                   AS TAXAMOUNT                                                                   ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))        AS DETAILAMOUNTINCLUDINGTAX                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)        AS AMOUNTINCLUDINGTAX                                                          ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX)                                                AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0))                               AS OLDDETAILTAXAMOUNT                                                          ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0)                               AS OLDTAXAMOUNT                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0)) AS OLDDETAILAMOUNTINCLUDINGTAX                                                 ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0) AS OLDAMOUNTINCLUDINGTAX                                                       ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES)                                                       AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.NONTAXABLESALES)                                                    AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES + T1.NONTAXABLESALES)                                  AS NONTAXABLEAMOUNTS                                                           ")
        SQLBldr.AppendLine("    FROM (                                                                                                                                                        ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            KEIJOYM                                                                AS KEIJOYM                                                                     ")
        SQLBldr.AppendLine("           ,TORICODE                                                               AS TORICODE                                                                    ")
        SQLBldr.AppendLine("           ,INVOICEORGCODE                                                         AS INVOICEORGCODE                                                              ")
        SQLBldr.AppendLine("           ,SCHEDATEPAYMENT                                                        AS SCHEDATEPAYMENT                                                             ")
        SQLBldr.AppendLine("           ,CTNTYPE                                                                AS CTNTYPE                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END        AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END        AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END        AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END        AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0089_CONTAINER_STOCK                                                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                           ")
        SQLBldr.AppendLine("        AND TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                          ")
        SQLBldr.AppendLine("        AND INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                    ")
        SQLBldr.AppendLine("        AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                        ")
        SQLBldr.AppendLine("        AND REQUESTFLG      = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("    )  T1                                                                                                                                                         ")
        SQLBldr.AppendLine("    GROUP BY                                                                                                                                                      ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                                ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                               ")
        SQLBldr.AppendLine("       ,T1.INVOICEORGCODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.SCHEDATEPAYMENT                                                                                                                                        ")
        SQLBldr.AppendLine(")  T2                                                                                                                                                             ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T2.KEIJOYM         = T1.KEIJOYM                                                                                                                               ")
        SQLBldr.AppendLine("AND T2.TORICODE        = T1.TORICODE                                                                                                                              ")
        SQLBldr.AppendLine("AND T2.INVOICEORGCODE  = T1.INVOICEORGCODE                                                                                                                        ")
        SQLBldr.AppendLine("AND T2.SCHEDATEPAYMENT = T1.SCHEDATEPAYMENT                                                                                                                       ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                                                       ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                                                 ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                                                 ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                                             ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                                                       ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                                                 ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                                                  ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                                                         ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                                                      ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                                             ")
        SQLBldr.AppendLine(") T3                                                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T3.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0024_KEKKJM T5                                                                                                                                         ")
        SQLBldr.AppendLine("ON  T5.TORICODE      = T1.TORICODE                                                                                                                                ")
        SQLBldr.AppendLine("AND T5.INVFILINGDEPT = T1.INVOICEORGCODE                                                                                                                          ")
        SQLBldr.AppendLine("AND T5.INVKESAIKBN   = (CASE                                                                                                                                      ")
        SQLBldr.AppendLine("                             WHEN T1.INVKESAIKBN IS NOT NULL THEN T1.INVKESAIKBN                                                                                  ")
        SQLBldr.AppendLine("                             ELSE '1'                                                                                                                             ")
        SQLBldr.AppendLine("                         END)                                                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T6                                                                                                                                ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T6.TORICODE       = T1.TORICODE                                                                                                                               ")
        SQLBldr.AppendLine("AND T6.INVFILINGDEPT  = T1.INVOICEORGCODE                                                                                                                         ")
        SQLBldr.AppendLine("AND T6.INVSUBCD       = '0'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T6.INVOICETYPE    = '5'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T6.DELFLG         = @P01                                                                                                                                      ")
        SQLBldr.AppendLine("ORDER BY T1.TAXKBN, T1.CTNNO                                                                                                                                      ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' 売却コンテナ明細無し)請求連携データ 検索処理(CSV用)
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    Public Shared Function SelectDraftCtnSaleOffDetailCsv(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
#Region "請求連携 売却コンテナ(明細無し)検索SQL"
        SQLBldr.AppendLine("SELECT                                                                                                                                                            ")
        SQLBldr.AppendLine("    FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                        AS 発行日                                              ")
        SQLBldr.AppendLine("   ,T1.TORICODE + '-' + CAST(T1.KEIJOYM AS NVARCHAR) + '-' + T1.INVOICEORGCODE                                                                                    ")
        SQLBldr.AppendLine("    + '-' + '00' + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000')       AS 請求仮番号                                          ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy/MM/dd')                                                                              ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy/MM/dd')                                                             ")
        SQLBldr.AppendLine("    END                                                                                                    AS 計上日付                                            ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01-' + T1.TORICODE + '-1'                                                                             AS 顧客コード              ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust04' + '-1'                                                                            AS 顧客コード              ")
        End If
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T1.AMOUNTWITHOUTTAX, 0), '0')                                                            AS 税抜金額                                            ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T1.KEIJOYM <= 202306                                                                                                                                 ")
        SQLBldr.AppendLine("            THEN (CASE T3.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T1.TAXAMOUNT, 0), '0')                                                                                              ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T1.DETAILTAXAMOUNT, 0), '0')                                                                                        ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T1.TAXAMOUNT, 0), '0')                                                                                                                 ")
        SQLBldr.AppendLine("    END                                                                                                    AS 消費税                                              ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T3.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T1.AMOUNTINCLUDINGTAX, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T1.DETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                               ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T1.AMOUNTINCLUDINGTAX, 0), '0')                                                                                                       ")
        SQLBldr.AppendLine("    END                                                                                                    AS 税込金額                                            ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T1.OLDAMOUNTWITHOUTTAX, 0), '0')                                                         AS 経過措置税抜金額                                    ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T3.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T1.OLDTAXAMOUNT, 0), '0')                                                                                           ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T1.OLDDETAILTAXAMOUNT, 0), '0')                                                                                     ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("        ELSE FORMAT(coalesce(T1.OLDTAXAMOUNT, 0), '0')                                                                                                              ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置消費税                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T3.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T1.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                  ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T1.OLDDETAILAMOUNTINCLUDINGTAX, 0), '0')                                                                            ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T1.OLDAMOUNTINCLUDINGTAX, 0), '0')                                                                                                    ")
        SQLBldr.AppendLine("    END                                                                                                    AS 経過措置税込金額                                    ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T1.NONTAXABLEAMOUNTS, 0), '0')                                                           AS 課税対象外金額                                      ")
        SQLBldr.AppendLine("   ,CASE WHEN T1.KEIJOYM <= 202306                                                                                                                                ")
        SQLBldr.AppendLine("            THEN (CASE T3.TAXCALCULATION                                                                                                                          ")
        SQLBldr.AppendLine("                  WHEN '1' THEN FORMAT(coalesce(T1.AMOUNTINCLUDINGTAX, 0) + coalesce(T1.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T1.NONTAXABLEAMOUNTS, 0), '0')             ")
        SQLBldr.AppendLine("                  WHEN '2' THEN FORMAT(coalesce(T1.DETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T1.OLDDETAILAMOUNTINCLUDINGTAX, 0) + coalesce(T1.NONTAXABLEAMOUNTS, 0), '0') ")
        SQLBldr.AppendLine("            END)                                                                                                                                                  ")
        SQLBldr.AppendLine("         ELSE FORMAT(coalesce(T1.AMOUNTINCLUDINGTAX, 0) + coalesce(T1.OLDAMOUNTINCLUDINGTAX, 0) + coalesce(T1.NONTAXABLEAMOUNTS, 0), '0')                               ")
        SQLBldr.AppendLine("    END                                                                                                    AS 請求書合計金額                                      ")
        SQLBldr.AppendLine("   ,0                                                                                                      AS 免税売上小計                                        ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T1.TAXFREESALES, 0), '0')                                                                AS 非課税売上小計                                      ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T1.NONTAXABLESALES, 0), '0')                                                             AS 不課税売上小計                                      ")
        SQLBldr.AppendLine("   ,coalesce(FORMAT(T1.SCHEDATEPAYMENT, 'yyyy/MM/dd'), '')                                                   AS 支払期日                                            ")
        SQLBldr.AppendLine("   ,'01-' + T1.INVOICEORGCODE                                                                              AS 発行側部署コード                                    ")
        SQLBldr.AppendLine("   ,T2.STAFFNAMEL                                                                                          AS 発行担当者名                                        ")
        SQLBldr.AppendLine("   ,'01-' + T1.INACCOUNTCD                                                                                 AS 請求入金銀行コード                                  ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN CAST(T1.KEIJOYM AS NVARCHAR) LIKE '%02' AND T1.CLOSINGDAY >= 29                                                                                      ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        WHEN T1.CLOSINGDAY >= 31                                                                                                                                  ")
        SQLBldr.AppendLine("        THEN FORMAT(EOMONTH(CAST((T1.KEIJOYM * 100) + 1 AS NVARCHAR)), 'yyyy年M月分')                                                                             ")
        SQLBldr.AppendLine("        ELSE FORMAT(CAST(CAST((T1.KEIJOYM * 100) + T1.CLOSINGDAY AS NVARCHAR) AS DATE), 'yyyy年M月分')                                                            ")
        SQLBldr.AppendLine("    END + ' コンテナご購入代 ' + CAST(T1.CTNCOUNT AS NVARCHAR) + '個'                                      AS 見出しエリア1用フリーコメント１                     ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                          ")
        SQLBldr.AppendLine("        WHEN T4.SLIPDESCRIPTION IS NOT NULL THEN T4.SLIPDESCRIPTION                                                                                               ")
        SQLBldr.AppendLine("        ELSE ''                                                                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                    AS 見出しエリア1用フリーコメント２                     ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS 見出しエリア1用フリーコメント３                     ")
        SQLBldr.AppendLine("   ,''                                                                                                     AS フッター用フリーコメント                            ")
        SQLBldr.AppendLine("   ,5                                                                                                      AS 帳票種別                                            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 日付                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 内訳                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 数量                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 本体価格                                            ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 送料                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 整備費                                              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 洗浄費                                              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS その他                                              ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 合計                                                ")
        SQLBldr.AppendLine("   ,NULL                                                                                                   AS 請求書区分名                                        ")
        SQLBldr.AppendLine("FROM                                                                                                                                                              ")
        SQLBldr.AppendLine("   (SELECT                                                                                                                                                        ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                 AS KEIJOYM                                                                     ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                AS TORICODE                                                                    ")
        SQLBldr.AppendLine("       ,T1.INVOICEORGCODE                                                          AS INVOICEORGCODE                                                              ")
        SQLBldr.AppendLine("       ,T1.SCHEDATEPAYMENT                                                         AS SCHEDATEPAYMENT                                                             ")
        SQLBldr.AppendLine("       ,MAX(T1.CLOSINGDAY)                                                         AS CLOSINGDAY                                                                  ")
        SQLBldr.AppendLine("       ,MAX(T1.INACCOUNTCD)                                                        AS INACCOUNTCD                                                                 ")
        SQLBldr.AppendLine("       ,MAX(T1.INVKESAIKBN)                                                        AS INVKESAIKBN                                                                 ")
        SQLBldr.AppendLine("       ,COUNT(T1.CTNTYPE)                                                          AS CTNCOUNT                                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX)                                                   AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))                                   AS DETAILTAXAMOUNT                                                             ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)                                   AS TAXAMOUNT                                                                   ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + SUM(ROUND(T1.AMOUNTWITHOUTTAX * 0.1, 0))        AS DETAILAMOUNTINCLUDINGTAX                                                    ")
        SQLBldr.AppendLine("       ,SUM(T1.AMOUNTWITHOUTTAX) + ROUND(SUM(T1.AMOUNTWITHOUTTAX) * 0.1, 0)        AS AMOUNTINCLUDINGTAX                                                          ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX)                                                AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("       ,SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0))                               AS OLDDETAILTAXAMOUNT                                                          ")
        SQLBldr.AppendLine("       ,ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0)                               AS OLDTAXAMOUNT                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + SUM(ROUND(T1.OLDAMOUNTWITHOUTTAX * 0.08, 0)) AS OLDDETAILAMOUNTINCLUDINGTAX                                                 ")
        SQLBldr.AppendLine("       ,SUM(T1.OLDAMOUNTWITHOUTTAX) + ROUND(SUM(T1.OLDAMOUNTWITHOUTTAX) * 0.08, 0) AS OLDAMOUNTINCLUDINGTAX                                                       ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES)                                                       AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("       ,SUM(T1.NONTAXABLESALES)                                                    AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("       ,SUM(T1.TAXFREESALES + T1.NONTAXABLESALES)                                  AS NONTAXABLEAMOUNTS                                                           ")
        SQLBldr.AppendLine("    FROM (                                                                                                                                                        ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                                    ")
        SQLBldr.AppendLine("            KEIJOYM                                                                AS KEIJOYM                                                                     ")
        SQLBldr.AppendLine("           ,TORICODE                                                               AS TORICODE                                                                    ")
        SQLBldr.AppendLine("           ,INVOICEORGCODE                                                         AS INVOICEORGCODE                                                              ")
        SQLBldr.AppendLine("           ,SCHEDATEPAYMENT                                                        AS SCHEDATEPAYMENT                                                             ")
        SQLBldr.AppendLine("           ,CLOSINGDAY                                                             AS CLOSINGDAY                                                                  ")
        SQLBldr.AppendLine("           ,INACCOUNTCD                                                            AS INACCOUNTCD                                                                 ")
        SQLBldr.AppendLine("           ,INVKESAIKBN                                                            AS INVKESAIKBN                                                                 ")
        SQLBldr.AppendLine("           ,CTNTYPE                                                                AS CTNTYPE                                                                     ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '01' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '01' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '01' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '01' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '01' THEN OTHERFEE ELSE 0 END        AS AMOUNTWITHOUTTAX                                                            ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '02' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '02' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '02' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '02' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '02' THEN OTHERFEE ELSE 0 END        AS OLDAMOUNTWITHOUTTAX                                                         ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '11' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '11' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '11' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '11' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '11' THEN OTHERFEE ELSE 0 END        AS TAXFREESALES                                                                ")
        SQLBldr.AppendLine("           ,CASE WHEN SALESAMOUNTTAXCODE    = '12' THEN SALESAMOUNT ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN POSTAGETAXCODE        = '12' THEN POSTAGE ELSE 0 END +                                                                                      ")
        SQLBldr.AppendLine("            CASE WHEN CLEANINGFEETAXCODE    = '12' THEN CLEANINGFEE ELSE 0 END +                                                                                  ")
        SQLBldr.AppendLine("            CASE WHEN MAINTENANCEFEETAXCODE = '12' THEN MAINTENANCEFEE ELSE 0 END +                                                                               ")
        SQLBldr.AppendLine("            CASE WHEN OTHERFEETAXCODE       = '12' THEN OTHERFEE ELSE 0 END        AS NONTAXABLESALES                                                             ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                      ")
        SQLBldr.AppendLine("            LNG.LNT0089_CONTAINER_STOCK                                                                                                                           ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                                     ")
        SQLBldr.AppendLine("            KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                           ")
        SQLBldr.AppendLine("        AND TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                          ")
        SQLBldr.AppendLine("        AND INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                    ")
        SQLBldr.AppendLine("        AND SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                        ")
        SQLBldr.AppendLine("        AND REQUESTFLG      = '1'                                                                                                                                 ")
        SQLBldr.AppendLine("        AND DELFLG               = @P01                                                                                                                           ")
        SQLBldr.AppendLine("    )  T1                                                                                                                                                         ")
        SQLBldr.AppendLine("    GROUP BY                                                                                                                                                      ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                                ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                               ")
        SQLBldr.AppendLine("       ,T1.INVOICEORGCODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.SCHEDATEPAYMENT                                                                                                                                        ")
        SQLBldr.AppendLine(")  T1                                                                                                                                                             ")
        SQLBldr.AppendLine("INNER JOIN(                                                                                                                                                       ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                                                 ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                                                 ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                                             ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                          ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                                                       ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                         ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                                                 ")
        SQLBldr.AppendLine("    AND CURDATE() BETWEEN T1.STYMD AND T1.ENDYMD                                                                                                                  ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                                                         ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                                                      ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                                             ")
        SQLBldr.AppendLine(") T2                                                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T2.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0024_KEKKJM T3                                                                                                                                         ")
        SQLBldr.AppendLine("ON  T3.TORICODE      = T1.TORICODE                                                                                                                                ")
        SQLBldr.AppendLine("AND T3.INVFILINGDEPT = T1.INVOICEORGCODE                                                                                                                          ")
        SQLBldr.AppendLine("AND T3.INVKESAIKBN   = (CASE                                                                                                                                      ")
        SQLBldr.AppendLine("                             WHEN T1.INVKESAIKBN IS NOT NULL THEN T1.INVKESAIKBN                                                                                  ")
        SQLBldr.AppendLine("                             ELSE '1'                                                                                                                             ")
        SQLBldr.AppendLine("                         END)                                                                                                                                     ")
        SQLBldr.AppendLine("LEFT OUTER JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0037_SLIPDESCRIPTION T4                                                                                                                                ")
        SQLBldr.AppendLine("ON                                                                                                                                                                ")
        SQLBldr.AppendLine("    T4.TORICODE       = T1.TORICODE                                                                                                                               ")
        SQLBldr.AppendLine("AND T4.INVFILINGDEPT  = T1.INVOICEORGCODE                                                                                                                         ")
        SQLBldr.AppendLine("AND T4.INVSUBCD       = '0'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T4.INVOICETYPE    = '5'                                                                                                                                       ")
        SQLBldr.AppendLine("AND T4.DELFLG         = @P01                                                                                                                                      ")
        SQLBldr.AppendLine("WHERE                                                                                                                                                             ")
        SQLBldr.AppendLine("    T1.KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                                ")
        SQLBldr.AppendLine("AND T1.TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                               ")
        SQLBldr.AppendLine("AND T1.INVOICEORGCODE  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                         ")
        SQLBldr.AppendLine("AND T1.SCHEDATEPAYMENT = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                             ")
#End Region

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' ドラフト版請求書連携実績テーブル 検索処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htRentData">請求明細使用料データ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftInvoiceLog(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htRentData As Hashtable) As DataTable
        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT                                                                                   ")
        SQLBldr.AppendLine("   KEIJOYM                                                                               ")
        SQLBldr.AppendLine("   ,RENKEICOUNT                                                                          ")
        SQLBldr.AppendLine("FROM                                                                                     ")
        SQLBldr.AppendLine("    LNG.LNT0082_DRAFTINVOICELOG                                                          ")
        SQLBldr.AppendLine("WHERE                                                                                    ")
        SQLBldr.AppendLine("    ISSUETYPE       = '" & htRentData(SELECT_PRIMALKEY.SP_ISSUETYPE).ToString & "'       ")    '発行種別
        SQLBldr.AppendLine("AND KEIJOYM         = '" & htRentData(SELECT_PRIMALKEY.SP_KEIJOYM).ToString & "'         ")    '請求年月
        SQLBldr.AppendLine("AND INVOICEORGCODE  = '" & htRentData(SELECT_PRIMALKEY.SP_INVOICEORGCODE).ToString & "'  ")    '請求担当部店コード
        SQLBldr.AppendLine("AND TORICODE        = '" & htRentData(SELECT_PRIMALKEY.SP_TORICODE).ToString & "'        ")    '請求取引先コード
        SQLBldr.AppendLine("AND SCHEDATEPAYMENT = '" & htRentData(SELECT_PRIMALKEY.SP_SCHEDATEPAYMENT).ToString & "' ")    '入金予定日
        SQLBldr.AppendLine("AND INVSUBCD        = '" & htRentData(SELECT_PRIMALKEY.SP_INVSUBCD).ToString & "'        ")    '細分コード
        SQLBldr.AppendLine("AND INVOICETYPE     = '" & htRentData(SELECT_PRIMALKEY.SP_INVOICETYPE).ToString & "'     ")    '請求書種類
        SQLBldr.AppendLine("AND DELFLG = @P01                                                                        ")    '削除フラグ

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' ドラフト版請求書連携実績テーブル 登録処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htInsData">ドラフト版請求書連携実績テーブル</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub InsertDraftInvoiceLog(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htInsData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("INSERT INTO LNG.LNT0082_DRAFTINVOICELOG ( ")
        sqlSeikyuStat.AppendLine("    ISSUETYPE                             ")      '発行種別
        sqlSeikyuStat.AppendLine("   ,KEIJOYM                               ")      '請求年月
        sqlSeikyuStat.AppendLine("   ,INVOICEORGCODE                        ")      '請求担当部店コード
        sqlSeikyuStat.AppendLine("   ,TORICODE                              ")      '請求取引先コード
        sqlSeikyuStat.AppendLine("   ,INVOICETYPE                           ")      '請求書種類
        sqlSeikyuStat.AppendLine("   ,SCHEDATEPAYMENT                       ")      '入金予定日
        sqlSeikyuStat.AppendLine("   ,RENKEICOUNT                           ")      '連携回数
        sqlSeikyuStat.AppendLine("   ,INVSUBCD                              ")      '細分コード
        sqlSeikyuStat.AppendLine("   ,DELFLG                                ")      '削除フラグ
        sqlSeikyuStat.AppendLine("   ,INITYMD                               ")      '登録年月日
        sqlSeikyuStat.AppendLine("   ,INITUSER                              ")      '登録ユーザーID
        sqlSeikyuStat.AppendLine("   ,INITTERMID                            ")      '登録端末
        sqlSeikyuStat.AppendLine("   ,INITPGID                              ")      '登録プログラムID
        sqlSeikyuStat.AppendLine(")                                         ")
        sqlSeikyuStat.AppendLine(" VALUES(                                  ")
        sqlSeikyuStat.AppendLine("    @ISSUETYPE                            ")      '発行種別
        sqlSeikyuStat.AppendLine("   ,@KEIJOYM                              ")      '請求年月
        sqlSeikyuStat.AppendLine("   ,@INVOICEORGCODE                       ")      '請求担当部店コード
        sqlSeikyuStat.AppendLine("   ,@TORICODE                             ")      '請求取引先コード
        sqlSeikyuStat.AppendLine("   ,@INVOICETYPE                          ")      '請求書種類
        sqlSeikyuStat.AppendLine("   ,@SCHEDATEPAYMENT                      ")      '入金予定日
        sqlSeikyuStat.AppendLine("   ,@RENKEICOUNT                          ")      '連携回数
        sqlSeikyuStat.AppendLine("   ,@INVSUBCD                             ")      '細分コード
        sqlSeikyuStat.AppendLine("   ,@DELFLG                               ")      '削除フラグ
        sqlSeikyuStat.AppendLine("   ,@INITYMD                              ")      '登録年月日
        sqlSeikyuStat.AppendLine("   ,@INITUSER                             ")      '登録ユーザーID
        sqlSeikyuStat.AppendLine("   ,@INITTERMID                           ")      '登録端末
        sqlSeikyuStat.AppendLine("   ,@INITPGID                             ")      '登録プログラムID
        sqlSeikyuStat.AppendLine(")                                         ")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("ISSUETYPE", MySqlDbType.VarChar).Value = htInsData(INSERT_DRAFTINVOICELOG.IP_ISSUETYPE)                                 '発行種別
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htInsData(INSERT_DRAFTINVOICELOG.IP_KEIJOYM)                                          '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = htInsData(INSERT_DRAFTINVOICELOG.IP_INVOICEORGCODE)                       '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = htInsData(INSERT_DRAFTINVOICELOG.IP_TORICODE)                                   '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htInsData(INSERT_DRAFTINVOICELOG.IP_INVOICETYPE)                             '請求書種類
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_SCHEDATEPAYMENT))          '入金予定日
                .Add("RENKEICOUNT", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_RENKEICOUNT))                   '連携回数
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_INVSUBCD))                         '細分コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_DELFLG))                             '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_INITYMD))                      '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_INITUSER))                    '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_INITTERMID))                '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(INSERT_DRAFTINVOICELOG.IP_INITPGID))                    '登録プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' ドラフト版請求書連携実績テーブル 更新処理
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htInsData">ドラフト版請求書連携実績テーブル</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Sub UpdateDraftInvoiceLog(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htInsData As Hashtable)

        '◯受注TBL
        Dim sqlSeikyuStat As New StringBuilder
        sqlSeikyuStat.AppendLine("UPDATE LNG.LNT0082_DRAFTINVOICELOG        ")
        sqlSeikyuStat.AppendLine("SET                                       ")
        sqlSeikyuStat.AppendLine("    RENKEICOUNT = @RENKEICOUNT            ")
        sqlSeikyuStat.AppendLine("WHERE                                     ")
        sqlSeikyuStat.AppendLine("    ISSUETYPE = @ISSUETYPE                ")
        sqlSeikyuStat.AppendLine("	AND KEIJOYM = @KEIJOYM                  ")
        sqlSeikyuStat.AppendLine("	AND INVOICEORGCODE = @INVOICEORGCODE    ")
        sqlSeikyuStat.AppendLine("	AND TORICODE = @TORICODE                ")
        sqlSeikyuStat.AppendLine("	AND INVOICETYPE = @INVOICETYPE          ")
        sqlSeikyuStat.AppendLine("	AND SCHEDATEPAYMENT = @SCHEDATEPAYMENT  ")
        sqlSeikyuStat.AppendLine("	AND INVSUBCD = @INVSUBCD                ")

        Using sqlOrderCmd As New MySqlCommand(sqlSeikyuStat.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("ISSUETYPE", MySqlDbType.VarChar).Value = htInsData(UPDATE_DRAFTINVOICELOG.IP_ISSUETYPE)                                 '発行種別
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htInsData(UPDATE_DRAFTINVOICELOG.IP_KEIJOYM)                                          '請求年月
                .Add("INVOICEORGCODE", MySqlDbType.VarChar).Value = htInsData(UPDATE_DRAFTINVOICELOG.IP_INVOICEORGCODE)                       '請求担当部店コード
                .Add("TORICODE", MySqlDbType.VarChar).Value = htInsData(UPDATE_DRAFTINVOICELOG.IP_TORICODE)                                   '請求取引先コード
                .Add("INVOICETYPE", MySqlDbType.VarChar).Value = htInsData(UPDATE_DRAFTINVOICELOG.IP_INVOICETYPE)                             '請求書種類
                .Add("SCHEDATEPAYMENT", MySqlDbType.Date).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_SCHEDATEPAYMENT))          '入金予定日
                .Add("RENKEICOUNT", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_RENKEICOUNT))                   '連携回数
                .Add("INVSUBCD", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_INVSUBCD))                         '細分コード
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_DELFLG))                             '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_INITYMD))                      '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_INITUSER))                    '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_INITTERMID))                '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(UPDATE_DRAFTINVOICELOG.IP_INITPGID))                    '登録プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(ドラフト版 請求連携用(使用料))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftRentalCsv_RESSNF(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT                                                                                                                             ")
        SQLBldr.AppendLine("    FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                    AS 発行日                   ")
        'SQLBldr.AppendLine("   ,T01.TORICODE + '-' + T01.KEIJOYM + '-' + T01.INVFILINGDEPT + '-' + T01.INVSUBCD + '-' + '2'        AS 請求仮番号               ")
        SQLBldr.AppendLine("   ,T01.TORICODE + '-' + T01.KEIJOYM + '-' + T01.INVFILINGDEPT + '-'                                                               ")
        SQLBldr.AppendLine("    + T01.INVSUBCD + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号               ")
        'SQLBldr.AppendLine("    + T01.INVKESAIKBN + T01.INVSUBCD + '-' + '29'                                                      AS 請求仮番号               ")
        SQLBldr.AppendLine("   ,T01.CLOSINGDATE                                                                                    AS 計上日付                 ")
        If CS0050Session.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01' + '-' + T01.TORICODE + '-' + '1'                                                          AS 顧客コード               ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                    AS 顧客コード               ")
        End If
        SQLBldr.AppendLine("   ,'0'                                                                                                AS 税抜金額                 ")
        SQLBldr.AppendLine("   ,'0'                                                                                                AS 消費税                   ")
        SQLBldr.AppendLine("   ,'0'                                                                                                AS 税込金額                 ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 経過措置税抜金額         ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 経過措置消費税           ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 経過措置税込金額         ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 課税対象外金額           ")
        SQLBldr.AppendLine("   ,'0'                                                                                                AS 請求書合計金額           ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 免税売上小計             ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 非課税売上小計           ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 不課税売上小計           ")
        SQLBldr.AppendLine("   ,FORMAT(T01.DEPOSITYMD, 'yyyy/MM/dd')                                                               AS '請求サイト（支払期日）' ")
        SQLBldr.AppendLine("   ,'01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "'                                AS 発行部署コード           ")
        SQLBldr.AppendLine("   ,T06.STAFFNAMEL                                                                                     AS 発行担当者               ")
        SQLBldr.AppendLine("   ,'01-' + T05.INACCOUNTCD                                                                            AS 請求入金銀行コード       ")
        SQLBldr.AppendLine("   ,FORMAT(T01.CLOSINGDATE, 'yyyy年M月分') +                                                                                       ")
        SQLBldr.AppendLine("        CASE WHEN T09.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T09.SLIPDESCRIPTION                                                   ")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナ使用料'                                                                                           ")
        SQLBldr.AppendLine("    END                                                                                                AS 宛名欄付記1              ")
        SQLBldr.AppendLine("   ,''                                                                                                 AS 宛名欄付記2              ")
        SQLBldr.AppendLine("   ,''                                                                                                 AS 宛名欄付記3              ")
        SQLBldr.AppendLine("   ,''                                                                                                 AS 通信欄                   ")
        SQLBldr.AppendLine("   ,'29'                                                                                               AS 帳票種別                 ")
        SQLBldr.AppendLine("   ,T03.NAMES                                                                                          AS 発駅名                   ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                           ")
        SQLBldr.AppendLine("        WHEN coalesce(T07.DUMMYKBN, '00') = '01' THEN '加減額'                                                                       ")
        SQLBldr.AppendLine("        ELSE T04.NAMES                                                                                                             ")
        SQLBldr.AppendLine("    END                                                                                                AS 着駅名                   ")
        SQLBldr.AppendLine("   ,FORMAT(T01.SHIPYMD, 'yyyy/MM/d')                                                                   AS 発送年月日               ")
        SQLBldr.AppendLine("   ,T01.CTNTYPE                                                                                        AS コンテナ記号             ")
        SQLBldr.AppendLine("   ,CAST(T01.CTNNO AS nvarchar)                                                                        AS コンテナ番号             ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                           ")
        SQLBldr.AppendLine("        WHEN coalesce(T07.DUMMYKBN, '00') = '01' THEN '0'                                                                            ")
        SQLBldr.AppendLine("        ELSE '1'                                                                                                                   ")
        SQLBldr.AppendLine("    END                                                                                                AS 個数                     ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T01.JRFIXEDFARE,0), '0')                                                             AS JR所定運賃               ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T01.OWNDISCOUNTFEE,0), '0')                                                          AS 私有割引相当額           ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T01.RETURNFARE,0), '0')                                                              AS 割戻運賃                 ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T01.USEFEE,0), '0')                                                                  AS 使用料金額               ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T01.NITTSUFREESEND,0), '0')                                                          AS 通運負担回送運賃         ")
        SQLBldr.AppendLine("   ,0                                                                                                  AS 発駅合計個数             ")
        SQLBldr.AppendLine("   ,FORMAT(0, '0')                                                                                     AS 発駅合計使用料           ")
        SQLBldr.AppendLine("FROM (                                                                                                                             ")
        SQLBldr.AppendLine("    SELECT                                                                                                                         ")
        SQLBldr.AppendLine("         T1.SHIPYMD                                                 AS SHIPYMD                                                     ")
        SQLBldr.AppendLine("        ,T1.TORICODE                                                AS TORICODE                                                    ")
        SQLBldr.AppendLine("        ,CONVERT(NVARCHAR, T1.KEIJOYM)                              AS KEIJOYM                                                     ")
        SQLBldr.AppendLine("        ,T1.INVFILINGDEPT                                           AS INVFILINGDEPT                                               ")
        SQLBldr.AppendLine("        ,FORMAT(T1.INVKESAIKBN, '00')                               AS INVKESAIKBN                                                 ")
        SQLBldr.AppendLine("        ,FORMAT(T1.INVSUBCD, '00')                                  AS INVSUBCD                                                    ")
        SQLBldr.AppendLine("        ,T1.CLOSINGDATE                                             AS CLOSINGDATE                                                 ")
        SQLBldr.AppendLine("        ,T1.SCHEDATEPAYMENT                                         AS DEPOSITYMD                                                  ")
        SQLBldr.AppendLine("        ,T1.DEPOSITMONTHKBN                                         AS DEPOSITMONTHKBN                                             ")
        SQLBldr.AppendLine("        ,FORMAT(T1.CLOSINGDATE, 'dd')                               AS CLOSINGDAY                                                  ")
        SQLBldr.AppendLine("        ,T1.CTNTYPE                                                 AS CTNTYPE                                                     ")
        SQLBldr.AppendLine("        ,CONVERT(VARCHAR, T1.CTNNO)                                 AS CTNNO                                                       ")
        SQLBldr.AppendLine("        ,T1.SAMEDAYCNT                                              AS SAMEDAYCNT                                                  ")
        SQLBldr.AppendLine("        ,T1.CTNLINENO                                               AS CTNLINENO                                                   ")
        SQLBldr.AppendLine("        ,T1.DEPSTATION                                              AS DEPSTATION                                                  ")
        SQLBldr.AppendLine("        ,T1.ARRSTATION                                              AS ARRSTATION                                                  ")
        SQLBldr.AppendLine("        ,coalesce(T1.JRFIXEDFARE, 0)                                  AS JRFIXEDFARE                                                 ")
        SQLBldr.AppendLine("        ,coalesce(T1.OWNDISCOUNTFEE, 0)                               AS OWNDISCOUNTFEE                                              ")
        SQLBldr.AppendLine("        ,coalesce(T1.RETURNFARE, 0)                                   AS RETURNFARE                                                  ")
        SQLBldr.AppendLine("        ,coalesce(T1.TOTALINCOME, 0) - coalesce(T1.NITTSUFREESEND, 0)   AS USEFEE                                                      ")
        SQLBldr.AppendLine("        ,coalesce(T1.NITTSUFREESEND, 0)                               AS NITTSUFREESEND                                              ")
        SQLBldr.AppendLine("        ,T1.INACCOUNTCD                                             AS INACCOUNTCD                                                 ")
        SQLBldr.AppendLine("    FROM                                                                                                                            ")
        SQLBldr.AppendLine("        LNG.LNT0017_RESSNF T1                                                                                                       ")
        SQLBldr.AppendLine("    WHERE                                                                                                                          ")
        SQLBldr.AppendLine("        T1.DELFLG               = @P01                                                                                             ")
        SQLBldr.AppendLine("    AND T1.JURISDICTIONCD       = '14'                                                                                             ")
        SQLBldr.AppendLine("    AND T1.ACCOUNTINGASSETSKBN  = '1'                                                                                              ")
        SQLBldr.AppendLine("    AND T1.ACCOUNTSTATUSKBN    <> '8'                                                                                              ")
        SQLBldr.AppendLine("    AND T1.TOTALINCOME         <> 0                                                                                                ")
        SQLBldr.AppendLine(") T01                                                                                                                              ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                                                          ")
        SQLBldr.AppendLine("    com.LNS0020_STATION T03                                                                                                        ")
        SQLBldr.AppendLine("ON                                                                                                                                 ")
        SQLBldr.AppendLine("    T03.CAMPCODE = @P02                                                                                                            ")
        SQLBldr.AppendLine("AND T03.STATION  = T01.DEPSTATION                                                                                                  ")
        SQLBldr.AppendLine("AND T03.DELFLG   = @P01                                                                                                            ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                                                          ")
        SQLBldr.AppendLine("    com.LNS0020_STATION T04                                                                                                        ")
        SQLBldr.AppendLine("ON                                                                                                                                 ")
        SQLBldr.AppendLine("    T04.CAMPCODE = @P02                                                                                                            ")
        SQLBldr.AppendLine("AND T04.STATION  = T01.ARRSTATION                                                                                                  ")
        SQLBldr.AppendLine("AND T04.DELFLG   = @P01                                                                                                            ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                         ")
        SQLBldr.AppendLine("    LNG.LNM0024_KEKKJM T05                                                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                                                 ")
        SQLBldr.AppendLine("    T05.TORICODE                  = T01.TORICODE                                                                                   ")
        SQLBldr.AppendLine("AND T05.INVFILINGDEPT             = T01.INVFILINGDEPT                                                                              ")
        SQLBldr.AppendLine("AND FORMAT(T05.INVKESAIKBN, '00') = T01.INVKESAIKBN                                                                                ")
        SQLBldr.AppendLine("AND T05.DELFLG                    = @P01                                                                                           ")
        SQLBldr.AppendLine("LEFT JOIN(                                                                                                                         ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                  ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                  ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                              ")
        SQLBldr.AppendLine("    FROM                                                                                                                           ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                        ")
        SQLBldr.AppendLine("    WHERE                                                                                                                          ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                  ")
        SQLBldr.AppendLine("    AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'                                                         ")
        SQLBldr.AppendLine("    AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'                                                         ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                          ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                       ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                              ")
        SQLBldr.AppendLine(") T06                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                 ")
        SQLBldr.AppendLine("    T06.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                     ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                                                          ")
        SQLBldr.AppendLine("    LNG.LNM0002_RECONM T07                                                                                                         ")
        SQLBldr.AppendLine("ON                                                                                                                                 ")
        SQLBldr.AppendLine("    T07.CTNTYPE = T01.CTNTYPE                                                                                                      ")
        SQLBldr.AppendLine("AND T07.CTNNO   = T01.CTNNO                                                                                                        ")
        SQLBldr.AppendLine("AND T07.DELFLG  = @P01                                                                                                             ")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0037_SLIPDESCRIPTION T09                                                                                        ")
        SQLBldr.AppendLine("    ON  T09.TORICODE = T01.TORICODE                                                                                                ")
        SQLBldr.AppendLine("    AND T09.INVFILINGDEPT = T01.INVFILINGDEPT                                                                                      ")
        SQLBldr.AppendLine("    AND T09.INVSUBCD =  T01.INVSUBCD                                                                                               ")
        SQLBldr.AppendLine("    AND T09.INVOICETYPE = '2'                                                                                                      ")
        SQLBldr.AppendLine("    AND T09.DELFLG = @P01                                                                                                          ")
        SQLBldr.AppendLine("WHERE                                                                                                                              ")
        SQLBldr.AppendLine("    T01.KEIJOYM        = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                 ")
        SQLBldr.AppendLine("AND T01.TORICODE       = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                ")
        SQLBldr.AppendLine("AND T01.INVFILINGDEPT  = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                          ")
        SQLBldr.AppendLine("AND T01.DEPOSITYMD     = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                              ")
        SQLBldr.AppendLine("AND T01.INVSUBCD       = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                                                  ")
        SQLBldr.AppendLine("ORDER BY                                                                                                                           ")
        SQLBldr.AppendLine("    T01.INVSUBCD                                                                                                                   ")
        SQLBldr.AppendLine("   ,T01.DEPSTATION                                                                                                                 ")
        SQLBldr.AppendLine("   ,T01.ARRSTATION                                                                                                                 ")
        SQLBldr.AppendLine("   ,T01.SHIPYMD                                                                                                                    ")
        SQLBldr.AppendLine("   ,T01.CTNNO                                                                                                                      ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ
            Dim PARA02 As MySqlParameter = SQLcmd.Parameters.Add("@P02", MySqlDbType.VarChar)  '会社コード
            Dim PARA03 As MySqlParameter = SQLcmd.Parameters.Add("@P03", MySqlDbType.Float)     '税率

            PARA01.Value = C_DELETE_FLG.ALIVE
            PARA02.Value = htParm(SELECT_INVOICE_COOP.SL_CORPCD).ToString
            PARA03.Value = htParm(SELECT_INVOICE_COOP.SL_ZEIRITU)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

    ''' <summary>
    ''' コンテナ清算ファイル 検索処理(ドラフト版 請求連携用(リース))
    ''' </summary>
    ''' <param name="sqlCon">接続オブジェクト</param>
    ''' <param name="sqlTran">トランザクションオブジェクト(トランザクションを利用しない場合はNothing指定)</param>
    ''' <param name="htParm">パラメータデータ</param>
    ''' <remarks>データ行オブジェクト</remarks>
    Public Shared Function SelectDraftLeaseCsv_LEASE(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htParm As Hashtable) As DataTable
        Dim dt = New DataTable
        Dim CS0050Session As New CS0050SESSION

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT                                                                                                                                                      ")
        SQLBldr.AppendLine("    FORMAT(CURDATE(), 'yyyy/MM/dd')                                                                                             AS 発行日                   ")
        'SQLBldr.AppendLine("    , T01.TORICODE + '-' + CAST(T01.KEIJOYM AS NVARCHAR) + '-' + T01.INVOICEOUTORGCD + '-' + FORMAT(coalesce(T01.INVSUBCD, 0), '00') + '-' + '3' AS 請求仮番号 ")
        SQLBldr.AppendLine("   ,T01.TORICODE + '-' + CAST(T01.KEIJOYM AS NVARCHAR) + '-' + T01.INVOICEOUTORGCD + '-' +                                                                  ")
        SQLBldr.AppendLine("    + FORMAT(coalesce(T01.INVSUBCD, 0), '00') + '-' + FORMAT(" & CInt(htParm(SELECT_INVOICE_COOP.SL_SEQ).ToString) & ", '000000') AS 請求仮番号               ")
        'SQLBldr.AppendLine("      FORMAT(T01.INVKESAIKBN, '00') + FORMAT(T01.INVSUBCD, '00')                                                                AS 請求仮番号               ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                    ") '2024/09/10 伊藤 ADD START
        SQLBldr.AppendLine("        WHEN coalesce(T01.CLOSINGDAYKBN,'0') = '0' THEN T01.CLOSINGDATE                                                                                       ")
        SQLBldr.AppendLine("        WHEN coalesce(T01.CLOSINGDAYKBN,'0') = '1' THEN T01.LEASEMONTHSTARTYMD                                                                                ") '2024/09/10 伊藤 ADD END
        SQLBldr.AppendLine("    END                                                                                                                         AS 計上日付                 ") '計上日付 2024/09/10 伊藤 CHG
        If CS0050SESSION.ENVIRONMENTFLG = "2" Then
            SQLBldr.AppendLine("   ,'01' + '-' + T01.TORICODE + '-' + '1'                                                                                   AS 顧客コード               ")
        Else
            SQLBldr.AppendLine("   ,'01-' + 'TestCust01' + '-1'                                                                                             AS 顧客コード               ")
        End If

        SQLBldr.AppendLine("   ,FORMAT(coalesce(T02.SUM_LEASEFEE,0), '0')                                                                                     AS 税抜金額                 ")
        SQLBldr.AppendLine("   ,CASE WHEN T01.KEIJOYM <= 202306                                                                                                                         ")
        SQLBldr.AppendLine("      THEN (CASE T10.TAXCALCULATION                                                                                                                         ")
        SQLBldr.AppendLine("               WHEN '1' THEN FORMAT(ROUND(coalesce(T02.SUM_LEASEFEE,0) * 10 / 100 , 0), '0')                                                                  ")
        SQLBldr.AppendLine("               WHEN '2' THEN FORMAT(coalesce(T02.SUM_LEASEFEE_DTL,0), '0')                                                                                    ")
        SQLBldr.AppendLine("            END)                                                                                                                                            ")
        SQLBldr.AppendLine("      ELSE FORMAT(ROUND(coalesce(T02.SUM_LEASEFEE,0) * 10 / 100 , 0), '0')                                                                                    ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 消費税                   ")
        SQLBldr.AppendLine("   ,CASE WHEN T01.KEIJOYM <= 202306                                                                                                                         ")
        SQLBldr.AppendLine("      THEN (CASE T10.TAXCALCULATION                                                                                                                         ")
        SQLBldr.AppendLine("               WHEN '1' THEN FORMAT(coalesce(T02.SUM_LEASEFEE,0) + ROUND(coalesce(T02.SUM_LEASEFEE,0) * 10 / 100 , 0), '0')                                     ")
        SQLBldr.AppendLine("               WHEN '2' THEN FORMAT(coalesce(T02.SUM_LEASEFEE,0) + coalesce(T02.SUM_LEASEFEE_DTL,0), '0')                                                       ")
        SQLBldr.AppendLine("            END)                                                                                                                                            ")
        SQLBldr.AppendLine("      ELSE FORMAT(coalesce(T02.SUM_LEASEFEE,0) + ROUND(coalesce(T02.SUM_LEASEFEE,0) * 10 / 100 , 0), '0')                                                       ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 税込金額                 ")
        SQLBldr.AppendLine("   ,FORMAT(coalesce(T08.SUM_LEASEFEE,0), '0')                                                                                     AS 経過措置税抜金額         ")
        SQLBldr.AppendLine("   ,CASE WHEN T01.KEIJOYM <= 202306                                                                                                                         ")
        SQLBldr.AppendLine("      THEN (CASE T10.TAXCALCULATION                                                                                                                         ")
        SQLBldr.AppendLine("               WHEN '1' THEN FORMAT(ROUND(coalesce(T08.SUM_LEASEFEE,0) * 8 / 100 , 0), '0')                                                                   ")
        SQLBldr.AppendLine("               WHEN '2' THEN FORMAT(coalesce(T08.SUM_LEASEFEE_DTL,0), '0')                                                                                    ")
        SQLBldr.AppendLine("            END)                                                                                                                                            ")
        SQLBldr.AppendLine("      ELSE FORMAT(ROUND(coalesce(T08.SUM_LEASEFEE,0) * 8 / 100 , 0), '0')                                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 経過措置消費税           ")
        SQLBldr.AppendLine("   ,CASE WHEN T01.KEIJOYM <= 202306                                                                                                                         ")
        SQLBldr.AppendLine("      THEN (CASE T10.TAXCALCULATION                                                                                                                         ")
        SQLBldr.AppendLine("               WHEN '1' THEN FORMAT(coalesce(T08.SUM_LEASEFEE,0) + ROUND(coalesce(T08.SUM_LEASEFEE,0) * 8 / 100 , 0), '0')                                      ")
        SQLBldr.AppendLine("               WHEN '2' THEN FORMAT(coalesce(T08.SUM_LEASEFEE,0) + coalesce(T08.SUM_LEASEFEE_DTL,0), '0')                                                       ")
        SQLBldr.AppendLine("            END)                                                                                                                                            ")
        SQLBldr.AppendLine("      ELSE FORMAT(coalesce(T08.SUM_LEASEFEE,0) + ROUND(coalesce(T08.SUM_LEASEFEE,0) * 8 / 100 , 0), '0')                                                        ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 経過措置税込金額         ")
        SQLBldr.AppendLine("   ,0                                                                                                                           AS 課税対象外金額           ")
        SQLBldr.AppendLine("   ,CASE WHEN T01.KEIJOYM <= 202306                                                                                                                         ")
        SQLBldr.AppendLine("      THEN (CASE T10.TAXCALCULATION                                                                                                                         ")
        SQLBldr.AppendLine("               WHEN '1' THEN FORMAT(coalesce(T02.SUM_LEASEFEE,0) + coalesce(T08.SUM_LEASEFEE,0) + ROUND(coalesce(T02.SUM_LEASEFEE,0) * 10 / 100 , 0) + ROUND(coalesce(T08.SUM_LEASEFEE,0) * 8 / 100 , 0), '0')                ")
        SQLBldr.AppendLine("               WHEN '2' THEN FORMAT(coalesce(T02.SUM_LEASEFEE,0) + coalesce(T08.SUM_LEASEFEE,0) + coalesce(T02.SUM_LEASEFEE_DTL,0) + coalesce(T08.SUM_LEASEFEE_DTL,0), '0')                                                   ")
        SQLBldr.AppendLine("            END)                                                                                                                                                                                                      ")
        SQLBldr.AppendLine("      ELSE FORMAT(coalesce(T02.SUM_LEASEFEE,0) + coalesce(T08.SUM_LEASEFEE,0) + ROUND(coalesce(T02.SUM_LEASEFEE,0) * 10 / 100 , 0) + ROUND(coalesce(T08.SUM_LEASEFEE,0) * 8 / 100 , 0), '0')                                  ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 請求書合計金額            ")
        SQLBldr.AppendLine("   ,0                                                                                                                           AS 免税売上小計             ")
        SQLBldr.AppendLine("   ,0                                                                                                                           AS 非課税売上小計           ")
        SQLBldr.AppendLine("   ,0                                                                                                                           AS 不課税売上小計           ")
        SQLBldr.AppendLine("   ,CONVERT(NVARCHAR, T01.DEPOSITYMD, 111)                                                                                      AS '請求サイト（支払期日）' ")
        SQLBldr.AppendLine("   ,'01-' + '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_ORG).ToString & "'                                                         AS 発行部署コード           ")
        SQLBldr.AppendLine("   ,T06.STAFFNAMEL                                                                                                              AS 発行担当者               ")
        SQLBldr.AppendLine("   ,'01-' + T03.INACCOUNTCD                                                                                                     AS 請求入金銀行コード       ")
        SQLBldr.AppendLine("   ,FORMAT(CONVERT(DATE, CAST(T01.KEIJOYM AS NVARCHAR) + '01'), 'yyyy年M月分') +                                                                            ")
        SQLBldr.AppendLine("        CASE WHEN T11.SLIPDESCRIPTION IS NOT NULL THEN ' ' + T11.SLIPDESCRIPTION                                                                            ")
        SQLBldr.AppendLine("             ELSE ' ' + 'コンテナご使用料'                                                                                                                  ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 宛名欄付記1              ")
        SQLBldr.AppendLine("   ,''                                                                                                                          AS 宛名欄付記2              ")
        SQLBldr.AppendLine("   ,''                                                                                                                          AS 宛名欄付記3              ")
        SQLBldr.AppendLine("   ,''                                                                                                                          AS 通信欄                   ")
        SQLBldr.AppendLine("   ,'21'                                                                                                                        AS 帳票種別                 ")
        SQLBldr.AppendLine("   ,REPLACE(TRIM(T05.KANJI1),'　','') + 'コンテナ'                                                                              AS 品名                     ")
        SQLBldr.AppendLine("   ,T01.CTNTYPE                                                                                                                 AS コンテナ記号             ")
        SQLBldr.AppendLine("   ,CONVERT(VARCHAR, T01.CTNNO)                                                                                                 AS コンテナ番号             ")
        SQLBldr.AppendLine("   ,CASE                                                                                                                                                    ")
        SQLBldr.AppendLine("        WHEN coalesce(T04.DUMMYKBN, '00') = '01' THEN '0'                                                                                                     ")
        SQLBldr.AppendLine("        ELSE '1'                                                                                                                                            ")
        SQLBldr.AppendLine("    END                                                                                                                         AS 個数                     ")
        SQLBldr.AppendLine("   ,T04.CARGOWEIGHT                                                                                                             AS トン数                   ")
        SQLBldr.AppendLine("   ,FORMAT(T01.LEASEMONTHSTARTYMD, 'yyyy/M/d')                                                                                  AS '使用期間（自）'         ")
        SQLBldr.AppendLine("   ,FORMAT(T01.LEASEMONTHENDYMD, 'yyyy/M/d')                                                                                    AS '使用期間（至）'         ")
        SQLBldr.AppendLine("   ,DATEDIFF(day, CONVERT(date, T01.LEASEMONTHSTARTYMD), DATEADD(DAY,1,CONVERT(date, T01.LEASEMONTHENDYMD)))                    AS '使用期間（日数）'       ")
        SQLBldr.AppendLine("   ,FORMAT(T01.MONTHLEASEFEE, '0')                                                                                              AS 単価                     ")
        SQLBldr.AppendLine("   ,FORMAT(T01.MONTHLEASEFEE, '0')                                                                                              AS 金額                     ")
        SQLBldr.AppendLine("   ,T01.TAXRATE                                                                                                                 AS 税率                     ")
        SQLBldr.AppendLine("   ,FORMAT(T07.SUM_LEASEFEE, '0')                                                                                               AS 品名の小計               ")
        SQLBldr.AppendLine("   ,''                                                                                                                          AS 備考                     ")
        SQLBldr.AppendLine("   ,REPLACE(TRIM(T05.KANJI1),'　','') + 'コンテナ'                                                                              AS LK65                     ")
        SQLBldr.AppendLine("   ,''                                                                                                                          AS 単位                     ")
        SQLBldr.AppendLine("   ,''                                                                                                                          AS 請求書用税区分名         ")
        SQLBldr.AppendLine("FROM                                                                                                                                                        ")
        SQLBldr.AppendLine("    LNG.LNT0042_LEASEDATA T01                                                                                                                               ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNT0041_LEASEAPPLY T41                                                                                                                              ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T41.LEASENO  = T01.LEASENO                                                                                                                              ")
        SQLBldr.AppendLine("AND T41.CTNTYPE  = T01.CTNTYPE                                                                                                                              ")
        SQLBldr.AppendLine("AND T41.CTNNO    = T01.CTNNO                                                                                                                                ")
        SQLBldr.AppendLine("AND T01.LEASEMONTHSTARTYMD BETWEEN T41.APPLYSTARTYMD AND T41.APPLYENDYMD                                                                                    ")
        SQLBldr.AppendLine("LEFT JOIN (                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                  ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                          ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.INVOICEOUTORGCD                                                                                                                                  ")
        SQLBldr.AppendLine("       ,T1.DEPOSITYMD                                                                                                                                       ")
        SQLBldr.AppendLine("       ,T1.INVSUBCD                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.DELFLG                                                                                                                                           ")
        SQLBldr.AppendLine("       ,SUM(T1.MONTHLEASEFEE) AS SUM_LEASEFEE                                                                                                               ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.MONTHLEASEFEE * 10 / 100) ,0)) AS SUM_LEASEFEE_DTL                                                                                    ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                    ")
        SQLBldr.AppendLine("        LNG.LNT0042_LEASEDATA T1                                                                                                                            ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                   ")
        SQLBldr.AppendLine("        T1.TAXRATE = '10'                                                                                                                                   ")
        SQLBldr.AppendLine("    AND T1.LEASEAPPLYKBN <> '2'                                                                                                                             ")
        SQLBldr.AppendLine("    AND T1.DELFLG = @P01                                                                                                                                    ")
        SQLBldr.AppendLine("    GROUP BY                                                                                                                                                ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                          ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.INVOICEOUTORGCD                                                                                                                                  ")
        SQLBldr.AppendLine("       ,T1.DEPOSITYMD                                                                                                                                       ")
        SQLBldr.AppendLine("       ,T1.INVSUBCD                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.DELFLG                                                                                                                                           ")
        SQLBldr.AppendLine(") T02                                                                                                                                                       ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T01.KEIJOYM         = T02.KEIJOYM                                                                                                                       ")
        SQLBldr.AppendLine("AND T01.TORICODE        = T02.TORICODE                                                                                                                      ")
        SQLBldr.AppendLine("AND T01.INVOICEOUTORGCD = T02.INVOICEOUTORGCD                                                                                                               ")
        SQLBldr.AppendLine("AND T01.DEPOSITYMD      = T02.DEPOSITYMD                                                                                                                    ")
        SQLBldr.AppendLine("AND T01.INVSUBCD        = T02.INVSUBCD                                                                                                                      ")
        SQLBldr.AppendLine("AND T02.DELFLG          = @P01                                                                                                                              ")
        SQLBldr.AppendLine("INNER JOIN                                                                                                                                                  ")
        SQLBldr.AppendLine("    LNG.LNM0024_KEKKJM T03                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T03.TORICODE                  = T01.TORICODE                                                                                                            ")
        SQLBldr.AppendLine("AND T03.INVFILINGDEPT             = T01.INVOICEOUTORGCD                                                                                                     ")
        SQLBldr.AppendLine("AND FORMAT(T03.INVKESAIKBN, '00') = T01.INVKESAIKBN                                                                                                         ")
        SQLBldr.AppendLine("AND T03.DELFLG                    = @P01                                                                                                                    ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0002_RECONM T04                                                                                                                                  ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T04.CTNTYPE = T01.CTNTYPE                                                                                                                               ")
        SQLBldr.AppendLine("AND T04.CTNNO   = T01.CTNNO                                                                                                                                 ")
        SQLBldr.AppendLine("AND T04.DELFLG  = @P01                                                                                                                                      ")
        SQLBldr.AppendLine("LEFT JOIN                                                                                                                                                   ")
        SQLBldr.AppendLine("    LNG.LNM0022_CLASS T05                                                                                                                                   ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T05.BIGCTNCD    = T04.BIGCTNCD                                                                                                                          ")
        SQLBldr.AppendLine("AND T05.MIDDLECTNCD = T04.MIDDLECTNCD                                                                                                                       ")
        SQLBldr.AppendLine("AND T05.SMALLCTNCD  = T04.SMALLCTNCD                                                                                                                        ")
        SQLBldr.AppendLine("AND T05.DELFLG      = @P01                                                                                                                                  ")
        SQLBldr.AppendLine("LEFT JOIN(                                                                                                                                                  ")
        SQLBldr.AppendLine("    SELECT TOP(1)                                                                                                                                           ")
        SQLBldr.AppendLine("        T1.USERID                                                                                                                                           ")
        SQLBldr.AppendLine("       ,T1.STAFFNAMEL                                                                                                                                       ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                    ")
        SQLBldr.AppendLine("        COM.LNS0001_USER T1                                                                                                                                 ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                   ")
        SQLBldr.AppendLine("        T1.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                                           ")
        SQLBldr.AppendLine("    AND T1.STYMD  <= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'                                                                                  ")
        SQLBldr.AppendLine("    AND T1.ENDYMD >= '" & htParm(SELECT_INVOICE_COOP.SL_NOW).ToString & "'                                                                                  ")
        SQLBldr.AppendLine("    AND T1.DELFLG  = @P01                                                                                                                                   ")
        SQLBldr.AppendLine("    ORDER BY                                                                                                                                                ")
        SQLBldr.AppendLine("        T1.STYMD DESC                                                                                                                                       ")
        SQLBldr.AppendLine(") T06                                                                                                                                                       ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T06.USERID  = '" & htParm(SELECT_INVOICE_COOP.SL_LOGIN_USER).ToString & "'                                                                              ")
        SQLBldr.AppendLine("LEFT JOIN (                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                  ")
        SQLBldr.AppendLine("        T1.KEIJOYM            AS KEIJOYM                                                                                                                    ")
        SQLBldr.AppendLine("       ,T1.TORICODE           AS TORICODE                                                                                                                   ")
        SQLBldr.AppendLine("       ,T1.INVOICEOUTORGCD    AS INVOICEOUTORGCD                                                                                                            ")
        SQLBldr.AppendLine("       ,T1.DEPOSITYMD         AS DEPOSITYMD                                                                                                                 ")
        SQLBldr.AppendLine("       ,T1.INVSUBCD           AS INVSUBCD                                                                                                                   ")
        SQLBldr.AppendLine("       ,T3.KANJI1             AS KANJI1                                                                                                                     ")
        SQLBldr.AppendLine("       ,T1.DELFLG             AS DELFLG                                                                                                                     ")
        SQLBldr.AppendLine("       ,COUNT(T1.LEASENO)     AS KENSU                                                                                                                      ")
        SQLBldr.AppendLine("       ,SUM(T1.MONTHLEASEFEE) AS SUM_LEASEFEE                                                                                                               ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                    ")
        SQLBldr.AppendLine("        LNG.LNT0042_LEASEDATA T1                                                                                                                            ")
        SQLBldr.AppendLine("    LEFT JOIN                                                                                                                                               ")
        SQLBldr.AppendLine("        LNG.LNM0002_RECONM T2                                                                                                                               ")
        SQLBldr.AppendLine("    ON                                                                                                                                                      ")
        SQLBldr.AppendLine("        T2.CTNTYPE = T1.CTNTYPE                                                                                                                             ")
        SQLBldr.AppendLine("    AND T2.CTNNO   = T1.CTNNO                                                                                                                               ")
        SQLBldr.AppendLine("    AND T2.DELFLG  = @P01                                                                                                                                   ")
        SQLBldr.AppendLine("    LEFT JOIN                                                                                                                                               ")
        SQLBldr.AppendLine("        LNG.LNM0022_CLASS T3                                                                                                                                ")
        SQLBldr.AppendLine("    ON                                                                                                                                                      ")
        SQLBldr.AppendLine("        T3.BIGCTNCD    = T2.BIGCTNCD                                                                                                                        ")
        SQLBldr.AppendLine("    AND T3.MIDDLECTNCD = T2.MIDDLECTNCD                                                                                                                     ")
        SQLBldr.AppendLine("    AND T3.SMALLCTNCD  = T2.SMALLCTNCD                                                                                                                      ")
        SQLBldr.AppendLine("    AND T3.DELFLG      = @P01                                                                                                                               ")
        SQLBldr.AppendLine("    GROUP BY                                                                                                                                                ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                          ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.INVOICEOUTORGCD                                                                                                                                  ")
        SQLBldr.AppendLine("       ,T1.DEPOSITYMD                                                                                                                                       ")
        SQLBldr.AppendLine("       ,T1.INVSUBCD                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T3.KANJI1                                                                                                                                           ")
        SQLBldr.AppendLine("       ,T1.DELFLG                                                                                                                                           ")
        SQLBldr.AppendLine(") T07                                                                                                                                                       ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T07.KEIJOYM         = T01.KEIJOYM                                                                                                                       ")
        SQLBldr.AppendLine("AND T07.TORICODE        = T01.TORICODE                                                                                                                      ")
        SQLBldr.AppendLine("AND T07.INVOICEOUTORGCD = T01.INVOICEOUTORGCD                                                                                                               ")
        SQLBldr.AppendLine("AND T07.DEPOSITYMD      = T01.DEPOSITYMD                                                                                                                    ")
        SQLBldr.AppendLine("AND T07.INVSUBCD        = T01.INVSUBCD                                                                                                                      ")
        SQLBldr.AppendLine("AND T07.KANJI1          = T05.KANJI1                                                                                                                        ")
        SQLBldr.AppendLine("AND T07.DELFLG          = @P01                                                                                                                              ")
        SQLBldr.AppendLine("LEFT JOIN (                                                                                                                                                 ")
        SQLBldr.AppendLine("    SELECT                                                                                                                                                  ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                          ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.INVOICEOUTORGCD                                                                                                                                  ")
        SQLBldr.AppendLine("       ,T1.DEPOSITYMD                                                                                                                                       ")
        SQLBldr.AppendLine("       ,T1.INVSUBCD                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.DELFLG                                                                                                                                           ")
        SQLBldr.AppendLine("       ,SUM(T1.MONTHLEASEFEE) AS SUM_LEASEFEE                                                                                                               ")
        SQLBldr.AppendLine("       ,SUM(ROUND((T1.MONTHLEASEFEE * 8 / 100) ,0)) AS SUM_LEASEFEE_DTL                                                                                     ")
        SQLBldr.AppendLine("    FROM                                                                                                                                                    ")
        SQLBldr.AppendLine("        LNG.LNT0042_LEASEDATA T1                                                                                                                            ")
        SQLBldr.AppendLine("    WHERE                                                                                                                                                   ")
        SQLBldr.AppendLine("        T1.TAXRATE = '8'                                                                                                                                    ")
        SQLBldr.AppendLine("    AND T1.LEASEAPPLYKBN <> '2'                                                                                                                             ")
        SQLBldr.AppendLine("    AND T1.DELFLG = @P01                                                                                                                                    ")
        SQLBldr.AppendLine("    GROUP BY                                                                                                                                                ")
        SQLBldr.AppendLine("        T1.KEIJOYM                                                                                                                                          ")
        SQLBldr.AppendLine("       ,T1.TORICODE                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.INVOICEOUTORGCD                                                                                                                                  ")
        SQLBldr.AppendLine("       ,T1.DEPOSITYMD                                                                                                                                       ")
        SQLBldr.AppendLine("       ,T1.INVSUBCD                                                                                                                                         ")
        SQLBldr.AppendLine("       ,T1.DELFLG                                                                                                                                           ")
        SQLBldr.AppendLine(") T08                                                                                                                                                       ")
        SQLBldr.AppendLine("ON                                                                                                                                                          ")
        SQLBldr.AppendLine("    T01.KEIJOYM         = T08.KEIJOYM                                                                                                                       ")
        SQLBldr.AppendLine("AND T01.TORICODE        = T08.TORICODE                                                                                                                      ")
        SQLBldr.AppendLine("AND T01.INVOICEOUTORGCD = T08.INVOICEOUTORGCD                                                                                                               ")
        SQLBldr.AppendLine("AND T01.DEPOSITYMD      = T08.DEPOSITYMD                                                                                                                    ")
        SQLBldr.AppendLine("AND T01.INVSUBCD        = T08.INVSUBCD                                                                                                                      ")
        SQLBldr.AppendLine("AND T08.DELFLG          = @P01                                                                                                                              ")
        SQLBldr.AppendLine("OUTER APPLY(                                                                                                                                                ")
        SQLBldr.AppendLine("        SELECT                                                                                                                                              ")
        SQLBldr.AppendLine("            TOP 1 T19.INVKESAIKBN                                                                                                                           ")
        SQLBldr.AppendLine("        FROM                                                                                                                                                ")
        SQLBldr.AppendLine("            lng.LNT0042_LEASEDATA T19                                                                                                                     ")
        SQLBldr.AppendLine("        WHERE                                                                                                                                               ")
        SQLBldr.AppendLine("            T19.KEIJOYM = T01.KEIJOYM                                                                                                                       ")
        SQLBldr.AppendLine("            AND T19.TORICODE = T01.TORICODE                                                                                                                 ")
        SQLBldr.AppendLine("            AND T19.DEPOSITYMD = T01.DEPOSITYMD                                                                                                             ")
        SQLBldr.AppendLine("            AND T19.INVOICEOUTORGCD = T01.INVOICEOUTORGCD                                                                                                   ")
        SQLBldr.AppendLine("            AND T19.LEASEAPPLYKBN <> '2'                                                                                                                    ")
        SQLBldr.AppendLine("            AND T19.DELFLG = @P01                                                                                                                           ")
        SQLBldr.AppendLine("    ) T09                                                                                                                                                   ")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0024_KEKKJM T10                                                                                                                          ")
        SQLBldr.AppendLine("    ON  T10.TORICODE = T01.TORICODE                                                                                                                         ")
        SQLBldr.AppendLine("    AND T10.INVFILINGDEPT = T01.INVOICEOUTORGCD                                                                                                             ")
        SQLBldr.AppendLine("    AND T10.INVKESAIKBN =  T09.INVKESAIKBN                                                                                                                  ")
        SQLBldr.AppendLine("LEFT JOIN lng.LNM0037_SLIPDESCRIPTION T11                                                                                                                 ")
        SQLBldr.AppendLine("    ON  T11.TORICODE = T01.TORICODE                                                                                                                         ")
        SQLBldr.AppendLine("    AND T11.INVFILINGDEPT = T01.INVOICEOUTORGCD                                                                                                             ")
        SQLBldr.AppendLine("    AND T11.INVSUBCD =  T01.INVSUBCD                                                                                                                        ")
        SQLBldr.AppendLine("    AND T11.INVOICETYPE = '3'                                                                                                                               ")
        SQLBldr.AppendLine("    AND T11.DELFLG = @P01                                                                                                                                   ")
        SQLBldr.AppendLine("WHERE                                                                                                                                                       ")
        SQLBldr.AppendLine("    T01.DELFLG          = @P01                                                                                                                              ")
        SQLBldr.AppendLine("AND T01.LEASEAPPLYKBN   <> '2'                                                                                                                              ")
        SQLBldr.AppendLine("AND T01.KEIJOYM         = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJOYM).ToString & "'                                                                         ")
        SQLBldr.AppendLine("AND T01.TORICODE        = '" & htParm(SELECT_INVOICE_COOP.SL_TORICODE).ToString & "'                                                                        ")
        SQLBldr.AppendLine("AND T01.INVOICEOUTORGCD = '" & htParm(SELECT_INVOICE_COOP.SL_KEIJYOBRANCHCD).ToString & "'                                                                  ")
        SQLBldr.AppendLine("AND T01.DEPOSITYMD      = '" & htParm(SELECT_INVOICE_COOP.SL_DEPOSITYMD).ToString & "'                                                                      ")
        SQLBldr.AppendLine("AND T01.INVSUBCD      = " & htParm(SELECT_INVOICE_COOP.SL_INVSUBCD).ToString & "                                                                            ")
        SQLBldr.AppendLine("ORDER BY                                                                                                                                                    ")
        SQLBldr.AppendLine("   T01.INVSUBCD                                                                                                                                             ")
        SQLBldr.AppendLine("   ,CASE T41.CONTRALNTYPE                                                                                                                                   ")
        SQLBldr.AppendLine("        WHEN '1' THEN 1                                                                                                                                     ")
        SQLBldr.AppendLine("    	WHEN '3' THEN 2                                                                                                                                     ")
        SQLBldr.AppendLine("    	WHEN '2' THEN 3                                                                                                                                     ")
        SQLBldr.AppendLine("    END                                                                                                                                                     ")
        SQLBldr.AppendLine("   ,T01.CTNTYPE                                                                                                                                             ")
        SQLBldr.AppendLine("   ,T01.CTNNO                                                                                                                                               ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        '取得データ返却
        Return dt

    End Function

#End Region

#Region "請求連携 共通"
    ''' <summary>
    ''' 請求連携 仮請求番号用の採番値を取得する
    ''' </summary>
    ''' <param name="sqlCon"></param>
    ''' <remarks></remarks>
    Public Shared Function GetNewProvInvoiceNoSEQ(sqlCon As MySqlConnection, ByVal KeijoYM As String) As Integer
        Dim dt = New DataTable
        Dim ProvInvoiceNoSEQ As Integer = 0

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine(" SELECT                           ")
        SQLBldr.AppendLine("     coalesce(MAX(SEQ),0)    AS SEQ ")
        SQLBldr.AppendLine(" FROM                             ")
        SQLBldr.AppendLine("     LNG.LNT0084_PROVINVOICENOSEQ ")
        SQLBldr.AppendLine(" WHERE                            ")
        SQLBldr.AppendLine("     KEIJOYM = '" & KeijoYM & "'  ")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon)

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        If dt.Rows.Count > 0 Then
            ProvInvoiceNoSEQ = CInt(dt.Rows(0)("SEQ").ToString)
        End If

        Return ProvInvoiceNoSEQ

    End Function

    ''' <summary>
    ''' 請求連携 仮請求番号用の採番値を登録・更新する
    ''' </summary>
    ''' <param name="sqlCon"></param>
    ''' <param name="sqlTran"></param>
    ''' <remarks></remarks>
    Public Shared Sub InsertUpdateProvInvoiceNoSEQ(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, htInsData As Hashtable)

        '◯データ登録・更新SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine(" DECLARE @hensuu AS bigint ;                  ")
        SQLBldr.AppendLine("     SET @hensuu = 0 ;                        ")
        SQLBldr.AppendLine(" DECLARE hensuu CURSOR FOR                    ")
        SQLBldr.AppendLine("     SELECT                                   ")
        SQLBldr.AppendLine("         UPDTIMSTP AS hensuu                  ")
        SQLBldr.AppendLine("     FROM                                     ")
        SQLBldr.AppendLine("         LNG.LNT0084_PROVINVOICENOSEQ         ")
        SQLBldr.AppendLine("     WHERE                                    ")
        SQLBldr.AppendLine("         KEIJOYM = @KEIJOYM                   ")
        SQLBldr.AppendLine(" OPEN hensuu ;                                ")
        SQLBldr.AppendLine(" FETCH NEXT FROM hensuu INTO @hensuu ;        ")
        SQLBldr.AppendLine(" IF (@@FETCH_STATUS = 0)                      ")
        SQLBldr.AppendLine("     UPDATE LNG.LNT0084_PROVINVOICENOSEQ      ")
        SQLBldr.AppendLine("     SET                                      ")
        SQLBldr.AppendLine("         DELFLG    = @DELFLG                  ")
        SQLBldr.AppendLine("        ,SEQ       = @SEQ                     ")
        SQLBldr.AppendLine("        ,UPDYMD    = @INITYMD                 ")
        SQLBldr.AppendLine("        ,UPDUSER   = @INITUSER                ")
        SQLBldr.AppendLine("        ,UPDTERMID = @INITTERMID              ")
        SQLBldr.AppendLine("        ,UPDPGID   = @INITPGID                ")
        SQLBldr.AppendLine("     WHERE                                    ")
        SQLBldr.AppendLine("         KEIJOYM = @KEIJOYM                   ")
        SQLBldr.AppendLine(" IF (@@FETCH_STATUS <> 0)                     ")
        SQLBldr.AppendLine("     INSERT INTO LNG.LNT0084_PROVINVOICENOSEQ ")
        SQLBldr.AppendLine("         (DELFLG                              ")
        SQLBldr.AppendLine("         ,KEIJOYM                             ")
        SQLBldr.AppendLine("         ,SEQ                                 ")
        SQLBldr.AppendLine("         ,INITYMD                             ")
        SQLBldr.AppendLine("         ,INITUSER                            ")
        SQLBldr.AppendLine("         ,INITTERMID                          ")
        SQLBldr.AppendLine("         ,INITPGID                            ")
        SQLBldr.AppendLine("         ,UPDYMD                              ")
        SQLBldr.AppendLine("         ,UPDUSER                             ")
        SQLBldr.AppendLine("         ,UPDTERMID                           ")
        SQLBldr.AppendLine("         ,UPDPGID)                            ")
        SQLBldr.AppendLine("     VALUES                                   ")
        SQLBldr.AppendLine("         (@DELFLG                             ")
        SQLBldr.AppendLine("         ,@KEIJOYM                            ")
        SQLBldr.AppendLine("         ,@SEQ                                ")
        SQLBldr.AppendLine("         ,@INITYMD                            ")
        SQLBldr.AppendLine("         ,@INITUSER                           ")
        SQLBldr.AppendLine("         ,@INITTERMID                         ")
        SQLBldr.AppendLine("         ,@INITPGID                           ")
        SQLBldr.AppendLine("         ,NULL                                ")
        SQLBldr.AppendLine("         ,NULL                                ")
        SQLBldr.AppendLine("         ,NULL                                ")
        SQLBldr.AppendLine("         ,NULL) ;                             ")
        SQLBldr.AppendLine(" CLOSE hensuu ;                               ")
        SQLBldr.AppendLine(" DEALLOCATE hensuu ;                          ")

        Using sqlOrderCmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("KEIJOYM", MySqlDbType.Int32).Value = htInsData(INSERT_PROVINVOICENOSEQ.IP_KEIJOYM)                           '計上年月
                .Add("SEQ", MySqlDbType.VarChar).Value = htInsData(INSERT_PROVINVOICENOSEQ.IP_SEQ)                              'SEQ
                .Add("DELFLG", MySqlDbType.Int32).Value = BlankToDBNull(htInsData(INSERT_PROVINVOICENOSEQ.IP_DELFLG))              '削除フラグ
                .Add("INITYMD", MySqlDbType.DateTime).Value = BlankToDBNull(htInsData(INSERT_PROVINVOICENOSEQ.IP_INITYMD))       '登録年月日
                .Add("INITUSER", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(INSERT_PROVINVOICENOSEQ.IP_INITUSER))     '登録ユーザーID
                .Add("INITTERMID", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(INSERT_PROVINVOICENOSEQ.IP_INITTERMID)) '登録端末
                .Add("INITPGID", MySqlDbType.VarChar).Value = BlankToDBNull(htInsData(INSERT_PROVINVOICENOSEQ.IP_INITPGID))     '登録プログラムID
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

#End Region

#Region "その他"
    ''' <summary>
    ''' DataTableの指定位置からString値を取得する
    ''' </summary>
    ''' <param name="objOutputData">DataTable</param>
    ''' <param name="nRow">行</param>
    ''' <param name="strCol">列</param>
    ''' <param name="strDefault">規定値</param>
    ''' <returns>取得データ</returns>
    ''' <remarks>値がDBNULLの場合は規定値が返却される</remarks>
    Private Shared Function GetStringValue(ByVal objOutputData As DataTable, ByVal nRow As Integer, ByVal strCol As String, Optional ByVal strDefault As String = "") As String
        Dim strRet As String = strDefault
        Dim objCell As Object = objOutputData.Rows(nRow)(strCol)

        If Not IsDBNull(objCell) Then
            strRet = objCell.ToString
        End If

        Return strRet
    End Function

    Public Shared Function BlankToDBNull(strTarger As Object) As Object

        If strTarger Is Nothing Then
            Return CType(DBNull.Value, Object)
        ElseIf strTarger.ToString.Trim = "" Then
            Return CType(DBNull.Value, Object)
        Else
            Return strTarger
        End If

    End Function

#End Region

#Region "経理仕分け用仮テーブル作成"
    Public Shared Sub CreateTemporaryTable(ByVal KEIJOYM As String, ByVal TORICODE As String)

        Dim dt As New DataTable
        Dim Datadt As New DataTable
        Dim CS0050SESSION As New CS0050SESSION

        Using SQLcon As MySqlConnection = CS0050SESSION.getConnection
            SQLcon.Open()
            '細分コード複数件チェック
            dt = GetInvSubCdCount(SQLcon, KEIJOYM, TORICODE)

            If dt.Rows.Count <> 0 AndAlso dt.Rows.Count <> 1 Then
                '仮テーブル作成用データ取得
                Datadt = GetTableData(SQLcon, KEIJOYM, TORICODE)

                Try
                    Using tran = SQLcon.BeginTransaction

                        '仮テーブル削除
                        DeleteTable(SQLcon, tran, KEIJOYM, TORICODE)

                        '仮テーブル作成
                        For Each rowData As DataRow In Datadt.Rows
                            CreateTable(SQLcon, tran, rowData)
                        Next

                        'トランザクションコミット
                        tran.Commit()

                    End Using

                Catch ex As Exception
                    Exit Sub
                End Try

            End If

        End Using

    End Sub

    Public Shared Function GetInvSubCdCount(sqlCon As MySqlConnection, ByVal KEIJOYM As String, ByVal TORICODE As String) As DataTable

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT DISTINCT")
        SQLBldr.AppendLine("    T01.KEIJOYM")
        SQLBldr.AppendLine("   ,T01.TORICODE")
        SQLBldr.AppendLine("   ,T01.INVSUBCD")
        SQLBldr.AppendLine("FROM(")
        SQLBldr.AppendLine("    SELECT")
        SQLBldr.AppendLine("        A01.KEIJOYM")
        SQLBldr.AppendLine("       ,A01.TORICODE")
        SQLBldr.AppendLine("       ,A03.INVSUBCD")
        SQLBldr.AppendLine("    FROM ")
        SQLBldr.AppendLine("        LNG.LNT0067_INVOICEDATA_RENT A01")
        SQLBldr.AppendLine("    LEFT JOIN LNG.LNT0064_INVOICEHEAD A02")
        SQLBldr.AppendLine("       ON  A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("       AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        SQLBldr.AppendLine("       AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        SQLBldr.AppendLine("       AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("    INNER JOIN LNG.LNT0017_RESSNF A03")
        SQLBldr.AppendLine("       ON  A01.TORICODE = A03.TORICODE")
        SQLBldr.AppendLine("       AND A01.INVOICEORGCODE = A03.INVFILINGDEPT")
        SQLBldr.AppendLine("       AND A01.KEIJOYM = A03.KEIJOYM")
        SQLBldr.AppendLine("       AND A02.SCHEDATEPAYMENT = A02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("       AND A01.SHIPYMD = A03.SHIPYMD")
        SQLBldr.AppendLine("       AND A01.CTNTYPE = A03.CTNTYPE")
        SQLBldr.AppendLine("       AND A01.CTNNO = A03.CTNNO")
        SQLBldr.AppendLine("       AND A01.SAMEDAYCNT = A03.SAMEDAYCNT")
        SQLBldr.AppendLine("       AND A01.CTNLINENO = A03.CTNLINENO")
        SQLBldr.AppendLine("       AND A03.DELFLG = @P01")
        SQLBldr.AppendLine("    UNION ALL")
        SQLBldr.AppendLine("    SELECT")
        SQLBldr.AppendLine("        B01.KEIJOYM")
        SQLBldr.AppendLine("       ,B01.TORICODE")
        SQLBldr.AppendLine("       ,B03.INVSUBCD")
        SQLBldr.AppendLine("    FROM")
        SQLBldr.AppendLine("        LNG.LNT0068_INVOICEDATA_LEASE B01")
        SQLBldr.AppendLine("    LEFT JOIN LNG.LNT0064_INVOICEHEAD B02")
        SQLBldr.AppendLine("       ON  B01.KEIJOYM = B02.KEIJOYM")
        SQLBldr.AppendLine("       AND B01.INVOICENUMBER = B02.INVOICENUMBER")
        SQLBldr.AppendLine("       AND B01.INVOICEORGCODE = B02.INVOICEORGCODE")
        SQLBldr.AppendLine("       AND B01.TORICODE = B02.TORICODE")
        SQLBldr.AppendLine("    INNER JOIN LNG.LNT0042_LEASEDATA B03")
        SQLBldr.AppendLine("       ON  B03.TORICODE = B01.TORICODE")
        SQLBldr.AppendLine("       AND B03.INVOICEOUTORGCD = B01.INVOICEORGCODE")
        SQLBldr.AppendLine("       AND B03.KEIJOYM = B01.KEIJOYM")
        SQLBldr.AppendLine("       AND B03.DEPOSITYMD = B02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("       AND B03.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("       AND B03.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("       AND B03.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("       AND B03.LEASEMONTHSTARTYMD = B01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("       AND B03.DELFLG = @P01")
        SQLBldr.AppendLine("    INNER JOIN LNG.LNT0041_LEASEAPPLY B04")
        SQLBldr.AppendLine("       ON  B04.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("       AND B04.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("       AND B04.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("       AND B01.LEASEMONTHSTARTYMD BETWEEN B04.APPLYSTARTYMD AND B04.APPLYENDYMD")
        SQLBldr.AppendLine("    UNION ALL")
        SQLBldr.AppendLine("    SELECT")
        SQLBldr.AppendLine("        C01.KEIJOYM")
        SQLBldr.AppendLine("       ,C01.TORICODE")
        SQLBldr.AppendLine("       ,'0' AS INVSUBCD")
        SQLBldr.AppendLine("    FROM")
        SQLBldr.AppendLine("        LNG.LNT0080_INVOICEDATA_ADDAMOUNT C01")
        SQLBldr.AppendLine("    ) T01")
        SQLBldr.AppendLine("WHERE")
        SQLBldr.AppendLine("    T01.KEIJOYM = '" & KEIJOYM & "'")
        SQLBldr.AppendLine("    AND T01.TORICODE = '" & TORICODE & "'")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        Return dt

    End Function

    Public Shared Function GetTableData(sqlCon As MySqlConnection, ByVal KEIJOYM As String, ByVal TORICODE As String) As DataTable

        Dim dt = New DataTable

        '◯データ検索SQL
        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("SELECT")
        SQLBldr.AppendLine("    T01.TORICODE")
        SQLBldr.AppendLine("   ,T01.INVSUBCD")
        SQLBldr.AppendLine("   ,T01.ACCOUNT")
        SQLBldr.AppendLine("   ,FORMAT(T01.AMOUNTWITHOUTTAX10 + T01.AMOUNTWITHOUTTAX08,'0') AS AMOUNTWITHOUTTAX")
        SQLBldr.AppendLine("   ,FORMAT(ROUND(T01.AMOUNTWITHOUTTAX10 * 0.1, 0) + ROUND(T01.AMOUNTWITHOUTTAX08 * 0.08, 0),'0') AS CONSUMPTIONTAX")
        SQLBldr.AppendLine("   ,FORMAT(T01.AMOUNTWITHOUTTAX10 + ROUND(T01.AMOUNTWITHOUTTAX10 * 0.1, 0) + ")
        SQLBldr.AppendLine("    T01.AMOUNTWITHOUTTAX08 + ROUND(T01.AMOUNTWITHOUTTAX08 * 0.08, 0),'0') AS AMOUNTINCLUDINGTAX")
        SQLBldr.AppendLine("FROM(")
        SQLBldr.AppendLine("    SELECT")
        SQLBldr.AppendLine("        T11.KEIJOYM")
        SQLBldr.AppendLine("       ,T11.TORICODE")
        SQLBldr.AppendLine("       ,T11.INVSUBCD")
        SQLBldr.AppendLine("       ,T11.ACCOUNT")
        SQLBldr.AppendLine("       ,SUM(T11.AMOUNTWITHOUTTAX10) AS AMOUNTWITHOUTTAX10")
        SQLBldr.AppendLine("       ,SUM(T11.AMOUNTWITHOUTTAX08) AS AMOUNTWITHOUTTAX08")
        SQLBldr.AppendLine("    FROM(")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            A01.KEIJOYM")
        SQLBldr.AppendLine("           ,A01.TORICODE")
        SQLBldr.AppendLine("           ,A03.INVSUBCD")
        SQLBldr.AppendLine("           ,'41010301' AS ACCOUNT")
        SQLBldr.AppendLine("           ,A01.BILLINGFEE AS AMOUNTWITHOUTTAX10")
        SQLBldr.AppendLine("           ,0 AS AMOUNTWITHOUTTAX08")
        SQLBldr.AppendLine("        FROM ")
        SQLBldr.AppendLine("            LNG.LNT0067_INVOICEDATA_RENT A01")
        SQLBldr.AppendLine("        LEFT JOIN LNG.LNT0064_INVOICEHEAD A02")
        SQLBldr.AppendLine("           ON  A01.KEIJOYM = A02.KEIJOYM")
        SQLBldr.AppendLine("           AND A01.INVOICENUMBER = A02.INVOICENUMBER")
        SQLBldr.AppendLine("           AND A01.INVOICEORGCODE = A02.INVOICEORGCODE")
        SQLBldr.AppendLine("           AND A01.TORICODE = A02.TORICODE")
        SQLBldr.AppendLine("        INNER JOIN LNG.LNT0017_RESSNF A03")
        SQLBldr.AppendLine("           ON  A01.TORICODE = A03.TORICODE")
        SQLBldr.AppendLine("           AND A01.INVOICEORGCODE = A03.INVFILINGDEPT")
        SQLBldr.AppendLine("           AND A01.KEIJOYM = A03.KEIJOYM")
        SQLBldr.AppendLine("           AND A02.SCHEDATEPAYMENT = A02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("           AND A01.SHIPYMD = A03.SHIPYMD")
        SQLBldr.AppendLine("           AND A01.CTNTYPE = A03.CTNTYPE")
        SQLBldr.AppendLine("           AND A01.CTNNO = A03.CTNNO")
        SQLBldr.AppendLine("           AND A01.SAMEDAYCNT = A03.SAMEDAYCNT")
        SQLBldr.AppendLine("           AND A01.CTNLINENO = A03.CTNLINENO")
        SQLBldr.AppendLine("           AND A03.DELFLG = @P01")
        SQLBldr.AppendLine("        UNION ALL")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            B01.KEIJOYM")
        SQLBldr.AppendLine("           ,B01.TORICODE")
        SQLBldr.AppendLine("           ,B03.INVSUBCD")
        SQLBldr.AppendLine("           ,CASE")
        SQLBldr.AppendLine("                WHEN B04.CONTRALNTYPE = '1' THEN '41010203'")
        SQLBldr.AppendLine("                WHEN B04.CONTRALNTYPE = '2' THEN '41010202'")
        SQLBldr.AppendLine("                WHEN B04.CONTRALNTYPE = '3' THEN '41010201'")
        SQLBldr.AppendLine("            END AS ACCOUNT")
        SQLBldr.AppendLine("           ,B01.MONTHLEASEFEE AS AMOUNTWITHOUTTAX10")
        SQLBldr.AppendLine("           ,0 AS AMOUNTWITHOUTTAX08")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE B01")
        SQLBldr.AppendLine("        LEFT JOIN LNG.LNT0064_INVOICEHEAD B02")
        SQLBldr.AppendLine("           ON  B01.KEIJOYM = B02.KEIJOYM")
        SQLBldr.AppendLine("           AND B01.INVOICENUMBER = B02.INVOICENUMBER")
        SQLBldr.AppendLine("           AND B01.INVOICEORGCODE = B02.INVOICEORGCODE")
        SQLBldr.AppendLine("           AND B01.TORICODE = B02.TORICODE")
        SQLBldr.AppendLine("        INNER JOIN LNG.LNT0042_LEASEDATA B03")
        SQLBldr.AppendLine("           ON  B03.TORICODE = B01.TORICODE")
        SQLBldr.AppendLine("           AND B03.INVOICEOUTORGCD = B01.INVOICEORGCODE")
        SQLBldr.AppendLine("           AND B03.KEIJOYM = B01.KEIJOYM")
        SQLBldr.AppendLine("           AND B03.DEPOSITYMD = B02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("           AND B03.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("           AND B03.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("           AND B03.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("           AND B03.LEASEMONTHSTARTYMD = B01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("           AND B03.DELFLG = @P01")
        SQLBldr.AppendLine("        INNER JOIN LNG.LNT0041_LEASEAPPLY B04")
        SQLBldr.AppendLine("           ON  B04.LEASENO = B01.LEASENO")
        SQLBldr.AppendLine("           AND B04.CTNTYPE = B01.CTNTYPE")
        SQLBldr.AppendLine("           AND B04.CTNNO = B01.CTNNO")
        SQLBldr.AppendLine("           AND B01.LEASEMONTHSTARTYMD BETWEEN B04.APPLYSTARTYMD AND B04.APPLYENDYMD")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("           B03.TAXRATE = '10'")
        SQLBldr.AppendLine("        UNION ALL")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            C01.KEIJOYM")
        SQLBldr.AppendLine("           ,C01.TORICODE")
        SQLBldr.AppendLine("           ,C03.INVSUBCD")
        SQLBldr.AppendLine("           ,CASE")
        SQLBldr.AppendLine("                WHEN C04.CONTRALNTYPE = '1' THEN '41010203'")
        SQLBldr.AppendLine("                WHEN C04.CONTRALNTYPE = '2' THEN '41010202'")
        SQLBldr.AppendLine("                WHEN C04.CONTRALNTYPE = '3' THEN '41010201'")
        SQLBldr.AppendLine("            END AS ACCOUNT")
        SQLBldr.AppendLine("           ,0 AS AMOUNTWITHOUTTAX10")
        SQLBldr.AppendLine("           ,C01.MONTHLEASEFEE AS AMOUNTWITHOUTTAX08")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            LNG.LNT0068_INVOICEDATA_LEASE C01")
        SQLBldr.AppendLine("        LEFT JOIN LNG.LNT0064_INVOICEHEAD C02")
        SQLBldr.AppendLine("           ON  C01.KEIJOYM = C02.KEIJOYM")
        SQLBldr.AppendLine("           AND C01.INVOICENUMBER = C02.INVOICENUMBER")
        SQLBldr.AppendLine("           AND C01.INVOICEORGCODE = C02.INVOICEORGCODE")
        SQLBldr.AppendLine("           AND C01.TORICODE = C02.TORICODE")
        SQLBldr.AppendLine("        INNER JOIN LNG.LNT0042_LEASEDATA C03")
        SQLBldr.AppendLine("           ON  C03.TORICODE = C01.TORICODE")
        SQLBldr.AppendLine("           AND C03.INVOICEOUTORGCD = C01.INVOICEORGCODE")
        SQLBldr.AppendLine("           AND C03.KEIJOYM = C01.KEIJOYM")
        SQLBldr.AppendLine("           AND C03.DEPOSITYMD = C02.SCHEDATEPAYMENT")
        SQLBldr.AppendLine("           AND C03.LEASENO = C01.LEASENO")
        SQLBldr.AppendLine("           AND C03.CTNTYPE = C01.CTNTYPE")
        SQLBldr.AppendLine("           AND C03.CTNNO = C01.CTNNO")
        SQLBldr.AppendLine("           AND C03.LEASEMONTHSTARTYMD = C01.LEASEMONTHSTARTYMD")
        SQLBldr.AppendLine("           AND C03.DELFLG = @P01")
        SQLBldr.AppendLine("        INNER JOIN LNG.LNT0041_LEASEAPPLY C04")
        SQLBldr.AppendLine("           ON  C04.LEASENO = C01.LEASENO")
        SQLBldr.AppendLine("           AND C04.CTNTYPE = C01.CTNTYPE")
        SQLBldr.AppendLine("           AND C04.CTNNO = C01.CTNNO")
        SQLBldr.AppendLine("           AND C01.LEASEMONTHSTARTYMD BETWEEN C04.APPLYSTARTYMD AND C04.APPLYENDYMD")
        SQLBldr.AppendLine("        WHERE")
        SQLBldr.AppendLine("           C03.TAXRATE = '8'")
        SQLBldr.AppendLine("        UNION ALL")
        SQLBldr.AppendLine("        SELECT")
        SQLBldr.AppendLine("            D01.KEIJOYM")
        SQLBldr.AppendLine("           ,D01.TORICODE")
        SQLBldr.AppendLine("           ,'0' AS INVSUBCD")
        SQLBldr.AppendLine("           ,D01.ACCOUNTCODE AS ACCOUNT")
        SQLBldr.AppendLine("           ,CASE")
        SQLBldr.AppendLine("                WHEN D01.AMOUNTTYPE = '2' AND D01.RENTADJUSTMENT IS NOT NULL THEN D01.RENTADJUSTMENT")
        SQLBldr.AppendLine("                WHEN D01.AMOUNTTYPE = '2' AND D01.LEASEADJUSTMENT IS NOT NULL THEN D01.LEASEADJUSTMENT")
        SQLBldr.AppendLine("                WHEN D01.AMOUNTTYPE = '5' THEN D01.MISCELLANEOUSEXPENSE")
        SQLBldr.AppendLine("            END AS AMOUNTWITHOUTTAX10")
        SQLBldr.AppendLine("           ,0 AS AMOUNTWITHOUTTAX08")
        SQLBldr.AppendLine("        FROM")
        SQLBldr.AppendLine("            LNG.LNT0080_INVOICEDATA_ADDAMOUNT D01")
        SQLBldr.AppendLine("        ) T11")
        SQLBldr.AppendLine("    WHERE")
        SQLBldr.AppendLine("        T11.KEIJOYM = '" & KEIJOYM & "'")
        SQLBldr.AppendLine("        AND T11.TORICODE = '" & TORICODE & "'")
        SQLBldr.AppendLine("    GROUP BY")
        SQLBldr.AppendLine("        T11.KEIJOYM")
        SQLBldr.AppendLine("       ,T11.TORICODE")
        SQLBldr.AppendLine("       ,T11.INVSUBCD")
        SQLBldr.AppendLine("       ,T11.ACCOUNT")
        SQLBldr.AppendLine("    )T01")

        Using SQLcmd As New MySqlCommand(SQLBldr.ToString, sqlCon)

            Dim PARA01 As MySqlParameter = SQLcmd.Parameters.Add("@P01", MySqlDbType.VarChar)  '削除フラグ

            PARA01.Value = C_DELETE_FLG.ALIVE

            'SQL実行
            Using SQLdr As MySqlDataReader = SQLcmd.ExecuteReader()
                '○ フィールド名とフィールドの型を取得
                For index As Integer = 0 To SQLdr.FieldCount - 1
                    dt.Columns.Add(SQLdr.GetName(index), SQLdr.GetFieldType(index))
                Next

                '○ テーブル検索結果をテーブル格納
                dt.Load(SQLdr)
            End Using

        End Using

        Return dt

    End Function

    Public Shared Sub DeleteTable(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, ByVal KEIJOYM As String, ByVal TORICODE As String)

        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine(" DELETE FROM LNG.ACC_AMOUNT")
        SQLBldr.AppendLine("    WHERE")
        SQLBldr.AppendLine("    TORICODE = @TORICODE")

        Using sqlOrderCmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("TORICODE", MySqlDbType.VarChar).Value = TORICODE                   '取引先コード

            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub

    Public Shared Sub CreateTable(sqlCon As MySqlConnection, sqlTran As MySqlTransaction, ByVal row As DataRow)

        Dim SQLBldr As New StringBuilder
        SQLBldr.AppendLine("INSERT INTO LNG.ACC_AMOUNT (")
        SQLBldr.AppendLine("    TORICODE")
        SQLBldr.AppendLine("  , INVSUBCD")
        SQLBldr.AppendLine("  , ACCOUNT")
        SQLBldr.AppendLine("  , AMOUNTWITHOUTTAX")
        SQLBldr.AppendLine("  , CONSUMPTIONTAX")
        SQLBldr.AppendLine("  , AMOUNTINCLUDINGTAX")
        SQLBldr.AppendLine(")")
        SQLBldr.AppendLine(" VALUES(")
        SQLBldr.AppendLine("    @TORICODE")
        SQLBldr.AppendLine("  , @INVSUBCD")
        SQLBldr.AppendLine("  , @ACCOUNT")
        SQLBldr.AppendLine("  , @AMOUNTWITHOUTTAX")
        SQLBldr.AppendLine("  , @CONSUMPTIONTAX")
        SQLBldr.AppendLine("  , @AMOUNTINCLUDINGTAX")
        SQLBldr.AppendLine(")")

        Using sqlOrderCmd As New MySqlCommand(SQLBldr.ToString, sqlCon, sqlTran)
            With sqlOrderCmd.Parameters
                .Add("TORICODE", MySqlDbType.VarChar).Value = row("TORICODE")
                .Add("INVSUBCD", MySqlDbType.Int32).Value = row("INVSUBCD")
                .Add("ACCOUNT", MySqlDbType.VarChar).Value = row("ACCOUNT")
                .Add("AMOUNTWITHOUTTAX", MySqlDbType.Decimal).Value = row("AMOUNTWITHOUTTAX")
                .Add("CONSUMPTIONTAX", MySqlDbType.Decimal).Value = row("CONSUMPTIONTAX")
                .Add("AMOUNTINCLUDINGTAX", MySqlDbType.Decimal).Value = row("AMOUNTINCLUDINGTAX")
            End With
            sqlOrderCmd.CommandTimeout = 300
            sqlOrderCmd.ExecuteNonQuery()
        End Using

    End Sub
#End Region

End Class
